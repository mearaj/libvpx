This SDK includes a number of sample applications. Each sample documents a feature of the SDK in both prose and the associated C code. The following samples are included\+:
\begin{DoxyItemize}
\item \mbox{\hyperlink{example_decode_to_md5}{decode\+\_\+to\+\_\+md5}} Frame by frame MD5 checksum
\item \mbox{\hyperlink{example_decode_with_drops}{decode\+\_\+with\+\_\+drops}} Drops frames while decoding
\item \mbox{\hyperlink{example_postproc}{postproc}} Decoder postprocessor control
\item \mbox{\hyperlink{example_resize_util}{resize\+\_\+util}}
\item \mbox{\hyperlink{example_set_maps}{set\+\_\+maps}} Set active and ROI maps
\item \mbox{\hyperlink{example_simple_decoder}{simple\+\_\+decoder}} Simplified decoder loop
\item \mbox{\hyperlink{example_simple_encoder}{simple\+\_\+encoder}} Simplified encoder loop
\item \mbox{\hyperlink{example_twopass_encoder}{twopass\+\_\+encoder}} Two-\/pass encoder loop
\item \mbox{\hyperlink{example_vp8cx_set_ref}{vp8cx\+\_\+set\+\_\+ref}} VP8 set encoder reference frame
\item \mbox{\hyperlink{example_vp9_lossless_encoder}{vp9\+\_\+lossless\+\_\+encoder}} Simplified lossless VP9 encoder
\item \mbox{\hyperlink{example_vp9_spatial_svc_encoder}{vp9\+\_\+spatial\+\_\+svc\+\_\+encoder}} VP9 Spatial SVC Encoder
\item \mbox{\hyperlink{example_vp9cx_set_ref}{vp9cx\+\_\+set\+\_\+ref}} VP9 set encoder reference frame
\item \mbox{\hyperlink{example_vpx_temporal_svc_encoder}{vpx\+\_\+temporal\+\_\+svc\+\_\+encoder}} Temporal SVC Encoder
\end{DoxyItemize}

In addition, the SDK contains a number of utilities. Since these utilities are built upon the concepts described in the sample code listed above, they are not documented in pieces like the samples are. Their source is included here for reference. The following utilities are included\+:
\begin{DoxyItemize}
\item \mbox{\hyperlink{example_vpxdec}{vpxdec}} Full featured decoder
\item \mbox{\hyperlink{example_vpxenc}{vpxenc}} Full featured encoder 
\end{DoxyItemize}\hypertarget{example_decode_to_md5}{}\doxysubsection{decode\+\_\+to\+\_\+md5}\label{example_decode_to_md5}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// Frame-\/by-\/frame MD5 Checksum}}
\DoxyCodeLine{12 \textcolor{comment}{// ===========================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This example builds upon the simple decoder loop to show how checksums}}
\DoxyCodeLine{15 \textcolor{comment}{// of the decoded output can be generated. These are used for validating}}
\DoxyCodeLine{16 \textcolor{comment}{// decoder implementations against the reference implementation, for example.}}
\DoxyCodeLine{17 \textcolor{comment}{//}}
\DoxyCodeLine{18 \textcolor{comment}{// MD5 algorithm}}
\DoxyCodeLine{19 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{20 \textcolor{comment}{// The Message-\/Digest 5 (MD5) is a well known hash function. We have provided}}
\DoxyCodeLine{21 \textcolor{comment}{// an implementation derived from the RSA Data Security, Inc. MD5 Message-\/Digest}}
\DoxyCodeLine{22 \textcolor{comment}{// Algorithm for your use. Our implmentation only changes the interface of this}}
\DoxyCodeLine{23 \textcolor{comment}{// reference code. You must include the `md5\_utils.h` header for access to these}}
\DoxyCodeLine{24 \textcolor{comment}{// functions.}}
\DoxyCodeLine{25 \textcolor{comment}{//}}
\DoxyCodeLine{26 \textcolor{comment}{// Processing The Decoded Data}}
\DoxyCodeLine{27 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{28 \textcolor{comment}{// Each row of the image is passed to the MD5 accumulator. First the Y plane}}
\DoxyCodeLine{29 \textcolor{comment}{// is processed, then U, then V. It is important to honor the image's `stride`}}
\DoxyCodeLine{30 \textcolor{comment}{// values.}}
\DoxyCodeLine{31 }
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8dx_8h}{vpx/vp8dx.h}}"{}}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}../md5\_utils.h"{}}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#include "{}../video\_reader.h"{}}}
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{keyword}{static} \textcolor{keywordtype}{void} get\_image\_md5(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} digest[16]) \{}
\DoxyCodeLine{45   \textcolor{keywordtype}{int} plane, y;}
\DoxyCodeLine{46   MD5Context md5;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   MD5Init(\&md5);}
\DoxyCodeLine{49 }
\DoxyCodeLine{50   \textcolor{keywordflow}{for} (plane = 0; plane < 3; ++plane) \{}
\DoxyCodeLine{51     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *buf = img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[plane];}
\DoxyCodeLine{52     \textcolor{keyword}{const} \textcolor{keywordtype}{int} stride = img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[plane];}
\DoxyCodeLine{53     \textcolor{keyword}{const} \textcolor{keywordtype}{int} w = plane ? (img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} + 1) >> 1 : img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}};}
\DoxyCodeLine{54     \textcolor{keyword}{const} \textcolor{keywordtype}{int} h = plane ? (img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}} + 1) >> 1 : img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \textcolor{keywordflow}{for} (y = 0; y < h; ++y) \{}
\DoxyCodeLine{57       MD5Update(\&md5, buf, w);}
\DoxyCodeLine{58       buf += stride;}
\DoxyCodeLine{59     \}}
\DoxyCodeLine{60   \}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62   MD5Final(digest, \&md5);}
\DoxyCodeLine{63 \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{keyword}{static} \textcolor{keywordtype}{void} print\_md5(FILE *stream, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} digest[16]) \{}
\DoxyCodeLine{66   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{keywordflow}{for} (i = 0; i < 16; ++i) fprintf(stream, \textcolor{stringliteral}{"{}\%02x"{}}, digest[i]);}
\DoxyCodeLine{69 \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{74   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <infile> <outfile>\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{75   exit(EXIT\_FAILURE);}
\DoxyCodeLine{76 \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{79   \textcolor{keywordtype}{int} frame\_cnt = 0;}
\DoxyCodeLine{80   FILE *outfile = NULL;}
\DoxyCodeLine{81   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{82   VpxVideoReader *reader = NULL;}
\DoxyCodeLine{83   \textcolor{keyword}{const} VpxVideoInfo *info = NULL;}
\DoxyCodeLine{84   \textcolor{keyword}{const} VpxInterface *decoder = NULL;}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   exec\_name = argv[0];}
\DoxyCodeLine{87 }
\DoxyCodeLine{88   \textcolor{keywordflow}{if} (argc != 3) die(\textcolor{stringliteral}{"{}Invalid number of arguments."{}});}
\DoxyCodeLine{89 }
\DoxyCodeLine{90   reader = vpx\_video\_reader\_open(argv[1]);}
\DoxyCodeLine{91   \textcolor{keywordflow}{if} (!reader) die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[1]);}
\DoxyCodeLine{92 }
\DoxyCodeLine{93   \textcolor{keywordflow}{if} (!(outfile = fopen(argv[2], \textcolor{stringliteral}{"{}wb"{}})))}
\DoxyCodeLine{94     die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, argv[2]);}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   info = vpx\_video\_reader\_get\_info(reader);}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   decoder = get\_vpx\_decoder\_by\_fourcc(info-\/>codec\_fourcc);}
\DoxyCodeLine{99   \textcolor{keywordflow}{if} (!decoder) die(\textcolor{stringliteral}{"{}Unknown input codec."{}});}
\DoxyCodeLine{100 }
\DoxyCodeLine{101   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(decoder-\/>codec\_interface()));}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&codec, decoder-\/>codec\_interface(), NULL, 0))}
\DoxyCodeLine{104     die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to initialize decoder"{}});}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{keywordflow}{while} (vpx\_video\_reader\_read\_frame(reader)) \{}
\DoxyCodeLine{107     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{108     \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img = NULL;}
\DoxyCodeLine{109     \textcolor{keywordtype}{size\_t} frame\_size = 0;}
\DoxyCodeLine{110     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *frame =}
\DoxyCodeLine{111         vpx\_video\_reader\_get\_frame(reader, \&frame\_size);}
\DoxyCodeLine{112     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&codec, frame, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})frame\_size, NULL, 0))}
\DoxyCodeLine{113       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to decode frame"{}});}
\DoxyCodeLine{114 }
\DoxyCodeLine{115     \textcolor{keywordflow}{while} ((img = \mbox{\hyperlink{group__decoder_gac23542417b964c7f7cd6767e72775b54}{vpx\_codec\_get\_frame}}(\&codec, \&iter)) != NULL) \{}
\DoxyCodeLine{116       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} digest[16];}
\DoxyCodeLine{117 }
\DoxyCodeLine{118       get\_image\_md5(img, digest);}
\DoxyCodeLine{119       print\_md5(outfile, digest);}
\DoxyCodeLine{120       fprintf(outfile, \textcolor{stringliteral}{"{}  img-\/\%dx\%d-\/\%04d.i420\(\backslash\)n"{}}, img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}},}
\DoxyCodeLine{121               ++frame\_cnt);}
\DoxyCodeLine{122     \}}
\DoxyCodeLine{123   \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_cnt);}
\DoxyCodeLine{126   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{127 }
\DoxyCodeLine{128   vpx\_video\_reader\_close(reader);}
\DoxyCodeLine{129 }
\DoxyCodeLine{130   fclose(outfile);}
\DoxyCodeLine{131   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{132 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_decode_with_drops}{}\doxysubsection{decode\+\_\+with\+\_\+drops}\label{example_decode_with_drops}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// Decode With Drops Example}}
\DoxyCodeLine{12 \textcolor{comment}{// =========================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example utility which drops a series of frames, as specified}}
\DoxyCodeLine{15 \textcolor{comment}{// on the command line. This is useful for observing the error recovery}}
\DoxyCodeLine{16 \textcolor{comment}{// features of the codec.}}
\DoxyCodeLine{17 \textcolor{comment}{//}}
\DoxyCodeLine{18 \textcolor{comment}{// Usage}}
\DoxyCodeLine{19 \textcolor{comment}{// -\/-\/-\/-\/-\/}}
\DoxyCodeLine{20 \textcolor{comment}{// This example adds a single argument to the `simple\_decoder` example,}}
\DoxyCodeLine{21 \textcolor{comment}{// which specifies the range or pattern of frames to drop. The parameter is}}
\DoxyCodeLine{22 \textcolor{comment}{// parsed as follows:}}
\DoxyCodeLine{23 \textcolor{comment}{//}}
\DoxyCodeLine{24 \textcolor{comment}{// Dropping A Range Of Frames}}
\DoxyCodeLine{25 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{26 \textcolor{comment}{// To drop a range of frames, specify the starting frame and the ending}}
\DoxyCodeLine{27 \textcolor{comment}{// frame to drop, separated by a dash. The following command will drop}}
\DoxyCodeLine{28 \textcolor{comment}{// frames 5 through 10 (base 1).}}
\DoxyCodeLine{29 \textcolor{comment}{//}}
\DoxyCodeLine{30 \textcolor{comment}{//  \$ ./decode\_with\_drops in.ivf out.i420 5-\/10}}
\DoxyCodeLine{31 \textcolor{comment}{//}}
\DoxyCodeLine{32 \textcolor{comment}{//}}
\DoxyCodeLine{33 \textcolor{comment}{// Dropping A Pattern Of Frames}}
\DoxyCodeLine{34 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{35 \textcolor{comment}{// To drop a pattern of frames, specify the number of frames to drop and}}
\DoxyCodeLine{36 \textcolor{comment}{// the number of frames after which to repeat the pattern, separated by}}
\DoxyCodeLine{37 \textcolor{comment}{// a forward-\/slash. The following command will drop 3 of 7 frames.}}
\DoxyCodeLine{38 \textcolor{comment}{// Specifically, it will decode 4 frames, then drop 3 frames, and then}}
\DoxyCodeLine{39 \textcolor{comment}{// repeat.}}
\DoxyCodeLine{40 \textcolor{comment}{//}}
\DoxyCodeLine{41 \textcolor{comment}{//  \$ ./decode\_with\_drops in.ivf out.i420 3/7}}
\DoxyCodeLine{42 \textcolor{comment}{//}}
\DoxyCodeLine{43 \textcolor{comment}{//}}
\DoxyCodeLine{44 \textcolor{comment}{// Extra Variables}}
\DoxyCodeLine{45 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{46 \textcolor{comment}{// This example maintains the pattern passed on the command line in the}}
\DoxyCodeLine{47 \textcolor{comment}{// `n`, `m`, and `is\_range` variables:}}
\DoxyCodeLine{48 \textcolor{comment}{//}}
\DoxyCodeLine{49 \textcolor{comment}{//}}
\DoxyCodeLine{50 \textcolor{comment}{// Making The Drop Decision}}
\DoxyCodeLine{51 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{52 \textcolor{comment}{// The example decides whether to drop the frame based on the current}}
\DoxyCodeLine{53 \textcolor{comment}{// frame number, immediately before decoding the frame.}}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{56 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8dx_8h}{vpx/vp8dx.h}}"{}}}
\DoxyCodeLine{60 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{63 \textcolor{preprocessor}{\#include "{}../video\_reader.h"{}}}
\DoxyCodeLine{64 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{69   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <infile> <outfile> <N-\/M|N/M>\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{70   exit(EXIT\_FAILURE);}
\DoxyCodeLine{71 \}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{74   \textcolor{keywordtype}{int} frame\_cnt = 0;}
\DoxyCodeLine{75   FILE *outfile = NULL;}
\DoxyCodeLine{76   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{77   \textcolor{keyword}{const} VpxInterface *decoder = NULL;}
\DoxyCodeLine{78   VpxVideoReader *reader = NULL;}
\DoxyCodeLine{79   \textcolor{keyword}{const} VpxVideoInfo *info = NULL;}
\DoxyCodeLine{80   \textcolor{keywordtype}{int} n = 0;}
\DoxyCodeLine{81   \textcolor{keywordtype}{int} m = 0;}
\DoxyCodeLine{82   \textcolor{keywordtype}{int} is\_range = 0;}
\DoxyCodeLine{83   \textcolor{keywordtype}{char} *nptr = NULL;}
\DoxyCodeLine{84 }
\DoxyCodeLine{85   exec\_name = argv[0];}
\DoxyCodeLine{86 }
\DoxyCodeLine{87   \textcolor{keywordflow}{if} (argc != 4) die(\textcolor{stringliteral}{"{}Invalid number of arguments."{}});}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   reader = vpx\_video\_reader\_open(argv[1]);}
\DoxyCodeLine{90   \textcolor{keywordflow}{if} (!reader) die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[1]);}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{keywordflow}{if} (!(outfile = fopen(argv[2], \textcolor{stringliteral}{"{}wb"{}})))}
\DoxyCodeLine{93     die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, argv[2]);}
\DoxyCodeLine{94 }
\DoxyCodeLine{95   n = (int)strtol(argv[3], \&nptr, 0);}
\DoxyCodeLine{96   m = (int)strtol(nptr + 1, NULL, 0);}
\DoxyCodeLine{97   is\_range = (*nptr == \textcolor{charliteral}{'-\/'});}
\DoxyCodeLine{98   \textcolor{keywordflow}{if} (!n || !m || (*nptr != \textcolor{charliteral}{'-\/'} \&\& *nptr != \textcolor{charliteral}{'/'}))}
\DoxyCodeLine{99     die(\textcolor{stringliteral}{"{}Couldn't parse pattern \%s.\(\backslash\)n"{}}, argv[3]);}
\DoxyCodeLine{100 }
\DoxyCodeLine{101   info = vpx\_video\_reader\_get\_info(reader);}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   decoder = get\_vpx\_decoder\_by\_fourcc(info-\/>codec\_fourcc);}
\DoxyCodeLine{104   \textcolor{keywordflow}{if} (!decoder) die(\textcolor{stringliteral}{"{}Unknown input codec."{}});}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(decoder-\/>codec\_interface()));}
\DoxyCodeLine{107 }
\DoxyCodeLine{108   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&codec, decoder-\/>codec\_interface(), NULL, 0))}
\DoxyCodeLine{109     die(\textcolor{stringliteral}{"{}Failed to initialize decoder."{}});}
\DoxyCodeLine{110 }
\DoxyCodeLine{111   \textcolor{keywordflow}{while} (vpx\_video\_reader\_read\_frame(reader)) \{}
\DoxyCodeLine{112     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{113     \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img = NULL;}
\DoxyCodeLine{114     \textcolor{keywordtype}{size\_t} frame\_size = 0;}
\DoxyCodeLine{115     \textcolor{keywordtype}{int} skip;}
\DoxyCodeLine{116     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *frame =}
\DoxyCodeLine{117         vpx\_video\_reader\_get\_frame(reader, \&frame\_size);}
\DoxyCodeLine{118     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&codec, frame, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})frame\_size, NULL, 0))}
\DoxyCodeLine{119       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to decode frame."{}});}
\DoxyCodeLine{120 }
\DoxyCodeLine{121     ++frame\_cnt;}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     skip = (is\_range \&\& frame\_cnt >= n \&\& frame\_cnt <= m) ||}
\DoxyCodeLine{124            (!is\_range \&\& m -\/ (frame\_cnt -\/ 1) \% m <= n);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     \textcolor{keywordflow}{if} (!skip) \{}
\DoxyCodeLine{127       putc(\textcolor{charliteral}{'.'}, stdout);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129       \textcolor{keywordflow}{while} ((img = \mbox{\hyperlink{group__decoder_gac23542417b964c7f7cd6767e72775b54}{vpx\_codec\_get\_frame}}(\&codec, \&iter)) != NULL)}
\DoxyCodeLine{130         vpx\_img\_write(img, outfile);}
\DoxyCodeLine{131     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{132       putc(\textcolor{charliteral}{'X'}, stdout);}
\DoxyCodeLine{133     \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135     fflush(stdout);}
\DoxyCodeLine{136   \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_cnt);}
\DoxyCodeLine{139   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{140 }
\DoxyCodeLine{141   printf(\textcolor{stringliteral}{"{}Play: ffplay -\/f rawvideo -\/pix\_fmt yuv420p -\/s \%dx\%d \%s\(\backslash\)n"{}},}
\DoxyCodeLine{142          info-\/>frame\_width, info-\/>frame\_height, argv[2]);}
\DoxyCodeLine{143 }
\DoxyCodeLine{144   vpx\_video\_reader\_close(reader);}
\DoxyCodeLine{145   fclose(outfile);}
\DoxyCodeLine{146 }
\DoxyCodeLine{147   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{148 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_postproc}{}\doxysubsection{postproc}\label{example_postproc}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// Postprocessing Decoder}}
\DoxyCodeLine{12 \textcolor{comment}{// ======================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This example adds postprocessing to the simple decoder loop.}}
\DoxyCodeLine{15 \textcolor{comment}{//}}
\DoxyCodeLine{16 \textcolor{comment}{// Initializing Postprocessing}}
\DoxyCodeLine{17 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{18 \textcolor{comment}{// You must inform the codec that you might request postprocessing at}}
\DoxyCodeLine{19 \textcolor{comment}{// initialization time. This is done by passing the VPX\_CODEC\_USE\_POSTPROC}}
\DoxyCodeLine{20 \textcolor{comment}{// flag to `vpx\_codec\_dec\_init`. If the codec does not support}}
\DoxyCodeLine{21 \textcolor{comment}{// postprocessing, this call will return VPX\_CODEC\_INCAPABLE. For}}
\DoxyCodeLine{22 \textcolor{comment}{// demonstration purposes, we also fall back to default initialization if}}
\DoxyCodeLine{23 \textcolor{comment}{// the codec does not provide support.}}
\DoxyCodeLine{24 \textcolor{comment}{//}}
\DoxyCodeLine{25 \textcolor{comment}{// Using Adaptive Postprocessing}}
\DoxyCodeLine{26 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{27 \textcolor{comment}{// VP6 provides "{}adaptive postprocessing."{} It will automatically select the}}
\DoxyCodeLine{28 \textcolor{comment}{// best postprocessing filter on a frame by frame basis based on the amount}}
\DoxyCodeLine{29 \textcolor{comment}{// of time remaining before the user's specified deadline expires. The}}
\DoxyCodeLine{30 \textcolor{comment}{// special value 0 indicates that the codec should take as long as}}
\DoxyCodeLine{31 \textcolor{comment}{// necessary to provide the best quality frame. This example gives the}}
\DoxyCodeLine{32 \textcolor{comment}{// codec 15ms (15000us) to return a frame. Remember that this is a soft}}
\DoxyCodeLine{33 \textcolor{comment}{// deadline, and the codec may exceed it doing its regular processing. In}}
\DoxyCodeLine{34 \textcolor{comment}{// these cases, no additional postprocessing will be done.}}
\DoxyCodeLine{35 \textcolor{comment}{//}}
\DoxyCodeLine{36 \textcolor{comment}{// Codec Specific Postprocessing Controls}}
\DoxyCodeLine{37 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{38 \textcolor{comment}{// Some codecs provide fine grained controls over their built-\/in}}
\DoxyCodeLine{39 \textcolor{comment}{// postprocessors. VP8 is one example. The following sample code toggles}}
\DoxyCodeLine{40 \textcolor{comment}{// postprocessing on and off every 15 frames.}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8dx_8h}{vpx/vp8dx.h}}"{}}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#include "{}../video\_reader.h"{}}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{56   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <infile> <outfile>\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{57   exit(EXIT\_FAILURE);}
\DoxyCodeLine{58 \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{61   \textcolor{keywordtype}{int} frame\_cnt = 0;}
\DoxyCodeLine{62   FILE *outfile = NULL;}
\DoxyCodeLine{63   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{64   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{65   VpxVideoReader *reader = NULL;}
\DoxyCodeLine{66   \textcolor{keyword}{const} VpxInterface *decoder = NULL;}
\DoxyCodeLine{67   \textcolor{keyword}{const} VpxVideoInfo *info = NULL;}
\DoxyCodeLine{68 }
\DoxyCodeLine{69   exec\_name = argv[0];}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   \textcolor{keywordflow}{if} (argc != 3) die(\textcolor{stringliteral}{"{}Invalid number of arguments."{}});}
\DoxyCodeLine{72 }
\DoxyCodeLine{73   reader = vpx\_video\_reader\_open(argv[1]);}
\DoxyCodeLine{74   \textcolor{keywordflow}{if} (!reader) die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[1]);}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{keywordflow}{if} (!(outfile = fopen(argv[2], \textcolor{stringliteral}{"{}wb"{}})))}
\DoxyCodeLine{77     die(\textcolor{stringliteral}{"{}Failed to open \%s for writing"{}}, argv[2]);}
\DoxyCodeLine{78 }
\DoxyCodeLine{79   info = vpx\_video\_reader\_get\_info(reader);}
\DoxyCodeLine{80 }
\DoxyCodeLine{81   decoder = get\_vpx\_decoder\_by\_fourcc(info-\/>codec\_fourcc);}
\DoxyCodeLine{82   \textcolor{keywordflow}{if} (!decoder) die(\textcolor{stringliteral}{"{}Unknown input codec."{}});}
\DoxyCodeLine{83 }
\DoxyCodeLine{84   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(decoder-\/>codec\_interface()));}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   res = \mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&codec, decoder-\/>codec\_interface(), NULL,}
\DoxyCodeLine{87                            \mbox{\hyperlink{group__decoder_ga6fe14f30254aff769412b128b29664cc}{VPX\_CODEC\_USE\_POSTPROC}});}
\DoxyCodeLine{88   \textcolor{keywordflow}{if} (res == \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2a4470784ba5a3ef84dc0697d5489dd292}{VPX\_CODEC\_INCAPABLE}})}
\DoxyCodeLine{89     die(\textcolor{stringliteral}{"{}Postproc not supported by this decoder."{}});}
\DoxyCodeLine{90 }
\DoxyCodeLine{91   \textcolor{keywordflow}{if} (res) die(\textcolor{stringliteral}{"{}Failed to initialize decoder."{}});}
\DoxyCodeLine{92 }
\DoxyCodeLine{93   \textcolor{keywordflow}{while} (vpx\_video\_reader\_read\_frame(reader)) \{}
\DoxyCodeLine{94     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{95     \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img = NULL;}
\DoxyCodeLine{96     \textcolor{keywordtype}{size\_t} frame\_size = 0;}
\DoxyCodeLine{97     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *frame =}
\DoxyCodeLine{98         vpx\_video\_reader\_get\_frame(reader, \&frame\_size);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     ++frame\_cnt;}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{keywordflow}{if} (frame\_cnt \% 30 == 1) \{}
\DoxyCodeLine{103       \mbox{\hyperlink{structvp8__postproc__cfg}{vp8\_postproc\_cfg\_t}} pp = \{ 0, 0, 0 \};}
\DoxyCodeLine{104 }
\DoxyCodeLine{105       \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a43e85c68bc1c1473f4a94b005a59482c}{VP8\_SET\_POSTPROC}}, \&pp))}
\DoxyCodeLine{106         die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to turn off postproc."{}});}
\DoxyCodeLine{107     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (frame\_cnt \% 30 == 16) \{}
\DoxyCodeLine{108       \mbox{\hyperlink{structvp8__postproc__cfg}{vp8\_postproc\_cfg\_t}} pp = \{ VP8\_DEBLOCK | VP8\_DEMACROBLOCK | VP8\_MFQE, 4,}
\DoxyCodeLine{109                                 0 \};}
\DoxyCodeLine{110       \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a43e85c68bc1c1473f4a94b005a59482c}{VP8\_SET\_POSTPROC}}, \&pp))}
\DoxyCodeLine{111         die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to turn on postproc."{}});}
\DoxyCodeLine{112     \}}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \textcolor{comment}{// Decode the frame with 15ms deadline}}
\DoxyCodeLine{115     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&codec, frame, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})frame\_size, NULL, 15000))}
\DoxyCodeLine{116       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to decode frame"{}});}
\DoxyCodeLine{117 }
\DoxyCodeLine{118     \textcolor{keywordflow}{while} ((img = \mbox{\hyperlink{group__decoder_gac23542417b964c7f7cd6767e72775b54}{vpx\_codec\_get\_frame}}(\&codec, \&iter)) != NULL) \{}
\DoxyCodeLine{119       vpx\_img\_write(img, outfile);}
\DoxyCodeLine{120     \}}
\DoxyCodeLine{121   \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_cnt);}
\DoxyCodeLine{124   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec"{}});}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   printf(\textcolor{stringliteral}{"{}Play: ffplay -\/f rawvideo -\/pix\_fmt yuv420p -\/s \%dx\%d \%s\(\backslash\)n"{}},}
\DoxyCodeLine{127          info-\/>frame\_width, info-\/>frame\_height, argv[2]);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   vpx\_video\_reader\_close(reader);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131   fclose(outfile);}
\DoxyCodeLine{132   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{133 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_resize_util}{}\doxysubsection{resize\+\_\+util}\label{example_resize_util}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2014 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <limits.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include "{}../vp9/encoder/vp9\_resize.h"{}}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name = NULL;}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{static} \textcolor{keywordtype}{void} usage() \{}
\DoxyCodeLine{24   printf(\textcolor{stringliteral}{"{}Usage:\(\backslash\)n"{}});}
\DoxyCodeLine{25   printf(\textcolor{stringliteral}{"{}\%s <input\_yuv> <width>x<height> <target\_width>x<target\_height> "{}},}
\DoxyCodeLine{26          exec\_name);}
\DoxyCodeLine{27   printf(\textcolor{stringliteral}{"{}<output\_yuv> [<frames>]\(\backslash\)n"{}});}
\DoxyCodeLine{28 \}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{31   usage();}
\DoxyCodeLine{32   exit(EXIT\_FAILURE);}
\DoxyCodeLine{33 \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{static} \textcolor{keywordtype}{int} parse\_dim(\textcolor{keywordtype}{char} *v, \textcolor{keywordtype}{int} *width, \textcolor{keywordtype}{int} *height) \{}
\DoxyCodeLine{36   \textcolor{keywordtype}{char} *x = strchr(v, \textcolor{charliteral}{'x'});}
\DoxyCodeLine{37   \textcolor{keywordflow}{if} (x == NULL) x = strchr(v, \textcolor{charliteral}{'X'});}
\DoxyCodeLine{38   \textcolor{keywordflow}{if} (x == NULL) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{39   *width = atoi(v);}
\DoxyCodeLine{40   *height = atoi(\&x[1]);}
\DoxyCodeLine{41   \textcolor{keywordflow}{if} (*width <= 0 || *height <= 0)}
\DoxyCodeLine{42     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{43   \textcolor{keywordflow}{else}}
\DoxyCodeLine{44     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{45 \}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[]) \{}
\DoxyCodeLine{48   \textcolor{keywordtype}{char} *fin, *fout;}
\DoxyCodeLine{49   FILE *fpin, *fpout;}
\DoxyCodeLine{50   uint8\_t *inbuf, *outbuf;}
\DoxyCodeLine{51   uint8\_t *inbuf\_u, *outbuf\_u;}
\DoxyCodeLine{52   uint8\_t *inbuf\_v, *outbuf\_v;}
\DoxyCodeLine{53   \textcolor{keywordtype}{int} f, frames;}
\DoxyCodeLine{54   \textcolor{keywordtype}{int} width, height, target\_width, target\_height;}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   exec\_name = argv[0];}
\DoxyCodeLine{57 }
\DoxyCodeLine{58   \textcolor{keywordflow}{if} (argc < 5) \{}
\DoxyCodeLine{59     printf(\textcolor{stringliteral}{"{}Incorrect parameters:\(\backslash\)n"{}});}
\DoxyCodeLine{60     usage();}
\DoxyCodeLine{61     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{62   \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64   fin = argv[1];}
\DoxyCodeLine{65   fout = argv[4];}
\DoxyCodeLine{66   \textcolor{keywordflow}{if} (!parse\_dim(argv[2], \&width, \&height)) \{}
\DoxyCodeLine{67     printf(\textcolor{stringliteral}{"{}Incorrect parameters: \%s\(\backslash\)n"{}}, argv[2]);}
\DoxyCodeLine{68     usage();}
\DoxyCodeLine{69     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{70   \}}
\DoxyCodeLine{71   \textcolor{keywordflow}{if} (!parse\_dim(argv[3], \&target\_width, \&target\_height)) \{}
\DoxyCodeLine{72     printf(\textcolor{stringliteral}{"{}Incorrect parameters: \%s\(\backslash\)n"{}}, argv[3]);}
\DoxyCodeLine{73     usage();}
\DoxyCodeLine{74     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{75   \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77   fpin = fopen(fin, \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{78   \textcolor{keywordflow}{if} (fpin == NULL) \{}
\DoxyCodeLine{79     printf(\textcolor{stringliteral}{"{}Can't open file \%s to read\(\backslash\)n"{}}, fin);}
\DoxyCodeLine{80     usage();}
\DoxyCodeLine{81     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{82   \}}
\DoxyCodeLine{83   fpout = fopen(fout, \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{84   \textcolor{keywordflow}{if} (fpout == NULL) \{}
\DoxyCodeLine{85     printf(\textcolor{stringliteral}{"{}Can't open file \%s to write\(\backslash\)n"{}}, fout);}
\DoxyCodeLine{86     usage();}
\DoxyCodeLine{87     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{88   \}}
\DoxyCodeLine{89   \textcolor{keywordflow}{if} (argc >= 6)}
\DoxyCodeLine{90     frames = atoi(argv[5]);}
\DoxyCodeLine{91   \textcolor{keywordflow}{else}}
\DoxyCodeLine{92     frames = INT\_MAX;}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   printf(\textcolor{stringliteral}{"{}Input size:  \%dx\%d\(\backslash\)n"{}}, width, height);}
\DoxyCodeLine{95   printf(\textcolor{stringliteral}{"{}Target size: \%dx\%d, Frames: "{}}, target\_width, target\_height);}
\DoxyCodeLine{96   \textcolor{keywordflow}{if} (frames == INT\_MAX)}
\DoxyCodeLine{97     printf(\textcolor{stringliteral}{"{}All\(\backslash\)n"{}});}
\DoxyCodeLine{98   \textcolor{keywordflow}{else}}
\DoxyCodeLine{99     printf(\textcolor{stringliteral}{"{}\%d\(\backslash\)n"{}}, frames);}
\DoxyCodeLine{100 }
\DoxyCodeLine{101   inbuf = (uint8\_t *)malloc(width * height * 3 / 2);}
\DoxyCodeLine{102   outbuf = (uint8\_t *)malloc(target\_width * target\_height * 3 / 2);}
\DoxyCodeLine{103   inbuf\_u = inbuf + width * height;}
\DoxyCodeLine{104   inbuf\_v = inbuf\_u + width * height / 4;}
\DoxyCodeLine{105   outbuf\_u = outbuf + target\_width * target\_height;}
\DoxyCodeLine{106   outbuf\_v = outbuf\_u + target\_width * target\_height / 4;}
\DoxyCodeLine{107   f = 0;}
\DoxyCodeLine{108   \textcolor{keywordflow}{while} (f < frames) \{}
\DoxyCodeLine{109     \textcolor{keywordflow}{if} (fread(inbuf, width * height * 3 / 2, 1, fpin) != 1) \textcolor{keywordflow}{break};}
\DoxyCodeLine{110     vp9\_resize\_frame420(inbuf, width, inbuf\_u, inbuf\_v, width / 2, height,}
\DoxyCodeLine{111                         width, outbuf, target\_width, outbuf\_u, outbuf\_v,}
\DoxyCodeLine{112                         target\_width / 2, target\_height, target\_width);}
\DoxyCodeLine{113     fwrite(outbuf, target\_width * target\_height * 3 / 2, 1, fpout);}
\DoxyCodeLine{114     f++;}
\DoxyCodeLine{115   \}}
\DoxyCodeLine{116   printf(\textcolor{stringliteral}{"{}\%d frames processed\(\backslash\)n"{}}, f);}
\DoxyCodeLine{117   fclose(fpin);}
\DoxyCodeLine{118   fclose(fpout);}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   free(inbuf);}
\DoxyCodeLine{121   free(outbuf);}
\DoxyCodeLine{122   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{123 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_set_maps}{}\doxysubsection{set\+\_\+maps}\label{example_set_maps}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// VP8 Set Active and ROI Maps}}
\DoxyCodeLine{12 \textcolor{comment}{// ===========================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example demonstrating how to control the VP8 encoder's}}
\DoxyCodeLine{15 \textcolor{comment}{// ROI and Active maps.}}
\DoxyCodeLine{16 \textcolor{comment}{//}}
\DoxyCodeLine{17 \textcolor{comment}{// ROI (Reigon of Interest) maps are a way for the application to assign}}
\DoxyCodeLine{18 \textcolor{comment}{// each macroblock in the image to a region, and then set quantizer and}}
\DoxyCodeLine{19 \textcolor{comment}{// filtering parameters on that image.}}
\DoxyCodeLine{20 \textcolor{comment}{//}}
\DoxyCodeLine{21 \textcolor{comment}{// Active maps are a way for the application to specify on a}}
\DoxyCodeLine{22 \textcolor{comment}{// macroblock-\/by-\/macroblock basis whether there is any activity in that}}
\DoxyCodeLine{23 \textcolor{comment}{// macroblock.}}
\DoxyCodeLine{24 \textcolor{comment}{//}}
\DoxyCodeLine{25 \textcolor{comment}{//}}
\DoxyCodeLine{26 \textcolor{comment}{// Configuration}}
\DoxyCodeLine{27 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{28 \textcolor{comment}{// An ROI map is set on frame 22. If the width of the image in macroblocks}}
\DoxyCodeLine{29 \textcolor{comment}{// is evenly divisble by 4, then the output will appear to have distinct}}
\DoxyCodeLine{30 \textcolor{comment}{// columns, where the quantizer, loopfilter, and static threshold differ}}
\DoxyCodeLine{31 \textcolor{comment}{// from column to column.}}
\DoxyCodeLine{32 \textcolor{comment}{//}}
\DoxyCodeLine{33 \textcolor{comment}{// An active map is set on frame 33. If the width of the image in macroblocks}}
\DoxyCodeLine{34 \textcolor{comment}{// is evenly divisble by 4, then the output will appear to have distinct}}
\DoxyCodeLine{35 \textcolor{comment}{// columns, where one column will have motion and the next will not.}}
\DoxyCodeLine{36 \textcolor{comment}{//}}
\DoxyCodeLine{37 \textcolor{comment}{// The active map is cleared on frame 44.}}
\DoxyCodeLine{38 \textcolor{comment}{//}}
\DoxyCodeLine{39 \textcolor{comment}{// Observing The Effects}}
\DoxyCodeLine{40 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{41 \textcolor{comment}{// Use the `simple\_decoder` example to decode this sample, and observe}}
\DoxyCodeLine{42 \textcolor{comment}{// the change in the image at frames 22, 33, and 44.}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{46 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{53 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{58   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <codec> <width> <height> <infile> <outfile>\(\backslash\)n"{}},}
\DoxyCodeLine{59           exec\_name);}
\DoxyCodeLine{60   exit(EXIT\_FAILURE);}
\DoxyCodeLine{61 \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_roi\_map(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{64                         \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec) \{}
\DoxyCodeLine{65   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{66   \mbox{\hyperlink{structvpx__roi__map}{vpx\_roi\_map\_t}} roi;}
\DoxyCodeLine{67   memset(\&roi, 0, \textcolor{keyword}{sizeof}(roi));}
\DoxyCodeLine{68 }
\DoxyCodeLine{69   roi.\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} + 15) / 16;}
\DoxyCodeLine{70   roi.\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} + 15) / 16;}
\DoxyCodeLine{71 }
\DoxyCodeLine{72   roi.\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}}[0] = 0;}
\DoxyCodeLine{73   roi.\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}}[1] = -\/2;}
\DoxyCodeLine{74   roi.\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}}[2] = -\/4;}
\DoxyCodeLine{75   roi.\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}}[3] = -\/6;}
\DoxyCodeLine{76 }
\DoxyCodeLine{77   roi.\mbox{\hyperlink{structvpx__roi__map_aca3e926d9612ac6530092f7cfb0dc34c}{delta\_lf}}[0] = 0;}
\DoxyCodeLine{78   roi.\mbox{\hyperlink{structvpx__roi__map_aca3e926d9612ac6530092f7cfb0dc34c}{delta\_lf}}[1] = 1;}
\DoxyCodeLine{79   roi.\mbox{\hyperlink{structvpx__roi__map_aca3e926d9612ac6530092f7cfb0dc34c}{delta\_lf}}[2] = 2;}
\DoxyCodeLine{80   roi.\mbox{\hyperlink{structvpx__roi__map_aca3e926d9612ac6530092f7cfb0dc34c}{delta\_lf}}[3] = 3;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   roi.\mbox{\hyperlink{structvpx__roi__map_a3354ff458e229361b53a0b2d1bf68cfb}{static\_threshold}}[0] = 1500;}
\DoxyCodeLine{83   roi.\mbox{\hyperlink{structvpx__roi__map_a3354ff458e229361b53a0b2d1bf68cfb}{static\_threshold}}[1] = 1000;}
\DoxyCodeLine{84   roi.\mbox{\hyperlink{structvpx__roi__map_a3354ff458e229361b53a0b2d1bf68cfb}{static\_threshold}}[2] = 500;}
\DoxyCodeLine{85   roi.\mbox{\hyperlink{structvpx__roi__map_a3354ff458e229361b53a0b2d1bf68cfb}{static\_threshold}}[3] = 0;}
\DoxyCodeLine{86 }
\DoxyCodeLine{87   roi.\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}} = (uint8\_t *)malloc(roi.\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} * roi.\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}});}
\DoxyCodeLine{88   \textcolor{keywordflow}{for} (i = 0; i < roi.\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} * roi.\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}}; ++i) roi.\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}}[i] = i \% 4;}
\DoxyCodeLine{89 }
\DoxyCodeLine{90   if (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca25a828dbab350f80db769a8f53e3940f}{VP8E\_SET\_ROI\_MAP}}, \&roi))}
\DoxyCodeLine{91     die\_codec(codec, \textcolor{stringliteral}{"{}Failed to set ROI map"{}});}
\DoxyCodeLine{92 }
\DoxyCodeLine{93   free(roi.\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}});}
\DoxyCodeLine{94 \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_active\_map(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{97                            \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec) \{}
\DoxyCodeLine{98   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{99   \mbox{\hyperlink{structvpx__active__map}{vpx\_active\_map\_t}} map = \{ 0, 0, 0 \};}
\DoxyCodeLine{100 }
\DoxyCodeLine{101   map.\mbox{\hyperlink{structvpx__active__map_a29424c92ff201f97db9bf62d16dfab4d}{rows}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} + 15) / 16;}
\DoxyCodeLine{102   map.\mbox{\hyperlink{structvpx__active__map_a310edb5efc62d596b2c276e3f7d1b42a}{cols}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} + 15) / 16;}
\DoxyCodeLine{103 }
\DoxyCodeLine{104   map.\mbox{\hyperlink{structvpx__active__map_a6e5e092e766ae3f65d280c68c9f6df82}{active\_map}} = (uint8\_t *)malloc(map.\mbox{\hyperlink{structvpx__active__map_a29424c92ff201f97db9bf62d16dfab4d}{rows}} * map.\mbox{\hyperlink{structvpx__active__map_a310edb5efc62d596b2c276e3f7d1b42a}{cols}});}
\DoxyCodeLine{105   \textcolor{keywordflow}{for} (i = 0; i < map.\mbox{\hyperlink{structvpx__active__map_a29424c92ff201f97db9bf62d16dfab4d}{rows}} * map.\mbox{\hyperlink{structvpx__active__map_a310edb5efc62d596b2c276e3f7d1b42a}{cols}}; ++i) map.\mbox{\hyperlink{structvpx__active__map_a6e5e092e766ae3f65d280c68c9f6df82}{active\_map}}[i] = i \% 2;}
\DoxyCodeLine{106 }
\DoxyCodeLine{107   if (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca6c904eb7e9e4aa58052742b56f1b4497}{VP8E\_SET\_ACTIVEMAP}}, \&map))}
\DoxyCodeLine{108     die\_codec(codec, \textcolor{stringliteral}{"{}Failed to set active map"{}});}
\DoxyCodeLine{109 }
\DoxyCodeLine{110   free(map.\mbox{\hyperlink{structvpx__active__map_a6e5e092e766ae3f65d280c68c9f6df82}{active\_map}});}
\DoxyCodeLine{111 \}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \textcolor{keyword}{static} \textcolor{keywordtype}{void} unset\_active\_map(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{114                              \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec) \{}
\DoxyCodeLine{115   \mbox{\hyperlink{structvpx__active__map}{vpx\_active\_map\_t}} map = \{ 0, 0, 0 \};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117   map.\mbox{\hyperlink{structvpx__active__map_a29424c92ff201f97db9bf62d16dfab4d}{rows}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} + 15) / 16;}
\DoxyCodeLine{118   map.\mbox{\hyperlink{structvpx__active__map_a310edb5efc62d596b2c276e3f7d1b42a}{cols}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} + 15) / 16;}
\DoxyCodeLine{119   map.\mbox{\hyperlink{structvpx__active__map_a6e5e092e766ae3f65d280c68c9f6df82}{active\_map}} = NULL;}
\DoxyCodeLine{120 }
\DoxyCodeLine{121   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca6c904eb7e9e4aa58052742b56f1b4497}{VP8E\_SET\_ACTIVEMAP}}, \&map))}
\DoxyCodeLine{122     die\_codec(codec, \textcolor{stringliteral}{"{}Failed to set active map"{}});}
\DoxyCodeLine{123 \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \textcolor{keyword}{static} \textcolor{keywordtype}{int} encode\_frame(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec, \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{126                         \textcolor{keywordtype}{int} frame\_index, VpxVideoWriter *writer) \{}
\DoxyCodeLine{127   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{128   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{129   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{130   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{131       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(codec, img, frame\_index, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}});}
\DoxyCodeLine{132   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(codec, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{133 }
\DoxyCodeLine{134   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(codec, \&iter)) != NULL) \{}
\DoxyCodeLine{135     got\_pkts = 1;}
\DoxyCodeLine{136 }
\DoxyCodeLine{137     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}) \{}
\DoxyCodeLine{138       \textcolor{keyword}{const} \textcolor{keywordtype}{int} keyframe = (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}}) != 0;}
\DoxyCodeLine{139       \textcolor{keywordflow}{if} (!vpx\_video\_writer\_write\_frame(writer, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{140                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{141                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}})) \{}
\DoxyCodeLine{142         die\_codec(codec, \textcolor{stringliteral}{"{}Failed to write compressed frame"{}});}
\DoxyCodeLine{143       \}}
\DoxyCodeLine{144 }
\DoxyCodeLine{145       printf(keyframe ? \textcolor{stringliteral}{"{}K"{}} : \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{146       fflush(stdout);}
\DoxyCodeLine{147     \}}
\DoxyCodeLine{148   \}}
\DoxyCodeLine{149 }
\DoxyCodeLine{150   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{151 \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{154   FILE *infile = NULL;}
\DoxyCodeLine{155   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{156   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{157   \textcolor{keywordtype}{int} frame\_count = 0;}
\DoxyCodeLine{158   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{159   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{160   VpxVideoInfo info;}
\DoxyCodeLine{161   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{162   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{163   \textcolor{keyword}{const} \textcolor{keywordtype}{int} fps = 2;  \textcolor{comment}{// TODO(dkovalev) add command line argument}}
\DoxyCodeLine{164   \textcolor{keyword}{const} \textcolor{keywordtype}{double} bits\_per\_pixel\_per\_frame = 0.067;}
\DoxyCodeLine{165 }
\DoxyCodeLine{166   exec\_name = argv[0];}
\DoxyCodeLine{167   \textcolor{keywordflow}{if} (argc != 6) die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{168 }
\DoxyCodeLine{169   memset(\&info, 0, \textcolor{keyword}{sizeof}(info));}
\DoxyCodeLine{170 }
\DoxyCodeLine{171   encoder = get\_vpx\_encoder\_by\_name(argv[1]);}
\DoxyCodeLine{172   \textcolor{keywordflow}{if} (encoder == NULL) \{}
\DoxyCodeLine{173     die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{174   \}}
\DoxyCodeLine{175   assert(encoder != NULL);}
\DoxyCodeLine{176   info.codec\_fourcc = encoder-\/>fourcc;}
\DoxyCodeLine{177   info.frame\_width = (int)strtol(argv[2], NULL, 0);}
\DoxyCodeLine{178   info.frame\_height = (int)strtol(argv[3], NULL, 0);}
\DoxyCodeLine{179   info.time\_base.numerator = 1;}
\DoxyCodeLine{180   info.time\_base.denominator = fps;}
\DoxyCodeLine{181 }
\DoxyCodeLine{182   \textcolor{keywordflow}{if} (info.frame\_width <= 0 || info.frame\_height <= 0 ||}
\DoxyCodeLine{183       (info.frame\_width \% 2) != 0 || (info.frame\_height \% 2) != 0) \{}
\DoxyCodeLine{184     die(\textcolor{stringliteral}{"{}Invalid frame size: \%dx\%d"{}}, info.frame\_width, info.frame\_height);}
\DoxyCodeLine{185   \}}
\DoxyCodeLine{186 }
\DoxyCodeLine{187   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, info.frame\_width,}
\DoxyCodeLine{188                      info.frame\_height, 1)) \{}
\DoxyCodeLine{189     die(\textcolor{stringliteral}{"{}Failed to allocate image."{}});}
\DoxyCodeLine{190   \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{192   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{193 }
\DoxyCodeLine{194   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{195   \textcolor{keywordflow}{if} (res) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to get default codec config."{}});}
\DoxyCodeLine{196 }
\DoxyCodeLine{197   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = info.frame\_width;}
\DoxyCodeLine{198   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = info.frame\_height;}
\DoxyCodeLine{199   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = info.time\_base.numerator;}
\DoxyCodeLine{200   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = info.time\_base.denominator;}
\DoxyCodeLine{201   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} =}
\DoxyCodeLine{202       (\textcolor{keywordtype}{unsigned} int)(bits\_per\_pixel\_per\_frame * cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} * cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} * fps / 1000);}
\DoxyCodeLine{203   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a992668d9e30305f3f7ab2672ea31a890}{g\_lag\_in\_frames}} = 0;}
\DoxyCodeLine{204 }
\DoxyCodeLine{205   writer = vpx\_video\_writer\_open(argv[5], kContainerIVF, \&info);}
\DoxyCodeLine{206   \textcolor{keywordflow}{if} (!writer) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, argv[5]);}
\DoxyCodeLine{207 }
\DoxyCodeLine{208   \textcolor{keywordflow}{if} (!(infile = fopen(argv[4], \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{209     die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[4]);}
\DoxyCodeLine{210 }
\DoxyCodeLine{211   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), \&cfg, 0))}
\DoxyCodeLine{212     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{213 }
\DoxyCodeLine{214   \textcolor{comment}{// Encode frames.}}
\DoxyCodeLine{215   \textcolor{keywordflow}{while} (vpx\_img\_read(\&raw, infile)) \{}
\DoxyCodeLine{216     ++frame\_count;}
\DoxyCodeLine{217 }
\DoxyCodeLine{218     \textcolor{keywordflow}{if} (frame\_count == 22 \&\& encoder-\/>fourcc == VP8\_FOURCC) \{}
\DoxyCodeLine{219       set\_roi\_map(\&cfg, \&codec);}
\DoxyCodeLine{220     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (frame\_count == 33) \{}
\DoxyCodeLine{221       set\_active\_map(\&cfg, \&codec);}
\DoxyCodeLine{222     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (frame\_count == 44) \{}
\DoxyCodeLine{223       unset\_active\_map(\&cfg, \&codec);}
\DoxyCodeLine{224     \}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226     encode\_frame(\&codec, \&raw, frame\_count, writer);}
\DoxyCodeLine{227   \}}
\DoxyCodeLine{228 }
\DoxyCodeLine{229   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{230   \textcolor{keywordflow}{while} (encode\_frame(\&codec, NULL, -\/1, writer)) \{}
\DoxyCodeLine{231   \}}
\DoxyCodeLine{232 }
\DoxyCodeLine{233   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{234   fclose(infile);}
\DoxyCodeLine{235   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_count);}
\DoxyCodeLine{236 }
\DoxyCodeLine{237   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{238   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{239 }
\DoxyCodeLine{240   vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{241 }
\DoxyCodeLine{242   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{243 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_simple_decoder}{}\doxysubsection{simple\+\_\+decoder}\label{example_simple_decoder}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// Simple Decoder}}
\DoxyCodeLine{12 \textcolor{comment}{// ==============}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example of a simple decoder loop. It takes an input file}}
\DoxyCodeLine{15 \textcolor{comment}{// containing the compressed data (in IVF format), passes it through the}}
\DoxyCodeLine{16 \textcolor{comment}{// decoder, and writes the decompressed frames to disk. Other decoder}}
\DoxyCodeLine{17 \textcolor{comment}{// examples build upon this one.}}
\DoxyCodeLine{18 \textcolor{comment}{//}}
\DoxyCodeLine{19 \textcolor{comment}{// The details of the IVF format have been elided from this example for}}
\DoxyCodeLine{20 \textcolor{comment}{// simplicity of presentation, as IVF files will not generally be used by}}
\DoxyCodeLine{21 \textcolor{comment}{// your application. In general, an IVF file consists of a file header,}}
\DoxyCodeLine{22 \textcolor{comment}{// followed by a variable number of frames. Each frame consists of a frame}}
\DoxyCodeLine{23 \textcolor{comment}{// header followed by a variable length payload. The length of the payload}}
\DoxyCodeLine{24 \textcolor{comment}{// is specified in the first four bytes of the frame header. The payload is}}
\DoxyCodeLine{25 \textcolor{comment}{// the raw compressed data.}}
\DoxyCodeLine{26 \textcolor{comment}{//}}
\DoxyCodeLine{27 \textcolor{comment}{// Standard Includes}}
\DoxyCodeLine{28 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{29 \textcolor{comment}{// For decoders, you only have to include `vpx\_decoder.h` and then any}}
\DoxyCodeLine{30 \textcolor{comment}{// header files for the specific codecs you use. In this case, we're using}}
\DoxyCodeLine{31 \textcolor{comment}{// vp8.}}
\DoxyCodeLine{32 \textcolor{comment}{//}}
\DoxyCodeLine{33 \textcolor{comment}{// Initializing The Codec}}
\DoxyCodeLine{34 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{35 \textcolor{comment}{// The libvpx decoder is initialized by the call to vpx\_codec\_dec\_init().}}
\DoxyCodeLine{36 \textcolor{comment}{// Determining the codec interface to use is handled by VpxVideoReader and the}}
\DoxyCodeLine{37 \textcolor{comment}{// functions prefixed with vpx\_video\_reader\_. Discussion of those functions is}}
\DoxyCodeLine{38 \textcolor{comment}{// beyond the scope of this example, but the main gist is to open the input file}}
\DoxyCodeLine{39 \textcolor{comment}{// and parse just enough of it to determine if it's a VPx file and which VPx}}
\DoxyCodeLine{40 \textcolor{comment}{// codec is contained within the file.}}
\DoxyCodeLine{41 \textcolor{comment}{// Note the NULL pointer passed to vpx\_codec\_dec\_init(). We do that in this}}
\DoxyCodeLine{42 \textcolor{comment}{// example because we want the algorithm to determine the stream configuration}}
\DoxyCodeLine{43 \textcolor{comment}{// (width/height) and allocate memory automatically.}}
\DoxyCodeLine{44 \textcolor{comment}{//}}
\DoxyCodeLine{45 \textcolor{comment}{// Decoding A Frame}}
\DoxyCodeLine{46 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{47 \textcolor{comment}{// Once the frame has been read into memory, it is decoded using the}}
\DoxyCodeLine{48 \textcolor{comment}{// `vpx\_codec\_decode` function. The call takes a pointer to the data}}
\DoxyCodeLine{49 \textcolor{comment}{// (`frame`) and the length of the data (`frame\_size`). No application data}}
\DoxyCodeLine{50 \textcolor{comment}{// is associated with the frame in this example, so the `user\_priv`}}
\DoxyCodeLine{51 \textcolor{comment}{// parameter is NULL. The `deadline` parameter is left at zero for this}}
\DoxyCodeLine{52 \textcolor{comment}{// example. This parameter is generally only used when doing adaptive post}}
\DoxyCodeLine{53 \textcolor{comment}{// processing.}}
\DoxyCodeLine{54 \textcolor{comment}{//}}
\DoxyCodeLine{55 \textcolor{comment}{// Codecs may produce a variable number of output frames for every call to}}
\DoxyCodeLine{56 \textcolor{comment}{// `vpx\_codec\_decode`. These frames are retrieved by the}}
\DoxyCodeLine{57 \textcolor{comment}{// `vpx\_codec\_get\_frame` iterator function. The iterator variable `iter` is}}
\DoxyCodeLine{58 \textcolor{comment}{// initialized to NULL each time `vpx\_codec\_decode` is called.}}
\DoxyCodeLine{59 \textcolor{comment}{// `vpx\_codec\_get\_frame` is called in a loop, returning a pointer to a}}
\DoxyCodeLine{60 \textcolor{comment}{// decoded image or NULL to indicate the end of list.}}
\DoxyCodeLine{61 \textcolor{comment}{//}}
\DoxyCodeLine{62 \textcolor{comment}{// Processing The Decoded Data}}
\DoxyCodeLine{63 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{64 \textcolor{comment}{// In this example, we simply write the encoded data to disk. It is}}
\DoxyCodeLine{65 \textcolor{comment}{// important to honor the image's `stride` values.}}
\DoxyCodeLine{66 \textcolor{comment}{//}}
\DoxyCodeLine{67 \textcolor{comment}{// Cleanup}}
\DoxyCodeLine{68 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{69 \textcolor{comment}{// The `vpx\_codec\_destroy` call frees any memory allocated by the codec.}}
\DoxyCodeLine{70 \textcolor{comment}{//}}
\DoxyCodeLine{71 \textcolor{comment}{// Error Handling}}
\DoxyCodeLine{72 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{73 \textcolor{comment}{// This example does not special case any error return codes. If there was}}
\DoxyCodeLine{74 \textcolor{comment}{// an error, a descriptive message is printed and the program exits. With}}
\DoxyCodeLine{75 \textcolor{comment}{// few exceptions, vpx\_codec functions return an enumerated error status,}}
\DoxyCodeLine{76 \textcolor{comment}{// with the value `0` indicating success.}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{79 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{80 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{85 \textcolor{preprocessor}{\#include "{}../video\_reader.h"{}}}
\DoxyCodeLine{86 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{87 }
\DoxyCodeLine{88 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{91   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <infile> <outfile>\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{92   exit(EXIT\_FAILURE);}
\DoxyCodeLine{93 \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{96   \textcolor{keywordtype}{int} frame\_cnt = 0;}
\DoxyCodeLine{97   FILE *outfile = NULL;}
\DoxyCodeLine{98   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{99   VpxVideoReader *reader = NULL;}
\DoxyCodeLine{100   \textcolor{keyword}{const} VpxInterface *decoder = NULL;}
\DoxyCodeLine{101   \textcolor{keyword}{const} VpxVideoInfo *info = NULL;}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   exec\_name = argv[0];}
\DoxyCodeLine{104 }
\DoxyCodeLine{105   \textcolor{keywordflow}{if} (argc != 3) die(\textcolor{stringliteral}{"{}Invalid number of arguments."{}});}
\DoxyCodeLine{106 }
\DoxyCodeLine{107   reader = vpx\_video\_reader\_open(argv[1]);}
\DoxyCodeLine{108   \textcolor{keywordflow}{if} (!reader) die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[1]);}
\DoxyCodeLine{109 }
\DoxyCodeLine{110   \textcolor{keywordflow}{if} (!(outfile = fopen(argv[2], \textcolor{stringliteral}{"{}wb"{}})))}
\DoxyCodeLine{111     die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, argv[2]);}
\DoxyCodeLine{112 }
\DoxyCodeLine{113   info = vpx\_video\_reader\_get\_info(reader);}
\DoxyCodeLine{114 }
\DoxyCodeLine{115   decoder = get\_vpx\_decoder\_by\_fourcc(info-\/>codec\_fourcc);}
\DoxyCodeLine{116   \textcolor{keywordflow}{if} (!decoder) die(\textcolor{stringliteral}{"{}Unknown input codec."{}});}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(decoder-\/>codec\_interface()));}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&codec, decoder-\/>codec\_interface(), NULL, 0))}
\DoxyCodeLine{121     die(\textcolor{stringliteral}{"{}Failed to initialize decoder."{}});}
\DoxyCodeLine{122 }
\DoxyCodeLine{123   \textcolor{keywordflow}{while} (vpx\_video\_reader\_read\_frame(reader)) \{}
\DoxyCodeLine{124     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{125     \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img = NULL;}
\DoxyCodeLine{126     \textcolor{keywordtype}{size\_t} frame\_size = 0;}
\DoxyCodeLine{127     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *frame =}
\DoxyCodeLine{128         vpx\_video\_reader\_get\_frame(reader, \&frame\_size);}
\DoxyCodeLine{129     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&codec, frame, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})frame\_size, NULL, 0))}
\DoxyCodeLine{130       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to decode frame."{}});}
\DoxyCodeLine{131 }
\DoxyCodeLine{132     \textcolor{keywordflow}{while} ((img = \mbox{\hyperlink{group__decoder_gac23542417b964c7f7cd6767e72775b54}{vpx\_codec\_get\_frame}}(\&codec, \&iter)) != NULL) \{}
\DoxyCodeLine{133       vpx\_img\_write(img, outfile);}
\DoxyCodeLine{134       ++frame\_cnt;}
\DoxyCodeLine{135     \}}
\DoxyCodeLine{136   \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_cnt);}
\DoxyCodeLine{139   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec"{}});}
\DoxyCodeLine{140 }
\DoxyCodeLine{141   printf(\textcolor{stringliteral}{"{}Play: ffplay -\/f rawvideo -\/pix\_fmt yuv420p -\/s \%dx\%d \%s\(\backslash\)n"{}},}
\DoxyCodeLine{142          info-\/>frame\_width, info-\/>frame\_height, argv[2]);}
\DoxyCodeLine{143 }
\DoxyCodeLine{144   vpx\_video\_reader\_close(reader);}
\DoxyCodeLine{145 }
\DoxyCodeLine{146   fclose(outfile);}
\DoxyCodeLine{147 }
\DoxyCodeLine{148   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{149 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_simple_encoder}{}\doxysubsection{simple\+\_\+encoder}\label{example_simple_encoder}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// Simple Encoder}}
\DoxyCodeLine{12 \textcolor{comment}{// ==============}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example of a simple encoder loop. It takes an input file in}}
\DoxyCodeLine{15 \textcolor{comment}{// YV12 format, passes it through the encoder, and writes the compressed}}
\DoxyCodeLine{16 \textcolor{comment}{// frames to disk in IVF format. Other decoder examples build upon this}}
\DoxyCodeLine{17 \textcolor{comment}{// one.}}
\DoxyCodeLine{18 \textcolor{comment}{//}}
\DoxyCodeLine{19 \textcolor{comment}{// The details of the IVF format have been elided from this example for}}
\DoxyCodeLine{20 \textcolor{comment}{// simplicity of presentation, as IVF files will not generally be used by}}
\DoxyCodeLine{21 \textcolor{comment}{// your application. In general, an IVF file consists of a file header,}}
\DoxyCodeLine{22 \textcolor{comment}{// followed by a variable number of frames. Each frame consists of a frame}}
\DoxyCodeLine{23 \textcolor{comment}{// header followed by a variable length payload. The length of the payload}}
\DoxyCodeLine{24 \textcolor{comment}{// is specified in the first four bytes of the frame header. The payload is}}
\DoxyCodeLine{25 \textcolor{comment}{// the raw compressed data.}}
\DoxyCodeLine{26 \textcolor{comment}{//}}
\DoxyCodeLine{27 \textcolor{comment}{// Standard Includes}}
\DoxyCodeLine{28 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{29 \textcolor{comment}{// For encoders, you only have to include `vpx\_encoder.h` and then any}}
\DoxyCodeLine{30 \textcolor{comment}{// header files for the specific codecs you use. In this case, we're using}}
\DoxyCodeLine{31 \textcolor{comment}{// vp8.}}
\DoxyCodeLine{32 \textcolor{comment}{//}}
\DoxyCodeLine{33 \textcolor{comment}{// Getting The Default Configuration}}
\DoxyCodeLine{34 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{35 \textcolor{comment}{// Encoders have the notion of "{}usage profiles."{} For example, an encoder}}
\DoxyCodeLine{36 \textcolor{comment}{// may want to publish default configurations for both a video}}
\DoxyCodeLine{37 \textcolor{comment}{// conferencing application and a best quality offline encoder. These}}
\DoxyCodeLine{38 \textcolor{comment}{// obviously have very different default settings. Consult the}}
\DoxyCodeLine{39 \textcolor{comment}{// documentation for your codec to see if it provides any default}}
\DoxyCodeLine{40 \textcolor{comment}{// configurations. All codecs provide a default configuration, number 0,}}
\DoxyCodeLine{41 \textcolor{comment}{// which is valid for material in the vacinity of QCIF/QVGA.}}
\DoxyCodeLine{42 \textcolor{comment}{//}}
\DoxyCodeLine{43 \textcolor{comment}{// Updating The Configuration}}
\DoxyCodeLine{44 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{45 \textcolor{comment}{// Almost all applications will want to update the default configuration}}
\DoxyCodeLine{46 \textcolor{comment}{// with settings specific to their usage. Here we set the width and height}}
\DoxyCodeLine{47 \textcolor{comment}{// of the video file to that specified on the command line. We also scale}}
\DoxyCodeLine{48 \textcolor{comment}{// the default bitrate based on the ratio between the default resolution}}
\DoxyCodeLine{49 \textcolor{comment}{// and the resolution specified on the command line.}}
\DoxyCodeLine{50 \textcolor{comment}{//}}
\DoxyCodeLine{51 \textcolor{comment}{// Initializing The Codec}}
\DoxyCodeLine{52 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{53 \textcolor{comment}{// The encoder is initialized by the following code.}}
\DoxyCodeLine{54 \textcolor{comment}{//}}
\DoxyCodeLine{55 \textcolor{comment}{// Encoding A Frame}}
\DoxyCodeLine{56 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{57 \textcolor{comment}{// The frame is read as a continuous block (size width * height * 3 / 2)}}
\DoxyCodeLine{58 \textcolor{comment}{// from the input file. If a frame was read (the input file has not hit}}
\DoxyCodeLine{59 \textcolor{comment}{// EOF) then the frame is passed to the encoder. Otherwise, a NULL}}
\DoxyCodeLine{60 \textcolor{comment}{// is passed, indicating the End-\/Of-\/Stream condition to the encoder. The}}
\DoxyCodeLine{61 \textcolor{comment}{// `frame\_cnt` is reused as the presentation time stamp (PTS) and each}}
\DoxyCodeLine{62 \textcolor{comment}{// frame is shown for one frame-\/time in duration. The flags parameter is}}
\DoxyCodeLine{63 \textcolor{comment}{// unused in this example. The deadline is set to VPX\_DL\_REALTIME to}}
\DoxyCodeLine{64 \textcolor{comment}{// make the example run as quickly as possible.}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{comment}{// Forced Keyframes}}
\DoxyCodeLine{67 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{68 \textcolor{comment}{// Keyframes can be forced by setting the VPX\_EFLAG\_FORCE\_KF bit of the}}
\DoxyCodeLine{69 \textcolor{comment}{// flags passed to `vpx\_codec\_control()`. In this example, we force a}}
\DoxyCodeLine{70 \textcolor{comment}{// keyframe every <keyframe-\/interval> frames. Note, the output stream can}}
\DoxyCodeLine{71 \textcolor{comment}{// contain additional keyframes beyond those that have been forced using the}}
\DoxyCodeLine{72 \textcolor{comment}{// VPX\_EFLAG\_FORCE\_KF flag because of automatic keyframe placement by the}}
\DoxyCodeLine{73 \textcolor{comment}{// encoder.}}
\DoxyCodeLine{74 \textcolor{comment}{//}}
\DoxyCodeLine{75 \textcolor{comment}{// Processing The Encoded Data}}
\DoxyCodeLine{76 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{77 \textcolor{comment}{// Each packet of type `VPX\_CODEC\_CX\_FRAME\_PKT` contains the encoded data}}
\DoxyCodeLine{78 \textcolor{comment}{// for this frame. We write a IVF frame header, followed by the raw data.}}
\DoxyCodeLine{79 \textcolor{comment}{//}}
\DoxyCodeLine{80 \textcolor{comment}{// Cleanup}}
\DoxyCodeLine{81 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{82 \textcolor{comment}{// The `vpx\_codec\_destroy` call frees any memory allocated by the codec.}}
\DoxyCodeLine{83 \textcolor{comment}{//}}
\DoxyCodeLine{84 \textcolor{comment}{// Error Handling}}
\DoxyCodeLine{85 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{86 \textcolor{comment}{// This example does not special case any error return codes. If there was}}
\DoxyCodeLine{87 \textcolor{comment}{// an error, a descriptive message is printed and the program exits. With}}
\DoxyCodeLine{88 \textcolor{comment}{// few exeptions, vpx\_codec functions return an enumerated error status,}}
\DoxyCodeLine{89 \textcolor{comment}{// with the value `0` indicating success.}}
\DoxyCodeLine{90 \textcolor{comment}{//}}
\DoxyCodeLine{91 \textcolor{comment}{// Error Resiliency Features}}
\DoxyCodeLine{92 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{93 \textcolor{comment}{// Error resiliency is controlled by the g\_error\_resilient member of the}}
\DoxyCodeLine{94 \textcolor{comment}{// configuration structure. Use the `decode\_with\_drops` example to decode with}}
\DoxyCodeLine{95 \textcolor{comment}{// frames 5-\/10 dropped. Compare the output for a file encoded with this example}}
\DoxyCodeLine{96 \textcolor{comment}{// versus one encoded with the `simple\_encoder` example.}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{99 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{100 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{105 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{106 }
\DoxyCodeLine{107 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{110   fprintf(stderr,}
\DoxyCodeLine{111           \textcolor{stringliteral}{"{}Usage: \%s <codec> <width> <height> <infile> <outfile> "{}}}
\DoxyCodeLine{112           \textcolor{stringliteral}{"{}<keyframe-\/interval> <error-\/resilient> <frames to encode>\(\backslash\)n"{}}}
\DoxyCodeLine{113           \textcolor{stringliteral}{"{}See comments in simple\_encoder.c for more information.\(\backslash\)n"{}},}
\DoxyCodeLine{114           exec\_name);}
\DoxyCodeLine{115   exit(EXIT\_FAILURE);}
\DoxyCodeLine{116 \}}
\DoxyCodeLine{117 }
\DoxyCodeLine{118 \textcolor{keyword}{static} \textcolor{keywordtype}{int} encode\_frame(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec, \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{119                         \textcolor{keywordtype}{int} frame\_index, \textcolor{keywordtype}{int} flags, VpxVideoWriter *writer) \{}
\DoxyCodeLine{120   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{121   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{122   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{123   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{124       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(codec, img, frame\_index, 1, flags, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}});}
\DoxyCodeLine{125   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(codec, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{126 }
\DoxyCodeLine{127   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(codec, \&iter)) != NULL) \{}
\DoxyCodeLine{128     got\_pkts = 1;}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}) \{}
\DoxyCodeLine{131       \textcolor{keyword}{const} \textcolor{keywordtype}{int} keyframe = (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}}) != 0;}
\DoxyCodeLine{132       \textcolor{keywordflow}{if} (!vpx\_video\_writer\_write\_frame(writer, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{133                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{134                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}})) \{}
\DoxyCodeLine{135         die\_codec(codec, \textcolor{stringliteral}{"{}Failed to write compressed frame"{}});}
\DoxyCodeLine{136       \}}
\DoxyCodeLine{137       printf(keyframe ? \textcolor{stringliteral}{"{}K"{}} : \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{138       fflush(stdout);}
\DoxyCodeLine{139     \}}
\DoxyCodeLine{140   \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{143 \}}
\DoxyCodeLine{144 }
\DoxyCodeLine{145 \textcolor{comment}{// TODO(tomfinegan): Improve command line parsing and add args for bitrate/fps.}}
\DoxyCodeLine{146 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{147   FILE *infile = NULL;}
\DoxyCodeLine{148   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{149   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{150   \textcolor{keywordtype}{int} frame\_count = 0;}
\DoxyCodeLine{151   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{152   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{153   VpxVideoInfo info = \{ 0, 0, 0, \{ 0, 0 \} \};}
\DoxyCodeLine{154   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{155   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{156   \textcolor{keyword}{const} \textcolor{keywordtype}{int} fps = 30;}
\DoxyCodeLine{157   \textcolor{keyword}{const} \textcolor{keywordtype}{int} bitrate = 200;}
\DoxyCodeLine{158   \textcolor{keywordtype}{int} keyframe\_interval = 0;}
\DoxyCodeLine{159   \textcolor{keywordtype}{int} max\_frames = 0;}
\DoxyCodeLine{160   \textcolor{keywordtype}{int} frames\_encoded = 0;}
\DoxyCodeLine{161   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *codec\_arg = NULL;}
\DoxyCodeLine{162   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *width\_arg = NULL;}
\DoxyCodeLine{163   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *height\_arg = NULL;}
\DoxyCodeLine{164   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *infile\_arg = NULL;}
\DoxyCodeLine{165   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *outfile\_arg = NULL;}
\DoxyCodeLine{166   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *keyframe\_interval\_arg = NULL;}
\DoxyCodeLine{167 }
\DoxyCodeLine{168   exec\_name = argv[0];}
\DoxyCodeLine{169 }
\DoxyCodeLine{170   \textcolor{keywordflow}{if} (argc != 9) die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{171 }
\DoxyCodeLine{172   codec\_arg = argv[1];}
\DoxyCodeLine{173   width\_arg = argv[2];}
\DoxyCodeLine{174   height\_arg = argv[3];}
\DoxyCodeLine{175   infile\_arg = argv[4];}
\DoxyCodeLine{176   outfile\_arg = argv[5];}
\DoxyCodeLine{177   keyframe\_interval\_arg = argv[6];}
\DoxyCodeLine{178   max\_frames = (int)strtol(argv[8], NULL, 0);}
\DoxyCodeLine{179 }
\DoxyCodeLine{180   encoder = get\_vpx\_encoder\_by\_name(codec\_arg);}
\DoxyCodeLine{181   \textcolor{keywordflow}{if} (!encoder) die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{182 }
\DoxyCodeLine{183   info.codec\_fourcc = encoder-\/>fourcc;}
\DoxyCodeLine{184   info.frame\_width = (int)strtol(width\_arg, NULL, 0);}
\DoxyCodeLine{185   info.frame\_height = (int)strtol(height\_arg, NULL, 0);}
\DoxyCodeLine{186   info.time\_base.numerator = 1;}
\DoxyCodeLine{187   info.time\_base.denominator = fps;}
\DoxyCodeLine{188 }
\DoxyCodeLine{189   \textcolor{keywordflow}{if} (info.frame\_width <= 0 || info.frame\_height <= 0 ||}
\DoxyCodeLine{190       (info.frame\_width \% 2) != 0 || (info.frame\_height \% 2) != 0) \{}
\DoxyCodeLine{191     die(\textcolor{stringliteral}{"{}Invalid frame size: \%dx\%d"{}}, info.frame\_width, info.frame\_height);}
\DoxyCodeLine{192   \}}
\DoxyCodeLine{193 }
\DoxyCodeLine{194   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, info.frame\_width,}
\DoxyCodeLine{195                      info.frame\_height, 1)) \{}
\DoxyCodeLine{196     die(\textcolor{stringliteral}{"{}Failed to allocate image."{}});}
\DoxyCodeLine{197   \}}
\DoxyCodeLine{198 }
\DoxyCodeLine{199   keyframe\_interval = (int)strtol(keyframe\_interval\_arg, NULL, 0);}
\DoxyCodeLine{200   \textcolor{keywordflow}{if} (keyframe\_interval < 0) die(\textcolor{stringliteral}{"{}Invalid keyframe interval value."{}});}
\DoxyCodeLine{201 }
\DoxyCodeLine{202   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{203 }
\DoxyCodeLine{204   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{205   \textcolor{keywordflow}{if} (res) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to get default codec config."{}});}
\DoxyCodeLine{206 }
\DoxyCodeLine{207   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = info.frame\_width;}
\DoxyCodeLine{208   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = info.frame\_height;}
\DoxyCodeLine{209   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = info.time\_base.numerator;}
\DoxyCodeLine{210   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = info.time\_base.denominator;}
\DoxyCodeLine{211   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = bitrate;}
\DoxyCodeLine{212   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4e17173b66ca0d7dfba9978625d7ba76}{g\_error\_resilient}} = (\mbox{\hyperlink{group__encoder_ga77e0e1fff62556a4f4d54c84467a41f3}{vpx\_codec\_er\_flags\_t}})strtoul(argv[7], NULL, 0);}
\DoxyCodeLine{213 }
\DoxyCodeLine{214   writer = vpx\_video\_writer\_open(outfile\_arg, kContainerIVF, \&info);}
\DoxyCodeLine{215   \textcolor{keywordflow}{if} (!writer) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, outfile\_arg);}
\DoxyCodeLine{216 }
\DoxyCodeLine{217   \textcolor{keywordflow}{if} (!(infile = fopen(infile\_arg, \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{218     die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, infile\_arg);}
\DoxyCodeLine{219 }
\DoxyCodeLine{220   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), \&cfg, 0))}
\DoxyCodeLine{221     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{222 }
\DoxyCodeLine{223   \textcolor{comment}{// Encode frames.}}
\DoxyCodeLine{224   \textcolor{keywordflow}{while} (vpx\_img\_read(\&raw, infile)) \{}
\DoxyCodeLine{225     \textcolor{keywordtype}{int} flags = 0;}
\DoxyCodeLine{226     \textcolor{keywordflow}{if} (keyframe\_interval > 0 \&\& frame\_count \% keyframe\_interval == 0)}
\DoxyCodeLine{227       flags |= \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}};}
\DoxyCodeLine{228     encode\_frame(\&codec, \&raw, frame\_count++, flags, writer);}
\DoxyCodeLine{229     frames\_encoded++;}
\DoxyCodeLine{230     \textcolor{keywordflow}{if} (max\_frames > 0 \&\& frames\_encoded >= max\_frames) \textcolor{keywordflow}{break};}
\DoxyCodeLine{231   \}}
\DoxyCodeLine{232 }
\DoxyCodeLine{233   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{234   \textcolor{keywordflow}{while} (encode\_frame(\&codec, NULL, -\/1, 0, writer)) \{}
\DoxyCodeLine{235   \}}
\DoxyCodeLine{236 }
\DoxyCodeLine{237   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{238   fclose(infile);}
\DoxyCodeLine{239   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_count);}
\DoxyCodeLine{240 }
\DoxyCodeLine{241   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{242   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{243 }
\DoxyCodeLine{244   vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{245 }
\DoxyCodeLine{246   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{247 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_twopass_encoder}{}\doxysubsection{twopass\+\_\+encoder}\label{example_twopass_encoder}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// Two Pass Encoder}}
\DoxyCodeLine{12 \textcolor{comment}{// ================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example of a two pass encoder loop. It takes an input file in}}
\DoxyCodeLine{15 \textcolor{comment}{// YV12 format, passes it through the encoder twice, and writes the compressed}}
\DoxyCodeLine{16 \textcolor{comment}{// frames to disk in IVF format. It builds upon the simple\_encoder example.}}
\DoxyCodeLine{17 \textcolor{comment}{//}}
\DoxyCodeLine{18 \textcolor{comment}{// Twopass Variables}}
\DoxyCodeLine{19 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{20 \textcolor{comment}{// Twopass mode needs to track the current pass number and the buffer of}}
\DoxyCodeLine{21 \textcolor{comment}{// statistics packets.}}
\DoxyCodeLine{22 \textcolor{comment}{//}}
\DoxyCodeLine{23 \textcolor{comment}{// Updating The Configuration}}
\DoxyCodeLine{24 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{25 \textcolor{comment}{// In two pass mode, the configuration has to be updated on each pass. The}}
\DoxyCodeLine{26 \textcolor{comment}{// statistics buffer is passed on the last pass.}}
\DoxyCodeLine{27 \textcolor{comment}{//}}
\DoxyCodeLine{28 \textcolor{comment}{// Encoding A Frame}}
\DoxyCodeLine{29 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{30 \textcolor{comment}{// Encoding a frame in two pass mode is identical to the simple encoder}}
\DoxyCodeLine{31 \textcolor{comment}{// example. To increase the quality while sacrificing encoding speed,}}
\DoxyCodeLine{32 \textcolor{comment}{// VPX\_DL\_BEST\_QUALITY can be used in place of VPX\_DL\_GOOD\_QUALITY.}}
\DoxyCodeLine{33 \textcolor{comment}{//}}
\DoxyCodeLine{34 \textcolor{comment}{// Processing Statistics Packets}}
\DoxyCodeLine{35 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{36 \textcolor{comment}{// Each packet of type `VPX\_CODEC\_CX\_FRAME\_PKT` contains the encoded data}}
\DoxyCodeLine{37 \textcolor{comment}{// for this frame. We write a IVF frame header, followed by the raw data.}}
\DoxyCodeLine{38 \textcolor{comment}{//}}
\DoxyCodeLine{39 \textcolor{comment}{//}}
\DoxyCodeLine{40 \textcolor{comment}{// Pass Progress Reporting}}
\DoxyCodeLine{41 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{42 \textcolor{comment}{// It's sometimes helpful to see when each pass completes.}}
\DoxyCodeLine{43 \textcolor{comment}{//}}
\DoxyCodeLine{44 \textcolor{comment}{//}}
\DoxyCodeLine{45 \textcolor{comment}{// Clean-\/up}}
\DoxyCodeLine{46 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{47 \textcolor{comment}{// Destruction of the encoder instance must be done on each pass. The}}
\DoxyCodeLine{48 \textcolor{comment}{// raw image should be destroyed at the end as usual.}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{62   fprintf(stderr,}
\DoxyCodeLine{63           \textcolor{stringliteral}{"{}Usage: \%s <codec> <width> <height> <infile> <outfile> "{}}}
\DoxyCodeLine{64           \textcolor{stringliteral}{"{}<frame limit>\(\backslash\)n"{}},}
\DoxyCodeLine{65           exec\_name);}
\DoxyCodeLine{66   exit(EXIT\_FAILURE);}
\DoxyCodeLine{67 \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{keyword}{static} \textcolor{keywordtype}{int} get\_frame\_stats(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *ctx, \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{70                            \mbox{\hyperlink{group__encoder_ga7e711b0a71c65aef8f0faea8bd57b05f}{vpx\_codec\_pts\_t}} pts, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} duration,}
\DoxyCodeLine{71                            \mbox{\hyperlink{group__encoder_ga99e4a3c966f0de19fe1aa626bd860366}{vpx\_enc\_frame\_flags\_t}} flags, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} deadline,}
\DoxyCodeLine{72                            \mbox{\hyperlink{structvpx__fixed__buf}{vpx\_fixed\_buf\_t}} *stats) \{}
\DoxyCodeLine{73   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{74   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{75   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{76   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{77       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(ctx, img, pts, duration, flags, deadline);}
\DoxyCodeLine{78   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(ctx, \textcolor{stringliteral}{"{}Failed to get frame stats."{}});}
\DoxyCodeLine{79 }
\DoxyCodeLine{80   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(ctx, \&iter)) != NULL) \{}
\DoxyCodeLine{81     got\_pkts = 1;}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a77cd8b95d9891bcce36117f5f31994fd}{VPX\_CODEC\_STATS\_PKT}}) \{}
\DoxyCodeLine{84       \textcolor{keyword}{const} uint8\_t *\textcolor{keyword}{const} pkt\_buf = pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a4018900fa26ecc55abc4703cc7d7c7fc}{twopass\_stats}}.\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}};}
\DoxyCodeLine{85       \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} pkt\_size = pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a4018900fa26ecc55abc4703cc7d7c7fc}{twopass\_stats}}.\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}};}
\DoxyCodeLine{86       stats-\/>\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}} = realloc(stats-\/>\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}}, stats-\/>\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}} + pkt\_size);}
\DoxyCodeLine{87       memcpy((uint8\_t *)stats-\/>\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}} + stats-\/>\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}}, pkt\_buf, pkt\_size);}
\DoxyCodeLine{88       stats-\/>\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}} += pkt\_size;}
\DoxyCodeLine{89     \}}
\DoxyCodeLine{90   \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{93 \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{keyword}{static} \textcolor{keywordtype}{int} encode\_frame(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *ctx, \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{96                         \mbox{\hyperlink{group__encoder_ga7e711b0a71c65aef8f0faea8bd57b05f}{vpx\_codec\_pts\_t}} pts, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} duration,}
\DoxyCodeLine{97                         \mbox{\hyperlink{group__encoder_ga99e4a3c966f0de19fe1aa626bd860366}{vpx\_enc\_frame\_flags\_t}} flags, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} deadline,}
\DoxyCodeLine{98                         VpxVideoWriter *writer) \{}
\DoxyCodeLine{99   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{100   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{101   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{102   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{103       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(ctx, img, pts, duration, flags, deadline);}
\DoxyCodeLine{104   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(ctx, \textcolor{stringliteral}{"{}Failed to encode frame."{}});}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(ctx, \&iter)) != NULL) \{}
\DoxyCodeLine{107     got\_pkts = 1;}
\DoxyCodeLine{108     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}) \{}
\DoxyCodeLine{109       \textcolor{keyword}{const} \textcolor{keywordtype}{int} keyframe = (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}}) != 0;}
\DoxyCodeLine{110 }
\DoxyCodeLine{111       \textcolor{keywordflow}{if} (!vpx\_video\_writer\_write\_frame(writer, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{112                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{113                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}}))}
\DoxyCodeLine{114         die\_codec(ctx, \textcolor{stringliteral}{"{}Failed to write compressed frame."{}});}
\DoxyCodeLine{115       printf(keyframe ? \textcolor{stringliteral}{"{}K"{}} : \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{116       fflush(stdout);}
\DoxyCodeLine{117     \}}
\DoxyCodeLine{118   \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{121 \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 \textcolor{keyword}{static} \mbox{\hyperlink{structvpx__fixed__buf}{vpx\_fixed\_buf\_t}} pass0(\mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *raw, FILE *infile,}
\DoxyCodeLine{124                              \textcolor{keyword}{const} VpxInterface *encoder,}
\DoxyCodeLine{125                              \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg, \textcolor{keywordtype}{int} max\_frames) \{}
\DoxyCodeLine{126   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{127   \textcolor{keywordtype}{int} frame\_count = 0;}
\DoxyCodeLine{128   \mbox{\hyperlink{structvpx__fixed__buf}{vpx\_fixed\_buf\_t}} stats = \{ NULL, 0 \};}
\DoxyCodeLine{129 }
\DoxyCodeLine{130   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), cfg, 0))}
\DoxyCodeLine{131     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{132 }
\DoxyCodeLine{133   \textcolor{comment}{// Calculate frame statistics.}}
\DoxyCodeLine{134   \textcolor{keywordflow}{while} (vpx\_img\_read(raw, infile)) \{}
\DoxyCodeLine{135     ++frame\_count;}
\DoxyCodeLine{136     get\_frame\_stats(\&codec, raw, frame\_count, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}},}
\DoxyCodeLine{137                     \&stats);}
\DoxyCodeLine{138     \textcolor{keywordflow}{if} (max\_frames > 0 \&\& frame\_count >= max\_frames) \textcolor{keywordflow}{break};}
\DoxyCodeLine{139   \}}
\DoxyCodeLine{140 }
\DoxyCodeLine{141   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{142   \textcolor{keywordflow}{while} (get\_frame\_stats(\&codec, NULL, frame\_count, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}},}
\DoxyCodeLine{143                          \&stats)) \{}
\DoxyCodeLine{144   \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146   printf(\textcolor{stringliteral}{"{}Pass 0 complete. Processed \%d frames.\(\backslash\)n"{}}, frame\_count);}
\DoxyCodeLine{147   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{148 }
\DoxyCodeLine{149   \textcolor{keywordflow}{return} stats;}
\DoxyCodeLine{150 \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{keyword}{static} \textcolor{keywordtype}{void} pass1(\mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *raw, FILE *infile, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *outfile\_name,}
\DoxyCodeLine{153                   \textcolor{keyword}{const} VpxInterface *encoder, \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{154                   \textcolor{keywordtype}{int} max\_frames) \{}
\DoxyCodeLine{155   VpxVideoInfo info = \{ encoder-\/>fourcc,}
\DoxyCodeLine{156                         cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}},}
\DoxyCodeLine{157                         cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}},}
\DoxyCodeLine{158                         \{ cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}}, cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} \} \};}
\DoxyCodeLine{159   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{160   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{161   \textcolor{keywordtype}{int} frame\_count = 0;}
\DoxyCodeLine{162 }
\DoxyCodeLine{163   writer = vpx\_video\_writer\_open(outfile\_name, kContainerIVF, \&info);}
\DoxyCodeLine{164   \textcolor{keywordflow}{if} (!writer) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing"{}}, outfile\_name);}
\DoxyCodeLine{165 }
\DoxyCodeLine{166   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), cfg, 0))}
\DoxyCodeLine{167     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{168 }
\DoxyCodeLine{169   \textcolor{comment}{// Encode frames.}}
\DoxyCodeLine{170   \textcolor{keywordflow}{while} (vpx\_img\_read(raw, infile)) \{}
\DoxyCodeLine{171     ++frame\_count;}
\DoxyCodeLine{172     encode\_frame(\&codec, raw, frame\_count, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}}, writer);}
\DoxyCodeLine{173 }
\DoxyCodeLine{174     \textcolor{keywordflow}{if} (max\_frames > 0 \&\& frame\_count >= max\_frames) \textcolor{keywordflow}{break};}
\DoxyCodeLine{175   \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{178   \textcolor{keywordflow}{while} (encode\_frame(\&codec, NULL, -\/1, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}}, writer)) \{}
\DoxyCodeLine{179   \}}
\DoxyCodeLine{180 }
\DoxyCodeLine{181   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{182 }
\DoxyCodeLine{183   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{184 }
\DoxyCodeLine{185   vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{186 }
\DoxyCodeLine{187   printf(\textcolor{stringliteral}{"{}Pass 1 complete. Processed \%d frames.\(\backslash\)n"{}}, frame\_count);}
\DoxyCodeLine{188 \}}
\DoxyCodeLine{189 }
\DoxyCodeLine{190 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{191   FILE *infile = NULL;}
\DoxyCodeLine{192   \textcolor{keywordtype}{int} w, h;}
\DoxyCodeLine{193   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{194   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{195   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{196   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{197   \mbox{\hyperlink{structvpx__fixed__buf}{vpx\_fixed\_buf\_t}} stats;}
\DoxyCodeLine{198 }
\DoxyCodeLine{199   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{200   \textcolor{keyword}{const} \textcolor{keywordtype}{int} fps = 30;       \textcolor{comment}{// TODO(dkovalev) add command line argument}}
\DoxyCodeLine{201   \textcolor{keyword}{const} \textcolor{keywordtype}{int} bitrate = 200;  \textcolor{comment}{// kbit/s TODO(dkovalev) add command line argument}}
\DoxyCodeLine{202   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keyword}{const} codec\_arg = argv[1];}
\DoxyCodeLine{203   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keyword}{const} width\_arg = argv[2];}
\DoxyCodeLine{204   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keyword}{const} height\_arg = argv[3];}
\DoxyCodeLine{205   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keyword}{const} infile\_arg = argv[4];}
\DoxyCodeLine{206   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keyword}{const} outfile\_arg = argv[5];}
\DoxyCodeLine{207   \textcolor{keywordtype}{int} max\_frames = 0;}
\DoxyCodeLine{208   exec\_name = argv[0];}
\DoxyCodeLine{209 }
\DoxyCodeLine{210   \textcolor{keywordflow}{if} (argc != 7) die(\textcolor{stringliteral}{"{}Invalid number of arguments."{}});}
\DoxyCodeLine{211 }
\DoxyCodeLine{212   max\_frames = (int)strtol(argv[6], NULL, 0);}
\DoxyCodeLine{213 }
\DoxyCodeLine{214   encoder = get\_vpx\_encoder\_by\_name(codec\_arg);}
\DoxyCodeLine{215   \textcolor{keywordflow}{if} (!encoder) die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{216 }
\DoxyCodeLine{217   w = (int)strtol(width\_arg, NULL, 0);}
\DoxyCodeLine{218   h = (int)strtol(height\_arg, NULL, 0);}
\DoxyCodeLine{219 }
\DoxyCodeLine{220   \textcolor{keywordflow}{if} (w <= 0 || h <= 0 || (w \% 2) != 0 || (h \% 2) != 0)}
\DoxyCodeLine{221     die(\textcolor{stringliteral}{"{}Invalid frame size: \%dx\%d"{}}, w, h);}
\DoxyCodeLine{222 }
\DoxyCodeLine{223   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, w, h, 1))}
\DoxyCodeLine{224     die(\textcolor{stringliteral}{"{}Failed to allocate image (\%dx\%d)"{}}, w, h);}
\DoxyCodeLine{225 }
\DoxyCodeLine{226   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{227 }
\DoxyCodeLine{228   \textcolor{comment}{// Configuration}}
\DoxyCodeLine{229   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{230   \textcolor{keywordflow}{if} (res) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to get default codec config."{}});}
\DoxyCodeLine{231 }
\DoxyCodeLine{232   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = w;}
\DoxyCodeLine{233   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = h;}
\DoxyCodeLine{234   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = 1;}
\DoxyCodeLine{235   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = fps;}
\DoxyCodeLine{236   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = bitrate;}
\DoxyCodeLine{237 }
\DoxyCodeLine{238   \textcolor{keywordflow}{if} (!(infile = fopen(infile\_arg, \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{239     die(\textcolor{stringliteral}{"{}Failed to open \%s for reading"{}}, infile\_arg);}
\DoxyCodeLine{240 }
\DoxyCodeLine{241   \textcolor{comment}{// Pass 0}}
\DoxyCodeLine{242   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a70d62d87aae7d1168746577f14a6dccf}{g\_pass}} = \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493faa0765945345b160905f3b762986dae3b}{VPX\_RC\_FIRST\_PASS}};}
\DoxyCodeLine{243   stats = pass0(\&raw, infile, encoder, \&cfg, max\_frames);}
\DoxyCodeLine{244 }
\DoxyCodeLine{245   \textcolor{comment}{// Pass 1}}
\DoxyCodeLine{246   rewind(infile);}
\DoxyCodeLine{247   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a70d62d87aae7d1168746577f14a6dccf}{g\_pass}} = \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493fa65da543b956d6a9b1f301ab8cc90d3a7}{VPX\_RC\_LAST\_PASS}};}
\DoxyCodeLine{248   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1bd769247042e5806295f6e06d20f008}{rc\_twopass\_stats\_in}} = stats;}
\DoxyCodeLine{249   pass1(\&raw, infile, outfile\_arg, encoder, \&cfg, max\_frames);}
\DoxyCodeLine{250   free(stats.\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}});}
\DoxyCodeLine{251 }
\DoxyCodeLine{252   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{253   fclose(infile);}
\DoxyCodeLine{254 }
\DoxyCodeLine{255   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{256 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vp8cx_set_ref}{}\doxysubsection{vp8cx\+\_\+set\+\_\+ref}\label{example_vp8cx_set_ref}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// VP8 Set Reference Frame}}
\DoxyCodeLine{12 \textcolor{comment}{// =======================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example demonstrating how to overwrite the VP8 encoder's}}
\DoxyCodeLine{15 \textcolor{comment}{// internal reference frame. In the sample we set the last frame to the}}
\DoxyCodeLine{16 \textcolor{comment}{// current frame. If this is done at a cut scene it will avoid a keyframe.}}
\DoxyCodeLine{17 \textcolor{comment}{// This technique could be used to bounce between two cameras.}}
\DoxyCodeLine{18 \textcolor{comment}{//}}
\DoxyCodeLine{19 \textcolor{comment}{// Note that the decoder would also have to set the reference frame to the}}
\DoxyCodeLine{20 \textcolor{comment}{// same value on the same frame, or the video will become corrupt.}}
\DoxyCodeLine{21 \textcolor{comment}{//}}
\DoxyCodeLine{22 \textcolor{comment}{// Usage}}
\DoxyCodeLine{23 \textcolor{comment}{// -\/-\/-\/-\/-\/}}
\DoxyCodeLine{24 \textcolor{comment}{// This example adds a single argument to the `simple\_encoder` example,}}
\DoxyCodeLine{25 \textcolor{comment}{// which specifies the frame number to update the reference frame on.}}
\DoxyCodeLine{26 \textcolor{comment}{// The parameter is parsed as follows:}}
\DoxyCodeLine{27 \textcolor{comment}{//}}
\DoxyCodeLine{28 \textcolor{comment}{//}}
\DoxyCodeLine{29 \textcolor{comment}{// Extra Variables}}
\DoxyCodeLine{30 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{31 \textcolor{comment}{// This example maintains the frame number passed on the command line}}
\DoxyCodeLine{32 \textcolor{comment}{// in the `update\_frame\_num` variable.}}
\DoxyCodeLine{33 \textcolor{comment}{//}}
\DoxyCodeLine{34 \textcolor{comment}{//}}
\DoxyCodeLine{35 \textcolor{comment}{// Configuration}}
\DoxyCodeLine{36 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{37 \textcolor{comment}{//}}
\DoxyCodeLine{38 \textcolor{comment}{// The reference frame is updated on the frame specified on the command}}
\DoxyCodeLine{39 \textcolor{comment}{// line.}}
\DoxyCodeLine{40 \textcolor{comment}{//}}
\DoxyCodeLine{41 \textcolor{comment}{// Observing The Effects}}
\DoxyCodeLine{42 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{43 \textcolor{comment}{// Use the `simple\_encoder` example to encode a sample with a cut scene.}}
\DoxyCodeLine{44 \textcolor{comment}{// Determine the frame number of the cut scene by looking for a generated}}
\DoxyCodeLine{45 \textcolor{comment}{// key-\/frame (indicated by a 'K'). Supply that frame number as an argument}}
\DoxyCodeLine{46 \textcolor{comment}{// to this example, and observe that no key-\/frame is generated.}}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{53 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{54 \textcolor{preprocessor}{\#include "{}vp8/common/common.h"{}}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{62   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <width> <height> <infile> <outfile> <frame>\(\backslash\)n"{}},}
\DoxyCodeLine{63           exec\_name);}
\DoxyCodeLine{64   exit(EXIT\_FAILURE);}
\DoxyCodeLine{65 \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 \textcolor{keyword}{static} \textcolor{keywordtype}{int} encode\_frame(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec, \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{68                         \textcolor{keywordtype}{int} frame\_index, VpxVideoWriter *writer) \{}
\DoxyCodeLine{69   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{70   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{71   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{72   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{73       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(codec, img, frame\_index, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}});}
\DoxyCodeLine{74   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(codec, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(codec, \&iter)) != NULL) \{}
\DoxyCodeLine{77     got\_pkts = 1;}
\DoxyCodeLine{78 }
\DoxyCodeLine{79     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}) \{}
\DoxyCodeLine{80       \textcolor{keyword}{const} \textcolor{keywordtype}{int} keyframe = (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}}) != 0;}
\DoxyCodeLine{81       \textcolor{keywordflow}{if} (!vpx\_video\_writer\_write\_frame(writer, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{82                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{83                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}})) \{}
\DoxyCodeLine{84         die\_codec(codec, \textcolor{stringliteral}{"{}Failed to write compressed frame"{}});}
\DoxyCodeLine{85       \}}
\DoxyCodeLine{86 }
\DoxyCodeLine{87       printf(keyframe ? \textcolor{stringliteral}{"{}K"{}} : \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{88       fflush(stdout);}
\DoxyCodeLine{89     \}}
\DoxyCodeLine{90   \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{93 \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{96   FILE *infile = NULL;}
\DoxyCodeLine{97   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{98   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{99   \textcolor{keywordtype}{int} frame\_count = 0;}
\DoxyCodeLine{100   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{101   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{102   VpxVideoInfo info;}
\DoxyCodeLine{103   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{104   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{105   \textcolor{keywordtype}{int} update\_frame\_num = 0;}
\DoxyCodeLine{106   \textcolor{keyword}{const} \textcolor{keywordtype}{int} fps = 30;       \textcolor{comment}{// TODO(dkovalev) add command line argument}}
\DoxyCodeLine{107   \textcolor{keyword}{const} \textcolor{keywordtype}{int} bitrate = 200;  \textcolor{comment}{// kbit/s TODO(dkovalev) add command line argument}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109   vp8\_zero(codec);}
\DoxyCodeLine{110   vp8\_zero(cfg);}
\DoxyCodeLine{111   vp8\_zero(info);}
\DoxyCodeLine{112 }
\DoxyCodeLine{113   exec\_name = argv[0];}
\DoxyCodeLine{114 }
\DoxyCodeLine{115   \textcolor{keywordflow}{if} (argc != 6) die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{116 }
\DoxyCodeLine{117   \textcolor{comment}{// TODO(dkovalev): add vp9 support and rename the file accordingly}}
\DoxyCodeLine{118   encoder = get\_vpx\_encoder\_by\_name(\textcolor{stringliteral}{"{}vp8"{}});}
\DoxyCodeLine{119   \textcolor{keywordflow}{if} (!encoder) die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{120 }
\DoxyCodeLine{121   update\_frame\_num = atoi(argv[5]);}
\DoxyCodeLine{122   \textcolor{keywordflow}{if} (!update\_frame\_num) die(\textcolor{stringliteral}{"{}Couldn't parse frame number '\%s'\(\backslash\)n"{}}, argv[5]);}
\DoxyCodeLine{123 }
\DoxyCodeLine{124   info.codec\_fourcc = encoder-\/>fourcc;}
\DoxyCodeLine{125   info.frame\_width = (int)strtol(argv[1], NULL, 0);}
\DoxyCodeLine{126   info.frame\_height = (int)strtol(argv[2], NULL, 0);}
\DoxyCodeLine{127   info.time\_base.numerator = 1;}
\DoxyCodeLine{128   info.time\_base.denominator = fps;}
\DoxyCodeLine{129 }
\DoxyCodeLine{130   \textcolor{keywordflow}{if} (info.frame\_width <= 0 || info.frame\_height <= 0 ||}
\DoxyCodeLine{131       (info.frame\_width \% 2) != 0 || (info.frame\_height \% 2) != 0) \{}
\DoxyCodeLine{132     die(\textcolor{stringliteral}{"{}Invalid frame size: \%dx\%d"{}}, info.frame\_width, info.frame\_height);}
\DoxyCodeLine{133   \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, info.frame\_width,}
\DoxyCodeLine{136                      info.frame\_height, 1)) \{}
\DoxyCodeLine{137     die(\textcolor{stringliteral}{"{}Failed to allocate image."{}});}
\DoxyCodeLine{138   \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{141 }
\DoxyCodeLine{142   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{143   \textcolor{keywordflow}{if} (res) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to get default codec config."{}});}
\DoxyCodeLine{144 }
\DoxyCodeLine{145   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = info.frame\_width;}
\DoxyCodeLine{146   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = info.frame\_height;}
\DoxyCodeLine{147   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = info.time\_base.numerator;}
\DoxyCodeLine{148   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = info.time\_base.denominator;}
\DoxyCodeLine{149   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = bitrate;}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   writer = vpx\_video\_writer\_open(argv[4], kContainerIVF, \&info);}
\DoxyCodeLine{152   \textcolor{keywordflow}{if} (!writer) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, argv[4]);}
\DoxyCodeLine{153 }
\DoxyCodeLine{154   \textcolor{keywordflow}{if} (!(infile = fopen(argv[3], \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{155     die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[3]);}
\DoxyCodeLine{156 }
\DoxyCodeLine{157   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), \&cfg, 0))}
\DoxyCodeLine{158     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{159 }
\DoxyCodeLine{160   \textcolor{comment}{// Encode frames.}}
\DoxyCodeLine{161   \textcolor{keywordflow}{while} (vpx\_img\_read(\&raw, infile)) \{}
\DoxyCodeLine{162     \textcolor{keywordflow}{if} (frame\_count + 1 == update\_frame\_num) \{}
\DoxyCodeLine{163       \mbox{\hyperlink{structvpx__ref__frame}{vpx\_ref\_frame\_t}} ref;}
\DoxyCodeLine{164       ref.\mbox{\hyperlink{structvpx__ref__frame_a7fbe51de592d0ff16d9fbd4d2b367c9b}{frame\_type}} = VP8\_LAST\_FRAME;}
\DoxyCodeLine{165       ref.\mbox{\hyperlink{structvpx__ref__frame_a972d24d0243f51f84eef7e1b79c6c414}{img}} = raw;}
\DoxyCodeLine{166       \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a7abc38d739a5ef49c36d9b2cd88e64a6}{VP8\_SET\_REFERENCE}}, \&ref))}
\DoxyCodeLine{167         die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to set reference frame"{}});}
\DoxyCodeLine{168     \}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170     encode\_frame(\&codec, \&raw, frame\_count++, writer);}
\DoxyCodeLine{171   \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{173   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{174   \textcolor{keywordflow}{while} (encode\_frame(\&codec, NULL, -\/1, writer)) \{}
\DoxyCodeLine{175   \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{178   fclose(infile);}
\DoxyCodeLine{179   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_count);}
\DoxyCodeLine{180 }
\DoxyCodeLine{181   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{182   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{183 }
\DoxyCodeLine{184   vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{185 }
\DoxyCodeLine{186   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{187 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vp9_lossless_encoder}{}\doxysubsection{vp9\+\_\+lossless\+\_\+encoder}\label{example_vp9_lossless_encoder}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2014 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}vp9/common/vp9\_common.h"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{25   fprintf(stderr,}
\DoxyCodeLine{26           \textcolor{stringliteral}{"{}vp9\_lossless\_encoder: Example demonstrating VP9 lossless "{}}}
\DoxyCodeLine{27           \textcolor{stringliteral}{"{}encoding feature. Supports raw input only.\(\backslash\)n"{}});}
\DoxyCodeLine{28   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <width> <height> <infile> <outfile>\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{29   exit(EXIT\_FAILURE);}
\DoxyCodeLine{30 \}}
\DoxyCodeLine{31 }
\DoxyCodeLine{32 \textcolor{keyword}{static} \textcolor{keywordtype}{int} encode\_frame(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec, \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{33                         \textcolor{keywordtype}{int} frame\_index, \textcolor{keywordtype}{int} flags, VpxVideoWriter *writer) \{}
\DoxyCodeLine{34   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{35   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{36   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{37   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{38       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(codec, img, frame\_index, 1, flags, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}});}
\DoxyCodeLine{39   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(codec, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(codec, \&iter)) != NULL) \{}
\DoxyCodeLine{42     got\_pkts = 1;}
\DoxyCodeLine{43 }
\DoxyCodeLine{44     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}) \{}
\DoxyCodeLine{45       \textcolor{keyword}{const} \textcolor{keywordtype}{int} keyframe = (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}}) != 0;}
\DoxyCodeLine{46       \textcolor{keywordflow}{if} (!vpx\_video\_writer\_write\_frame(writer, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{47                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{48                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}})) \{}
\DoxyCodeLine{49         die\_codec(codec, \textcolor{stringliteral}{"{}Failed to write compressed frame"{}});}
\DoxyCodeLine{50       \}}
\DoxyCodeLine{51       printf(keyframe ? \textcolor{stringliteral}{"{}K"{}} : \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{52       fflush(stdout);}
\DoxyCodeLine{53     \}}
\DoxyCodeLine{54   \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{57 \}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{60   FILE *infile = NULL;}
\DoxyCodeLine{61   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{62   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{63   \textcolor{keywordtype}{int} frame\_count = 0;}
\DoxyCodeLine{64   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{65   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{66   VpxVideoInfo info;}
\DoxyCodeLine{67   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{68   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{69   \textcolor{keyword}{const} \textcolor{keywordtype}{int} fps = 30;}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   vp9\_zero(info);}
\DoxyCodeLine{72 }
\DoxyCodeLine{73   exec\_name = argv[0];}
\DoxyCodeLine{74 }
\DoxyCodeLine{75   \textcolor{keywordflow}{if} (argc < 5) die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{76 }
\DoxyCodeLine{77   encoder = get\_vpx\_encoder\_by\_name(\textcolor{stringliteral}{"{}vp9"{}});}
\DoxyCodeLine{78   \textcolor{keywordflow}{if} (!encoder) die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{79 }
\DoxyCodeLine{80   info.codec\_fourcc = encoder-\/>fourcc;}
\DoxyCodeLine{81   info.frame\_width = (int)strtol(argv[1], NULL, 0);}
\DoxyCodeLine{82   info.frame\_height = (int)strtol(argv[2], NULL, 0);}
\DoxyCodeLine{83   info.time\_base.numerator = 1;}
\DoxyCodeLine{84   info.time\_base.denominator = fps;}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   \textcolor{keywordflow}{if} (info.frame\_width <= 0 || info.frame\_height <= 0 ||}
\DoxyCodeLine{87       (info.frame\_width \% 2) != 0 || (info.frame\_height \% 2) != 0) \{}
\DoxyCodeLine{88     die(\textcolor{stringliteral}{"{}Invalid frame size: \%dx\%d"{}}, info.frame\_width, info.frame\_height);}
\DoxyCodeLine{89   \}}
\DoxyCodeLine{90 }
\DoxyCodeLine{91   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, info.frame\_width,}
\DoxyCodeLine{92                      info.frame\_height, 1)) \{}
\DoxyCodeLine{93     die(\textcolor{stringliteral}{"{}Failed to allocate image."{}});}
\DoxyCodeLine{94   \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{99   \textcolor{keywordflow}{if} (res) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to get default codec config."{}});}
\DoxyCodeLine{100 }
\DoxyCodeLine{101   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = info.frame\_width;}
\DoxyCodeLine{102   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = info.frame\_height;}
\DoxyCodeLine{103   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = info.time\_base.numerator;}
\DoxyCodeLine{104   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = info.time\_base.denominator;}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   writer = vpx\_video\_writer\_open(argv[4], kContainerIVF, \&info);}
\DoxyCodeLine{107   \textcolor{keywordflow}{if} (!writer) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, argv[4]);}
\DoxyCodeLine{108 }
\DoxyCodeLine{109   \textcolor{keywordflow}{if} (!(infile = fopen(argv[3], \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{110     die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, argv[3]);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), \&cfg, 0))}
\DoxyCodeLine{113     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{114 }
\DoxyCodeLine{115   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gaf7849b69cc390b21d889c8c71f69ec14}{vpx\_codec\_control\_}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca7224f4edeeaf940584e6fe3ff2345b86}{VP9E\_SET\_LOSSLESS}}, 1))}
\DoxyCodeLine{116     die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to use lossless mode"{}});}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   \textcolor{comment}{// Encode frames.}}
\DoxyCodeLine{119   \textcolor{keywordflow}{while} (vpx\_img\_read(\&raw, infile)) \{}
\DoxyCodeLine{120     encode\_frame(\&codec, \&raw, frame\_count++, 0, writer);}
\DoxyCodeLine{121   \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{124   \textcolor{keywordflow}{while} (encode\_frame(\&codec, NULL, -\/1, 0, writer)) \{}
\DoxyCodeLine{125   \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{128   fclose(infile);}
\DoxyCodeLine{129   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_count);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{132   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec."{}});}
\DoxyCodeLine{133 }
\DoxyCodeLine{134   vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{135 }
\DoxyCodeLine{136   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{137 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vp9_spatial_svc_encoder}{}\doxysubsection{vp9\+\_\+spatial\+\_\+svc\+\_\+encoder}\label{example_vp9_spatial_svc_encoder}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2012 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{/*}}
\DoxyCodeLine{12 \textcolor{comment}{ * This is an example demonstrating how to implement a multi-\/layer}}
\DoxyCodeLine{13 \textcolor{comment}{ * VP9 encoding scheme based on spatial scalability for video applications}}
\DoxyCodeLine{14 \textcolor{comment}{ * that benefit from a scalable bitstream.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <time.h>}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}../args.h"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}../vpx\_ports/vpx\_timer.h"{}}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}./svc\_context.h"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include "{}../vpxstats.h"{}}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include "{}vp9/encoder/vp9\_encoder.h"{}}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include "{}./y4minput.h"{}}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{preprocessor}{\#define OUTPUT\_RC\_STATS 1}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{preprocessor}{\#define SIMULCAST\_MODE 0}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t outputfile =}
\DoxyCodeLine{40     ARG\_DEF(\textcolor{stringliteral}{"{}o"{}}, \textcolor{stringliteral}{"{}output"{}}, 1, \textcolor{stringliteral}{"{}Output filename"{}});}
\DoxyCodeLine{41 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t skip\_frames\_arg =}
\DoxyCodeLine{42     ARG\_DEF(\textcolor{stringliteral}{"{}s"{}}, \textcolor{stringliteral}{"{}skip-\/frames"{}}, 1, \textcolor{stringliteral}{"{}input frames to skip"{}});}
\DoxyCodeLine{43 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t frames\_arg =}
\DoxyCodeLine{44     ARG\_DEF(\textcolor{stringliteral}{"{}f"{}}, \textcolor{stringliteral}{"{}frames"{}}, 1, \textcolor{stringliteral}{"{}number of frames to encode"{}});}
\DoxyCodeLine{45 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t threads\_arg =}
\DoxyCodeLine{46     ARG\_DEF(\textcolor{stringliteral}{"{}th"{}}, \textcolor{stringliteral}{"{}threads"{}}, 1, \textcolor{stringliteral}{"{}number of threads to use"{}});}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{48 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t output\_rc\_stats\_arg =}
\DoxyCodeLine{49     ARG\_DEF(\textcolor{stringliteral}{"{}rcstat"{}}, \textcolor{stringliteral}{"{}output\_rc\_stats"{}}, 1, \textcolor{stringliteral}{"{}output rc stats"{}});}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{51 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t width\_arg = ARG\_DEF(\textcolor{stringliteral}{"{}w"{}}, \textcolor{stringliteral}{"{}width"{}}, 1, \textcolor{stringliteral}{"{}source width"{}});}
\DoxyCodeLine{52 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t height\_arg = ARG\_DEF(\textcolor{stringliteral}{"{}h"{}}, \textcolor{stringliteral}{"{}height"{}}, 1, \textcolor{stringliteral}{"{}source height"{}});}
\DoxyCodeLine{53 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t timebase\_arg =}
\DoxyCodeLine{54     ARG\_DEF(\textcolor{stringliteral}{"{}t"{}}, \textcolor{stringliteral}{"{}timebase"{}}, 1, \textcolor{stringliteral}{"{}timebase (num/den)"{}});}
\DoxyCodeLine{55 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t bitrate\_arg = ARG\_DEF(}
\DoxyCodeLine{56     \textcolor{stringliteral}{"{}b"{}}, \textcolor{stringliteral}{"{}target-\/bitrate"{}}, 1, \textcolor{stringliteral}{"{}encoding bitrate, in kilobits per second"{}});}
\DoxyCodeLine{57 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t spatial\_layers\_arg =}
\DoxyCodeLine{58     ARG\_DEF(\textcolor{stringliteral}{"{}sl"{}}, \textcolor{stringliteral}{"{}spatial-\/layers"{}}, 1, \textcolor{stringliteral}{"{}number of spatial SVC layers"{}});}
\DoxyCodeLine{59 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t temporal\_layers\_arg =}
\DoxyCodeLine{60     ARG\_DEF(\textcolor{stringliteral}{"{}tl"{}}, \textcolor{stringliteral}{"{}temporal-\/layers"{}}, 1, \textcolor{stringliteral}{"{}number of temporal SVC layers"{}});}
\DoxyCodeLine{61 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t temporal\_layering\_mode\_arg =}
\DoxyCodeLine{62     ARG\_DEF(\textcolor{stringliteral}{"{}tlm"{}}, \textcolor{stringliteral}{"{}temporal-\/layering-\/mode"{}}, 1,}
\DoxyCodeLine{63             \textcolor{stringliteral}{"{}temporal layering scheme."{}}}
\DoxyCodeLine{64             \textcolor{stringliteral}{"{}VP9E\_TEMPORAL\_LAYERING\_MODE"{}});}
\DoxyCodeLine{65 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_dist\_arg =}
\DoxyCodeLine{66     ARG\_DEF(\textcolor{stringliteral}{"{}k"{}}, \textcolor{stringliteral}{"{}kf-\/dist"{}}, 1, \textcolor{stringliteral}{"{}number of frames between keyframes"{}});}
\DoxyCodeLine{67 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t scale\_factors\_arg =}
\DoxyCodeLine{68     ARG\_DEF(\textcolor{stringliteral}{"{}r"{}}, \textcolor{stringliteral}{"{}scale-\/factors"{}}, 1, \textcolor{stringliteral}{"{}scale factors (lowest to highest layer)"{}});}
\DoxyCodeLine{69 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t min\_q\_arg =}
\DoxyCodeLine{70     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}min-\/q"{}}, 1, \textcolor{stringliteral}{"{}Minimum quantizer"{}});}
\DoxyCodeLine{71 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t max\_q\_arg =}
\DoxyCodeLine{72     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}max-\/q"{}}, 1, \textcolor{stringliteral}{"{}Maximum quantizer"{}});}
\DoxyCodeLine{73 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t min\_bitrate\_arg =}
\DoxyCodeLine{74     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}min-\/bitrate"{}}, 1, \textcolor{stringliteral}{"{}Minimum bitrate"{}});}
\DoxyCodeLine{75 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t max\_bitrate\_arg =}
\DoxyCodeLine{76     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}max-\/bitrate"{}}, 1, \textcolor{stringliteral}{"{}Maximum bitrate"{}});}
\DoxyCodeLine{77 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t lag\_in\_frame\_arg =}
\DoxyCodeLine{78     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}lag-\/in-\/frames"{}}, 1,}
\DoxyCodeLine{79             \textcolor{stringliteral}{"{}Number of frame to input before "{}}}
\DoxyCodeLine{80             \textcolor{stringliteral}{"{}generating any outputs"{}});}
\DoxyCodeLine{81 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rc\_end\_usage\_arg =}
\DoxyCodeLine{82     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}rc-\/end-\/usage"{}}, 1, \textcolor{stringliteral}{"{}0 -\/ 3: VBR, CBR, CQ, Q"{}});}
\DoxyCodeLine{83 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t speed\_arg =}
\DoxyCodeLine{84     ARG\_DEF(\textcolor{stringliteral}{"{}sp"{}}, \textcolor{stringliteral}{"{}speed"{}}, 1, \textcolor{stringliteral}{"{}speed configuration"{}});}
\DoxyCodeLine{85 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t aqmode\_arg =}
\DoxyCodeLine{86     ARG\_DEF(\textcolor{stringliteral}{"{}aq"{}}, \textcolor{stringliteral}{"{}aqmode"{}}, 1, \textcolor{stringliteral}{"{}aq-\/mode off/on"{}});}
\DoxyCodeLine{87 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t bitrates\_arg =}
\DoxyCodeLine{88     ARG\_DEF(\textcolor{stringliteral}{"{}bl"{}}, \textcolor{stringliteral}{"{}bitrates"{}}, 1, \textcolor{stringliteral}{"{}bitrates[sl * num\_tl + tl]"{}});}
\DoxyCodeLine{89 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t dropframe\_thresh\_arg =}
\DoxyCodeLine{90     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}drop-\/frame"{}}, 1, \textcolor{stringliteral}{"{}Temporal resampling threshold (buf \%)"{}});}
\DoxyCodeLine{91 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list tune\_content\_enum[] = \{}
\DoxyCodeLine{92   \{ \textcolor{stringliteral}{"{}default"{}}, VP9E\_CONTENT\_DEFAULT \},}
\DoxyCodeLine{93   \{ \textcolor{stringliteral}{"{}screen"{}}, VP9E\_CONTENT\_SCREEN \},}
\DoxyCodeLine{94   \{ \textcolor{stringliteral}{"{}film"{}}, VP9E\_CONTENT\_FILM \},}
\DoxyCodeLine{95   \{ NULL, 0 \}}
\DoxyCodeLine{96 \};}
\DoxyCodeLine{97 }
\DoxyCodeLine{98 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t tune\_content\_arg = ARG\_DEF\_ENUM(}
\DoxyCodeLine{99     NULL, \textcolor{stringliteral}{"{}tune-\/content"{}}, 1, \textcolor{stringliteral}{"{}Tune content type"{}}, tune\_content\_enum);}
\DoxyCodeLine{100 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t inter\_layer\_pred\_arg = ARG\_DEF(}
\DoxyCodeLine{101     NULL, \textcolor{stringliteral}{"{}inter-\/layer-\/pred"{}}, 1, \textcolor{stringliteral}{"{}0 -\/ 3: On, Off, Key-\/frames, Constrained"{}});}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{104 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list bitdepth\_enum[] = \{}
\DoxyCodeLine{105   \{ \textcolor{stringliteral}{"{}8"{}}, \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}} \}, \{ \textcolor{stringliteral}{"{}10"{}}, \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9aaecd7245969d06b539de89cf580401e1}{VPX\_BITS\_10}} \}, \{ \textcolor{stringliteral}{"{}12"{}}, \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a7d053a31e269b4d3746e88b0ff424862}{VPX\_BITS\_12}} \}, \{ NULL, 0 \}}
\DoxyCodeLine{106 \};}
\DoxyCodeLine{107 }
\DoxyCodeLine{108 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t bitdepth\_arg = ARG\_DEF\_ENUM(}
\DoxyCodeLine{109     \textcolor{stringliteral}{"{}d"{}}, \textcolor{stringliteral}{"{}bit-\/depth"{}}, 1, \textcolor{stringliteral}{"{}Bit depth for codec 8, 10 or 12. "{}}, bitdepth\_enum);}
\DoxyCodeLine{110 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *svc\_args[] = \{ \&frames\_arg,}
\DoxyCodeLine{113                                        \&outputfile,}
\DoxyCodeLine{114                                        \&width\_arg,}
\DoxyCodeLine{115                                        \&height\_arg,}
\DoxyCodeLine{116                                        \&timebase\_arg,}
\DoxyCodeLine{117                                        \&bitrate\_arg,}
\DoxyCodeLine{118                                        \&skip\_frames\_arg,}
\DoxyCodeLine{119                                        \&spatial\_layers\_arg,}
\DoxyCodeLine{120                                        \&kf\_dist\_arg,}
\DoxyCodeLine{121                                        \&scale\_factors\_arg,}
\DoxyCodeLine{122                                        \&min\_q\_arg,}
\DoxyCodeLine{123                                        \&max\_q\_arg,}
\DoxyCodeLine{124                                        \&min\_bitrate\_arg,}
\DoxyCodeLine{125                                        \&max\_bitrate\_arg,}
\DoxyCodeLine{126                                        \&temporal\_layers\_arg,}
\DoxyCodeLine{127                                        \&temporal\_layering\_mode\_arg,}
\DoxyCodeLine{128                                        \&lag\_in\_frame\_arg,}
\DoxyCodeLine{129                                        \&threads\_arg,}
\DoxyCodeLine{130                                        \&aqmode\_arg,}
\DoxyCodeLine{131 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{132                                        \&output\_rc\_stats\_arg,}
\DoxyCodeLine{133 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{136                                        \&bitdepth\_arg,}
\DoxyCodeLine{137 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{138                                        \&speed\_arg,}
\DoxyCodeLine{139                                        \&rc\_end\_usage\_arg,}
\DoxyCodeLine{140                                        \&bitrates\_arg,}
\DoxyCodeLine{141                                        \&dropframe\_thresh\_arg,}
\DoxyCodeLine{142                                        \&tune\_content\_arg,}
\DoxyCodeLine{143                                        \&inter\_layer\_pred\_arg,}
\DoxyCodeLine{144                                        NULL \};}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_frames\_to\_skip = 0;}
\DoxyCodeLine{147 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_frames\_to\_code = 60 * 60;}
\DoxyCodeLine{148 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_width = 1920;}
\DoxyCodeLine{149 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_height = 1080;}
\DoxyCodeLine{150 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_timebase\_num = 1;}
\DoxyCodeLine{151 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_timebase\_den = 60;}
\DoxyCodeLine{152 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_bitrate = 1000;}
\DoxyCodeLine{153 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_spatial\_layers = 5;}
\DoxyCodeLine{154 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_temporal\_layers = 1;}
\DoxyCodeLine{155 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_kf\_dist = 100;}
\DoxyCodeLine{156 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_temporal\_layering\_mode = 0;}
\DoxyCodeLine{157 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_output\_rc\_stats = 0;}
\DoxyCodeLine{158 \textcolor{keyword}{static} \textcolor{keyword}{const} int32\_t default\_speed = -\/1;    \textcolor{comment}{// -\/1 means use library default.}}
\DoxyCodeLine{159 \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t default\_threads = 0;  \textcolor{comment}{// zero means use library default.}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{162   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *output\_filename;}
\DoxyCodeLine{163   uint32\_t frames\_to\_code;}
\DoxyCodeLine{164   uint32\_t frames\_to\_skip;}
\DoxyCodeLine{165   \textcolor{keyword}{struct }VpxInputContext input\_ctx;}
\DoxyCodeLine{166   stats\_io\_t rc\_stats;}
\DoxyCodeLine{167   \textcolor{keywordtype}{int} tune\_content;}
\DoxyCodeLine{168   \textcolor{keywordtype}{int} inter\_layer\_pred;}
\DoxyCodeLine{169 \} AppInput;}
\DoxyCodeLine{170 }
\DoxyCodeLine{171 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{172 }
\DoxyCodeLine{173 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{174   fprintf(stderr, \textcolor{stringliteral}{"{}Usage: \%s <options> input\_filename -\/o output\_filename\(\backslash\)n"{}},}
\DoxyCodeLine{175           exec\_name);}
\DoxyCodeLine{176   fprintf(stderr, \textcolor{stringliteral}{"{}Options:\(\backslash\)n"{}});}
\DoxyCodeLine{177   arg\_show\_usage(stderr, svc\_args);}
\DoxyCodeLine{178   exit(EXIT\_FAILURE);}
\DoxyCodeLine{179 \}}
\DoxyCodeLine{180 }
\DoxyCodeLine{181 \textcolor{keyword}{static} \textcolor{keywordtype}{void} parse\_command\_line(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv\_,}
\DoxyCodeLine{182                                AppInput *app\_input, SvcContext *svc\_ctx,}
\DoxyCodeLine{183                                \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *enc\_cfg) \{}
\DoxyCodeLine{184   \textcolor{keyword}{struct }arg arg;}
\DoxyCodeLine{185   \textcolor{keywordtype}{char} **argv = NULL;}
\DoxyCodeLine{186   \textcolor{keywordtype}{char} **argi = NULL;}
\DoxyCodeLine{187   \textcolor{keywordtype}{char} **argj = NULL;}
\DoxyCodeLine{188   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{189   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} min\_bitrate = 0;}
\DoxyCodeLine{190   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} max\_bitrate = 0;}
\DoxyCodeLine{191   \textcolor{keywordtype}{char} string\_options[1024] = \{ 0 \};}
\DoxyCodeLine{192 }
\DoxyCodeLine{193   \textcolor{comment}{// initialize SvcContext with parameters that will be passed to vpx\_svc\_init}}
\DoxyCodeLine{194   svc\_ctx-\/>log\_level = SVC\_LOG\_DEBUG;}
\DoxyCodeLine{195   svc\_ctx-\/>spatial\_layers = default\_spatial\_layers;}
\DoxyCodeLine{196   svc\_ctx-\/>temporal\_layers = default\_temporal\_layers;}
\DoxyCodeLine{197   svc\_ctx-\/>temporal\_layering\_mode = default\_temporal\_layering\_mode;}
\DoxyCodeLine{198 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{199   svc\_ctx-\/>output\_rc\_stat = default\_output\_rc\_stats;}
\DoxyCodeLine{200 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{201   svc\_ctx-\/>speed = default\_speed;}
\DoxyCodeLine{202   svc\_ctx-\/>threads = default\_threads;}
\DoxyCodeLine{203 }
\DoxyCodeLine{204   \textcolor{comment}{// start with default encoder configuration}}
\DoxyCodeLine{205   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(vpx\_codec\_vp9\_cx(), enc\_cfg, 0);}
\DoxyCodeLine{206   \textcolor{keywordflow}{if} (res) \{}
\DoxyCodeLine{207     die(\textcolor{stringliteral}{"{}Failed to get config: \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga550c4616424a08e85fc102486846141e}{vpx\_codec\_err\_to\_string}}(res));}
\DoxyCodeLine{208   \}}
\DoxyCodeLine{209   \textcolor{comment}{// update enc\_cfg with app default values}}
\DoxyCodeLine{210   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = default\_width;}
\DoxyCodeLine{211   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = default\_height;}
\DoxyCodeLine{212   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = default\_timebase\_num;}
\DoxyCodeLine{213   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = default\_timebase\_den;}
\DoxyCodeLine{214   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = default\_bitrate;}
\DoxyCodeLine{215   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a0a7b5444ecb09745cbe8d5af17553846}{kf\_min\_dist}} = default\_kf\_dist;}
\DoxyCodeLine{216   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ae018440136e271743376730413d25a9b}{kf\_max\_dist}} = default\_kf\_dist;}
\DoxyCodeLine{217   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a99c415edb6c6f909a095a57c3430a116}{rc\_end\_usage}} = \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2a5f2fd02b55c67d62bfd79380bcb03f63}{VPX\_CQ}};}
\DoxyCodeLine{218 }
\DoxyCodeLine{219   \textcolor{comment}{// initialize AppInput with default values}}
\DoxyCodeLine{220   app\_input-\/>frames\_to\_code = default\_frames\_to\_code;}
\DoxyCodeLine{221   app\_input-\/>frames\_to\_skip = default\_frames\_to\_skip;}
\DoxyCodeLine{222 }
\DoxyCodeLine{223   \textcolor{comment}{// process command line options}}
\DoxyCodeLine{224   argv = argv\_dup(argc -\/ 1, argv\_ + 1);}
\DoxyCodeLine{225   \textcolor{keywordflow}{for} (argi = argj = argv; (*argj = *argi); argi += arg.argv\_step) \{}
\DoxyCodeLine{226     arg.argv\_step = 1;}
\DoxyCodeLine{227 }
\DoxyCodeLine{228     \textcolor{keywordflow}{if} (arg\_match(\&arg, \&frames\_arg, argi)) \{}
\DoxyCodeLine{229       app\_input-\/>frames\_to\_code = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{230     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&outputfile, argi)) \{}
\DoxyCodeLine{231       app\_input-\/>output\_filename = arg.val;}
\DoxyCodeLine{232     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&width\_arg, argi)) \{}
\DoxyCodeLine{233       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{234     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&height\_arg, argi)) \{}
\DoxyCodeLine{235       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{236     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&timebase\_arg, argi)) \{}
\DoxyCodeLine{237       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}} = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{238     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&bitrate\_arg, argi)) \{}
\DoxyCodeLine{239       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{240     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&skip\_frames\_arg, argi)) \{}
\DoxyCodeLine{241       app\_input-\/>frames\_to\_skip = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{242     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&spatial\_layers\_arg, argi)) \{}
\DoxyCodeLine{243       svc\_ctx-\/>spatial\_layers = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{244     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&temporal\_layers\_arg, argi)) \{}
\DoxyCodeLine{245       svc\_ctx-\/>temporal\_layers = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{246 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{247     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&output\_rc\_stats\_arg, argi)) \{}
\DoxyCodeLine{248       svc\_ctx-\/>output\_rc\_stat = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{249 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{250     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&speed\_arg, argi)) \{}
\DoxyCodeLine{251       svc\_ctx-\/>speed = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{252       \textcolor{keywordflow}{if} (svc\_ctx-\/>speed > 9) \{}
\DoxyCodeLine{253         warn(\textcolor{stringliteral}{"{}Mapping speed \%d to speed 9.\(\backslash\)n"{}}, svc\_ctx-\/>speed);}
\DoxyCodeLine{254       \}}
\DoxyCodeLine{255     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&aqmode\_arg, argi)) \{}
\DoxyCodeLine{256       svc\_ctx-\/>aqmode = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{257     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&threads\_arg, argi)) \{}
\DoxyCodeLine{258       svc\_ctx-\/>threads = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{259     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&temporal\_layering\_mode\_arg, argi)) \{}
\DoxyCodeLine{260       svc\_ctx-\/>temporal\_layering\_mode = enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a07c78dd29423d5ab475b9d77a0107d16}{temporal\_layering\_mode}} =}
\DoxyCodeLine{261           arg\_parse\_int(\&arg);}
\DoxyCodeLine{262       \textcolor{keywordflow}{if} (svc\_ctx-\/>temporal\_layering\_mode) \{}
\DoxyCodeLine{263         enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4e17173b66ca0d7dfba9978625d7ba76}{g\_error\_resilient}} = 1;}
\DoxyCodeLine{264       \}}
\DoxyCodeLine{265     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_dist\_arg, argi)) \{}
\DoxyCodeLine{266       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a0a7b5444ecb09745cbe8d5af17553846}{kf\_min\_dist}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{267       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ae018440136e271743376730413d25a9b}{kf\_max\_dist}} = enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a0a7b5444ecb09745cbe8d5af17553846}{kf\_min\_dist}};}
\DoxyCodeLine{268     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&scale\_factors\_arg, argi)) \{}
\DoxyCodeLine{269       strncat(string\_options, \textcolor{stringliteral}{"{} scale-\/factors="{}},}
\DoxyCodeLine{270               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{271       strncat(string\_options, arg.val,}
\DoxyCodeLine{272               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{273     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&bitrates\_arg, argi)) \{}
\DoxyCodeLine{274       strncat(string\_options, \textcolor{stringliteral}{"{} bitrates="{}},}
\DoxyCodeLine{275               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{276       strncat(string\_options, arg.val,}
\DoxyCodeLine{277               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{278     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&min\_q\_arg, argi)) \{}
\DoxyCodeLine{279       strncat(string\_options, \textcolor{stringliteral}{"{} min-\/quantizers="{}},}
\DoxyCodeLine{280               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{281       strncat(string\_options, arg.val,}
\DoxyCodeLine{282               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{283     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&max\_q\_arg, argi)) \{}
\DoxyCodeLine{284       strncat(string\_options, \textcolor{stringliteral}{"{} max-\/quantizers="{}},}
\DoxyCodeLine{285               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{286       strncat(string\_options, arg.val,}
\DoxyCodeLine{287               \textcolor{keyword}{sizeof}(string\_options) -\/ strlen(string\_options) -\/ 1);}
\DoxyCodeLine{288     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&min\_bitrate\_arg, argi)) \{}
\DoxyCodeLine{289       min\_bitrate = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{290     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&max\_bitrate\_arg, argi)) \{}
\DoxyCodeLine{291       max\_bitrate = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{292     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&lag\_in\_frame\_arg, argi)) \{}
\DoxyCodeLine{293       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a992668d9e30305f3f7ab2672ea31a890}{g\_lag\_in\_frames}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{294     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rc\_end\_usage\_arg, argi)) \{}
\DoxyCodeLine{295       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a99c415edb6c6f909a095a57c3430a116}{rc\_end\_usage}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{296 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{297     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&bitdepth\_arg, argi)) \{}
\DoxyCodeLine{298       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_aaaa7bca27fd42f24a2c215b247ba9190}{g\_bit\_depth}} = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{299       \textcolor{keywordflow}{switch} (enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_aaaa7bca27fd42f24a2c215b247ba9190}{g\_bit\_depth}}) \{}
\DoxyCodeLine{300         \textcolor{keywordflow}{case} \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}}:}
\DoxyCodeLine{301           enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_abebad3c575d7a5ba6c09a52fedb7d762}{g\_input\_bit\_depth}} = 8;}
\DoxyCodeLine{302           enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3d7fe3a8b237338c094d5a956a41804d}{g\_profile}} = 0;}
\DoxyCodeLine{303           \textcolor{keywordflow}{break};}
\DoxyCodeLine{304         \textcolor{keywordflow}{case} \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9aaecd7245969d06b539de89cf580401e1}{VPX\_BITS\_10}}:}
\DoxyCodeLine{305           enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_abebad3c575d7a5ba6c09a52fedb7d762}{g\_input\_bit\_depth}} = 10;}
\DoxyCodeLine{306           enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3d7fe3a8b237338c094d5a956a41804d}{g\_profile}} = 2;}
\DoxyCodeLine{307           \textcolor{keywordflow}{break};}
\DoxyCodeLine{308         \textcolor{keywordflow}{case} \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a7d053a31e269b4d3746e88b0ff424862}{VPX\_BITS\_12}}:}
\DoxyCodeLine{309           enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_abebad3c575d7a5ba6c09a52fedb7d762}{g\_input\_bit\_depth}} = 12;}
\DoxyCodeLine{310           enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3d7fe3a8b237338c094d5a956a41804d}{g\_profile}} = 2;}
\DoxyCodeLine{311           \textcolor{keywordflow}{break};}
\DoxyCodeLine{312         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{313           die(\textcolor{stringliteral}{"{}Error: Invalid bit depth selected (\%d)\(\backslash\)n"{}}, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_aaaa7bca27fd42f24a2c215b247ba9190}{g\_bit\_depth}});}
\DoxyCodeLine{314           \textcolor{keywordflow}{break};}
\DoxyCodeLine{315       \}}
\DoxyCodeLine{316 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{317     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&dropframe\_thresh\_arg, argi)) \{}
\DoxyCodeLine{318       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a619269f9a6904de58c4790e6806a3905}{rc\_dropframe\_thresh}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{319     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&tune\_content\_arg, argi)) \{}
\DoxyCodeLine{320       app\_input-\/>tune\_content = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{321     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&inter\_layer\_pred\_arg, argi)) \{}
\DoxyCodeLine{322       app\_input-\/>inter\_layer\_pred = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{323     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{324       ++argj;}
\DoxyCodeLine{325     \}}
\DoxyCodeLine{326   \}}
\DoxyCodeLine{327 }
\DoxyCodeLine{328   \textcolor{comment}{// There will be a space in front of the string options}}
\DoxyCodeLine{329   \textcolor{keywordflow}{if} (strlen(string\_options) > 0)}
\DoxyCodeLine{330     vpx\_svc\_set\_options(svc\_ctx, string\_options + 1);}
\DoxyCodeLine{331 }
\DoxyCodeLine{332   enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a70d62d87aae7d1168746577f14a6dccf}{g\_pass}} = \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493fa7b6943a41868e8e26a77e9500f139ca1}{VPX\_RC\_ONE\_PASS}};}
\DoxyCodeLine{333 }
\DoxyCodeLine{334   \textcolor{keywordflow}{if} (enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} > 0) \{}
\DoxyCodeLine{335     \textcolor{keywordflow}{if} (min\_bitrate > 0) \{}
\DoxyCodeLine{336       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a21eb9fce0844ae07b617bf3f0a25f5a5}{rc\_2pass\_vbr\_minsection\_pct}} =}
\DoxyCodeLine{337           min\_bitrate * 100 / enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}};}
\DoxyCodeLine{338     \}}
\DoxyCodeLine{339     \textcolor{keywordflow}{if} (max\_bitrate > 0) \{}
\DoxyCodeLine{340       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab5212050b71b2d9f4dc663caa496949e}{rc\_2pass\_vbr\_maxsection\_pct}} =}
\DoxyCodeLine{341           max\_bitrate * 100 / enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}};}
\DoxyCodeLine{342     \}}
\DoxyCodeLine{343   \}}
\DoxyCodeLine{344 }
\DoxyCodeLine{345   \textcolor{comment}{// Check for unrecognized options}}
\DoxyCodeLine{346   \textcolor{keywordflow}{for} (argi = argv; *argi; ++argi)}
\DoxyCodeLine{347     \textcolor{keywordflow}{if} (argi[0][0] == \textcolor{charliteral}{'-\/'} \&\& strlen(argi[0]) > 1)}
\DoxyCodeLine{348       die(\textcolor{stringliteral}{"{}Error: Unrecognized option \%s\(\backslash\)n"{}}, *argi);}
\DoxyCodeLine{349 }
\DoxyCodeLine{350   \textcolor{keywordflow}{if} (argv[0] == NULL) \{}
\DoxyCodeLine{351     usage\_exit();}
\DoxyCodeLine{352   \}}
\DoxyCodeLine{353   app\_input-\/>input\_ctx.filename = argv[0];}
\DoxyCodeLine{354   free(argv);}
\DoxyCodeLine{355 }
\DoxyCodeLine{356   open\_input\_file(\&app\_input-\/>input\_ctx);}
\DoxyCodeLine{357   \textcolor{keywordflow}{if} (app\_input-\/>input\_ctx.file\_type == FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{358     enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = app\_input-\/>input\_ctx.width;}
\DoxyCodeLine{359     enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = app\_input-\/>input\_ctx.height;}
\DoxyCodeLine{360   \}}
\DoxyCodeLine{361 }
\DoxyCodeLine{362   \textcolor{keywordflow}{if} (enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} < 16 || enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} \% 2 || enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} < 16 ||}
\DoxyCodeLine{363       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} \% 2)}
\DoxyCodeLine{364     die(\textcolor{stringliteral}{"{}Invalid resolution: \%d x \%d\(\backslash\)n"{}}, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}});}
\DoxyCodeLine{365 }
\DoxyCodeLine{366   printf(}
\DoxyCodeLine{367       \textcolor{stringliteral}{"{}Codec \%s\(\backslash\)nframes: \%d, skip: \%d\(\backslash\)n"{}}}
\DoxyCodeLine{368       \textcolor{stringliteral}{"{}layers: \%d\(\backslash\)n"{}}}
\DoxyCodeLine{369       \textcolor{stringliteral}{"{}width \%d, height: \%d,\(\backslash\)n"{}}}
\DoxyCodeLine{370       \textcolor{stringliteral}{"{}num: \%d, den: \%d, bitrate: \%d,\(\backslash\)n"{}}}
\DoxyCodeLine{371       \textcolor{stringliteral}{"{}gop size: \%d\(\backslash\)n"{}},}
\DoxyCodeLine{372       \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(vpx\_codec\_vp9\_cx()), app\_input-\/>frames\_to\_code,}
\DoxyCodeLine{373       app\_input-\/>frames\_to\_skip, svc\_ctx-\/>spatial\_layers, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}},}
\DoxyCodeLine{374       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}}, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}}, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}},}
\DoxyCodeLine{375       enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}}, enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ae018440136e271743376730413d25a9b}{kf\_max\_dist}});}
\DoxyCodeLine{376 \}}
\DoxyCodeLine{377 }
\DoxyCodeLine{378 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{379 \textcolor{comment}{// For rate control encoding stats.}}
\DoxyCodeLine{380 \textcolor{keyword}{struct }RateControlStats \{}
\DoxyCodeLine{381   \textcolor{comment}{// Number of input frames per layer.}}
\DoxyCodeLine{382   \textcolor{keywordtype}{int} layer\_input\_frames[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{383   \textcolor{comment}{// Total (cumulative) number of encoded frames per layer.}}
\DoxyCodeLine{384   \textcolor{keywordtype}{int} layer\_tot\_enc\_frames[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{385   \textcolor{comment}{// Number of encoded non-\/key frames per layer.}}
\DoxyCodeLine{386   \textcolor{keywordtype}{int} layer\_enc\_frames[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{387   \textcolor{comment}{// Framerate per layer (cumulative).}}
\DoxyCodeLine{388   \textcolor{keywordtype}{double} layer\_framerate[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{389   \textcolor{comment}{// Target average frame size per layer (per-\/frame-\/bandwidth per layer).}}
\DoxyCodeLine{390   \textcolor{keywordtype}{double} layer\_pfb[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{391   \textcolor{comment}{// Actual average frame size per layer.}}
\DoxyCodeLine{392   \textcolor{keywordtype}{double} layer\_avg\_frame\_size[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{393   \textcolor{comment}{// Average rate mismatch per layer (|target -\/ actual| / target).}}
\DoxyCodeLine{394   \textcolor{keywordtype}{double} layer\_avg\_rate\_mismatch[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{395   \textcolor{comment}{// Actual encoding bitrate per layer (cumulative).}}
\DoxyCodeLine{396   \textcolor{keywordtype}{double} layer\_encoding\_bitrate[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{397   \textcolor{comment}{// Average of the short-\/time encoder actual bitrate.}}
\DoxyCodeLine{398   \textcolor{comment}{// TODO(marpan): Should we add these short-\/time stats for each layer?}}
\DoxyCodeLine{399   \textcolor{keywordtype}{double} avg\_st\_encoding\_bitrate;}
\DoxyCodeLine{400   \textcolor{comment}{// Variance of the short-\/time encoder actual bitrate.}}
\DoxyCodeLine{401   \textcolor{keywordtype}{double} variance\_st\_encoding\_bitrate;}
\DoxyCodeLine{402   \textcolor{comment}{// Window (number of frames) for computing short-\/time encoding bitrate.}}
\DoxyCodeLine{403   \textcolor{keywordtype}{int} window\_size;}
\DoxyCodeLine{404   \textcolor{comment}{// Number of window measurements.}}
\DoxyCodeLine{405   \textcolor{keywordtype}{int} window\_count;}
\DoxyCodeLine{406 \};}
\DoxyCodeLine{407 }
\DoxyCodeLine{408 \textcolor{comment}{// Note: these rate control stats assume only 1 key frame in the}}
\DoxyCodeLine{409 \textcolor{comment}{// sequence (i.e., first frame only).}}
\DoxyCodeLine{410 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_rate\_control\_stats(\textcolor{keyword}{struct} RateControlStats *rc,}
\DoxyCodeLine{411                                    \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg) \{}
\DoxyCodeLine{412   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sl, tl;}
\DoxyCodeLine{413   \textcolor{comment}{// Set the layer (cumulative) framerate and the target layer (non-\/cumulative)}}
\DoxyCodeLine{414   \textcolor{comment}{// per-\/frame-\/bandwidth, for the rate control encoding stats below.}}
\DoxyCodeLine{415   \textcolor{keyword}{const} \textcolor{keywordtype}{double} framerate = cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} / cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}};}
\DoxyCodeLine{416 }
\DoxyCodeLine{417   \textcolor{keywordflow}{for} (sl = 0; sl < cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{418     \textcolor{keywordflow}{for} (tl = 0; tl < cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++tl) \{}
\DoxyCodeLine{419       \textcolor{keyword}{const} \textcolor{keywordtype}{int} layer = sl * cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} + tl;}
\DoxyCodeLine{420       \textcolor{keywordflow}{if} (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} == 1)}
\DoxyCodeLine{421         rc-\/>layer\_framerate[layer] = framerate;}
\DoxyCodeLine{422       \textcolor{keywordflow}{else}}
\DoxyCodeLine{423         rc-\/>layer\_framerate[layer] = framerate / cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[tl];}
\DoxyCodeLine{424       \textcolor{keywordflow}{if} (tl > 0) \{}
\DoxyCodeLine{425         rc-\/>layer\_pfb[layer] =}
\DoxyCodeLine{426             1000.0 *}
\DoxyCodeLine{427             (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3f6b4c8aea7a713c51ad5d44e3552b1f}{layer\_target\_bitrate}}[layer] -\/}
\DoxyCodeLine{428              cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3f6b4c8aea7a713c51ad5d44e3552b1f}{layer\_target\_bitrate}}[layer -\/ 1]) /}
\DoxyCodeLine{429             (rc-\/>layer\_framerate[layer] -\/ rc-\/>layer\_framerate[layer -\/ 1]);}
\DoxyCodeLine{430       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{431         rc-\/>layer\_pfb[layer] = 1000.0 * cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3f6b4c8aea7a713c51ad5d44e3552b1f}{layer\_target\_bitrate}}[layer] /}
\DoxyCodeLine{432                                rc-\/>layer\_framerate[layer];}
\DoxyCodeLine{433       \}}
\DoxyCodeLine{434       rc-\/>layer\_input\_frames[layer] = 0;}
\DoxyCodeLine{435       rc-\/>layer\_enc\_frames[layer] = 0;}
\DoxyCodeLine{436       rc-\/>layer\_tot\_enc\_frames[layer] = 0;}
\DoxyCodeLine{437       rc-\/>layer\_encoding\_bitrate[layer] = 0.0;}
\DoxyCodeLine{438       rc-\/>layer\_avg\_frame\_size[layer] = 0.0;}
\DoxyCodeLine{439       rc-\/>layer\_avg\_rate\_mismatch[layer] = 0.0;}
\DoxyCodeLine{440     \}}
\DoxyCodeLine{441   \}}
\DoxyCodeLine{442   rc-\/>window\_count = 0;}
\DoxyCodeLine{443   rc-\/>window\_size = 15;}
\DoxyCodeLine{444   rc-\/>avg\_st\_encoding\_bitrate = 0.0;}
\DoxyCodeLine{445   rc-\/>variance\_st\_encoding\_bitrate = 0.0;}
\DoxyCodeLine{446 \}}
\DoxyCodeLine{447 }
\DoxyCodeLine{448 \textcolor{keyword}{static} \textcolor{keywordtype}{void} printout\_rate\_control\_summary(\textcolor{keyword}{struct} RateControlStats *rc,}
\DoxyCodeLine{449                                           \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{450                                           \textcolor{keywordtype}{int} frame\_cnt) \{}
\DoxyCodeLine{451   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sl, tl;}
\DoxyCodeLine{452   \textcolor{keywordtype}{double} perc\_fluctuation = 0.0;}
\DoxyCodeLine{453   \textcolor{keywordtype}{int} tot\_num\_frames = 0;}
\DoxyCodeLine{454   printf(\textcolor{stringliteral}{"{}Total number of processed frames: \%d\(\backslash\)n\(\backslash\)n"{}}, frame\_cnt -\/ 1);}
\DoxyCodeLine{455   printf(\textcolor{stringliteral}{"{}Rate control layer stats for sl\%d tl\%d layer(s):\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{456          cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}, cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}});}
\DoxyCodeLine{457   \textcolor{keywordflow}{for} (sl = 0; sl < cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{458     tot\_num\_frames = 0;}
\DoxyCodeLine{459     \textcolor{keywordflow}{for} (tl = 0; tl < cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++tl) \{}
\DoxyCodeLine{460       \textcolor{keyword}{const} \textcolor{keywordtype}{int} layer = sl * cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} + tl;}
\DoxyCodeLine{461       \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_dropped =}
\DoxyCodeLine{462           (tl > 0)}
\DoxyCodeLine{463               ? (rc-\/>layer\_input\_frames[layer] -\/ rc-\/>layer\_enc\_frames[layer])}
\DoxyCodeLine{464               : (rc-\/>layer\_input\_frames[layer] -\/ rc-\/>layer\_enc\_frames[layer] -\/}
\DoxyCodeLine{465                  1);}
\DoxyCodeLine{466       tot\_num\_frames += rc-\/>layer\_input\_frames[layer];}
\DoxyCodeLine{467       rc-\/>layer\_encoding\_bitrate[layer] = 0.001 * rc-\/>layer\_framerate[layer] *}
\DoxyCodeLine{468                                           rc-\/>layer\_encoding\_bitrate[layer] /}
\DoxyCodeLine{469                                           tot\_num\_frames;}
\DoxyCodeLine{470       rc-\/>layer\_avg\_frame\_size[layer] =}
\DoxyCodeLine{471           rc-\/>layer\_avg\_frame\_size[layer] / rc-\/>layer\_enc\_frames[layer];}
\DoxyCodeLine{472       rc-\/>layer\_avg\_rate\_mismatch[layer] = 100.0 *}
\DoxyCodeLine{473                                            rc-\/>layer\_avg\_rate\_mismatch[layer] /}
\DoxyCodeLine{474                                            rc-\/>layer\_enc\_frames[layer];}
\DoxyCodeLine{475       printf(\textcolor{stringliteral}{"{}For layer\#: sl\%d tl\%d \(\backslash\)n"{}}, sl, tl);}
\DoxyCodeLine{476       printf(\textcolor{stringliteral}{"{}Bitrate (target vs actual): \%d \%f.0 kbps\(\backslash\)n"{}},}
\DoxyCodeLine{477              cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a3f6b4c8aea7a713c51ad5d44e3552b1f}{layer\_target\_bitrate}}[layer],}
\DoxyCodeLine{478              rc-\/>layer\_encoding\_bitrate[layer]);}
\DoxyCodeLine{479       printf(\textcolor{stringliteral}{"{}Average frame size (target vs actual): \%f \%f bits\(\backslash\)n"{}},}
\DoxyCodeLine{480              rc-\/>layer\_pfb[layer], rc-\/>layer\_avg\_frame\_size[layer]);}
\DoxyCodeLine{481       printf(\textcolor{stringliteral}{"{}Average rate\_mismatch: \%f\(\backslash\)n"{}}, rc-\/>layer\_avg\_rate\_mismatch[layer]);}
\DoxyCodeLine{482       printf(}
\DoxyCodeLine{483           \textcolor{stringliteral}{"{}Number of input frames, encoded (non-\/key) frames, "{}}}
\DoxyCodeLine{484           \textcolor{stringliteral}{"{}and percent dropped frames: \%d \%d \%f.0 \(\backslash\)n"{}},}
\DoxyCodeLine{485           rc-\/>layer\_input\_frames[layer], rc-\/>layer\_enc\_frames[layer],}
\DoxyCodeLine{486           100.0 * num\_dropped / rc-\/>layer\_input\_frames[layer]);}
\DoxyCodeLine{487       printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{488     \}}
\DoxyCodeLine{489   \}}
\DoxyCodeLine{490   rc-\/>avg\_st\_encoding\_bitrate = rc-\/>avg\_st\_encoding\_bitrate / rc-\/>window\_count;}
\DoxyCodeLine{491   rc-\/>variance\_st\_encoding\_bitrate =}
\DoxyCodeLine{492       rc-\/>variance\_st\_encoding\_bitrate / rc-\/>window\_count -\/}
\DoxyCodeLine{493       (rc-\/>avg\_st\_encoding\_bitrate * rc-\/>avg\_st\_encoding\_bitrate);}
\DoxyCodeLine{494   perc\_fluctuation = 100.0 * sqrt(rc-\/>variance\_st\_encoding\_bitrate) /}
\DoxyCodeLine{495                      rc-\/>avg\_st\_encoding\_bitrate;}
\DoxyCodeLine{496   printf(\textcolor{stringliteral}{"{}Short-\/time stats, for window of \%d frames: \(\backslash\)n"{}}, rc-\/>window\_size);}
\DoxyCodeLine{497   printf(\textcolor{stringliteral}{"{}Average, rms-\/variance, and percent-\/fluct: \%f \%f \%f \(\backslash\)n"{}},}
\DoxyCodeLine{498          rc-\/>avg\_st\_encoding\_bitrate, sqrt(rc-\/>variance\_st\_encoding\_bitrate),}
\DoxyCodeLine{499          perc\_fluctuation);}
\DoxyCodeLine{500   printf(\textcolor{stringliteral}{"{}Num of input, num of encoded (super) frames: \%d \%d \(\backslash\)n"{}}, frame\_cnt,}
\DoxyCodeLine{501          tot\_num\_frames);}
\DoxyCodeLine{502 \}}
\DoxyCodeLine{503 }
\DoxyCodeLine{504 \textcolor{keyword}{static} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} parse\_superframe\_index(\textcolor{keyword}{const} uint8\_t *data,}
\DoxyCodeLine{505                                               \textcolor{keywordtype}{size\_t} data\_sz, uint64\_t sizes[8],}
\DoxyCodeLine{506                                               \textcolor{keywordtype}{int} *count) \{}
\DoxyCodeLine{507   \textcolor{comment}{// A chunk ending with a byte matching 0xc0 is an invalid chunk unless}}
\DoxyCodeLine{508   \textcolor{comment}{// it is a super frame index. If the last byte of real video compression}}
\DoxyCodeLine{509   \textcolor{comment}{// data is 0xc0 the encoder must add a 0 byte. If we have the marker but}}
\DoxyCodeLine{510   \textcolor{comment}{// not the associated matching marker byte at the front of the index we have}}
\DoxyCodeLine{511   \textcolor{comment}{// an invalid bitstream and need to return an error.}}
\DoxyCodeLine{512 }
\DoxyCodeLine{513   uint8\_t marker;}
\DoxyCodeLine{514 }
\DoxyCodeLine{515   marker = *(data + data\_sz -\/ 1);}
\DoxyCodeLine{516   *count = 0;}
\DoxyCodeLine{517 }
\DoxyCodeLine{518   \textcolor{keywordflow}{if} ((marker \& 0xe0) == 0xc0) \{}
\DoxyCodeLine{519     \textcolor{keyword}{const} uint32\_t frames = (marker \& 0x7) + 1;}
\DoxyCodeLine{520     \textcolor{keyword}{const} uint32\_t mag = ((marker >> 3) \& 0x3) + 1;}
\DoxyCodeLine{521     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} index\_sz = 2 + mag * frames;}
\DoxyCodeLine{522 }
\DoxyCodeLine{523     \textcolor{comment}{// This chunk is marked as having a superframe index but doesn't have}}
\DoxyCodeLine{524     \textcolor{comment}{// enough data for it, thus it's an invalid superframe index.}}
\DoxyCodeLine{525     \textcolor{keywordflow}{if} (data\_sz < index\_sz) \textcolor{keywordflow}{return} \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2a29d03c009e0479dbf4ecbd8db1011b85}{VPX\_CODEC\_CORRUPT\_FRAME}};}
\DoxyCodeLine{526 }
\DoxyCodeLine{527     \{}
\DoxyCodeLine{528       \textcolor{keyword}{const} uint8\_t marker2 = *(data + data\_sz -\/ index\_sz);}
\DoxyCodeLine{529 }
\DoxyCodeLine{530       \textcolor{comment}{// This chunk is marked as having a superframe index but doesn't have}}
\DoxyCodeLine{531       \textcolor{comment}{// the matching marker byte at the front of the index therefore it's an}}
\DoxyCodeLine{532       \textcolor{comment}{// invalid chunk.}}
\DoxyCodeLine{533       \textcolor{keywordflow}{if} (marker != marker2) \textcolor{keywordflow}{return} \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2a29d03c009e0479dbf4ecbd8db1011b85}{VPX\_CODEC\_CORRUPT\_FRAME}};}
\DoxyCodeLine{534     \}}
\DoxyCodeLine{535 }
\DoxyCodeLine{536     \{}
\DoxyCodeLine{537       \textcolor{comment}{// Found a valid superframe index.}}
\DoxyCodeLine{538       uint32\_t i, j;}
\DoxyCodeLine{539       \textcolor{keyword}{const} uint8\_t *x = \&data[data\_sz -\/ index\_sz + 1];}
\DoxyCodeLine{540 }
\DoxyCodeLine{541       \textcolor{keywordflow}{for} (i = 0; i < frames; ++i) \{}
\DoxyCodeLine{542         uint32\_t this\_sz = 0;}
\DoxyCodeLine{543 }
\DoxyCodeLine{544         \textcolor{keywordflow}{for} (j = 0; j < mag; ++j) this\_sz |= (*x++) << (j * 8);}
\DoxyCodeLine{545         sizes[i] = this\_sz;}
\DoxyCodeLine{546       \}}
\DoxyCodeLine{547       *count = frames;}
\DoxyCodeLine{548     \}}
\DoxyCodeLine{549   \}}
\DoxyCodeLine{550   \textcolor{keywordflow}{return} \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}};}
\DoxyCodeLine{551 \}}
\DoxyCodeLine{552 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{553 }
\DoxyCodeLine{554 \textcolor{comment}{// Example pattern for spatial layers and 2 temporal layers used in the}}
\DoxyCodeLine{555 \textcolor{comment}{// bypass/flexible mode. The pattern corresponds to the pattern}}
\DoxyCodeLine{556 \textcolor{comment}{// VP9E\_TEMPORAL\_LAYERING\_MODE\_0101 (temporal\_layering\_mode == 2) used in}}
\DoxyCodeLine{557 \textcolor{comment}{// non-\/flexible mode.}}
\DoxyCodeLine{558 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_frame\_flags\_bypass\_mode\_ex0(}
\DoxyCodeLine{559     \textcolor{keywordtype}{int} tl, \textcolor{keywordtype}{int} num\_spatial\_layers, \textcolor{keywordtype}{int} is\_key\_frame,}
\DoxyCodeLine{560     \mbox{\hyperlink{structvpx__svc__ref__frame__config}{vpx\_svc\_ref\_frame\_config\_t}} *ref\_frame\_config) \{}
\DoxyCodeLine{561   \textcolor{keywordtype}{int} sl;}
\DoxyCodeLine{562   \textcolor{keywordflow}{for} (sl = 0; sl < num\_spatial\_layers; ++sl)}
\DoxyCodeLine{563     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] = 0;}
\DoxyCodeLine{564 }
\DoxyCodeLine{565   for (sl = 0; sl < num\_spatial\_layers; ++sl) \{}
\DoxyCodeLine{566     \textcolor{comment}{// Set the buffer idx.}}
\DoxyCodeLine{567     \textcolor{keywordflow}{if} (tl == 0) \{}
\DoxyCodeLine{568       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[sl] = sl;}
\DoxyCodeLine{569       \textcolor{keywordflow}{if} (sl) \{}
\DoxyCodeLine{570         \textcolor{keywordflow}{if} (is\_key\_frame) \{}
\DoxyCodeLine{571           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[sl] = sl -\/ 1;}
\DoxyCodeLine{572           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[sl] = sl;}
\DoxyCodeLine{573         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{574           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[sl] = sl -\/ 1;}
\DoxyCodeLine{575         \}}
\DoxyCodeLine{576       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{577         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[sl] = 0;}
\DoxyCodeLine{578       \}}
\DoxyCodeLine{579       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[sl] = 0;}
\DoxyCodeLine{580     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (tl == 1) \{}
\DoxyCodeLine{581       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[sl] = sl;}
\DoxyCodeLine{582       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[sl] =}
\DoxyCodeLine{583           (sl == 0) ? 0 : num\_spatial\_layers + sl -\/ 1;}
\DoxyCodeLine{584       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[sl] = num\_spatial\_layers + sl;}
\DoxyCodeLine{585     \}}
\DoxyCodeLine{586     \textcolor{comment}{// Set the reference and update flags.}}
\DoxyCodeLine{587     \textcolor{keywordflow}{if} (!tl) \{}
\DoxyCodeLine{588       \textcolor{keywordflow}{if} (!sl) \{}
\DoxyCodeLine{589         \textcolor{comment}{// Base spatial and base temporal (sl = 0, tl = 0)}}
\DoxyCodeLine{590         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[sl] = 1;}
\DoxyCodeLine{591         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[sl] = 0;}
\DoxyCodeLine{592         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[sl] = 0;}
\DoxyCodeLine{593         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] |=}
\DoxyCodeLine{594             1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[sl];}
\DoxyCodeLine{595       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{596         \textcolor{keywordflow}{if} (is\_key\_frame) \{}
\DoxyCodeLine{597           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[sl] = 1;}
\DoxyCodeLine{598           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[sl] = 0;}
\DoxyCodeLine{599           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[sl] = 0;}
\DoxyCodeLine{600           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] |=}
\DoxyCodeLine{601               1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[sl];}
\DoxyCodeLine{602         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{603           \textcolor{comment}{// Non-\/zero spatiall layer.}}
\DoxyCodeLine{604           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[sl] = 1;}
\DoxyCodeLine{605           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[sl] = 1;}
\DoxyCodeLine{606           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[sl] = 1;}
\DoxyCodeLine{607           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] |=}
\DoxyCodeLine{608               1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[sl];}
\DoxyCodeLine{609         \}}
\DoxyCodeLine{610       \}}
\DoxyCodeLine{611     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (tl == 1) \{}
\DoxyCodeLine{612       \textcolor{keywordflow}{if} (!sl) \{}
\DoxyCodeLine{613         \textcolor{comment}{// Base spatial and top temporal (tl = 1)}}
\DoxyCodeLine{614         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[sl] = 1;}
\DoxyCodeLine{615         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[sl] = 0;}
\DoxyCodeLine{616         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[sl] = 0;}
\DoxyCodeLine{617         ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] |=}
\DoxyCodeLine{618             1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[sl];}
\DoxyCodeLine{619       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{620         \textcolor{comment}{// Non-\/zero spatial.}}
\DoxyCodeLine{621         \textcolor{keywordflow}{if} (sl < num\_spatial\_layers -\/ 1) \{}
\DoxyCodeLine{622           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[sl] = 1;}
\DoxyCodeLine{623           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[sl] = 1;}
\DoxyCodeLine{624           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[sl] = 0;}
\DoxyCodeLine{625           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] |=}
\DoxyCodeLine{626               1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[sl];}
\DoxyCodeLine{627         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sl == num\_spatial\_layers -\/ 1) \{}
\DoxyCodeLine{628           \textcolor{comment}{// Top spatial and top temporal (non-\/reference -\/-\/ doesn't update any}}
\DoxyCodeLine{629           \textcolor{comment}{// reference buffers)}}
\DoxyCodeLine{630           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[sl] = 1;}
\DoxyCodeLine{631           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[sl] = 1;}
\DoxyCodeLine{632           ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[sl] = 0;}
\DoxyCodeLine{633         \}}
\DoxyCodeLine{634       \}}
\DoxyCodeLine{635     \}}
\DoxyCodeLine{636   \}}
\DoxyCodeLine{637 \}}
\DoxyCodeLine{638 }
\DoxyCodeLine{639 \textcolor{comment}{// Example pattern for 2 spatial layers and 2 temporal layers used in the}}
\DoxyCodeLine{640 \textcolor{comment}{// bypass/flexible mode, except only 1 spatial layer when temporal\_layer\_id = 1.}}
\DoxyCodeLine{641 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_frame\_flags\_bypass\_mode\_ex1(}
\DoxyCodeLine{642     \textcolor{keywordtype}{int} tl, \textcolor{keywordtype}{int} num\_spatial\_layers, \textcolor{keywordtype}{int} is\_key\_frame,}
\DoxyCodeLine{643     \mbox{\hyperlink{structvpx__svc__ref__frame__config}{vpx\_svc\_ref\_frame\_config\_t}} *ref\_frame\_config) \{}
\DoxyCodeLine{644   \textcolor{keywordtype}{int} sl;}
\DoxyCodeLine{645   \textcolor{keywordflow}{for} (sl = 0; sl < num\_spatial\_layers; ++sl)}
\DoxyCodeLine{646     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[sl] = 0;}
\DoxyCodeLine{647 }
\DoxyCodeLine{648   if (tl == 0) \{}
\DoxyCodeLine{649     \textcolor{keywordflow}{if} (is\_key\_frame) \{}
\DoxyCodeLine{650       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[1] = 0;}
\DoxyCodeLine{651       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[1] = 1;}
\DoxyCodeLine{652     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{653       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[1] = 1;}
\DoxyCodeLine{654       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[1] = 0;}
\DoxyCodeLine{655     \}}
\DoxyCodeLine{656     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[1] = 0;}
\DoxyCodeLine{657 }
\DoxyCodeLine{658     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[0] = 0;}
\DoxyCodeLine{659     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[0] = 0;}
\DoxyCodeLine{660     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[0] = 0;}
\DoxyCodeLine{661   \}}
\DoxyCodeLine{662   \textcolor{keywordflow}{if} (tl == 1) \{}
\DoxyCodeLine{663     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[0] = 0;}
\DoxyCodeLine{664     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[0] = 1;}
\DoxyCodeLine{665     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[0] = 2;}
\DoxyCodeLine{666 }
\DoxyCodeLine{667     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[1] = 1;}
\DoxyCodeLine{668     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[1] = 2;}
\DoxyCodeLine{669     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab2a913dc166956efad8bdf6ad009b2eb}{alt\_fb\_idx}}[1] = 3;}
\DoxyCodeLine{670   \}}
\DoxyCodeLine{671   \textcolor{comment}{// Set the reference and update flags.}}
\DoxyCodeLine{672   \textcolor{keywordflow}{if} (tl == 0) \{}
\DoxyCodeLine{673     \textcolor{comment}{// Base spatial and base temporal (sl = 0, tl = 0)}}
\DoxyCodeLine{674     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[0] = 1;}
\DoxyCodeLine{675     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[0] = 0;}
\DoxyCodeLine{676     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[0] = 0;}
\DoxyCodeLine{677     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[0] |=}
\DoxyCodeLine{678         1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[0];}
\DoxyCodeLine{679 }
\DoxyCodeLine{680     \textcolor{keywordflow}{if} (is\_key\_frame) \{}
\DoxyCodeLine{681       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[1] = 1;}
\DoxyCodeLine{682       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[1] = 0;}
\DoxyCodeLine{683       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[1] = 0;}
\DoxyCodeLine{684       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[1] |=}
\DoxyCodeLine{685           1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a4af48b570c3262ad1d6fc7d436a7d5cc}{gld\_fb\_idx}}[1];}
\DoxyCodeLine{686     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{687       \textcolor{comment}{// Non-\/zero spatiall layer.}}
\DoxyCodeLine{688       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[1] = 1;}
\DoxyCodeLine{689       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[1] = 1;}
\DoxyCodeLine{690       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[1] = 1;}
\DoxyCodeLine{691       ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a3ff7ebe7b8056278efbbb9abae4d830a}{update\_buffer\_slot}}[1] |=}
\DoxyCodeLine{692           1 << ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a19b5483bc516fc83469d5967dc966783}{lst\_fb\_idx}}[1];}
\DoxyCodeLine{693     \}}
\DoxyCodeLine{694   \}}
\DoxyCodeLine{695   \textcolor{keywordflow}{if} (tl == 1) \{}
\DoxyCodeLine{696     \textcolor{comment}{// Top spatial and top temporal (non-\/reference -\/-\/ doesn't update any}}
\DoxyCodeLine{697     \textcolor{comment}{// reference buffers)}}
\DoxyCodeLine{698     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a812c764e0bd981b7083d66557595aa09}{reference\_last}}[1] = 1;}
\DoxyCodeLine{699     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_a8b61c119c626ec78b29ef52d0def7810}{reference\_golden}}[1] = 0;}
\DoxyCodeLine{700     ref\_frame\_config-\/>\mbox{\hyperlink{structvpx__svc__ref__frame__config_aab75feb72ec5cef3c6620765ac52c997}{reference\_alt\_ref}}[1] = 0;}
\DoxyCodeLine{701   \}}
\DoxyCodeLine{702 \}}
\DoxyCodeLine{703 }
\DoxyCodeLine{704 \textcolor{preprocessor}{\#if CONFIG\_VP9\_DECODER \&\& !SIMULCAST\_MODE}}
\DoxyCodeLine{705 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_decode(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *encoder, \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *decoder,}
\DoxyCodeLine{706                         \textcolor{keyword}{const} \textcolor{keywordtype}{int} frames\_out, \textcolor{keywordtype}{int} *mismatch\_seen) \{}
\DoxyCodeLine{707   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} enc\_img, dec\_img;}
\DoxyCodeLine{708   \textcolor{keyword}{struct }\mbox{\hyperlink{structvp9__ref__frame}{vp9\_ref\_frame}} ref\_enc, ref\_dec;}
\DoxyCodeLine{709   \textcolor{keywordflow}{if} (*mismatch\_seen) \textcolor{keywordflow}{return};}
\DoxyCodeLine{710   \textcolor{comment}{/* Get the internal reference frame */}}
\DoxyCodeLine{711   ref\_enc.\mbox{\hyperlink{structvp9__ref__frame_a26e0d119a61c29b72c6ccb91748b6b82}{idx}} = 0;}
\DoxyCodeLine{712   ref\_dec.idx = 0;}
\DoxyCodeLine{713   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(encoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a91e44472b21c720a9a7d087c7226d083}{VP9\_GET\_REFERENCE}}, \&ref\_enc);}
\DoxyCodeLine{714   enc\_img = ref\_enc.img;}
\DoxyCodeLine{715   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(decoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a91e44472b21c720a9a7d087c7226d083}{VP9\_GET\_REFERENCE}}, \&ref\_dec);}
\DoxyCodeLine{716   dec\_img = ref\_dec.img;}
\DoxyCodeLine{717 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{718   \textcolor{keywordflow}{if} ((enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) !=}
\DoxyCodeLine{719       (dec\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}})) \{}
\DoxyCodeLine{720     \textcolor{keywordflow}{if} (enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \{}
\DoxyCodeLine{721       \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&enc\_img, enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} -\/ \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}},}
\DoxyCodeLine{722                     enc\_img.\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, enc\_img.\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, 16);}
\DoxyCodeLine{723       vpx\_img\_truncate\_16\_to\_8(\&enc\_img, \&ref\_enc.img);}
\DoxyCodeLine{724     \}}
\DoxyCodeLine{725     \textcolor{keywordflow}{if} (dec\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \{}
\DoxyCodeLine{726       \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&dec\_img, dec\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} -\/ \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}},}
\DoxyCodeLine{727                     dec\_img.\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, dec\_img.\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, 16);}
\DoxyCodeLine{728       vpx\_img\_truncate\_16\_to\_8(\&dec\_img, \&ref\_dec.img);}
\DoxyCodeLine{729     \}}
\DoxyCodeLine{730   \}}
\DoxyCodeLine{731 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{732 }
\DoxyCodeLine{733   \textcolor{keywordflow}{if} (!compare\_img(\&enc\_img, \&dec\_img)) \{}
\DoxyCodeLine{734     \textcolor{keywordtype}{int} y[4], u[4], v[4];}
\DoxyCodeLine{735 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{736     \textcolor{keywordflow}{if} (enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \{}
\DoxyCodeLine{737       find\_mismatch\_high(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{738     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{739       find\_mismatch(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{740     \}}
\DoxyCodeLine{741 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{742     find\_mismatch(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{743 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{744     decoder-\/>\mbox{\hyperlink{structvpx__codec__ctx_a6f448802b0675013fd8c5179675c30de}{err}} = 1;}
\DoxyCodeLine{745     printf(}
\DoxyCodeLine{746         \textcolor{stringliteral}{"{}Encode/decode mismatch on frame \%d at"{}}}
\DoxyCodeLine{747         \textcolor{stringliteral}{"{} Y[\%d, \%d] \{\%d/\%d\},"{}}}
\DoxyCodeLine{748         \textcolor{stringliteral}{"{} U[\%d, \%d] \{\%d/\%d\},"{}}}
\DoxyCodeLine{749         \textcolor{stringliteral}{"{} V[\%d, \%d] \{\%d/\%d\}\(\backslash\)n"{}},}
\DoxyCodeLine{750         frames\_out, y[0], y[1], y[2], y[3], u[0], u[1], u[2], u[3], v[0], v[1],}
\DoxyCodeLine{751         v[2], v[3]);}
\DoxyCodeLine{752     *mismatch\_seen = frames\_out;}
\DoxyCodeLine{753   \}}
\DoxyCodeLine{754 }
\DoxyCodeLine{755   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&enc\_img);}
\DoxyCodeLine{756   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&dec\_img);}
\DoxyCodeLine{757 \}}
\DoxyCodeLine{758 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{759 }
\DoxyCodeLine{760 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{761 \textcolor{keyword}{static} \textcolor{keywordtype}{void} svc\_output\_rc\_stats(}
\DoxyCodeLine{762     \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *codec, \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *enc\_cfg,}
\DoxyCodeLine{763     \mbox{\hyperlink{structvpx__svc__layer__id}{vpx\_svc\_layer\_id\_t}} *layer\_id, \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *cx\_pkt,}
\DoxyCodeLine{764     \textcolor{keyword}{struct} RateControlStats *rc, VpxVideoWriter **outfile,}
\DoxyCodeLine{765     \textcolor{keyword}{const} uint32\_t frame\_cnt, \textcolor{keyword}{const} \textcolor{keywordtype}{double} framerate) \{}
\DoxyCodeLine{766   \textcolor{keywordtype}{int} num\_layers\_encoded = 0;}
\DoxyCodeLine{767   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sl, tl;}
\DoxyCodeLine{768   uint64\_t sizes[8];}
\DoxyCodeLine{769   uint64\_t sizes\_parsed[8];}
\DoxyCodeLine{770   \textcolor{keywordtype}{int} count = 0;}
\DoxyCodeLine{771   \textcolor{keywordtype}{double} sum\_bitrate = 0.0;}
\DoxyCodeLine{772   \textcolor{keywordtype}{double} sum\_bitrate2 = 0.0;}
\DoxyCodeLine{773   vp9\_zero(sizes);}
\DoxyCodeLine{774   vp9\_zero(sizes\_parsed);}
\DoxyCodeLine{775   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecae5198050ccb3c1aed11fee8a9fb3be18}{VP9E\_GET\_SVC\_LAYER\_ID}}, layer\_id);}
\DoxyCodeLine{776   parse\_superframe\_index(cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}}, cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{777                          sizes\_parsed, \&count);}
\DoxyCodeLine{778   \textcolor{keywordflow}{if} (enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}} == 1) \{}
\DoxyCodeLine{779     sizes[0] = cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}};}
\DoxyCodeLine{780   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{781     \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{782       sizes[sl] = 0;}
\DoxyCodeLine{783       \textcolor{keywordflow}{if} (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7b157182695b6c882bee7c0b290582fa}{spatial\_layer\_encoded}}[sl]) \{}
\DoxyCodeLine{784         sizes[sl] = sizes\_parsed[num\_layers\_encoded];}
\DoxyCodeLine{785         num\_layers\_encoded++;}
\DoxyCodeLine{786       \}}
\DoxyCodeLine{787     \}}
\DoxyCodeLine{788   \}}
\DoxyCodeLine{789   \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{790     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sl2;}
\DoxyCodeLine{791     uint64\_t tot\_size = 0;}
\DoxyCodeLine{792 \textcolor{preprocessor}{\#if SIMULCAST\_MODE}}
\DoxyCodeLine{793     \textcolor{keywordflow}{for} (sl2 = 0; sl2 < sl; ++sl2) \{}
\DoxyCodeLine{794       \textcolor{keywordflow}{if} (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7b157182695b6c882bee7c0b290582fa}{spatial\_layer\_encoded}}[sl2]) tot\_size += sizes[sl2];}
\DoxyCodeLine{795     \}}
\DoxyCodeLine{796     vpx\_video\_writer\_write\_frame(outfile[sl],}
\DoxyCodeLine{797                                  (uint8\_t *)(cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}}) + tot\_size,}
\DoxyCodeLine{798                                  (\textcolor{keywordtype}{size\_t})(sizes[sl]), cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}});}
\DoxyCodeLine{799 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{800     \textcolor{keywordflow}{for} (sl2 = 0; sl2 <= sl; ++sl2) \{}
\DoxyCodeLine{801       \textcolor{keywordflow}{if} (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7b157182695b6c882bee7c0b290582fa}{spatial\_layer\_encoded}}[sl2]) tot\_size += sizes[sl2];}
\DoxyCodeLine{802     \}}
\DoxyCodeLine{803     \textcolor{keywordflow}{if} (tot\_size > 0)}
\DoxyCodeLine{804       vpx\_video\_writer\_write\_frame(outfile[sl], cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{805                                    (\textcolor{keywordtype}{size\_t})(tot\_size), cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}});}
\DoxyCodeLine{806 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// SIMULCAST\_MODE}}
\DoxyCodeLine{807   \}}
\DoxyCodeLine{808   \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{809     \textcolor{keywordflow}{if} (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7b157182695b6c882bee7c0b290582fa}{spatial\_layer\_encoded}}[sl]) \{}
\DoxyCodeLine{810       \textcolor{keywordflow}{for} (tl = layer\_id-\/>\mbox{\hyperlink{structvpx__svc__layer__id_a365859e15e7a6ff2b06106ea00820ea7}{temporal\_layer\_id}}; tl < enc\_cfg-\/>ts\_number\_layers;}
\DoxyCodeLine{811            ++tl) \{}
\DoxyCodeLine{812         \textcolor{keyword}{const} \textcolor{keywordtype}{int} layer = sl * enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} + tl;}
\DoxyCodeLine{813         ++rc-\/>layer\_tot\_enc\_frames[layer];}
\DoxyCodeLine{814         rc-\/>layer\_encoding\_bitrate[layer] += 8.0 * sizes[sl];}
\DoxyCodeLine{815         \textcolor{comment}{// Keep count of rate control stats per layer, for non-\/key}}
\DoxyCodeLine{816         \textcolor{comment}{// frames.}}
\DoxyCodeLine{817         \textcolor{keywordflow}{if} (tl == (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})layer\_id-\/>\mbox{\hyperlink{structvpx__svc__layer__id_a365859e15e7a6ff2b06106ea00820ea7}{temporal\_layer\_id}} \&\&}
\DoxyCodeLine{818             !(cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}})) \{}
\DoxyCodeLine{819           rc-\/>layer\_avg\_frame\_size[layer] += 8.0 * sizes[sl];}
\DoxyCodeLine{820           rc-\/>layer\_avg\_rate\_mismatch[layer] +=}
\DoxyCodeLine{821               fabs(8.0 * sizes[sl] -\/ rc-\/>layer\_pfb[layer]) /}
\DoxyCodeLine{822               rc-\/>layer\_pfb[layer];}
\DoxyCodeLine{823           ++rc-\/>layer\_enc\_frames[layer];}
\DoxyCodeLine{824         \}}
\DoxyCodeLine{825       \}}
\DoxyCodeLine{826     \}}
\DoxyCodeLine{827   \}}
\DoxyCodeLine{828 }
\DoxyCodeLine{829   \textcolor{comment}{// Update for short-\/time encoding bitrate states, for moving}}
\DoxyCodeLine{830   \textcolor{comment}{// window of size rc-\/>window, shifted by rc-\/>window / 2.}}
\DoxyCodeLine{831   \textcolor{comment}{// Ignore first window segment, due to key frame.}}
\DoxyCodeLine{832   \textcolor{keywordflow}{if} (frame\_cnt > (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})rc-\/>window\_size) \{}
\DoxyCodeLine{833     \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{834       \textcolor{keywordflow}{if} (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7b157182695b6c882bee7c0b290582fa}{spatial\_layer\_encoded}}[sl])}
\DoxyCodeLine{835         sum\_bitrate += 0.001 * 8.0 * sizes[sl] * framerate;}
\DoxyCodeLine{836     \}}
\DoxyCodeLine{837     \textcolor{keywordflow}{if} (frame\_cnt \% rc-\/>window\_size == 0) \{}
\DoxyCodeLine{838       rc-\/>window\_count += 1;}
\DoxyCodeLine{839       rc-\/>avg\_st\_encoding\_bitrate += sum\_bitrate / rc-\/>window\_size;}
\DoxyCodeLine{840       rc-\/>variance\_st\_encoding\_bitrate +=}
\DoxyCodeLine{841           (sum\_bitrate / rc-\/>window\_size) * (sum\_bitrate / rc-\/>window\_size);}
\DoxyCodeLine{842     \}}
\DoxyCodeLine{843   \}}
\DoxyCodeLine{844 }
\DoxyCodeLine{845   \textcolor{comment}{// Second shifted window.}}
\DoxyCodeLine{846   \textcolor{keywordflow}{if} (frame\_cnt > (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})(rc-\/>window\_size + rc-\/>window\_size / 2)) \{}
\DoxyCodeLine{847     \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{848       sum\_bitrate2 += 0.001 * 8.0 * sizes[sl] * framerate;}
\DoxyCodeLine{849     \}}
\DoxyCodeLine{850 }
\DoxyCodeLine{851     \textcolor{keywordflow}{if} (frame\_cnt > (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})(2 * rc-\/>window\_size) \&\&}
\DoxyCodeLine{852         frame\_cnt \% rc-\/>window\_size == 0) \{}
\DoxyCodeLine{853       rc-\/>window\_count += 1;}
\DoxyCodeLine{854       rc-\/>avg\_st\_encoding\_bitrate += sum\_bitrate2 / rc-\/>window\_size;}
\DoxyCodeLine{855       rc-\/>variance\_st\_encoding\_bitrate +=}
\DoxyCodeLine{856           (sum\_bitrate2 / rc-\/>window\_size) * (sum\_bitrate2 / rc-\/>window\_size);}
\DoxyCodeLine{857     \}}
\DoxyCodeLine{858   \}}
\DoxyCodeLine{859 \}}
\DoxyCodeLine{860 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{861 }
\DoxyCodeLine{862 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{863   AppInput app\_input;}
\DoxyCodeLine{864   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{865   VpxVideoInfo info;}
\DoxyCodeLine{866   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} encoder;}
\DoxyCodeLine{867   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} enc\_cfg;}
\DoxyCodeLine{868   SvcContext svc\_ctx;}
\DoxyCodeLine{869   \mbox{\hyperlink{structvpx__svc__frame__drop}{vpx\_svc\_frame\_drop\_t}} svc\_drop\_frame;}
\DoxyCodeLine{870   uint32\_t i;}
\DoxyCodeLine{871   uint32\_t frame\_cnt = 0;}
\DoxyCodeLine{872   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{873   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{874   \textcolor{keywordtype}{int} pts = 0;            \textcolor{comment}{/* PTS starts at 0 */}}
\DoxyCodeLine{875   \textcolor{keywordtype}{int} frame\_duration = 1; \textcolor{comment}{/* 1 timebase tick per frame */}}
\DoxyCodeLine{876   \textcolor{keywordtype}{int} end\_of\_stream = 0;}
\DoxyCodeLine{877   \textcolor{keywordtype}{int} frames\_received = 0;}
\DoxyCodeLine{878 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{879   VpxVideoWriter *outfile[\mbox{\hyperlink{group__encoder_ga8ee6b12a5f4c97d9767adffb88fff7da}{VPX\_SS\_MAX\_LAYERS}}] = \{ NULL \};}
\DoxyCodeLine{880   \textcolor{keyword}{struct }RateControlStats rc;}
\DoxyCodeLine{881   \mbox{\hyperlink{structvpx__svc__layer__id}{vpx\_svc\_layer\_id\_t}} layer\_id;}
\DoxyCodeLine{882   \mbox{\hyperlink{structvpx__svc__ref__frame__config}{vpx\_svc\_ref\_frame\_config\_t}} ref\_frame\_config;}
\DoxyCodeLine{883   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sl;}
\DoxyCodeLine{884   \textcolor{keywordtype}{double} framerate = 30.0;}
\DoxyCodeLine{885 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{886   \textcolor{keyword}{struct }vpx\_usec\_timer timer;}
\DoxyCodeLine{887   int64\_t cx\_time = 0;}
\DoxyCodeLine{888 \textcolor{preprocessor}{\#if CONFIG\_INTERNAL\_STATS}}
\DoxyCodeLine{889   FILE *f = fopen(\textcolor{stringliteral}{"{}opsnr.stt"{}}, \textcolor{stringliteral}{"{}a"{}});}
\DoxyCodeLine{890 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{891 \textcolor{preprocessor}{\#if CONFIG\_VP9\_DECODER \&\& !SIMULCAST\_MODE}}
\DoxyCodeLine{892   \textcolor{keywordtype}{int} mismatch\_seen = 0;}
\DoxyCodeLine{893   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} decoder;}
\DoxyCodeLine{894 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{895   memset(\&svc\_ctx, 0, \textcolor{keyword}{sizeof}(svc\_ctx));}
\DoxyCodeLine{896   memset(\&app\_input, 0, \textcolor{keyword}{sizeof}(AppInput));}
\DoxyCodeLine{897   memset(\&info, 0, \textcolor{keyword}{sizeof}(VpxVideoInfo));}
\DoxyCodeLine{898   memset(\&layer\_id, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structvpx__svc__layer__id}{vpx\_svc\_layer\_id\_t}}));}
\DoxyCodeLine{899   memset(\&rc, 0, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} RateControlStats));}
\DoxyCodeLine{900   exec\_name = argv[0];}
\DoxyCodeLine{901 }
\DoxyCodeLine{902   \textcolor{comment}{/* Setup default input stream settings */}}
\DoxyCodeLine{903   app\_input.input\_ctx.framerate.numerator = 30;}
\DoxyCodeLine{904   app\_input.input\_ctx.framerate.denominator = 1;}
\DoxyCodeLine{905   app\_input.input\_ctx.only\_i420 = 1;}
\DoxyCodeLine{906   app\_input.input\_ctx.bit\_depth = 0;}
\DoxyCodeLine{907 }
\DoxyCodeLine{908   parse\_command\_line(argc, argv, \&app\_input, \&svc\_ctx, \&enc\_cfg);}
\DoxyCodeLine{909 }
\DoxyCodeLine{910   \textcolor{comment}{// Y4M reader handles its own allocation.}}
\DoxyCodeLine{911   \textcolor{keywordflow}{if} (app\_input.input\_ctx.file\_type != FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{912 \textcolor{comment}{// Allocate image buffer}}
\DoxyCodeLine{913 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{914     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw,}
\DoxyCodeLine{915                        enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_abebad3c575d7a5ba6c09a52fedb7d762}{g\_input\_bit\_depth}} == 8 ? \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}}
\DoxyCodeLine{916                                                       : \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}},}
\DoxyCodeLine{917                        enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}}, 32)) \{}
\DoxyCodeLine{918       die(\textcolor{stringliteral}{"{}Failed to allocate image \%dx\%d\(\backslash\)n"{}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}});}
\DoxyCodeLine{919     \}}
\DoxyCodeLine{920 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{921     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}}, 32)) \{}
\DoxyCodeLine{922       die(\textcolor{stringliteral}{"{}Failed to allocate image \%dx\%d\(\backslash\)n"{}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}});}
\DoxyCodeLine{923     \}}
\DoxyCodeLine{924 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{925   \}}
\DoxyCodeLine{926 }
\DoxyCodeLine{927   \textcolor{comment}{// Initialize codec}}
\DoxyCodeLine{928   \textcolor{keywordflow}{if} (vpx\_svc\_init(\&svc\_ctx, \&encoder, vpx\_codec\_vp9\_cx(), \&enc\_cfg) !=}
\DoxyCodeLine{929       \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}})}
\DoxyCodeLine{930     die(\textcolor{stringliteral}{"{}Failed to initialize encoder\(\backslash\)n"{}});}
\DoxyCodeLine{931 \textcolor{preprocessor}{\#if CONFIG\_VP9\_DECODER \&\& !SIMULCAST\_MODE}}
\DoxyCodeLine{932   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(}
\DoxyCodeLine{933           \&decoder, get\_vpx\_decoder\_by\_name(\textcolor{stringliteral}{"{}vp9"{}})-\/>codec\_interface(), NULL, 0))}
\DoxyCodeLine{934     die(\textcolor{stringliteral}{"{}Failed to initialize decoder\(\backslash\)n"{}});}
\DoxyCodeLine{935 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{936 }
\DoxyCodeLine{937 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{938   rc.window\_count = 1;}
\DoxyCodeLine{939   rc.window\_size = 15;  \textcolor{comment}{// Silence a static analysis warning.}}
\DoxyCodeLine{940   rc.avg\_st\_encoding\_bitrate = 0.0;}
\DoxyCodeLine{941   rc.variance\_st\_encoding\_bitrate = 0.0;}
\DoxyCodeLine{942   \textcolor{keywordflow}{if} (svc\_ctx.output\_rc\_stat) \{}
\DoxyCodeLine{943     set\_rate\_control\_stats(\&rc, \&enc\_cfg);}
\DoxyCodeLine{944     framerate = enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} / enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}};}
\DoxyCodeLine{945   \}}
\DoxyCodeLine{946 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{947 }
\DoxyCodeLine{948   info.codec\_fourcc = VP9\_FOURCC;}
\DoxyCodeLine{949   info.frame\_width = enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}};}
\DoxyCodeLine{950   info.frame\_height = enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}};}
\DoxyCodeLine{951   info.time\_base.numerator = enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}};}
\DoxyCodeLine{952   info.time\_base.denominator = enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}};}
\DoxyCodeLine{953 }
\DoxyCodeLine{954   writer =}
\DoxyCodeLine{955       vpx\_video\_writer\_open(app\_input.output\_filename, kContainerIVF, \&info);}
\DoxyCodeLine{956   \textcolor{keywordflow}{if} (!writer)}
\DoxyCodeLine{957     die(\textcolor{stringliteral}{"{}Failed to open \%s for writing\(\backslash\)n"{}}, app\_input.output\_filename);}
\DoxyCodeLine{958 }
\DoxyCodeLine{959 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{960   \textcolor{comment}{// Write out spatial layer stream.}}
\DoxyCodeLine{961   \textcolor{comment}{// TODO(marpan/jianj): allow for writing each spatial and temporal stream.}}
\DoxyCodeLine{962   \textcolor{keywordflow}{if} (svc\_ctx.output\_rc\_stat) \{}
\DoxyCodeLine{963     \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{964       \textcolor{keywordtype}{char} file\_name[PATH\_MAX];}
\DoxyCodeLine{965 }
\DoxyCodeLine{966       snprintf(file\_name, \textcolor{keyword}{sizeof}(file\_name), \textcolor{stringliteral}{"{}\%s\_s\%d.ivf"{}},}
\DoxyCodeLine{967                app\_input.output\_filename, sl);}
\DoxyCodeLine{968       outfile[sl] = vpx\_video\_writer\_open(file\_name, kContainerIVF, \&info);}
\DoxyCodeLine{969       \textcolor{keywordflow}{if} (!outfile[sl]) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing"{}}, file\_name);}
\DoxyCodeLine{970     \}}
\DoxyCodeLine{971   \}}
\DoxyCodeLine{972 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{973 }
\DoxyCodeLine{974   \textcolor{comment}{// skip initial frames}}
\DoxyCodeLine{975   \textcolor{keywordflow}{for} (i = 0; i < app\_input.frames\_to\_skip; ++i)}
\DoxyCodeLine{976     read\_frame(\&app\_input.input\_ctx, \&raw);}
\DoxyCodeLine{977 }
\DoxyCodeLine{978   \textcolor{keywordflow}{if} (svc\_ctx.speed != -\/1)}
\DoxyCodeLine{979     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca953ff0eaa2fcdc2ecd627e449b026853}{VP8E\_SET\_CPUUSED}}, svc\_ctx.speed);}
\DoxyCodeLine{980   \textcolor{keywordflow}{if} (svc\_ctx.threads) \{}
\DoxyCodeLine{981     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca9c221dc99c51eb5e6304461aed9b5f5b}{VP9E\_SET\_TILE\_COLUMNS}},}
\DoxyCodeLine{982                       get\_msb(svc\_ctx.threads));}
\DoxyCodeLine{983     \textcolor{keywordflow}{if} (svc\_ctx.threads > 1)}
\DoxyCodeLine{984       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca8ec97b90e57f4ddba099cd881a509360}{VP9E\_SET\_ROW\_MT}}, 1);}
\DoxyCodeLine{985     \textcolor{keywordflow}{else}}
\DoxyCodeLine{986       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca8ec97b90e57f4ddba099cd881a509360}{VP9E\_SET\_ROW\_MT}}, 0);}
\DoxyCodeLine{987   \}}
\DoxyCodeLine{988   \textcolor{keywordflow}{if} (svc\_ctx.speed >= 5 \&\& svc\_ctx.aqmode == 1)}
\DoxyCodeLine{989     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca375af288e2d7fa169cbfef4ba586c1d2}{VP9E\_SET\_AQ\_MODE}}, 3);}
\DoxyCodeLine{990   \textcolor{keywordflow}{if} (svc\_ctx.speed >= 5)}
\DoxyCodeLine{991     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecab34559df04d3d662616300ed0682dcfd}{VP8E\_SET\_STATIC\_THRESHOLD}}, 1);}
\DoxyCodeLine{992   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca09c69ff4a3aabdb307d4f24027dfc4c1}{VP8E\_SET\_MAX\_INTRA\_BITRATE\_PCT}}, 900);}
\DoxyCodeLine{993 }
\DoxyCodeLine{994   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca13dd95dd05c39d2f4db73d9c03add7b1}{VP9E\_SET\_SVC\_INTER\_LAYER\_PRED}},}
\DoxyCodeLine{995                     app\_input.inter\_layer\_pred);}
\DoxyCodeLine{996 }
\DoxyCodeLine{997   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecace6096a9fbe83dc72ed6a54a81ce215b}{VP9E\_SET\_NOISE\_SENSITIVITY}}, 0);}
\DoxyCodeLine{998 }
\DoxyCodeLine{999   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca87292610b42f00676aebdc75b63227de}{VP9E\_SET\_TUNE\_CONTENT}}, app\_input.tune\_content);}
\DoxyCodeLine{1000 }
\DoxyCodeLine{1001   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca73257656241aac7371e60fa99c8b797b}{VP9E\_SET\_DISABLE\_OVERSHOOT\_MAXQ\_CBR}}, 0);}
\DoxyCodeLine{1002   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacd2d31e611840edb87a0484a9ef1781a}{VP9E\_SET\_DISABLE\_LOOPFILTER}}, 0);}
\DoxyCodeLine{1003 }
\DoxyCodeLine{1004   svc\_drop\_frame.\mbox{\hyperlink{structvpx__svc__frame__drop_acdde4f09ba5bdaff7e6418bb15350a99}{framedrop\_mode}} = \mbox{\hyperlink{group__vp8__encoder_gga3205681fab504015432ce09e6e3fdce4a6ae5f6715816a5d8af0f880a46604753}{FULL\_SUPERFRAME\_DROP}};}
\DoxyCodeLine{1005   \textcolor{keywordflow}{for} (sl = 0; sl < (\textcolor{keywordtype}{unsigned} int)svc\_ctx.spatial\_layers; ++sl)}
\DoxyCodeLine{1006     svc\_drop\_frame.\mbox{\hyperlink{structvpx__svc__frame__drop_a519c245794a2cd3c3d8e502d92ad1435}{framedrop\_thresh}}[sl] = enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a619269f9a6904de58c4790e6806a3905}{rc\_dropframe\_thresh}};}
\DoxyCodeLine{1007   svc\_drop\_frame.\mbox{\hyperlink{structvpx__svc__frame__drop_aed72507d558a7133fe3493d501798f26}{max\_consec\_drop}} = INT\_MAX;}
\DoxyCodeLine{1008   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca9c3914bdf858bcb1c8e8a2922bd97783}{VP9E\_SET\_SVC\_FRAME\_DROP\_LAYER}}, \&svc\_drop\_frame);}
\DoxyCodeLine{1009 }
\DoxyCodeLine{1010   \textcolor{comment}{// Encode frames}}
\DoxyCodeLine{1011   \textcolor{keywordflow}{while} (!end\_of\_stream) \{}
\DoxyCodeLine{1012     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{1013     \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *cx\_pkt;}
\DoxyCodeLine{1014     \textcolor{comment}{// Example patterns for bypass/flexible mode:}}
\DoxyCodeLine{1015     \textcolor{comment}{// example\_pattern = 0: 2 temporal layers, and spatial\_layers = 1,2,3. Exact}}
\DoxyCodeLine{1016     \textcolor{comment}{// to fixed SVC patterns. example\_pattern = 1: 2 spatial and 2 temporal}}
\DoxyCodeLine{1017     \textcolor{comment}{// layers, with SL0 only has TL0, and SL1 has both TL0 and TL1. This example}}
\DoxyCodeLine{1018     \textcolor{comment}{// uses the extended API.}}
\DoxyCodeLine{1019     \textcolor{keywordtype}{int} example\_pattern = 0;}
\DoxyCodeLine{1020     \textcolor{keywordflow}{if} (frame\_cnt >= app\_input.frames\_to\_code ||}
\DoxyCodeLine{1021         !read\_frame(\&app\_input.input\_ctx, \&raw)) \{}
\DoxyCodeLine{1022       \textcolor{comment}{// We need one extra vpx\_svc\_encode call at end of stream to flush}}
\DoxyCodeLine{1023       \textcolor{comment}{// encoder and get remaining data}}
\DoxyCodeLine{1024       end\_of\_stream = 1;}
\DoxyCodeLine{1025     \}}
\DoxyCodeLine{1026 }
\DoxyCodeLine{1027     \textcolor{comment}{// For BYPASS/FLEXIBLE mode, set the frame flags (reference and updates)}}
\DoxyCodeLine{1028     \textcolor{comment}{// and the buffer indices for each spatial layer of the current}}
\DoxyCodeLine{1029     \textcolor{comment}{// (super)frame to be encoded. The spatial and temporal layer\_id for the}}
\DoxyCodeLine{1030     \textcolor{comment}{// current frame also needs to be set.}}
\DoxyCodeLine{1031     \textcolor{comment}{// TODO(marpan): Should rename the "{}VP9E\_TEMPORAL\_LAYERING\_MODE\_BYPASS"{}}}
\DoxyCodeLine{1032     \textcolor{comment}{// mode to "{}VP9E\_LAYERING\_MODE\_BYPASS"{}.}}
\DoxyCodeLine{1033     \textcolor{keywordflow}{if} (svc\_ctx.temporal\_layering\_mode == \mbox{\hyperlink{group__vp8__encoder_ggabe875c0c3993e488ffb342cf548a8ce8a680204f7c9d48155170bcb3fc6e673e8}{VP9E\_TEMPORAL\_LAYERING\_MODE\_BYPASS}}) \{}
\DoxyCodeLine{1034       layer\_id.spatial\_layer\_id = 0;}
\DoxyCodeLine{1035       \textcolor{comment}{// Example for 2 temporal layers.}}
\DoxyCodeLine{1036       \textcolor{keywordflow}{if} (frame\_cnt \% 2 == 0) \{}
\DoxyCodeLine{1037         layer\_id.temporal\_layer\_id = 0;}
\DoxyCodeLine{1038         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{group__encoder_ga8ee6b12a5f4c97d9767adffb88fff7da}{VPX\_SS\_MAX\_LAYERS}}; i++)}
\DoxyCodeLine{1039           layer\_id.temporal\_layer\_id\_per\_spatial[i] = 0;}
\DoxyCodeLine{1040       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1041         layer\_id.temporal\_layer\_id = 1;}
\DoxyCodeLine{1042         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{group__encoder_ga8ee6b12a5f4c97d9767adffb88fff7da}{VPX\_SS\_MAX\_LAYERS}}; i++)}
\DoxyCodeLine{1043           layer\_id.temporal\_layer\_id\_per\_spatial[i] = 1;}
\DoxyCodeLine{1044       \}}
\DoxyCodeLine{1045       \textcolor{keywordflow}{if} (example\_pattern == 1) \{}
\DoxyCodeLine{1046         \textcolor{comment}{// example\_pattern 1 is hard-\/coded for 2 spatial and 2 temporal layers.}}
\DoxyCodeLine{1047         assert(svc\_ctx.spatial\_layers == 2);}
\DoxyCodeLine{1048         assert(svc\_ctx.temporal\_layers == 2);}
\DoxyCodeLine{1049         \textcolor{keywordflow}{if} (frame\_cnt \% 2 == 0) \{}
\DoxyCodeLine{1050           \textcolor{comment}{// Spatial layer 0 and 1 are encoded.}}
\DoxyCodeLine{1051           layer\_id.temporal\_layer\_id\_per\_spatial[0] = 0;}
\DoxyCodeLine{1052           layer\_id.temporal\_layer\_id\_per\_spatial[1] = 0;}
\DoxyCodeLine{1053           layer\_id.spatial\_layer\_id = 0;}
\DoxyCodeLine{1054         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1055           \textcolor{comment}{// Only spatial layer 1 is encoded here.}}
\DoxyCodeLine{1056           layer\_id.temporal\_layer\_id\_per\_spatial[1] = 1;}
\DoxyCodeLine{1057           layer\_id.spatial\_layer\_id = 1;}
\DoxyCodeLine{1058         \}}
\DoxyCodeLine{1059       \}}
\DoxyCodeLine{1060       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca090ad9dcb1f2eea2af60f4737c5bf514}{VP9E\_SET\_SVC\_LAYER\_ID}}, \&layer\_id);}
\DoxyCodeLine{1061       \textcolor{comment}{// TODO(jianj): Fix the parameter passing for "{}is\_key\_frame"{} in}}
\DoxyCodeLine{1062       \textcolor{comment}{// set\_frame\_flags\_bypass\_model() for case of periodic key frames.}}
\DoxyCodeLine{1063       \textcolor{keywordflow}{if} (example\_pattern == 0) \{}
\DoxyCodeLine{1064         set\_frame\_flags\_bypass\_mode\_ex0(layer\_id.temporal\_layer\_id,}
\DoxyCodeLine{1065                                         svc\_ctx.spatial\_layers, frame\_cnt == 0,}
\DoxyCodeLine{1066                                         \&ref\_frame\_config);}
\DoxyCodeLine{1067       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (example\_pattern == 1) \{}
\DoxyCodeLine{1068         set\_frame\_flags\_bypass\_mode\_ex1(layer\_id.temporal\_layer\_id,}
\DoxyCodeLine{1069                                         svc\_ctx.spatial\_layers, frame\_cnt == 0,}
\DoxyCodeLine{1070                                         \&ref\_frame\_config);}
\DoxyCodeLine{1071       \}}
\DoxyCodeLine{1072       ref\_frame\_config.\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab089b385aaa31730b1c1f7ad08f0e1f6}{duration}}[0] = frame\_duration * 1;}
\DoxyCodeLine{1073       ref\_frame\_config.\mbox{\hyperlink{structvpx__svc__ref__frame__config_ab089b385aaa31730b1c1f7ad08f0e1f6}{duration}}[1] = frame\_duration * 1;}
\DoxyCodeLine{1074 }
\DoxyCodeLine{1075       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecaa0d822d0d1efa1868ce05d8523a8836b}{VP9E\_SET\_SVC\_REF\_FRAME\_CONFIG}},}
\DoxyCodeLine{1076                         \&ref\_frame\_config);}
\DoxyCodeLine{1077       \textcolor{comment}{// Keep track of input frames, to account for frame drops in rate control}}
\DoxyCodeLine{1078       \textcolor{comment}{// stats/metrics.}}
\DoxyCodeLine{1079       \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{1080         ++rc.layer\_input\_frames[sl * enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} +}
\DoxyCodeLine{1081                                 layer\_id.temporal\_layer\_id];}
\DoxyCodeLine{1082       \}}
\DoxyCodeLine{1083     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1084       \textcolor{comment}{// For the fixed pattern SVC, temporal layer is given by superframe count.}}
\DoxyCodeLine{1085       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} tl = 0;}
\DoxyCodeLine{1086       \textcolor{keywordflow}{if} (enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} == 2)}
\DoxyCodeLine{1087         tl = (frame\_cnt \% 2 != 0);}
\DoxyCodeLine{1088       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} == 3) \{}
\DoxyCodeLine{1089         \textcolor{keywordflow}{if} (frame\_cnt \% 2 != 0) tl = 2;}
\DoxyCodeLine{1090         \textcolor{keywordflow}{if} ((frame\_cnt > 1) \&\& ((frame\_cnt -\/ 2) \% 4 == 0)) tl = 1;}
\DoxyCodeLine{1091       \}}
\DoxyCodeLine{1092       \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl)}
\DoxyCodeLine{1093         ++rc.layer\_input\_frames[sl * enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} + tl];}
\DoxyCodeLine{1094     \}}
\DoxyCodeLine{1095 }
\DoxyCodeLine{1096     vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{1097     res = vpx\_svc\_encode(}
\DoxyCodeLine{1098         \&svc\_ctx, \&encoder, (end\_of\_stream ? NULL : \&raw), pts, frame\_duration,}
\DoxyCodeLine{1099         svc\_ctx.speed >= 5 ? \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}} : \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}});}
\DoxyCodeLine{1100     vpx\_usec\_timer\_mark(\&timer);}
\DoxyCodeLine{1101     cx\_time += vpx\_usec\_timer\_elapsed(\&timer);}
\DoxyCodeLine{1102 }
\DoxyCodeLine{1103     fflush(stdout);}
\DoxyCodeLine{1104     \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) \{}
\DoxyCodeLine{1105       die\_codec(\&encoder, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{1106     \}}
\DoxyCodeLine{1107 }
\DoxyCodeLine{1108     \textcolor{keywordflow}{while} ((cx\_pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(\&encoder, \&iter)) != NULL) \{}
\DoxyCodeLine{1109       \textcolor{keywordflow}{switch} (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}}) \{}
\DoxyCodeLine{1110         \textcolor{keywordflow}{case} \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}: \{}
\DoxyCodeLine{1111           SvcInternal\_t *\textcolor{keyword}{const} si = (SvcInternal\_t *)svc\_ctx.internal;}
\DoxyCodeLine{1112           if (cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}} > 0) \{}
\DoxyCodeLine{1113             vpx\_video\_writer\_write\_frame(writer, cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{1114                                          cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{1115                                          cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}});}
\DoxyCodeLine{1116 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{1117             \textcolor{keywordflow}{if} (svc\_ctx.output\_rc\_stat) \{}
\DoxyCodeLine{1118               svc\_output\_rc\_stats(\&encoder, \&enc\_cfg, \&layer\_id, cx\_pkt, \&rc,}
\DoxyCodeLine{1119                                   outfile, frame\_cnt, framerate);}
\DoxyCodeLine{1120             \}}
\DoxyCodeLine{1121 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1122           \}}
\DoxyCodeLine{1123           \textcolor{comment}{/*}}
\DoxyCodeLine{1124 \textcolor{comment}{          printf("{}SVC frame: \%d, kf: \%d, size: \%d, pts: \%d\(\backslash\)n"{}, frames\_received,}}
\DoxyCodeLine{1125 \textcolor{comment}{                 !!(cx\_pkt-\/>data.frame.flags \& VPX\_FRAME\_IS\_KEY),}}
\DoxyCodeLine{1126 \textcolor{comment}{                 (int)cx\_pkt-\/>data.frame.sz, (int)cx\_pkt-\/>data.frame.pts);}}
\DoxyCodeLine{1127 \textcolor{comment}{          */}}
\DoxyCodeLine{1128           \textcolor{keywordflow}{if} (enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}} == 1 \&\& enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} == 1)}
\DoxyCodeLine{1129             si-\/>bytes\_sum[0] += (int)cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}};}
\DoxyCodeLine{1130           ++frames\_received;}
\DoxyCodeLine{1131 \#\textcolor{keywordflow}{if} CONFIG\_VP9\_DECODER \&\& !SIMULCAST\_MODE}
\DoxyCodeLine{1132           if (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&decoder, cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{1133                                (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}}, NULL, 0))}
\DoxyCodeLine{1134             die\_codec(\&decoder, \textcolor{stringliteral}{"{}Failed to decode frame."{}});}
\DoxyCodeLine{1135 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1136           \textcolor{keywordflow}{break};}
\DoxyCodeLine{1137         \}}
\DoxyCodeLine{1138         \textcolor{keywordflow}{case} \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a77cd8b95d9891bcce36117f5f31994fd}{VPX\_CODEC\_STATS\_PKT}}: \{}
\DoxyCodeLine{1139           stats\_write(\&app\_input.rc\_stats, cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a4018900fa26ecc55abc4703cc7d7c7fc}{twopass\_stats}}.\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}},}
\DoxyCodeLine{1140                       cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a4018900fa26ecc55abc4703cc7d7c7fc}{twopass\_stats}}.\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}});}
\DoxyCodeLine{1141           \textcolor{keywordflow}{break};}
\DoxyCodeLine{1142         \}}
\DoxyCodeLine{1143         \textcolor{keywordflow}{default}: \{ \textcolor{keywordflow}{break}; \}}
\DoxyCodeLine{1144       \}}
\DoxyCodeLine{1145 }
\DoxyCodeLine{1146 \textcolor{preprocessor}{\#if CONFIG\_VP9\_DECODER \&\& !SIMULCAST\_MODE}}
\DoxyCodeLine{1147       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecae5198050ccb3c1aed11fee8a9fb3be18}{VP9E\_GET\_SVC\_LAYER\_ID}}, \&layer\_id);}
\DoxyCodeLine{1148       \textcolor{comment}{// Don't look for mismatch on top spatial and top temporal layers as they}}
\DoxyCodeLine{1149       \textcolor{comment}{// are non reference frames.}}
\DoxyCodeLine{1150       \textcolor{keywordflow}{if} ((enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}} > 1 || enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} > 1) \&\&}
\DoxyCodeLine{1151           !(layer\_id.temporal\_layer\_id > 0 \&\&}
\DoxyCodeLine{1152             layer\_id.temporal\_layer\_id == (\textcolor{keywordtype}{int})enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} -\/ 1 \&\&}
\DoxyCodeLine{1153             cx\_pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}}
\DoxyCodeLine{1154                 .\mbox{\hyperlink{structvpx__codec__cx__pkt_a7b157182695b6c882bee7c0b290582fa}{spatial\_layer\_encoded}}[enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}} -\/ 1])) \{}
\DoxyCodeLine{1155         test\_decode(\&encoder, \&decoder, frame\_cnt, \&mismatch\_seen);}
\DoxyCodeLine{1156       \}}
\DoxyCodeLine{1157 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1158     \}}
\DoxyCodeLine{1159 }
\DoxyCodeLine{1160     \textcolor{keywordflow}{if} (!end\_of\_stream) \{}
\DoxyCodeLine{1161       ++frame\_cnt;}
\DoxyCodeLine{1162       pts += frame\_duration;}
\DoxyCodeLine{1163     \}}
\DoxyCodeLine{1164   \}}
\DoxyCodeLine{1165 }
\DoxyCodeLine{1166   printf(\textcolor{stringliteral}{"{}Processed \%d frames\(\backslash\)n"{}}, frame\_cnt);}
\DoxyCodeLine{1167 }
\DoxyCodeLine{1168   close\_input\_file(\&app\_input.input\_ctx);}
\DoxyCodeLine{1169 }
\DoxyCodeLine{1170 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{1171   \textcolor{keywordflow}{if} (svc\_ctx.output\_rc\_stat) \{}
\DoxyCodeLine{1172     printout\_rate\_control\_summary(\&rc, \&enc\_cfg, frame\_cnt);}
\DoxyCodeLine{1173     printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{1174   \}}
\DoxyCodeLine{1175 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1176   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&encoder))}
\DoxyCodeLine{1177     die\_codec(\&encoder, \textcolor{stringliteral}{"{}Failed to destroy codec"{}});}
\DoxyCodeLine{1178   \textcolor{keywordflow}{if} (writer) \{}
\DoxyCodeLine{1179     vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{1180   \}}
\DoxyCodeLine{1181 \textcolor{preprocessor}{\#if OUTPUT\_RC\_STATS}}
\DoxyCodeLine{1182   \textcolor{keywordflow}{if} (svc\_ctx.output\_rc\_stat) \{}
\DoxyCodeLine{1183     \textcolor{keywordflow}{for} (sl = 0; sl < enc\_cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}}; ++sl) \{}
\DoxyCodeLine{1184       vpx\_video\_writer\_close(outfile[sl]);}
\DoxyCodeLine{1185     \}}
\DoxyCodeLine{1186   \}}
\DoxyCodeLine{1187 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1188 \textcolor{preprocessor}{\#if CONFIG\_INTERNAL\_STATS}}
\DoxyCodeLine{1189   \textcolor{keywordflow}{if} (mismatch\_seen) \{}
\DoxyCodeLine{1190     fprintf(f, \textcolor{stringliteral}{"{}First mismatch occurred in frame \%d\(\backslash\)n"{}}, mismatch\_seen);}
\DoxyCodeLine{1191   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1192     fprintf(f, \textcolor{stringliteral}{"{}No mismatch detected in recon buffers\(\backslash\)n"{}});}
\DoxyCodeLine{1193   \}}
\DoxyCodeLine{1194   fclose(f);}
\DoxyCodeLine{1195 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1196   printf(\textcolor{stringliteral}{"{}Frame cnt and encoding time/FPS stats for encoding: \%d \%f \%f \(\backslash\)n"{}},}
\DoxyCodeLine{1197          frame\_cnt, 1000 * (\textcolor{keywordtype}{float})cx\_time / (\textcolor{keywordtype}{double})(frame\_cnt * 1000000),}
\DoxyCodeLine{1198          1000000 * (\textcolor{keywordtype}{double})frame\_cnt / (\textcolor{keywordtype}{double})cx\_time);}
\DoxyCodeLine{1199   \textcolor{keywordflow}{if} (app\_input.input\_ctx.file\_type != FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{1200     \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{1201   \}}
\DoxyCodeLine{1202   \textcolor{comment}{// display average size, psnr}}
\DoxyCodeLine{1203   vpx\_svc\_dump\_statistics(\&svc\_ctx);}
\DoxyCodeLine{1204   vpx\_svc\_release(\&svc\_ctx);}
\DoxyCodeLine{1205   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{1206 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vp9cx_set_ref}{}\doxysubsection{vp9cx\+\_\+set\+\_\+ref}\label{example_vp9cx_set_ref}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2016 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{// VP9 Set Reference Frame}}
\DoxyCodeLine{12 \textcolor{comment}{// ============================}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// This is an example demonstrating how to overwrite the VP9 encoder's}}
\DoxyCodeLine{15 \textcolor{comment}{// internal reference frame. In the sample we set the last frame to the}}
\DoxyCodeLine{16 \textcolor{comment}{// current frame. This technique could be used to bounce between two cameras.}}
\DoxyCodeLine{17 \textcolor{comment}{//}}
\DoxyCodeLine{18 \textcolor{comment}{// The decoder would also have to set the reference frame to the same value}}
\DoxyCodeLine{19 \textcolor{comment}{// on the same frame, or the video will become corrupt. The 'test\_decode'}}
\DoxyCodeLine{20 \textcolor{comment}{// variable is set to 1 in this example that tests if the encoder and decoder}}
\DoxyCodeLine{21 \textcolor{comment}{// results are matching.}}
\DoxyCodeLine{22 \textcolor{comment}{//}}
\DoxyCodeLine{23 \textcolor{comment}{// Usage}}
\DoxyCodeLine{24 \textcolor{comment}{// -\/-\/-\/-\/-\/}}
\DoxyCodeLine{25 \textcolor{comment}{// This example encodes a raw video. And the last argument passed in specifies}}
\DoxyCodeLine{26 \textcolor{comment}{// the frame number to update the reference frame on. For example, run}}
\DoxyCodeLine{27 \textcolor{comment}{// examples/vp9cx\_set\_ref 352 288 in.yuv out.ivf 4 30}}
\DoxyCodeLine{28 \textcolor{comment}{// The parameter is parsed as follows:}}
\DoxyCodeLine{29 \textcolor{comment}{//}}
\DoxyCodeLine{30 \textcolor{comment}{//}}
\DoxyCodeLine{31 \textcolor{comment}{// Extra Variables}}
\DoxyCodeLine{32 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{33 \textcolor{comment}{// This example maintains the frame number passed on the command line}}
\DoxyCodeLine{34 \textcolor{comment}{// in the `update\_frame\_num` variable.}}
\DoxyCodeLine{35 \textcolor{comment}{//}}
\DoxyCodeLine{36 \textcolor{comment}{//}}
\DoxyCodeLine{37 \textcolor{comment}{// Configuration}}
\DoxyCodeLine{38 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{39 \textcolor{comment}{//}}
\DoxyCodeLine{40 \textcolor{comment}{// The reference frame is updated on the frame specified on the command}}
\DoxyCodeLine{41 \textcolor{comment}{// line.}}
\DoxyCodeLine{42 \textcolor{comment}{//}}
\DoxyCodeLine{43 \textcolor{comment}{// Observing The Effects}}
\DoxyCodeLine{44 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{45 \textcolor{comment}{// The encoder and decoder results should be matching when the same reference}}
\DoxyCodeLine{46 \textcolor{comment}{// frame setting operation is done in both encoder and decoder. Otherwise,}}
\DoxyCodeLine{47 \textcolor{comment}{// the encoder/decoder mismatch would be seen.}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{54 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{55 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{56 \textcolor{preprocessor}{\#include "{}vp9/common/vp9\_common.h"{}}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58 \textcolor{preprocessor}{\#include "{}./tools\_common.h"{}}}
\DoxyCodeLine{59 \textcolor{preprocessor}{\#include "{}./video\_writer.h"{}}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{keywordtype}{void} usage\_exit() \{}
\DoxyCodeLine{64   fprintf(stderr,}
\DoxyCodeLine{65           \textcolor{stringliteral}{"{}Usage: \%s <width> <height> <infile> <outfile> "{}}}
\DoxyCodeLine{66           \textcolor{stringliteral}{"{}<frame> <limit(optional)>\(\backslash\)n"{}},}
\DoxyCodeLine{67           exec\_name);}
\DoxyCodeLine{68   exit(EXIT\_FAILURE);}
\DoxyCodeLine{69 \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{keyword}{static} \textcolor{keywordtype}{void} testing\_decode(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *encoder, \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *decoder,}
\DoxyCodeLine{72                            \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frame\_out, \textcolor{keywordtype}{int} *mismatch\_seen) \{}
\DoxyCodeLine{73   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} enc\_img, dec\_img;}
\DoxyCodeLine{74   \textcolor{keyword}{struct }\mbox{\hyperlink{structvp9__ref__frame}{vp9\_ref\_frame}} ref\_enc, ref\_dec;}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{keywordflow}{if} (*mismatch\_seen) \textcolor{keywordflow}{return};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   ref\_enc.\mbox{\hyperlink{structvp9__ref__frame_a26e0d119a61c29b72c6ccb91748b6b82}{idx}} = 0;}
\DoxyCodeLine{79   ref\_dec.idx = 0;}
\DoxyCodeLine{80   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(encoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a91e44472b21c720a9a7d087c7226d083}{VP9\_GET\_REFERENCE}}, \&ref\_enc))}
\DoxyCodeLine{81     die\_codec(encoder, \textcolor{stringliteral}{"{}Failed to get encoder reference frame"{}});}
\DoxyCodeLine{82   enc\_img = ref\_enc.img;}
\DoxyCodeLine{83   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(decoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a91e44472b21c720a9a7d087c7226d083}{VP9\_GET\_REFERENCE}}, \&ref\_dec))}
\DoxyCodeLine{84     die\_codec(decoder, \textcolor{stringliteral}{"{}Failed to get decoder reference frame"{}});}
\DoxyCodeLine{85   dec\_img = ref\_dec.img;}
\DoxyCodeLine{86 }
\DoxyCodeLine{87   \textcolor{keywordflow}{if} (!compare\_img(\&enc\_img, \&dec\_img)) \{}
\DoxyCodeLine{88     \textcolor{keywordtype}{int} y[4], u[4], v[4];}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     *mismatch\_seen = 1;}
\DoxyCodeLine{91 }
\DoxyCodeLine{92     find\_mismatch(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{93     printf(}
\DoxyCodeLine{94         \textcolor{stringliteral}{"{}Encode/decode mismatch on frame \%d at"{}}}
\DoxyCodeLine{95         \textcolor{stringliteral}{"{} Y[\%d, \%d] \{\%d/\%d\},"{}}}
\DoxyCodeLine{96         \textcolor{stringliteral}{"{} U[\%d, \%d] \{\%d/\%d\},"{}}}
\DoxyCodeLine{97         \textcolor{stringliteral}{"{} V[\%d, \%d] \{\%d/\%d\}"{}},}
\DoxyCodeLine{98         frame\_out, y[0], y[1], y[2], y[3], u[0], u[1], u[2], u[3], v[0], v[1],}
\DoxyCodeLine{99         v[2], v[3]);}
\DoxyCodeLine{100   \}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&enc\_img);}
\DoxyCodeLine{103   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&dec\_img);}
\DoxyCodeLine{104 \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{keyword}{static} \textcolor{keywordtype}{int} encode\_frame(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *ecodec, \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *\mbox{\hyperlink{structvp9__ref__frame_ab8d92d960007586ea7c8cd9306e98db2}{img}},}
\DoxyCodeLine{107                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frame\_in, VpxVideoWriter *writer,}
\DoxyCodeLine{108                         \textcolor{keywordtype}{int} test\_decode, \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *dcodec,}
\DoxyCodeLine{109                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *frame\_out, \textcolor{keywordtype}{int} *mismatch\_seen) \{}
\DoxyCodeLine{110   \textcolor{keywordtype}{int} got\_pkts = 0;}
\DoxyCodeLine{111   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{112   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt = NULL;}
\DoxyCodeLine{113   \textcolor{keywordtype}{int} got\_data;}
\DoxyCodeLine{114   \textcolor{keyword}{const} \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res =}
\DoxyCodeLine{115       \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(ecodec, \mbox{\hyperlink{structvp9__ref__frame_ab8d92d960007586ea7c8cd9306e98db2}{img}}, frame\_in, 1, 0, \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}});}
\DoxyCodeLine{116   \textcolor{keywordflow}{if} (res != \mbox{\hyperlink{group__codec_ggada1084710837ad363b92f2379dd2b8d2af1dcde74b1c5ff7b29f31246dfd90986}{VPX\_CODEC\_OK}}) die\_codec(ecodec, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   got\_data = 0;}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(ecodec, \&iter)) != NULL) \{}
\DoxyCodeLine{121     got\_pkts = 1;}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}} == \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}) \{}
\DoxyCodeLine{124       \textcolor{keyword}{const} \textcolor{keywordtype}{int} keyframe = (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}}) != 0;}
\DoxyCodeLine{125 }
\DoxyCodeLine{126       \textcolor{keywordflow}{if} (!(pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_gafb9f7dbf9b8a764c521d8b12c0e6959d}{VPX\_FRAME\_IS\_FRAGMENT}})) \{}
\DoxyCodeLine{127         *frame\_out += 1;}
\DoxyCodeLine{128       \}}
\DoxyCodeLine{129 }
\DoxyCodeLine{130       \textcolor{keywordflow}{if} (!vpx\_video\_writer\_write\_frame(writer, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{131                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{132                                         pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}})) \{}
\DoxyCodeLine{133         die\_codec(ecodec, \textcolor{stringliteral}{"{}Failed to write compressed frame"{}});}
\DoxyCodeLine{134       \}}
\DoxyCodeLine{135       printf(keyframe ? \textcolor{stringliteral}{"{}K"{}} : \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{136       fflush(stdout);}
\DoxyCodeLine{137       got\_data = 1;}
\DoxyCodeLine{138 }
\DoxyCodeLine{139       \textcolor{comment}{// Decode 1 frame.}}
\DoxyCodeLine{140       \textcolor{keywordflow}{if} (test\_decode) \{}
\DoxyCodeLine{141         \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(dcodec, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{142                              (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}}, NULL, 0))}
\DoxyCodeLine{143           die\_codec(dcodec, \textcolor{stringliteral}{"{}Failed to decode frame."{}});}
\DoxyCodeLine{144       \}}
\DoxyCodeLine{145     \}}
\DoxyCodeLine{146   \}}
\DoxyCodeLine{147 }
\DoxyCodeLine{148   \textcolor{comment}{// Mismatch checking}}
\DoxyCodeLine{149   \textcolor{keywordflow}{if} (got\_data \&\& test\_decode) \{}
\DoxyCodeLine{150     testing\_decode(ecodec, dcodec, *frame\_out, mismatch\_seen);}
\DoxyCodeLine{151   \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153   \textcolor{keywordflow}{return} got\_pkts;}
\DoxyCodeLine{154 \}}
\DoxyCodeLine{155 }
\DoxyCodeLine{156 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{157   FILE *infile = NULL;}
\DoxyCodeLine{158   \textcolor{comment}{// Encoder}}
\DoxyCodeLine{159   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} ecodec;}
\DoxyCodeLine{160   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{161   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frame\_in = 0;}
\DoxyCodeLine{162   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{163   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{164   VpxVideoInfo info;}
\DoxyCodeLine{165   VpxVideoWriter *writer = NULL;}
\DoxyCodeLine{166   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{167 }
\DoxyCodeLine{168   \textcolor{comment}{// Test encoder/decoder mismatch.}}
\DoxyCodeLine{169   \textcolor{keywordtype}{int} test\_decode = 1;}
\DoxyCodeLine{170   \textcolor{comment}{// Decoder}}
\DoxyCodeLine{171   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} dcodec;}
\DoxyCodeLine{172   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frame\_out = 0;}
\DoxyCodeLine{173 }
\DoxyCodeLine{174   \textcolor{comment}{// The frame number to set reference frame on}}
\DoxyCodeLine{175   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} update\_frame\_num = 0;}
\DoxyCodeLine{176   \textcolor{keywordtype}{int} mismatch\_seen = 0;}
\DoxyCodeLine{177 }
\DoxyCodeLine{178   \textcolor{keyword}{const} \textcolor{keywordtype}{int} fps = 30;}
\DoxyCodeLine{179   \textcolor{keyword}{const} \textcolor{keywordtype}{int} bitrate = 500;}
\DoxyCodeLine{180 }
\DoxyCodeLine{181   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *width\_arg = NULL;}
\DoxyCodeLine{182   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *height\_arg = NULL;}
\DoxyCodeLine{183   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *infile\_arg = NULL;}
\DoxyCodeLine{184   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *outfile\_arg = NULL;}
\DoxyCodeLine{185   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *update\_frame\_num\_arg = NULL;}
\DoxyCodeLine{186   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} limit = 0;}
\DoxyCodeLine{187 }
\DoxyCodeLine{188   vp9\_zero(ecodec);}
\DoxyCodeLine{189   vp9\_zero(cfg);}
\DoxyCodeLine{190   vp9\_zero(info);}
\DoxyCodeLine{191 }
\DoxyCodeLine{192   exec\_name = argv[0];}
\DoxyCodeLine{193 }
\DoxyCodeLine{194   \textcolor{keywordflow}{if} (argc < 6) die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{195 }
\DoxyCodeLine{196   width\_arg = argv[1];}
\DoxyCodeLine{197   height\_arg = argv[2];}
\DoxyCodeLine{198   infile\_arg = argv[3];}
\DoxyCodeLine{199   outfile\_arg = argv[4];}
\DoxyCodeLine{200   update\_frame\_num\_arg = argv[5];}
\DoxyCodeLine{201 }
\DoxyCodeLine{202   encoder = get\_vpx\_encoder\_by\_name(\textcolor{stringliteral}{"{}vp9"{}});}
\DoxyCodeLine{203   \textcolor{keywordflow}{if} (!encoder) die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{204 }
\DoxyCodeLine{205   update\_frame\_num = (\textcolor{keywordtype}{unsigned} int)strtoul(update\_frame\_num\_arg, NULL, 0);}
\DoxyCodeLine{206   \textcolor{comment}{// In VP9, the reference buffers (cm-\/>buffer\_pool-\/>frame\_bufs[i].buf) are}}
\DoxyCodeLine{207   \textcolor{comment}{// allocated while calling vpx\_codec\_encode(), thus, setting reference for}}
\DoxyCodeLine{208   \textcolor{comment}{// 1st frame isn't supported.}}
\DoxyCodeLine{209   \textcolor{keywordflow}{if} (update\_frame\_num <= 1) \{}
\DoxyCodeLine{210     die(\textcolor{stringliteral}{"{}Couldn't parse frame number '\%s'\(\backslash\)n"{}}, update\_frame\_num\_arg);}
\DoxyCodeLine{211   \}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213   \textcolor{keywordflow}{if} (argc > 6) \{}
\DoxyCodeLine{214     limit = (\textcolor{keywordtype}{unsigned} int)strtoul(argv[6], NULL, 0);}
\DoxyCodeLine{215     \textcolor{keywordflow}{if} (update\_frame\_num > limit)}
\DoxyCodeLine{216       die(\textcolor{stringliteral}{"{}Update frame number couldn't larger than limit\(\backslash\)n"{}});}
\DoxyCodeLine{217   \}}
\DoxyCodeLine{218 }
\DoxyCodeLine{219   info.codec\_fourcc = encoder-\/>fourcc;}
\DoxyCodeLine{220   info.frame\_width = (int)strtol(width\_arg, NULL, 0);}
\DoxyCodeLine{221   info.frame\_height = (int)strtol(height\_arg, NULL, 0);}
\DoxyCodeLine{222   info.time\_base.numerator = 1;}
\DoxyCodeLine{223   info.time\_base.denominator = fps;}
\DoxyCodeLine{224 }
\DoxyCodeLine{225   \textcolor{keywordflow}{if} (info.frame\_width <= 0 || info.frame\_height <= 0 ||}
\DoxyCodeLine{226       (info.frame\_width \% 2) != 0 || (info.frame\_height \% 2) != 0) \{}
\DoxyCodeLine{227     die(\textcolor{stringliteral}{"{}Invalid frame size: \%dx\%d"{}}, info.frame\_width, info.frame\_height);}
\DoxyCodeLine{228   \}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, info.frame\_width,}
\DoxyCodeLine{231                      info.frame\_height, 1)) \{}
\DoxyCodeLine{232     die(\textcolor{stringliteral}{"{}Failed to allocate image."{}});}
\DoxyCodeLine{233   \}}
\DoxyCodeLine{234 }
\DoxyCodeLine{235   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{236 }
\DoxyCodeLine{237   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{238   \textcolor{keywordflow}{if} (res) die\_codec(\&ecodec, \textcolor{stringliteral}{"{}Failed to get default codec config."{}});}
\DoxyCodeLine{239 }
\DoxyCodeLine{240   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = info.frame\_width;}
\DoxyCodeLine{241   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = info.frame\_height;}
\DoxyCodeLine{242   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = info.time\_base.numerator;}
\DoxyCodeLine{243   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = info.time\_base.denominator;}
\DoxyCodeLine{244   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = bitrate;}
\DoxyCodeLine{245   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a992668d9e30305f3f7ab2672ea31a890}{g\_lag\_in\_frames}} = 3;}
\DoxyCodeLine{246 }
\DoxyCodeLine{247   writer = vpx\_video\_writer\_open(outfile\_arg, kContainerIVF, \&info);}
\DoxyCodeLine{248   \textcolor{keywordflow}{if} (!writer) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing."{}}, outfile\_arg);}
\DoxyCodeLine{249 }
\DoxyCodeLine{250   \textcolor{keywordflow}{if} (!(infile = fopen(infile\_arg, \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{251     die(\textcolor{stringliteral}{"{}Failed to open \%s for reading."{}}, infile\_arg);}
\DoxyCodeLine{252 }
\DoxyCodeLine{253   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&ecodec, encoder-\/>codec\_interface(), \&cfg, 0))}
\DoxyCodeLine{254     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{255 }
\DoxyCodeLine{256   \textcolor{comment}{// Disable alt\_ref.}}
\DoxyCodeLine{257   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&ecodec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca24a5530efabb8b4949d01622b1d72cb0}{VP8E\_SET\_ENABLEAUTOALTREF}}, 0))}
\DoxyCodeLine{258     die\_codec(\&ecodec, \textcolor{stringliteral}{"{}Failed to set enable auto alt ref"{}});}
\DoxyCodeLine{259 }
\DoxyCodeLine{260   \textcolor{keywordflow}{if} (test\_decode) \{}
\DoxyCodeLine{261     \textcolor{keyword}{const} VpxInterface *decoder = get\_vpx\_decoder\_by\_name(\textcolor{stringliteral}{"{}vp9"{}});}
\DoxyCodeLine{262     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&dcodec, decoder-\/>codec\_interface(), NULL, 0))}
\DoxyCodeLine{263       die\_codec(\&dcodec, \textcolor{stringliteral}{"{}Failed to initialize decoder."{}});}
\DoxyCodeLine{264   \}}
\DoxyCodeLine{265 }
\DoxyCodeLine{266   \textcolor{comment}{// Encode frames.}}
\DoxyCodeLine{267   \textcolor{keywordflow}{while} (vpx\_img\_read(\&raw, infile)) \{}
\DoxyCodeLine{268     \textcolor{keywordflow}{if} (limit \&\& frame\_in >= limit) \textcolor{keywordflow}{break};}
\DoxyCodeLine{269     \textcolor{keywordflow}{if} (update\_frame\_num > 1 \&\& frame\_out + 1 == update\_frame\_num) \{}
\DoxyCodeLine{270       \mbox{\hyperlink{structvpx__ref__frame}{vpx\_ref\_frame\_t}} ref;}
\DoxyCodeLine{271       ref.\mbox{\hyperlink{structvpx__ref__frame_a7fbe51de592d0ff16d9fbd4d2b367c9b}{frame\_type}} = VP8\_LAST\_FRAME;}
\DoxyCodeLine{272       ref.\mbox{\hyperlink{structvpx__ref__frame_a972d24d0243f51f84eef7e1b79c6c414}{img}} = raw;}
\DoxyCodeLine{273       \textcolor{comment}{// Set reference frame in encoder.}}
\DoxyCodeLine{274       \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&ecodec, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a7abc38d739a5ef49c36d9b2cd88e64a6}{VP8\_SET\_REFERENCE}}, \&ref))}
\DoxyCodeLine{275         die\_codec(\&ecodec, \textcolor{stringliteral}{"{}Failed to set reference frame"{}});}
\DoxyCodeLine{276       printf(\textcolor{stringliteral}{"{} <SET\_REF>"{}});}
\DoxyCodeLine{277 }
\DoxyCodeLine{278       \textcolor{comment}{// If set\_reference in decoder is commented out, the enc/dec mismatch}}
\DoxyCodeLine{279       \textcolor{comment}{// would be seen.}}
\DoxyCodeLine{280       \textcolor{keywordflow}{if} (test\_decode) \{}
\DoxyCodeLine{281         \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&dcodec, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a7abc38d739a5ef49c36d9b2cd88e64a6}{VP8\_SET\_REFERENCE}}, \&ref))}
\DoxyCodeLine{282           die\_codec(\&dcodec, \textcolor{stringliteral}{"{}Failed to set reference frame"{}});}
\DoxyCodeLine{283       \}}
\DoxyCodeLine{284     \}}
\DoxyCodeLine{285 }
\DoxyCodeLine{286     encode\_frame(\&ecodec, \&raw, frame\_in, writer, test\_decode, \&dcodec,}
\DoxyCodeLine{287                  \&frame\_out, \&mismatch\_seen);}
\DoxyCodeLine{288     frame\_in++;}
\DoxyCodeLine{289     \textcolor{keywordflow}{if} (mismatch\_seen) \textcolor{keywordflow}{break};}
\DoxyCodeLine{290   \}}
\DoxyCodeLine{291 }
\DoxyCodeLine{292   \textcolor{comment}{// Flush encoder.}}
\DoxyCodeLine{293   \textcolor{keywordflow}{if} (!mismatch\_seen)}
\DoxyCodeLine{294     \textcolor{keywordflow}{while} (encode\_frame(\&ecodec, NULL, frame\_in, writer, test\_decode, \&dcodec,}
\DoxyCodeLine{295                         \&frame\_out, \&mismatch\_seen)) \{}
\DoxyCodeLine{296     \}}
\DoxyCodeLine{297 }
\DoxyCodeLine{298   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{299   fclose(infile);}
\DoxyCodeLine{300   printf(\textcolor{stringliteral}{"{}Processed \%d frames.\(\backslash\)n"{}}, frame\_out);}
\DoxyCodeLine{301 }
\DoxyCodeLine{302   \textcolor{keywordflow}{if} (test\_decode) \{}
\DoxyCodeLine{303     \textcolor{keywordflow}{if} (!mismatch\_seen)}
\DoxyCodeLine{304       printf(\textcolor{stringliteral}{"{}Encoder/decoder results are matching.\(\backslash\)n"{}});}
\DoxyCodeLine{305     \textcolor{keywordflow}{else}}
\DoxyCodeLine{306       printf(\textcolor{stringliteral}{"{}Encoder/decoder results are NOT matching.\(\backslash\)n"{}});}
\DoxyCodeLine{307   \}}
\DoxyCodeLine{308 }
\DoxyCodeLine{309   \textcolor{keywordflow}{if} (test\_decode)}
\DoxyCodeLine{310     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&dcodec))}
\DoxyCodeLine{311       die\_codec(\&dcodec, \textcolor{stringliteral}{"{}Failed to destroy decoder"{}});}
\DoxyCodeLine{312 }
\DoxyCodeLine{313   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{314   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&ecodec))}
\DoxyCodeLine{315     die\_codec(\&ecodec, \textcolor{stringliteral}{"{}Failed to destroy encoder."{}});}
\DoxyCodeLine{316 }
\DoxyCodeLine{317   vpx\_video\_writer\_close(writer);}
\DoxyCodeLine{318 }
\DoxyCodeLine{319   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{320 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vpx_temporal_svc_encoder}{}\doxysubsection{vpx\+\_\+temporal\+\_\+svc\+\_\+encoder}\label{example_vpx_temporal_svc_encoder}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2012 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{//  This is an example demonstrating how to implement a multi-\/layer VPx}}
\DoxyCodeLine{12 \textcolor{comment}{//  encoding scheme based on temporal scalability for video applications}}
\DoxyCodeLine{13 \textcolor{comment}{//  that benefit from a scalable bitstream.}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}./y4minput.h"{}}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}../vpx\_ports/vpx\_timer.h"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}vpx\_ports/bitops.h"{}}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}../tools\_common.h"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}../video\_writer.h"{}}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#define ROI\_MAP 0}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{preprocessor}{\#define zero(Dest) memset(\&(Dest), 0, sizeof(Dest))}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{ exit(EXIT\_FAILURE); \}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{comment}{// Denoiser states for vp8, for temporal denoising.}}
\DoxyCodeLine{40 \textcolor{keyword}{enum} denoiserStateVp8 \{}
\DoxyCodeLine{41   kVp8DenoiserOff,}
\DoxyCodeLine{42   kVp8DenoiserOnYOnly,}
\DoxyCodeLine{43   kVp8DenoiserOnYUV,}
\DoxyCodeLine{44   kVp8DenoiserOnYUVAggressive,}
\DoxyCodeLine{45   kVp8DenoiserOnAdaptive}
\DoxyCodeLine{46 \};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{comment}{// Denoiser states for vp9, for temporal denoising.}}
\DoxyCodeLine{49 \textcolor{keyword}{enum} denoiserStateVp9 \{}
\DoxyCodeLine{50   kVp9DenoiserOff,}
\DoxyCodeLine{51   kVp9DenoiserOnYOnly,}
\DoxyCodeLine{52   \textcolor{comment}{// For SVC: denoise the top two spatial layers.}}
\DoxyCodeLine{53   kVp9DenoiserOnYTwoSpatialLayers}
\DoxyCodeLine{54 \};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mode\_to\_num\_layers[13] = \{ 1, 2, 2, 3, 3, 3, 3, 5, 2, 3, 3, 3, 3 \};}
\DoxyCodeLine{57 }
\DoxyCodeLine{58 \textcolor{comment}{// For rate control encoding stats.}}
\DoxyCodeLine{59 \textcolor{keyword}{struct }RateControlMetrics \{}
\DoxyCodeLine{60   \textcolor{comment}{// Number of input frames per layer.}}
\DoxyCodeLine{61   \textcolor{keywordtype}{int} layer\_input\_frames[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{62   \textcolor{comment}{// Total (cumulative) number of encoded frames per layer.}}
\DoxyCodeLine{63   \textcolor{keywordtype}{int} layer\_tot\_enc\_frames[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{64   \textcolor{comment}{// Number of encoded non-\/key frames per layer.}}
\DoxyCodeLine{65   \textcolor{keywordtype}{int} layer\_enc\_frames[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{66   \textcolor{comment}{// Framerate per layer layer (cumulative).}}
\DoxyCodeLine{67   \textcolor{keywordtype}{double} layer\_framerate[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{68   \textcolor{comment}{// Target average frame size per layer (per-\/frame-\/bandwidth per layer).}}
\DoxyCodeLine{69   \textcolor{keywordtype}{double} layer\_pfb[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{70   \textcolor{comment}{// Actual average frame size per layer.}}
\DoxyCodeLine{71   \textcolor{keywordtype}{double} layer\_avg\_frame\_size[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{72   \textcolor{comment}{// Average rate mismatch per layer (|target -\/ actual| / target).}}
\DoxyCodeLine{73   \textcolor{keywordtype}{double} layer\_avg\_rate\_mismatch[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{74   \textcolor{comment}{// Actual encoding bitrate per layer (cumulative).}}
\DoxyCodeLine{75   \textcolor{keywordtype}{double} layer\_encoding\_bitrate[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}];}
\DoxyCodeLine{76   \textcolor{comment}{// Average of the short-\/time encoder actual bitrate.}}
\DoxyCodeLine{77   \textcolor{comment}{// TODO(marpan): Should we add these short-\/time stats for each layer?}}
\DoxyCodeLine{78   \textcolor{keywordtype}{double} avg\_st\_encoding\_bitrate;}
\DoxyCodeLine{79   \textcolor{comment}{// Variance of the short-\/time encoder actual bitrate.}}
\DoxyCodeLine{80   \textcolor{keywordtype}{double} variance\_st\_encoding\_bitrate;}
\DoxyCodeLine{81   \textcolor{comment}{// Window (number of frames) for computing short-\/timee encoding bitrate.}}
\DoxyCodeLine{82   \textcolor{keywordtype}{int} window\_size;}
\DoxyCodeLine{83   \textcolor{comment}{// Number of window measurements.}}
\DoxyCodeLine{84   \textcolor{keywordtype}{int} window\_count;}
\DoxyCodeLine{85   \textcolor{keywordtype}{int} layer\_target\_bitrate[\mbox{\hyperlink{group__encoder_ga6edf57208cc368274e905c4d87dccf2e}{VPX\_MAX\_LAYERS}}];}
\DoxyCodeLine{86 \};}
\DoxyCodeLine{87 }
\DoxyCodeLine{88 \textcolor{comment}{// Note: these rate control metrics assume only 1 key frame in the}}
\DoxyCodeLine{89 \textcolor{comment}{// sequence (i.e., first frame only). So for temporal pattern\# 7}}
\DoxyCodeLine{90 \textcolor{comment}{// (which has key frame for every frame on base layer), the metrics}}
\DoxyCodeLine{91 \textcolor{comment}{// computation will be off/wrong.}}
\DoxyCodeLine{92 \textcolor{comment}{// TODO(marpan): Update these metrics to account for multiple key frames}}
\DoxyCodeLine{93 \textcolor{comment}{// in the stream.}}
\DoxyCodeLine{94 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_rate\_control\_metrics(\textcolor{keyword}{struct} RateControlMetrics *rc,}
\DoxyCodeLine{95                                      \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg) \{}
\DoxyCodeLine{96   \textcolor{keywordtype}{int} i = 0;}
\DoxyCodeLine{97   \textcolor{comment}{// Set the layer (cumulative) framerate and the target layer (non-\/cumulative)}}
\DoxyCodeLine{98   \textcolor{comment}{// per-\/frame-\/bandwidth, for the rate control encoding stats below.}}
\DoxyCodeLine{99   \textcolor{keyword}{const} \textcolor{keywordtype}{double} framerate = cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} / cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}};}
\DoxyCodeLine{100   \textcolor{keyword}{const} \textcolor{keywordtype}{int} ts\_number\_layers = cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}};}
\DoxyCodeLine{101   rc-\/>layer\_framerate[0] = framerate / cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0];}
\DoxyCodeLine{102   rc-\/>layer\_pfb[0] =}
\DoxyCodeLine{103       1000.0 * rc-\/>layer\_target\_bitrate[0] / rc-\/>layer\_framerate[0];}
\DoxyCodeLine{104   \textcolor{keywordflow}{for} (i = 0; i < ts\_number\_layers; ++i) \{}
\DoxyCodeLine{105     \textcolor{keywordflow}{if} (i > 0) \{}
\DoxyCodeLine{106       rc-\/>layer\_framerate[i] = framerate / cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[i];}
\DoxyCodeLine{107       rc-\/>layer\_pfb[i] =}
\DoxyCodeLine{108           1000.0 *}
\DoxyCodeLine{109           (rc-\/>layer\_target\_bitrate[i] -\/ rc-\/>layer\_target\_bitrate[i -\/ 1]) /}
\DoxyCodeLine{110           (rc-\/>layer\_framerate[i] -\/ rc-\/>layer\_framerate[i -\/ 1]);}
\DoxyCodeLine{111     \}}
\DoxyCodeLine{112     rc-\/>layer\_input\_frames[i] = 0;}
\DoxyCodeLine{113     rc-\/>layer\_enc\_frames[i] = 0;}
\DoxyCodeLine{114     rc-\/>layer\_tot\_enc\_frames[i] = 0;}
\DoxyCodeLine{115     rc-\/>layer\_encoding\_bitrate[i] = 0.0;}
\DoxyCodeLine{116     rc-\/>layer\_avg\_frame\_size[i] = 0.0;}
\DoxyCodeLine{117     rc-\/>layer\_avg\_rate\_mismatch[i] = 0.0;}
\DoxyCodeLine{118   \}}
\DoxyCodeLine{119   rc-\/>window\_count = 0;}
\DoxyCodeLine{120   rc-\/>window\_size = 15;}
\DoxyCodeLine{121   rc-\/>avg\_st\_encoding\_bitrate = 0.0;}
\DoxyCodeLine{122   rc-\/>variance\_st\_encoding\_bitrate = 0.0;}
\DoxyCodeLine{123   \textcolor{comment}{// Target bandwidth for the whole stream.}}
\DoxyCodeLine{124   \textcolor{comment}{// Set to layer\_target\_bitrate for highest layer (total bitrate).}}
\DoxyCodeLine{125   cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ab8339685175d66710f482706cc9f0aed}{rc\_target\_bitrate}} = rc-\/>layer\_target\_bitrate[ts\_number\_layers -\/ 1];}
\DoxyCodeLine{126 \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128 \textcolor{keyword}{static} \textcolor{keywordtype}{void} printout\_rate\_control\_summary(\textcolor{keyword}{struct} RateControlMetrics *rc,}
\DoxyCodeLine{129                                           \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{130                                           \textcolor{keywordtype}{int} frame\_cnt) \{}
\DoxyCodeLine{131   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0;}
\DoxyCodeLine{132   \textcolor{keywordtype}{int} tot\_num\_frames = 0;}
\DoxyCodeLine{133   \textcolor{keywordtype}{double} perc\_fluctuation = 0.0;}
\DoxyCodeLine{134   printf(\textcolor{stringliteral}{"{}Total number of processed frames: \%d\(\backslash\)n\(\backslash\)n"{}}, frame\_cnt -\/ 1);}
\DoxyCodeLine{135   printf(\textcolor{stringliteral}{"{}Rate control layer stats for \%d layer(s):\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{136          cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}});}
\DoxyCodeLine{137   \textcolor{keywordflow}{for} (i = 0; i < cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++i) \{}
\DoxyCodeLine{138     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_dropped =}
\DoxyCodeLine{139         (i > 0) ? (rc-\/>layer\_input\_frames[i] -\/ rc-\/>layer\_enc\_frames[i])}
\DoxyCodeLine{140                 : (rc-\/>layer\_input\_frames[i] -\/ rc-\/>layer\_enc\_frames[i] -\/ 1);}
\DoxyCodeLine{141     tot\_num\_frames += rc-\/>layer\_input\_frames[i];}
\DoxyCodeLine{142     rc-\/>layer\_encoding\_bitrate[i] = 0.001 * rc-\/>layer\_framerate[i] *}
\DoxyCodeLine{143                                     rc-\/>layer\_encoding\_bitrate[i] /}
\DoxyCodeLine{144                                     tot\_num\_frames;}
\DoxyCodeLine{145     rc-\/>layer\_avg\_frame\_size[i] =}
\DoxyCodeLine{146         rc-\/>layer\_avg\_frame\_size[i] / rc-\/>layer\_enc\_frames[i];}
\DoxyCodeLine{147     rc-\/>layer\_avg\_rate\_mismatch[i] =}
\DoxyCodeLine{148         100.0 * rc-\/>layer\_avg\_rate\_mismatch[i] / rc-\/>layer\_enc\_frames[i];}
\DoxyCodeLine{149     printf(\textcolor{stringliteral}{"{}For layer\#: \%d \(\backslash\)n"{}}, i);}
\DoxyCodeLine{150     printf(\textcolor{stringliteral}{"{}Bitrate (target vs actual): \%d \%f \(\backslash\)n"{}}, rc-\/>layer\_target\_bitrate[i],}
\DoxyCodeLine{151            rc-\/>layer\_encoding\_bitrate[i]);}
\DoxyCodeLine{152     printf(\textcolor{stringliteral}{"{}Average frame size (target vs actual): \%f \%f \(\backslash\)n"{}}, rc-\/>layer\_pfb[i],}
\DoxyCodeLine{153            rc-\/>layer\_avg\_frame\_size[i]);}
\DoxyCodeLine{154     printf(\textcolor{stringliteral}{"{}Average rate\_mismatch: \%f \(\backslash\)n"{}}, rc-\/>layer\_avg\_rate\_mismatch[i]);}
\DoxyCodeLine{155     printf(}
\DoxyCodeLine{156         \textcolor{stringliteral}{"{}Number of input frames, encoded (non-\/key) frames, "{}}}
\DoxyCodeLine{157         \textcolor{stringliteral}{"{}and perc dropped frames: \%d \%d \%f \(\backslash\)n"{}},}
\DoxyCodeLine{158         rc-\/>layer\_input\_frames[i], rc-\/>layer\_enc\_frames[i],}
\DoxyCodeLine{159         100.0 * num\_dropped / rc-\/>layer\_input\_frames[i]);}
\DoxyCodeLine{160     printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{161   \}}
\DoxyCodeLine{162   rc-\/>avg\_st\_encoding\_bitrate = rc-\/>avg\_st\_encoding\_bitrate / rc-\/>window\_count;}
\DoxyCodeLine{163   rc-\/>variance\_st\_encoding\_bitrate =}
\DoxyCodeLine{164       rc-\/>variance\_st\_encoding\_bitrate / rc-\/>window\_count -\/}
\DoxyCodeLine{165       (rc-\/>avg\_st\_encoding\_bitrate * rc-\/>avg\_st\_encoding\_bitrate);}
\DoxyCodeLine{166   perc\_fluctuation = 100.0 * sqrt(rc-\/>variance\_st\_encoding\_bitrate) /}
\DoxyCodeLine{167                      rc-\/>avg\_st\_encoding\_bitrate;}
\DoxyCodeLine{168   printf(\textcolor{stringliteral}{"{}Short-\/time stats, for window of \%d frames: \(\backslash\)n"{}}, rc-\/>window\_size);}
\DoxyCodeLine{169   printf(\textcolor{stringliteral}{"{}Average, rms-\/variance, and percent-\/fluct: \%f \%f \%f \(\backslash\)n"{}},}
\DoxyCodeLine{170          rc-\/>avg\_st\_encoding\_bitrate, sqrt(rc-\/>variance\_st\_encoding\_bitrate),}
\DoxyCodeLine{171          perc\_fluctuation);}
\DoxyCodeLine{172   \textcolor{keywordflow}{if} ((frame\_cnt -\/ 1) != tot\_num\_frames)}
\DoxyCodeLine{173     die(\textcolor{stringliteral}{"{}Error: Number of input frames not equal to output! \(\backslash\)n"{}});}
\DoxyCodeLine{174 \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{177 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_roi\_map(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *enc\_name, \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{178                         \mbox{\hyperlink{structvpx__roi__map}{vpx\_roi\_map\_t}} *roi) \{}
\DoxyCodeLine{179   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i, j;}
\DoxyCodeLine{180   \textcolor{keywordtype}{int} block\_size = 0;}
\DoxyCodeLine{181   uint8\_t is\_vp8 = strncmp(enc\_name, \textcolor{stringliteral}{"{}vp8"{}}, 3) == 0 ? 1 : 0;}
\DoxyCodeLine{182   uint8\_t is\_vp9 = strncmp(enc\_name, \textcolor{stringliteral}{"{}vp9"{}}, 3) == 0 ? 1 : 0;}
\DoxyCodeLine{183   \textcolor{keywordflow}{if} (!is\_vp8 \&\& !is\_vp9) \{}
\DoxyCodeLine{184     die(\textcolor{stringliteral}{"{}unsupported codec."{}});}
\DoxyCodeLine{185   \}}
\DoxyCodeLine{186   zero(*roi);}
\DoxyCodeLine{187 }
\DoxyCodeLine{188   block\_size = is\_vp9 \&\& !is\_vp8 ? 8 : 16;}
\DoxyCodeLine{189 }
\DoxyCodeLine{190   \textcolor{comment}{// ROI is based on the segments (4 for vp8, 8 for vp9), smallest unit for}}
\DoxyCodeLine{191   \textcolor{comment}{// segment is 16x16 for vp8, 8x8 for vp9.}}
\DoxyCodeLine{192   roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} + block\_size -\/ 1) / block\_size;}
\DoxyCodeLine{193   roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} + block\_size -\/ 1) / block\_size;}
\DoxyCodeLine{194 }
\DoxyCodeLine{195   \textcolor{comment}{// Applies delta QP on the segment blocks, varies from -\/63 to 63.}}
\DoxyCodeLine{196   \textcolor{comment}{// Setting to negative means lower QP (better quality).}}
\DoxyCodeLine{197   \textcolor{comment}{// Below we set delta\_q to the extreme (-\/63) to show strong effect.}}
\DoxyCodeLine{198   \textcolor{comment}{// VP8 uses the first 4 segments. VP9 uses all 8 segments.}}
\DoxyCodeLine{199   zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}});}
\DoxyCodeLine{200   roi-\/>\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}}[1] = -\/63;}
\DoxyCodeLine{201 }
\DoxyCodeLine{202   \textcolor{comment}{// Applies delta loopfilter strength on the segment blocks, varies from -\/63 to}}
\DoxyCodeLine{203   \textcolor{comment}{// 63. Setting to positive means stronger loopfilter. VP8 uses the first 4}}
\DoxyCodeLine{204   \textcolor{comment}{// segments. VP9 uses all 8 segments.}}
\DoxyCodeLine{205   zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_aca3e926d9612ac6530092f7cfb0dc34c}{delta\_lf}});}
\DoxyCodeLine{206 }
\DoxyCodeLine{207   \textcolor{keywordflow}{if} (is\_vp8) \{}
\DoxyCodeLine{208     \textcolor{comment}{// Applies skip encoding threshold on the segment blocks, varies from 0 to}}
\DoxyCodeLine{209     \textcolor{comment}{// UINT\_MAX. Larger value means more skipping of encoding is possible.}}
\DoxyCodeLine{210     \textcolor{comment}{// This skip threshold only applies on delta frames.}}
\DoxyCodeLine{211     zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3354ff458e229361b53a0b2d1bf68cfb}{static\_threshold}});}
\DoxyCodeLine{212   \}}
\DoxyCodeLine{213 }
\DoxyCodeLine{214   \textcolor{keywordflow}{if} (is\_vp9) \{}
\DoxyCodeLine{215     \textcolor{comment}{// Apply skip segment. Setting to 1 means this block will be copied from}}
\DoxyCodeLine{216     \textcolor{comment}{// previous frame.}}
\DoxyCodeLine{217     zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a2547af0f5b4f9c42cb5fb902803245d9}{skip}});}
\DoxyCodeLine{218   \}}
\DoxyCodeLine{219 }
\DoxyCodeLine{220   \textcolor{keywordflow}{if} (is\_vp9) \{}
\DoxyCodeLine{221     \textcolor{comment}{// Apply ref frame segment.}}
\DoxyCodeLine{222     \textcolor{comment}{// -\/1 : Do not apply this segment.}}
\DoxyCodeLine{223     \textcolor{comment}{//  0 : Froce using intra.}}
\DoxyCodeLine{224     \textcolor{comment}{//  1 : Force using last.}}
\DoxyCodeLine{225     \textcolor{comment}{//  2 : Force using golden.}}
\DoxyCodeLine{226     \textcolor{comment}{//  3 : Force using alfref but not used in non-\/rd pickmode for 0 lag.}}
\DoxyCodeLine{227     memset(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a570cce9ea40de31cce7a070e11cb5678}{ref\_frame}}, -\/1, \textcolor{keyword}{sizeof}(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a570cce9ea40de31cce7a070e11cb5678}{ref\_frame}}));}
\DoxyCodeLine{228     roi-\/>\mbox{\hyperlink{structvpx__roi__map_a570cce9ea40de31cce7a070e11cb5678}{ref\_frame}}[1] = 1;}
\DoxyCodeLine{229   \}}
\DoxyCodeLine{230 }
\DoxyCodeLine{231   \textcolor{comment}{// Use 2 states: 1 is center square, 0 is the rest.}}
\DoxyCodeLine{232   roi-\/>\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}} =}
\DoxyCodeLine{233       (uint8\_t *)calloc(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} * roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}}, \textcolor{keyword}{sizeof}(*roi-\/>\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}}));}
\DoxyCodeLine{234   \textcolor{keywordflow}{for} (i = 0; i < roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}}; ++i) \{}
\DoxyCodeLine{235     \textcolor{keywordflow}{for} (j = 0; j < roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}}; ++j) \{}
\DoxyCodeLine{236       \textcolor{keywordflow}{if} (i > (roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} >> 2) \&\& i < ((roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} * 3) >> 2) \&\&}
\DoxyCodeLine{237           j > (roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} >> 2) \&\& j < ((roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} * 3) >> 2)) \{}
\DoxyCodeLine{238         roi-\/>\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}}[i * roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} + j] = 1;}
\DoxyCodeLine{239       \}}
\DoxyCodeLine{240     \}}
\DoxyCodeLine{241   \}}
\DoxyCodeLine{242 \}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_roi\_skip\_map(\mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg, \mbox{\hyperlink{structvpx__roi__map}{vpx\_roi\_map\_t}} *roi,}
\DoxyCodeLine{245                              \textcolor{keywordtype}{int} *skip\_map, \textcolor{keywordtype}{int} *prev\_mask\_map, \textcolor{keywordtype}{int} frame\_num) \{}
\DoxyCodeLine{246   \textcolor{keyword}{const} \textcolor{keywordtype}{int} block\_size = 8;}
\DoxyCodeLine{247   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i, j;}
\DoxyCodeLine{248   roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} + block\_size -\/ 1) / block\_size;}
\DoxyCodeLine{249   roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} = (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} + block\_size -\/ 1) / block\_size;}
\DoxyCodeLine{250   zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a2547af0f5b4f9c42cb5fb902803245d9}{skip}});}
\DoxyCodeLine{251   zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_aa41b78c77cb7f2f24ad5b336c40cdf3c}{delta\_q}});}
\DoxyCodeLine{252   zero(roi-\/>\mbox{\hyperlink{structvpx__roi__map_aca3e926d9612ac6530092f7cfb0dc34c}{delta\_lf}});}
\DoxyCodeLine{253   memset(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a570cce9ea40de31cce7a070e11cb5678}{ref\_frame}}, -\/1, \textcolor{keyword}{sizeof}(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a570cce9ea40de31cce7a070e11cb5678}{ref\_frame}}));}
\DoxyCodeLine{254   roi-\/>\mbox{\hyperlink{structvpx__roi__map_a570cce9ea40de31cce7a070e11cb5678}{ref\_frame}}[1] = 1;}
\DoxyCodeLine{255   \textcolor{comment}{// Use segment 3 for skip.}}
\DoxyCodeLine{256   roi-\/>\mbox{\hyperlink{structvpx__roi__map_a2547af0f5b4f9c42cb5fb902803245d9}{skip}}[3] = 1;}
\DoxyCodeLine{257   roi-\/>\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}} =}
\DoxyCodeLine{258       (uint8\_t *)calloc(roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}} * roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}}, \textcolor{keyword}{sizeof}(*roi-\/>\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}}));}
\DoxyCodeLine{259   \textcolor{keywordflow}{for} (i = 0; i < roi-\/>\mbox{\hyperlink{structvpx__roi__map_a3fdcecd472553d08a99ced02cda5c9a6}{rows}}; ++i) \{}
\DoxyCodeLine{260     \textcolor{keywordflow}{for} (j = 0; j < roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}}; ++j) \{}
\DoxyCodeLine{261       \textcolor{keyword}{const} \textcolor{keywordtype}{int} idx = i * roi-\/>\mbox{\hyperlink{structvpx__roi__map_a5458459aaf16b14b86fb0adef32757c8}{cols}} + j;}
\DoxyCodeLine{262       \textcolor{comment}{// Use segment 3 for skip.}}
\DoxyCodeLine{263       \textcolor{comment}{// prev\_mask\_map keeps track of blocks that have been stably on segment 3}}
\DoxyCodeLine{264       \textcolor{comment}{// for the past 10 frames. Only skip when the block is on segment 3 in}}
\DoxyCodeLine{265       \textcolor{comment}{// both current map and prev\_mask\_map.}}
\DoxyCodeLine{266       \textcolor{keywordflow}{if} (skip\_map[idx] == 1 \&\& prev\_mask\_map[idx] == 1) roi-\/>\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}}[idx] = 3;}
\DoxyCodeLine{267       \textcolor{comment}{// Reset it every 10 frames so it doesn't propagate for too many frames.}}
\DoxyCodeLine{268       \textcolor{keywordflow}{if} (frame\_num \% 10 == 0)}
\DoxyCodeLine{269         prev\_mask\_map[idx] = skip\_map[idx];}
\DoxyCodeLine{270       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (prev\_mask\_map[idx] == 1 \&\& skip\_map[idx] == 0)}
\DoxyCodeLine{271         prev\_mask\_map[idx] = 0;}
\DoxyCodeLine{272     \}}
\DoxyCodeLine{273   \}}
\DoxyCodeLine{274 \}}
\DoxyCodeLine{275 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{276 }
\DoxyCodeLine{277 \textcolor{comment}{// Temporal scaling parameters:}}
\DoxyCodeLine{278 \textcolor{comment}{// NOTE: The 3 prediction frames cannot be used interchangeably due to}}
\DoxyCodeLine{279 \textcolor{comment}{// differences in the way they are handled throughout the code. The}}
\DoxyCodeLine{280 \textcolor{comment}{// frames should be allocated to layers in the order LAST, GF, ARF.}}
\DoxyCodeLine{281 \textcolor{comment}{// Other combinations work, but may produce slightly inferior results.}}
\DoxyCodeLine{282 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_temporal\_layer\_pattern(\textcolor{keywordtype}{int} layering\_mode,}
\DoxyCodeLine{283                                        \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} *cfg,}
\DoxyCodeLine{284                                        \textcolor{keywordtype}{int} *layer\_flags,}
\DoxyCodeLine{285                                        \textcolor{keywordtype}{int} *flag\_periodicity) \{}
\DoxyCodeLine{286   \textcolor{keywordflow}{switch} (layering\_mode) \{}
\DoxyCodeLine{287     \textcolor{keywordflow}{case} 0: \{}
\DoxyCodeLine{288       \textcolor{comment}{// 1-\/layer.}}
\DoxyCodeLine{289       \textcolor{keywordtype}{int} ids[1] = \{ 0 \};}
\DoxyCodeLine{290       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 1;}
\DoxyCodeLine{291       *flag\_periodicity = 1;}
\DoxyCodeLine{292       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 1;}
\DoxyCodeLine{293       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 1;}
\DoxyCodeLine{294       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{295       \textcolor{comment}{// Update L only.}}
\DoxyCodeLine{296       layer\_flags[0] =}
\DoxyCodeLine{297           \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{298       \textcolor{keywordflow}{break};}
\DoxyCodeLine{299     \}}
\DoxyCodeLine{300     \textcolor{keywordflow}{case} 1: \{}
\DoxyCodeLine{301       \textcolor{comment}{// 2-\/layers, 2-\/frame period.}}
\DoxyCodeLine{302       \textcolor{keywordtype}{int} ids[2] = \{ 0, 1 \};}
\DoxyCodeLine{303       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 2;}
\DoxyCodeLine{304       *flag\_periodicity = 2;}
\DoxyCodeLine{305       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 2;}
\DoxyCodeLine{306       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 2;}
\DoxyCodeLine{307       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 1;}
\DoxyCodeLine{308       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{309 \textcolor{preprocessor}{\#if 1}}
\DoxyCodeLine{310       \textcolor{comment}{// 0=L, 1=GF, Intra-\/layer prediction enabled.}}
\DoxyCodeLine{311       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{312                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{313                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}};}
\DoxyCodeLine{314       layer\_flags[1] =}
\DoxyCodeLine{315           \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}};}
\DoxyCodeLine{316 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{317       \textcolor{comment}{// 0=L, 1=GF, Intra-\/layer prediction disabled.}}
\DoxyCodeLine{318       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{319                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{320                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}};}
\DoxyCodeLine{321       layer\_flags[1] = \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} |}
\DoxyCodeLine{322                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gafb51c67e5743275146bc1fc425727da3}{VP8\_EFLAG\_NO\_REF\_LAST}};}
\DoxyCodeLine{323 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{324       \textcolor{keywordflow}{break};}
\DoxyCodeLine{325     \}}
\DoxyCodeLine{326     \textcolor{keywordflow}{case} 2: \{}
\DoxyCodeLine{327       \textcolor{comment}{// 2-\/layers, 3-\/frame period.}}
\DoxyCodeLine{328       \textcolor{keywordtype}{int} ids[3] = \{ 0, 1, 1 \};}
\DoxyCodeLine{329       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 3;}
\DoxyCodeLine{330       *flag\_periodicity = 3;}
\DoxyCodeLine{331       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 2;}
\DoxyCodeLine{332       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 3;}
\DoxyCodeLine{333       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 1;}
\DoxyCodeLine{334       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{335       \textcolor{comment}{// 0=L, 1=GF, Intra-\/layer prediction enabled.}}
\DoxyCodeLine{336       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{337                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{338                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{339       layer\_flags[1] = layer\_flags[2] =}
\DoxyCodeLine{340           \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} |}
\DoxyCodeLine{341           \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{342       \textcolor{keywordflow}{break};}
\DoxyCodeLine{343     \}}
\DoxyCodeLine{344     \textcolor{keywordflow}{case} 3: \{}
\DoxyCodeLine{345       \textcolor{comment}{// 3-\/layers, 6-\/frame period.}}
\DoxyCodeLine{346       \textcolor{keywordtype}{int} ids[6] = \{ 0, 2, 2, 1, 2, 2 \};}
\DoxyCodeLine{347       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 6;}
\DoxyCodeLine{348       *flag\_periodicity = 6;}
\DoxyCodeLine{349       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{350       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 6;}
\DoxyCodeLine{351       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 3;}
\DoxyCodeLine{352       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{353       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{354       \textcolor{comment}{// 0=L, 1=GF, 2=ARF, Intra-\/layer prediction enabled.}}
\DoxyCodeLine{355       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{356                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{357                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{358       layer\_flags[3] =}
\DoxyCodeLine{359           \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{360       layer\_flags[1] = layer\_flags[2] = layer\_flags[4] = layer\_flags[5] =}
\DoxyCodeLine{361           \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{362       \textcolor{keywordflow}{break};}
\DoxyCodeLine{363     \}}
\DoxyCodeLine{364     \textcolor{keywordflow}{case} 4: \{}
\DoxyCodeLine{365       \textcolor{comment}{// 3-\/layers, 4-\/frame period.}}
\DoxyCodeLine{366       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{367       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{368       *flag\_periodicity = 4;}
\DoxyCodeLine{369       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{370       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{371       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{372       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{373       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{374       \textcolor{comment}{// 0=L, 1=GF, 2=ARF, Intra-\/layer prediction disabled.}}
\DoxyCodeLine{375       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{376                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{377                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{378       layer\_flags[2] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{379                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{380       layer\_flags[1] = layer\_flags[3] =}
\DoxyCodeLine{381           \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{382           \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{383       \textcolor{keywordflow}{break};}
\DoxyCodeLine{384     \}}
\DoxyCodeLine{385     \textcolor{keywordflow}{case} 5: \{}
\DoxyCodeLine{386       \textcolor{comment}{// 3-\/layers, 4-\/frame period.}}
\DoxyCodeLine{387       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{388       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{389       *flag\_periodicity = 4;}
\DoxyCodeLine{390       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{391       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{392       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{393       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{394       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{395       \textcolor{comment}{// 0=L, 1=GF, 2=ARF, Intra-\/layer prediction enabled in layer 1, disabled}}
\DoxyCodeLine{396       \textcolor{comment}{// in layer 2.}}
\DoxyCodeLine{397       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{398                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{399                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{400       layer\_flags[2] =}
\DoxyCodeLine{401           \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{402       layer\_flags[1] = layer\_flags[3] =}
\DoxyCodeLine{403           \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{404           \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{405       \textcolor{keywordflow}{break};}
\DoxyCodeLine{406     \}}
\DoxyCodeLine{407     \textcolor{keywordflow}{case} 6: \{}
\DoxyCodeLine{408       \textcolor{comment}{// 3-\/layers, 4-\/frame period.}}
\DoxyCodeLine{409       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{410       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{411       *flag\_periodicity = 4;}
\DoxyCodeLine{412       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{413       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{414       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{415       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{416       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{417       \textcolor{comment}{// 0=L, 1=GF, 2=ARF, Intra-\/layer prediction enabled.}}
\DoxyCodeLine{418       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{419                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{420                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{421       layer\_flags[2] =}
\DoxyCodeLine{422           \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{423       layer\_flags[1] = layer\_flags[3] =}
\DoxyCodeLine{424           \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}};}
\DoxyCodeLine{425       \textcolor{keywordflow}{break};}
\DoxyCodeLine{426     \}}
\DoxyCodeLine{427     \textcolor{keywordflow}{case} 7: \{}
\DoxyCodeLine{428       \textcolor{comment}{// NOTE: Probably of academic interest only.}}
\DoxyCodeLine{429       \textcolor{comment}{// 5-\/layers, 16-\/frame period.}}
\DoxyCodeLine{430       \textcolor{keywordtype}{int} ids[16] = \{ 0, 4, 3, 4, 2, 4, 3, 4, 1, 4, 3, 4, 2, 4, 3, 4 \};}
\DoxyCodeLine{431       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 16;}
\DoxyCodeLine{432       *flag\_periodicity = 16;}
\DoxyCodeLine{433       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 5;}
\DoxyCodeLine{434       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 16;}
\DoxyCodeLine{435       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 8;}
\DoxyCodeLine{436       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 4;}
\DoxyCodeLine{437       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[3] = 2;}
\DoxyCodeLine{438       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[4] = 1;}
\DoxyCodeLine{439       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{440       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}};}
\DoxyCodeLine{441       layer\_flags[1] = layer\_flags[3] = layer\_flags[5] = layer\_flags[7] =}
\DoxyCodeLine{442           layer\_flags[9] = layer\_flags[11] = layer\_flags[13] = layer\_flags[15] =}
\DoxyCodeLine{443               \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{444               \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{445       layer\_flags[2] = layer\_flags[6] = layer\_flags[10] = layer\_flags[14] =}
\DoxyCodeLine{446           \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}};}
\DoxyCodeLine{447       layer\_flags[4] = layer\_flags[12] =}
\DoxyCodeLine{448           \mbox{\hyperlink{group__vp8__encoder_gafb51c67e5743275146bc1fc425727da3}{VP8\_EFLAG\_NO\_REF\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{449       layer\_flags[8] = \mbox{\hyperlink{group__vp8__encoder_gafb51c67e5743275146bc1fc425727da3}{VP8\_EFLAG\_NO\_REF\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}};}
\DoxyCodeLine{450       \textcolor{keywordflow}{break};}
\DoxyCodeLine{451     \}}
\DoxyCodeLine{452     \textcolor{keywordflow}{case} 8: \{}
\DoxyCodeLine{453       \textcolor{comment}{// 2-\/layers, with sync point at first frame of layer 1.}}
\DoxyCodeLine{454       \textcolor{keywordtype}{int} ids[2] = \{ 0, 1 \};}
\DoxyCodeLine{455       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 2;}
\DoxyCodeLine{456       *flag\_periodicity = 8;}
\DoxyCodeLine{457       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 2;}
\DoxyCodeLine{458       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 2;}
\DoxyCodeLine{459       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 1;}
\DoxyCodeLine{460       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{461       \textcolor{comment}{// 0=L, 1=GF.}}
\DoxyCodeLine{462       \textcolor{comment}{// ARF is used as predictor for all frames, and is only updated on}}
\DoxyCodeLine{463       \textcolor{comment}{// key frame. Sync point every 8 frames.}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465       \textcolor{comment}{// Layer 0: predict from L and ARF, update L and G.}}
\DoxyCodeLine{466       layer\_flags[0] =}
\DoxyCodeLine{467           \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{468       \textcolor{comment}{// Layer 1: sync point: predict from L and ARF, and update G.}}
\DoxyCodeLine{469       layer\_flags[1] =}
\DoxyCodeLine{470           \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{471       \textcolor{comment}{// Layer 0, predict from L and ARF, update L.}}
\DoxyCodeLine{472       layer\_flags[2] =}
\DoxyCodeLine{473           \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{474       \textcolor{comment}{// Layer 1: predict from L, G and ARF, and update G.}}
\DoxyCodeLine{475       layer\_flags[3] = \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} |}
\DoxyCodeLine{476                        \mbox{\hyperlink{group__vp8__encoder_ga5b91ad179910d4efc23aef66c7b2148b}{VP8\_EFLAG\_NO\_UPD\_ENTROPY}};}
\DoxyCodeLine{477       \textcolor{comment}{// Layer 0.}}
\DoxyCodeLine{478       layer\_flags[4] = layer\_flags[2];}
\DoxyCodeLine{479       \textcolor{comment}{// Layer 1.}}
\DoxyCodeLine{480       layer\_flags[5] = layer\_flags[3];}
\DoxyCodeLine{481       \textcolor{comment}{// Layer 0.}}
\DoxyCodeLine{482       layer\_flags[6] = layer\_flags[4];}
\DoxyCodeLine{483       \textcolor{comment}{// Layer 1.}}
\DoxyCodeLine{484       layer\_flags[7] = layer\_flags[5];}
\DoxyCodeLine{485       \textcolor{keywordflow}{break};}
\DoxyCodeLine{486     \}}
\DoxyCodeLine{487     \textcolor{keywordflow}{case} 9: \{}
\DoxyCodeLine{488       \textcolor{comment}{// 3-\/layers: Sync points for layer 1 and 2 every 8 frames.}}
\DoxyCodeLine{489       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{490       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{491       *flag\_periodicity = 8;}
\DoxyCodeLine{492       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{493       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{494       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{495       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{496       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{497       \textcolor{comment}{// 0=L, 1=GF, 2=ARF.}}
\DoxyCodeLine{498       layer\_flags[0] = \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} |}
\DoxyCodeLine{499                        \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{500                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{501       layer\_flags[1] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{502                        \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}};}
\DoxyCodeLine{503       layer\_flags[2] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{504                        \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{505       layer\_flags[3] = layer\_flags[5] =}
\DoxyCodeLine{506           \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}};}
\DoxyCodeLine{507       layer\_flags[4] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{508                        \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{509       layer\_flags[6] =}
\DoxyCodeLine{510           \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{511       layer\_flags[7] = \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{512                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga5b91ad179910d4efc23aef66c7b2148b}{VP8\_EFLAG\_NO\_UPD\_ENTROPY}};}
\DoxyCodeLine{513       \textcolor{keywordflow}{break};}
\DoxyCodeLine{514     \}}
\DoxyCodeLine{515     \textcolor{keywordflow}{case} 10: \{}
\DoxyCodeLine{516       \textcolor{comment}{// 3-\/layers structure where ARF is used as predictor for all frames,}}
\DoxyCodeLine{517       \textcolor{comment}{// and is only updated on key frame.}}
\DoxyCodeLine{518       \textcolor{comment}{// Sync points for layer 1 and 2 every 8 frames.}}
\DoxyCodeLine{519 }
\DoxyCodeLine{520       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{521       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{522       *flag\_periodicity = 8;}
\DoxyCodeLine{523       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{524       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{525       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{526       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{527       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{528       \textcolor{comment}{// 0=L, 1=GF, 2=ARF.}}
\DoxyCodeLine{529       \textcolor{comment}{// Layer 0: predict from L and ARF; update L and G.}}
\DoxyCodeLine{530       layer\_flags[0] =}
\DoxyCodeLine{531           \mbox{\hyperlink{group__encoder_ga4c4f4e3cbb5225d2c6c050e2d1e948fa}{VPX\_EFLAG\_FORCE\_KF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}};}
\DoxyCodeLine{532       \textcolor{comment}{// Layer 2: sync point: predict from L and ARF; update none.}}
\DoxyCodeLine{533       layer\_flags[1] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} |}
\DoxyCodeLine{534                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} |}
\DoxyCodeLine{535                        \mbox{\hyperlink{group__vp8__encoder_ga5b91ad179910d4efc23aef66c7b2148b}{VP8\_EFLAG\_NO\_UPD\_ENTROPY}};}
\DoxyCodeLine{536       \textcolor{comment}{// Layer 1: sync point: predict from L and ARF; update G.}}
\DoxyCodeLine{537       layer\_flags[2] =}
\DoxyCodeLine{538           \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{539       \textcolor{comment}{// Layer 2: predict from L, G, ARF; update none.}}
\DoxyCodeLine{540       layer\_flags[3] = \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} |}
\DoxyCodeLine{541                        \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga5b91ad179910d4efc23aef66c7b2148b}{VP8\_EFLAG\_NO\_UPD\_ENTROPY}};}
\DoxyCodeLine{542       \textcolor{comment}{// Layer 0: predict from L and ARF; update L.}}
\DoxyCodeLine{543       layer\_flags[4] =}
\DoxyCodeLine{544           \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}};}
\DoxyCodeLine{545       \textcolor{comment}{// Layer 2: predict from L, G, ARF; update none.}}
\DoxyCodeLine{546       layer\_flags[5] = layer\_flags[3];}
\DoxyCodeLine{547       \textcolor{comment}{// Layer 1: predict from L, G, ARF; update G.}}
\DoxyCodeLine{548       layer\_flags[6] = \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{549       \textcolor{comment}{// Layer 2: predict from L, G, ARF; update none.}}
\DoxyCodeLine{550       layer\_flags[7] = layer\_flags[3];}
\DoxyCodeLine{551       \textcolor{keywordflow}{break};}
\DoxyCodeLine{552     \}}
\DoxyCodeLine{553     \textcolor{keywordflow}{case} 11: \{}
\DoxyCodeLine{554       \textcolor{comment}{// 3-\/layers structure with one reference frame.}}
\DoxyCodeLine{555       \textcolor{comment}{// This works same as temporal\_layering\_mode 3.}}
\DoxyCodeLine{556       \textcolor{comment}{// This was added to compare with vp9\_spatial\_svc\_encoder.}}
\DoxyCodeLine{557 }
\DoxyCodeLine{558       \textcolor{comment}{// 3-\/layers, 4-\/frame period.}}
\DoxyCodeLine{559       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{560       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{561       *flag\_periodicity = 4;}
\DoxyCodeLine{562       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{563       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{564       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{565       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{566       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{567       \textcolor{comment}{// 0=L, 1=GF, 2=ARF, Intra-\/layer prediction disabled.}}
\DoxyCodeLine{568       layer\_flags[0] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{569                        \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}};}
\DoxyCodeLine{570       layer\_flags[2] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{571                        \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{572       layer\_flags[1] = \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{573                        \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}};}
\DoxyCodeLine{574       layer\_flags[3] = \mbox{\hyperlink{group__vp8__encoder_gafb51c67e5743275146bc1fc425727da3}{VP8\_EFLAG\_NO\_REF\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga650ab0baea12be91082226a5cc18776a}{VP8\_EFLAG\_NO\_REF\_ARF}} |}
\DoxyCodeLine{575                        \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}};}
\DoxyCodeLine{576       \textcolor{keywordflow}{break};}
\DoxyCodeLine{577     \}}
\DoxyCodeLine{578     \textcolor{keywordflow}{case} 12:}
\DoxyCodeLine{579     \textcolor{keywordflow}{default}: \{}
\DoxyCodeLine{580       \textcolor{comment}{// 3-\/layers structure as in case 10, but no sync/refresh points for}}
\DoxyCodeLine{581       \textcolor{comment}{// layer 1 and 2.}}
\DoxyCodeLine{582       \textcolor{keywordtype}{int} ids[4] = \{ 0, 2, 1, 2 \};}
\DoxyCodeLine{583       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}} = 4;}
\DoxyCodeLine{584       *flag\_periodicity = 8;}
\DoxyCodeLine{585       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}} = 3;}
\DoxyCodeLine{586       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[0] = 4;}
\DoxyCodeLine{587       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[1] = 2;}
\DoxyCodeLine{588       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_ad40c30846ef8ef1d8684f10a491ec535}{ts\_rate\_decimator}}[2] = 1;}
\DoxyCodeLine{589       memcpy(cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}, ids, \textcolor{keyword}{sizeof}(ids));}
\DoxyCodeLine{590       \textcolor{comment}{// 0=L, 1=GF, 2=ARF.}}
\DoxyCodeLine{591       \textcolor{comment}{// Layer 0: predict from L and ARF; update L.}}
\DoxyCodeLine{592       layer\_flags[0] =}
\DoxyCodeLine{593           \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_gabb5e95343a2738abef44eca13059da33}{VP8\_EFLAG\_NO\_REF\_GF}};}
\DoxyCodeLine{594       layer\_flags[4] = layer\_flags[0];}
\DoxyCodeLine{595       \textcolor{comment}{// Layer 1: predict from L, G, ARF; update G.}}
\DoxyCodeLine{596       layer\_flags[2] = \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} | \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}};}
\DoxyCodeLine{597       layer\_flags[6] = layer\_flags[2];}
\DoxyCodeLine{598       \textcolor{comment}{// Layer 2: predict from L, G, ARF; update none.}}
\DoxyCodeLine{599       layer\_flags[1] = \mbox{\hyperlink{group__vp8__encoder_gab01d066c5236457d345ce1cab4c41d6b}{VP8\_EFLAG\_NO\_UPD\_GF}} | \mbox{\hyperlink{group__vp8__encoder_ga1cff46a5287e73a620660030d40b9e6c}{VP8\_EFLAG\_NO\_UPD\_ARF}} |}
\DoxyCodeLine{600                        \mbox{\hyperlink{group__vp8__encoder_ga602edb6b02a89cb2db7a16d6dffba583}{VP8\_EFLAG\_NO\_UPD\_LAST}} | \mbox{\hyperlink{group__vp8__encoder_ga5b91ad179910d4efc23aef66c7b2148b}{VP8\_EFLAG\_NO\_UPD\_ENTROPY}};}
\DoxyCodeLine{601       layer\_flags[3] = layer\_flags[1];}
\DoxyCodeLine{602       layer\_flags[5] = layer\_flags[1];}
\DoxyCodeLine{603       layer\_flags[7] = layer\_flags[1];}
\DoxyCodeLine{604       \textcolor{keywordflow}{break};}
\DoxyCodeLine{605     \}}
\DoxyCodeLine{606   \}}
\DoxyCodeLine{607 \}}
\DoxyCodeLine{608 }
\DoxyCodeLine{609 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{610 \textcolor{keyword}{static} \textcolor{keywordtype}{void} read\_mask(FILE *mask\_file, \textcolor{keywordtype}{int} *seg\_map) \{}
\DoxyCodeLine{611   \textcolor{keywordtype}{int} mask\_rows, mask\_cols, i, j;}
\DoxyCodeLine{612   \textcolor{keywordtype}{int} *map\_start = seg\_map;}
\DoxyCodeLine{613   fscanf(mask\_file, \textcolor{stringliteral}{"{}\%d \%d\(\backslash\)n"{}}, \&mask\_cols, \&mask\_rows);}
\DoxyCodeLine{614   \textcolor{keywordflow}{for} (i = 0; i < mask\_rows; i++) \{}
\DoxyCodeLine{615     \textcolor{keywordflow}{for} (j = 0; j < mask\_cols; j++) \{}
\DoxyCodeLine{616       fscanf(mask\_file, \textcolor{stringliteral}{"{}\%d "{}}, \&seg\_map[j]);}
\DoxyCodeLine{617       \textcolor{comment}{// reverse the bit}}
\DoxyCodeLine{618       seg\_map[j] = 1 -\/ seg\_map[j];}
\DoxyCodeLine{619     \}}
\DoxyCodeLine{620     seg\_map += mask\_cols;}
\DoxyCodeLine{621   \}}
\DoxyCodeLine{622   seg\_map = map\_start;}
\DoxyCodeLine{623 \}}
\DoxyCodeLine{624 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{625 }
\DoxyCodeLine{626 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{627   VpxVideoWriter *outfile[\mbox{\hyperlink{group__encoder_ga2715ac3dd8bf2f5438c4bbfc82788eb2}{VPX\_TS\_MAX\_LAYERS}}] = \{ NULL \};}
\DoxyCodeLine{628   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} codec;}
\DoxyCodeLine{629   \mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg\_t}} cfg;}
\DoxyCodeLine{630   \textcolor{keywordtype}{int} frame\_cnt = 0;}
\DoxyCodeLine{631   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{632   \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{633   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} width;}
\DoxyCodeLine{634   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} height;}
\DoxyCodeLine{635   uint32\_t error\_resilient = 0;}
\DoxyCodeLine{636   \textcolor{keywordtype}{int} speed;}
\DoxyCodeLine{637   \textcolor{keywordtype}{int} frame\_avail;}
\DoxyCodeLine{638   \textcolor{keywordtype}{int} got\_data;}
\DoxyCodeLine{639   \textcolor{keywordtype}{int} flags = 0;}
\DoxyCodeLine{640   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{641   \textcolor{keywordtype}{int} pts = 0;             \textcolor{comment}{// PTS starts at 0.}}
\DoxyCodeLine{642   \textcolor{keywordtype}{int} frame\_duration = 1;  \textcolor{comment}{// 1 timebase tick per frame.}}
\DoxyCodeLine{643   \textcolor{keywordtype}{int} layering\_mode = 0;}
\DoxyCodeLine{644   \textcolor{keywordtype}{int} layer\_flags[\mbox{\hyperlink{group__encoder_ga684b48cb6e47a258247637186557eb19}{VPX\_TS\_MAX\_PERIODICITY}}] = \{ 0 \};}
\DoxyCodeLine{645   \textcolor{keywordtype}{int} flag\_periodicity = 1;}
\DoxyCodeLine{646 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{647   \mbox{\hyperlink{structvpx__roi__map}{vpx\_roi\_map\_t}} roi;}
\DoxyCodeLine{648 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{649   \mbox{\hyperlink{structvpx__svc__layer__id}{vpx\_svc\_layer\_id\_t}} layer\_id;}
\DoxyCodeLine{650   \textcolor{keyword}{const} VpxInterface *encoder = NULL;}
\DoxyCodeLine{651   \textcolor{keyword}{struct }VpxInputContext input\_ctx;}
\DoxyCodeLine{652   \textcolor{keyword}{struct }RateControlMetrics rc;}
\DoxyCodeLine{653   int64\_t cx\_time = 0;}
\DoxyCodeLine{654   \textcolor{keyword}{const} \textcolor{keywordtype}{int} min\_args\_base = 13;}
\DoxyCodeLine{655 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{656   \mbox{\hyperlink{group__codec_ga7c83dfc1c49b0fe94a929d7d04b7f3f1}{vpx\_bit\_depth\_t}} bit\_depth = \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}};}
\DoxyCodeLine{657   \textcolor{keywordtype}{int} input\_bit\_depth = 8;}
\DoxyCodeLine{658   \textcolor{keyword}{const} \textcolor{keywordtype}{int} min\_args = min\_args\_base + 1;}
\DoxyCodeLine{659 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{660   \textcolor{keyword}{const} \textcolor{keywordtype}{int} min\_args = min\_args\_base;}
\DoxyCodeLine{661 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{662   \textcolor{keywordtype}{double} sum\_bitrate = 0.0;}
\DoxyCodeLine{663   \textcolor{keywordtype}{double} sum\_bitrate2 = 0.0;}
\DoxyCodeLine{664   \textcolor{keywordtype}{double} framerate = 30.0;}
\DoxyCodeLine{665 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{666   FILE *mask\_file = NULL;}
\DoxyCodeLine{667   \textcolor{keywordtype}{int} block\_size = 8;}
\DoxyCodeLine{668   \textcolor{keywordtype}{int} mask\_rows = 0;}
\DoxyCodeLine{669   \textcolor{keywordtype}{int} mask\_cols = 0;}
\DoxyCodeLine{670   \textcolor{keywordtype}{int} *mask\_map;}
\DoxyCodeLine{671   \textcolor{keywordtype}{int} *prev\_mask\_map;}
\DoxyCodeLine{672 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{673   zero(rc.layer\_target\_bitrate);}
\DoxyCodeLine{674   memset(\&layer\_id, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structvpx__svc__layer__id}{vpx\_svc\_layer\_id\_t}}));}
\DoxyCodeLine{675   memset(\&input\_ctx, 0, \textcolor{keyword}{sizeof}(input\_ctx));}
\DoxyCodeLine{676   \textcolor{comment}{/* Setup default input stream settings */}}
\DoxyCodeLine{677   input\_ctx.framerate.numerator = 30;}
\DoxyCodeLine{678   input\_ctx.framerate.denominator = 1;}
\DoxyCodeLine{679   input\_ctx.only\_i420 = 1;}
\DoxyCodeLine{680   input\_ctx.bit\_depth = 0;}
\DoxyCodeLine{681 }
\DoxyCodeLine{682   exec\_name = argv[0];}
\DoxyCodeLine{683   \textcolor{comment}{// Check usage and arguments.}}
\DoxyCodeLine{684   \textcolor{keywordflow}{if} (argc < min\_args) \{}
\DoxyCodeLine{685 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{686     die(\textcolor{stringliteral}{"{}Usage: \%s <infile> <outfile> <codec\_type(vp8/vp9)> <width> <height> "{}}}
\DoxyCodeLine{687         \textcolor{stringliteral}{"{}<rate\_num> <rate\_den> <speed> <frame\_drop\_threshold> "{}}}
\DoxyCodeLine{688         \textcolor{stringliteral}{"{}<error\_resilient> <threads> <mode> "{}}}
\DoxyCodeLine{689         \textcolor{stringliteral}{"{}<Rate\_0> ... <Rate\_nlayers-\/1> <bit-\/depth> \(\backslash\)n"{}},}
\DoxyCodeLine{690         argv[0]);}
\DoxyCodeLine{691 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{692     die(\textcolor{stringliteral}{"{}Usage: \%s <infile> <outfile> <codec\_type(vp8/vp9)> <width> <height> "{}}}
\DoxyCodeLine{693         \textcolor{stringliteral}{"{}<rate\_num> <rate\_den> <speed> <frame\_drop\_threshold> "{}}}
\DoxyCodeLine{694         \textcolor{stringliteral}{"{}<error\_resilient> <threads> <mode> "{}}}
\DoxyCodeLine{695         \textcolor{stringliteral}{"{}<Rate\_0> ... <Rate\_nlayers-\/1> \(\backslash\)n"{}},}
\DoxyCodeLine{696         argv[0]);}
\DoxyCodeLine{697 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{698   \}}
\DoxyCodeLine{699 }
\DoxyCodeLine{700   encoder = get\_vpx\_encoder\_by\_name(argv[3]);}
\DoxyCodeLine{701   \textcolor{keywordflow}{if} (!encoder) die(\textcolor{stringliteral}{"{}Unsupported codec."{}});}
\DoxyCodeLine{702 }
\DoxyCodeLine{703   printf(\textcolor{stringliteral}{"{}Using \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()));}
\DoxyCodeLine{704 }
\DoxyCodeLine{705   width = (\textcolor{keywordtype}{unsigned} int)strtoul(argv[4], NULL, 0);}
\DoxyCodeLine{706   height = (\textcolor{keywordtype}{unsigned} int)strtoul(argv[5], NULL, 0);}
\DoxyCodeLine{707   \textcolor{keywordflow}{if} (width < 16 || width \% 2 || height < 16 || height \% 2) \{}
\DoxyCodeLine{708     die(\textcolor{stringliteral}{"{}Invalid resolution: \%d x \%d"{}}, width, height);}
\DoxyCodeLine{709   \}}
\DoxyCodeLine{710 }
\DoxyCodeLine{711   layering\_mode = (int)strtol(argv[12], NULL, 0);}
\DoxyCodeLine{712   \textcolor{keywordflow}{if} (layering\_mode < 0 || layering\_mode > 13) \{}
\DoxyCodeLine{713     die(\textcolor{stringliteral}{"{}Invalid layering mode (0..12) \%s"{}}, argv[12]);}
\DoxyCodeLine{714   \}}
\DoxyCodeLine{715 }
\DoxyCodeLine{716 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{717   \textcolor{keywordflow}{if} (argc != min\_args + mode\_to\_num\_layers[layering\_mode] + 1) \{}
\DoxyCodeLine{718     die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{719   \}}
\DoxyCodeLine{720 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{721   \textcolor{keywordflow}{if} (argc != min\_args + mode\_to\_num\_layers[layering\_mode]) \{}
\DoxyCodeLine{722     die(\textcolor{stringliteral}{"{}Invalid number of arguments"{}});}
\DoxyCodeLine{723   \}}
\DoxyCodeLine{724 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{725 }
\DoxyCodeLine{726   input\_ctx.filename = argv[1];}
\DoxyCodeLine{727   open\_input\_file(\&input\_ctx);}
\DoxyCodeLine{728 }
\DoxyCodeLine{729 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{730   \textcolor{keywordflow}{switch} (strtol(argv[argc -\/ 1], NULL, 0)) \{}
\DoxyCodeLine{731     \textcolor{keywordflow}{case} 8:}
\DoxyCodeLine{732       bit\_depth = \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}};}
\DoxyCodeLine{733       input\_bit\_depth = 8;}
\DoxyCodeLine{734       \textcolor{keywordflow}{break};}
\DoxyCodeLine{735     \textcolor{keywordflow}{case} 10:}
\DoxyCodeLine{736       bit\_depth = \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9aaecd7245969d06b539de89cf580401e1}{VPX\_BITS\_10}};}
\DoxyCodeLine{737       input\_bit\_depth = 10;}
\DoxyCodeLine{738       \textcolor{keywordflow}{break};}
\DoxyCodeLine{739     \textcolor{keywordflow}{case} 12:}
\DoxyCodeLine{740       bit\_depth = \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a7d053a31e269b4d3746e88b0ff424862}{VPX\_BITS\_12}};}
\DoxyCodeLine{741       input\_bit\_depth = 12;}
\DoxyCodeLine{742       \textcolor{keywordflow}{break};}
\DoxyCodeLine{743     \textcolor{keywordflow}{default}: die(\textcolor{stringliteral}{"{}Invalid bit depth (8, 10, 12) \%s"{}}, argv[argc -\/ 1]);}
\DoxyCodeLine{744   \}}
\DoxyCodeLine{745 }
\DoxyCodeLine{746   \textcolor{comment}{// Y4M reader has its own allocation.}}
\DoxyCodeLine{747   \textcolor{keywordflow}{if} (input\_ctx.file\_type != FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{748     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(}
\DoxyCodeLine{749             \&raw,}
\DoxyCodeLine{750             bit\_depth == \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}} ? \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}} : \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}},}
\DoxyCodeLine{751             width, height, 32)) \{}
\DoxyCodeLine{752       die(\textcolor{stringliteral}{"{}Failed to allocate image (\%dx\%d)"{}}, width, height);}
\DoxyCodeLine{753     \}}
\DoxyCodeLine{754   \}}
\DoxyCodeLine{755 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{756   \textcolor{comment}{// Y4M reader has its own allocation.}}
\DoxyCodeLine{757   \textcolor{keywordflow}{if} (input\_ctx.file\_type != FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{758     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, width, height, 32)) \{}
\DoxyCodeLine{759       die(\textcolor{stringliteral}{"{}Failed to allocate image (\%dx\%d)"{}}, width, height);}
\DoxyCodeLine{760     \}}
\DoxyCodeLine{761   \}}
\DoxyCodeLine{762 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{763 }
\DoxyCodeLine{764   \textcolor{comment}{// Populate encoder configuration.}}
\DoxyCodeLine{765   res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(encoder-\/>codec\_interface(), \&cfg, 0);}
\DoxyCodeLine{766   \textcolor{keywordflow}{if} (res) \{}
\DoxyCodeLine{767     printf(\textcolor{stringliteral}{"{}Failed to get config: \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga550c4616424a08e85fc102486846141e}{vpx\_codec\_err\_to\_string}}(res));}
\DoxyCodeLine{768     \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{769   \}}
\DoxyCodeLine{770 }
\DoxyCodeLine{771   \textcolor{comment}{// Update the default configuration with our settings.}}
\DoxyCodeLine{772   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} = width;}
\DoxyCodeLine{773   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} = height;}
\DoxyCodeLine{774 }
\DoxyCodeLine{775 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{776   \textcolor{keywordflow}{if} (bit\_depth != \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}}) \{}
\DoxyCodeLine{777     cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aaaa7bca27fd42f24a2c215b247ba9190}{g\_bit\_depth}} = bit\_depth;}
\DoxyCodeLine{778     cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_abebad3c575d7a5ba6c09a52fedb7d762}{g\_input\_bit\_depth}} = input\_bit\_depth;}
\DoxyCodeLine{779     cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a3d7fe3a8b237338c094d5a956a41804d}{g\_profile}} = 2;}
\DoxyCodeLine{780   \}}
\DoxyCodeLine{781 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{782 }
\DoxyCodeLine{783   \textcolor{comment}{// Timebase format e.g. 30fps: numerator=1, demoninator = 30.}}
\DoxyCodeLine{784   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} = (int)strtol(argv[6], NULL, 0);}
\DoxyCodeLine{785   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} = (int)strtol(argv[7], NULL, 0);}
\DoxyCodeLine{786 }
\DoxyCodeLine{787   speed = (int)strtol(argv[8], NULL, 0);}
\DoxyCodeLine{788   \textcolor{keywordflow}{if} (speed < 0) \{}
\DoxyCodeLine{789     die(\textcolor{stringliteral}{"{}Invalid speed setting: must be positive"{}});}
\DoxyCodeLine{790   \}}
\DoxyCodeLine{791   \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp9"{}}, 3) == 0 \&\& speed > 9) \{}
\DoxyCodeLine{792     warn(\textcolor{stringliteral}{"{}Mapping speed \%d to speed 9.\(\backslash\)n"{}}, speed);}
\DoxyCodeLine{793   \}}
\DoxyCodeLine{794 }
\DoxyCodeLine{795   \textcolor{keywordflow}{for} (i = min\_args\_base;}
\DoxyCodeLine{796        (int)i < min\_args\_base + mode\_to\_num\_layers[layering\_mode]; ++i) \{}
\DoxyCodeLine{797     rc.layer\_target\_bitrate[i -\/ 13] = (int)strtol(argv[i], NULL, 0);}
\DoxyCodeLine{798     \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp8"{}}, 3) == 0)}
\DoxyCodeLine{799       cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aba7ceb7a90500a8f76aff89575737f3a}{ts\_target\_bitrate}}[i -\/ 13] = rc.layer\_target\_bitrate[i -\/ 13];}
\DoxyCodeLine{800     \textcolor{keywordflow}{else} if (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp9"{}}, 3) == 0)}
\DoxyCodeLine{801       cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a3f6b4c8aea7a713c51ad5d44e3552b1f}{layer\_target\_bitrate}}[i -\/ 13] = rc.layer\_target\_bitrate[i -\/ 13];}
\DoxyCodeLine{802   \}}
\DoxyCodeLine{803 }
\DoxyCodeLine{804   \textcolor{comment}{// Real time parameters.}}
\DoxyCodeLine{805   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a619269f9a6904de58c4790e6806a3905}{rc\_dropframe\_thresh}} = (\textcolor{keywordtype}{unsigned} int)strtoul(argv[9], NULL, 0);}
\DoxyCodeLine{806   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a99c415edb6c6f909a095a57c3430a116}{rc\_end\_usage}} = \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2a8b02853cb35790d60cc171a11f6c268a}{VPX\_CBR}};}
\DoxyCodeLine{807   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1324600e3c63faaa7717e85cf6509dd9}{rc\_min\_quantizer}} = 2;}
\DoxyCodeLine{808   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a8abdd985d317b720e142335887d737df}{rc\_max\_quantizer}} = 56;}
\DoxyCodeLine{809   \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp9"{}}, 3) == 0) cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a8abdd985d317b720e142335887d737df}{rc\_max\_quantizer}} = 52;}
\DoxyCodeLine{810   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ad279fbb0a9fe9395340913161e28651a}{rc\_undershoot\_pct}} = 50;}
\DoxyCodeLine{811   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4f2fbd015c1b1f395cc4a4b03d4ead5f}{rc\_overshoot\_pct}} = 50;}
\DoxyCodeLine{812   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aa9e4d6405994ef42d61d478cf6e0d5e0}{rc\_buf\_initial\_sz}} = 600;}
\DoxyCodeLine{813   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aafde485867e040a58504ad796e79e47f}{rc\_buf\_optimal\_sz}} = 600;}
\DoxyCodeLine{814   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a61866272bb588cd86d28834f420430f0}{rc\_buf\_sz}} = 1000;}
\DoxyCodeLine{815 }
\DoxyCodeLine{816   \textcolor{comment}{// Disable dynamic resizing by default.}}
\DoxyCodeLine{817   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a02a4e2f18fb0fdfff44df8b0d9a99d6c}{rc\_resize\_allowed}} = 0;}
\DoxyCodeLine{818 }
\DoxyCodeLine{819   \textcolor{comment}{// Use 1 thread as default.}}
\DoxyCodeLine{820   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aff9d8d458c45c95dd542603210ba2b8b}{g\_threads}} = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})strtoul(argv[11], NULL, 0);}
\DoxyCodeLine{821 }
\DoxyCodeLine{822   error\_resilient = (uint32\_t)strtoul(argv[10], NULL, 0);}
\DoxyCodeLine{823   \textcolor{keywordflow}{if} (error\_resilient != 0 \&\& error\_resilient != 1) \{}
\DoxyCodeLine{824     die(\textcolor{stringliteral}{"{}Invalid value for error resilient (0, 1): \%d."{}}, error\_resilient);}
\DoxyCodeLine{825   \}}
\DoxyCodeLine{826   \textcolor{comment}{// Enable error resilient mode.}}
\DoxyCodeLine{827   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4e17173b66ca0d7dfba9978625d7ba76}{g\_error\_resilient}} = error\_resilient;}
\DoxyCodeLine{828   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a992668d9e30305f3f7ab2672ea31a890}{g\_lag\_in\_frames}} = 0;}
\DoxyCodeLine{829   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a491d67f061dcdb13f60c017563e9d788}{kf\_mode}} = \mbox{\hyperlink{group__encoder_gga9f461802aa4db35c04a8b23837987f40ab1b423e78f72e77d2dce755d6c9652f8}{VPX\_KF\_AUTO}};}
\DoxyCodeLine{830 }
\DoxyCodeLine{831   \textcolor{comment}{// Disable automatic keyframe placement.}}
\DoxyCodeLine{832   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a0a7b5444ecb09745cbe8d5af17553846}{kf\_min\_dist}} = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_ae018440136e271743376730413d25a9b}{kf\_max\_dist}} = 3000;}
\DoxyCodeLine{833 }
\DoxyCodeLine{834   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a07c78dd29423d5ab475b9d77a0107d16}{temporal\_layering\_mode}} = \mbox{\hyperlink{group__vp8__encoder_ggabe875c0c3993e488ffb342cf548a8ce8a680204f7c9d48155170bcb3fc6e673e8}{VP9E\_TEMPORAL\_LAYERING\_MODE\_BYPASS}};}
\DoxyCodeLine{835 }
\DoxyCodeLine{836   set\_temporal\_layer\_pattern(layering\_mode, \&cfg, layer\_flags,}
\DoxyCodeLine{837                              \&flag\_periodicity);}
\DoxyCodeLine{838 }
\DoxyCodeLine{839   set\_rate\_control\_metrics(\&rc, \&cfg);}
\DoxyCodeLine{840 }
\DoxyCodeLine{841   \textcolor{keywordflow}{if} (input\_ctx.file\_type == FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{842     \textcolor{keywordflow}{if} (input\_ctx.width != cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} || input\_ctx.height != cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}}) \{}
\DoxyCodeLine{843       die(\textcolor{stringliteral}{"{}Incorrect width or height: \%d x \%d"{}}, cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}});}
\DoxyCodeLine{844     \}}
\DoxyCodeLine{845     \textcolor{keywordflow}{if} (input\_ctx.framerate.numerator != cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} ||}
\DoxyCodeLine{846         input\_ctx.framerate.denominator != cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}}) \{}
\DoxyCodeLine{847       die(\textcolor{stringliteral}{"{}Incorrect framerate: numerator \%d denominator \%d"{}},}
\DoxyCodeLine{848           cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}}, cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}});}
\DoxyCodeLine{849     \}}
\DoxyCodeLine{850   \}}
\DoxyCodeLine{851 }
\DoxyCodeLine{852   framerate = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} / cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}};}
\DoxyCodeLine{853   \textcolor{comment}{// Open an output file for each stream.}}
\DoxyCodeLine{854   \textcolor{keywordflow}{for} (i = 0; i < cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++i) \{}
\DoxyCodeLine{855     \textcolor{keywordtype}{char} file\_name[PATH\_MAX];}
\DoxyCodeLine{856     VpxVideoInfo info;}
\DoxyCodeLine{857     info.codec\_fourcc = encoder-\/>fourcc;}
\DoxyCodeLine{858     info.frame\_width = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}};}
\DoxyCodeLine{859     info.frame\_height = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}};}
\DoxyCodeLine{860     info.time\_base.numerator = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}};}
\DoxyCodeLine{861     info.time\_base.denominator = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}};}
\DoxyCodeLine{862 }
\DoxyCodeLine{863     snprintf(file\_name, \textcolor{keyword}{sizeof}(file\_name), \textcolor{stringliteral}{"{}\%s\_\%d.ivf"{}}, argv[2], i);}
\DoxyCodeLine{864     outfile[i] = vpx\_video\_writer\_open(file\_name, kContainerIVF, \&info);}
\DoxyCodeLine{865     \textcolor{keywordflow}{if} (!outfile[i]) die(\textcolor{stringliteral}{"{}Failed to open \%s for writing"{}}, file\_name);}
\DoxyCodeLine{866 }
\DoxyCodeLine{867     assert(outfile[i] != NULL);}
\DoxyCodeLine{868   \}}
\DoxyCodeLine{869   \textcolor{comment}{// No spatial layers in this encoder.}}
\DoxyCodeLine{870   cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1e5e1d00b22f2ba8c5c7230f31900f95}{ss\_number\_layers}} = 1;}
\DoxyCodeLine{871 }
\DoxyCodeLine{872 \textcolor{comment}{// Initialize codec.}}
\DoxyCodeLine{873 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{874   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(}
\DoxyCodeLine{875           \&codec, encoder-\/>codec\_interface(), \&cfg,}
\DoxyCodeLine{876           bit\_depth == \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}} ? 0 : \mbox{\hyperlink{group__encoder_ga69576ef94099286853e64aee29661608}{VPX\_CODEC\_USE\_HIGHBITDEPTH}}))}
\DoxyCodeLine{877 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{878   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&codec, encoder-\/>codec\_interface(), \&cfg, 0))}
\DoxyCodeLine{879 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{880     die(\textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{881 }
\DoxyCodeLine{882 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{883   mask\_rows = (cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}} + block\_size -\/ 1) / block\_size;}
\DoxyCodeLine{884   mask\_cols = (cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} + block\_size -\/ 1) / block\_size;}
\DoxyCodeLine{885   mask\_map = (\textcolor{keywordtype}{int} *)calloc(mask\_rows * mask\_cols, \textcolor{keyword}{sizeof}(*mask\_map));}
\DoxyCodeLine{886   prev\_mask\_map = (\textcolor{keywordtype}{int} *)calloc(mask\_rows * mask\_cols, \textcolor{keyword}{sizeof}(*mask\_map));}
\DoxyCodeLine{887 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{888 }
\DoxyCodeLine{889   \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp8"{}}, 3) == 0) \{}
\DoxyCodeLine{890     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca953ff0eaa2fcdc2ecd627e449b026853}{VP8E\_SET\_CPUUSED}}, -\/speed);}
\DoxyCodeLine{891     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca3fa90cb70bade72af3c2d8d91471a36c}{VP8E\_SET\_NOISE\_SENSITIVITY}}, kVp8DenoiserOff);}
\DoxyCodeLine{892     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecab34559df04d3d662616300ed0682dcfd}{VP8E\_SET\_STATIC\_THRESHOLD}}, 1);}
\DoxyCodeLine{893     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca816c34530f29b611644592f439addfae}{VP8E\_SET\_GF\_CBR\_BOOST\_PCT}}, 0);}
\DoxyCodeLine{894 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{895     set\_roi\_map(encoder-\/>name, \&cfg, \&roi);}
\DoxyCodeLine{896     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca25a828dbab350f80db769a8f53e3940f}{VP8E\_SET\_ROI\_MAP}}, \&roi))}
\DoxyCodeLine{897       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to set ROI map"{}});}
\DoxyCodeLine{898 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{899   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp9"{}}, 3) == 0) \{}
\DoxyCodeLine{900     \mbox{\hyperlink{structvpx__svc__parameters}{vpx\_svc\_extra\_cfg\_t}} svc\_params;}
\DoxyCodeLine{901     memset(\&svc\_params, 0, \textcolor{keyword}{sizeof}(svc\_params));}
\DoxyCodeLine{902     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca474cce061fe13ef1d408b0a0224d887d}{VP9E\_SET\_POSTENCODE\_DROP}}, 0);}
\DoxyCodeLine{903     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca73257656241aac7371e60fa99c8b797b}{VP9E\_SET\_DISABLE\_OVERSHOOT\_MAXQ\_CBR}}, 0);}
\DoxyCodeLine{904     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca953ff0eaa2fcdc2ecd627e449b026853}{VP8E\_SET\_CPUUSED}}, speed);}
\DoxyCodeLine{905     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca375af288e2d7fa169cbfef4ba586c1d2}{VP9E\_SET\_AQ\_MODE}}, 3);}
\DoxyCodeLine{906     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecae38181c436d82d8554b43303e18cff0b}{VP9E\_SET\_GF\_CBR\_BOOST\_PCT}}, 0);}
\DoxyCodeLine{907     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca7e61bfc05a2eb5a53d8f2091ebc5d40e}{VP9E\_SET\_FRAME\_PARALLEL\_DECODING}}, 0);}
\DoxyCodeLine{908     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca064d768f60d2d60a07c160174c3df266}{VP9E\_SET\_FRAME\_PERIODIC\_BOOST}}, 0);}
\DoxyCodeLine{909     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecace6096a9fbe83dc72ed6a54a81ce215b}{VP9E\_SET\_NOISE\_SENSITIVITY}}, kVp9DenoiserOff);}
\DoxyCodeLine{910     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecab34559df04d3d662616300ed0682dcfd}{VP8E\_SET\_STATIC\_THRESHOLD}}, 1);}
\DoxyCodeLine{911     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca87292610b42f00676aebdc75b63227de}{VP9E\_SET\_TUNE\_CONTENT}}, 0);}
\DoxyCodeLine{912     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca9c221dc99c51eb5e6304461aed9b5f5b}{VP9E\_SET\_TILE\_COLUMNS}}, get\_msb(cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aff9d8d458c45c95dd542603210ba2b8b}{g\_threads}}));}
\DoxyCodeLine{913     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacd2d31e611840edb87a0484a9ef1781a}{VP9E\_SET\_DISABLE\_LOOPFILTER}}, 0);}
\DoxyCodeLine{914 }
\DoxyCodeLine{915     \textcolor{keywordflow}{if} (cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_aff9d8d458c45c95dd542603210ba2b8b}{g\_threads}} > 1)}
\DoxyCodeLine{916       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca8ec97b90e57f4ddba099cd881a509360}{VP9E\_SET\_ROW\_MT}}, 1);}
\DoxyCodeLine{917     \textcolor{keywordflow}{else}}
\DoxyCodeLine{918       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca8ec97b90e57f4ddba099cd881a509360}{VP9E\_SET\_ROW\_MT}}, 0);}
\DoxyCodeLine{919     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca88f29897083911e08434857aeff77407}{VP9E\_SET\_SVC}}, layering\_mode > 0 ? 1 : 0))}
\DoxyCodeLine{920       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to set SVC"{}});}
\DoxyCodeLine{921     \textcolor{keywordflow}{for} (i = 0; i < cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++i) \{}
\DoxyCodeLine{922       svc\_params.\mbox{\hyperlink{structvpx__svc__parameters_aae494f231727fd9f5feb47b465452509}{max\_quantizers}}[i] = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a8abdd985d317b720e142335887d737df}{rc\_max\_quantizer}};}
\DoxyCodeLine{923       svc\_params.\mbox{\hyperlink{structvpx__svc__parameters_a4b32be6e2e6f0c808c4ed3044f3c7ddf}{min\_quantizers}}[i] = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a1324600e3c63faaa7717e85cf6509dd9}{rc\_min\_quantizer}};}
\DoxyCodeLine{924     \}}
\DoxyCodeLine{925     svc\_params.\mbox{\hyperlink{structvpx__svc__parameters_a79544d65e1b3bb0b71f85b3f2b7167bf}{scaling\_factor\_num}}[0] = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}};}
\DoxyCodeLine{926     svc\_params.\mbox{\hyperlink{structvpx__svc__parameters_aaf33b6a09e97e04763b6d10de3899ee4}{scaling\_factor\_den}}[0] = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}};}
\DoxyCodeLine{927     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca7836375eec7f50dc580a2a8ace9c9055}{VP9E\_SET\_SVC\_PARAMETERS}}, \&svc\_params);}
\DoxyCodeLine{928   \}}
\DoxyCodeLine{929   \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp8"{}}, 3) == 0) \{}
\DoxyCodeLine{930     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacbd74e1cbae2b8a95907ea5eabbbe590}{VP8E\_SET\_SCREEN\_CONTENT\_MODE}}, 0);}
\DoxyCodeLine{931   \}}
\DoxyCodeLine{932   \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca462a4f14f39a6eb5c4a4004fc8d0ad75}{VP8E\_SET\_TOKEN\_PARTITIONS}}, 1);}
\DoxyCodeLine{933   \textcolor{comment}{// This controls the maximum target size of the key frame.}}
\DoxyCodeLine{934   \textcolor{comment}{// For generating smaller key frames, use a smaller max\_intra\_size\_pct}}
\DoxyCodeLine{935   \textcolor{comment}{// value, like 100 or 200.}}
\DoxyCodeLine{936   \{}
\DoxyCodeLine{937     \textcolor{keyword}{const} \textcolor{keywordtype}{int} max\_intra\_size\_pct = 1000;}
\DoxyCodeLine{938     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca09c69ff4a3aabdb307d4f24027dfc4c1}{VP8E\_SET\_MAX\_INTRA\_BITRATE\_PCT}},}
\DoxyCodeLine{939                       max\_intra\_size\_pct);}
\DoxyCodeLine{940   \}}
\DoxyCodeLine{941 }
\DoxyCodeLine{942   frame\_avail = 1;}
\DoxyCodeLine{943   \textcolor{keywordflow}{while} (frame\_avail || got\_data) \{}
\DoxyCodeLine{944     \textcolor{keyword}{struct }vpx\_usec\_timer timer;}
\DoxyCodeLine{945     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{946     \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt;}
\DoxyCodeLine{947 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{948     \textcolor{keywordtype}{char} mask\_file\_name[255];}
\DoxyCodeLine{949 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{950     \textcolor{comment}{// Update the temporal layer\_id. No spatial layers in this test.}}
\DoxyCodeLine{951     layer\_id.\mbox{\hyperlink{structvpx__svc__layer__id_a91ae13acc06ecde84886601374d4c872}{spatial\_layer\_id}} = 0;}
\DoxyCodeLine{952     layer\_id.\mbox{\hyperlink{structvpx__svc__layer__id_a365859e15e7a6ff2b06106ea00820ea7}{temporal\_layer\_id}} =}
\DoxyCodeLine{953         cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}[frame\_cnt \% cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}}];}
\DoxyCodeLine{954     layer\_id.\mbox{\hyperlink{structvpx__svc__layer__id_a72bab7b950f5687b08fd40a9b34e9500}{temporal\_layer\_id\_per\_spatial}}[0] = layer\_id.\mbox{\hyperlink{structvpx__svc__layer__id_a365859e15e7a6ff2b06106ea00820ea7}{temporal\_layer\_id}};}
\DoxyCodeLine{955     \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp9"{}}, 3) == 0) \{}
\DoxyCodeLine{956       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca090ad9dcb1f2eea2af60f4737c5bf514}{VP9E\_SET\_SVC\_LAYER\_ID}}, \&layer\_id);}
\DoxyCodeLine{957     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strncmp(encoder-\/>name, \textcolor{stringliteral}{"{}vp8"{}}, 3) == 0) \{}
\DoxyCodeLine{958       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca97533c494b55a54f6136cc2788966a03}{VP8E\_SET\_TEMPORAL\_LAYER\_ID}},}
\DoxyCodeLine{959                         layer\_id.\mbox{\hyperlink{structvpx__svc__layer__id_a365859e15e7a6ff2b06106ea00820ea7}{temporal\_layer\_id}});}
\DoxyCodeLine{960     \}}
\DoxyCodeLine{961     flags = layer\_flags[frame\_cnt \% flag\_periodicity];}
\DoxyCodeLine{962     \textcolor{keywordflow}{if} (layering\_mode == 0) flags = 0;}
\DoxyCodeLine{963 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{964     snprintf(mask\_file\_name, \textcolor{keyword}{sizeof}(mask\_file\_name), \textcolor{stringliteral}{"{}\%s\%05d.txt"{}},}
\DoxyCodeLine{965              argv[argc -\/ 1], frame\_cnt);}
\DoxyCodeLine{966     mask\_file = fopen(mask\_file\_name, \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{967     \textcolor{keywordflow}{if} (mask\_file != NULL) \{}
\DoxyCodeLine{968       read\_mask(mask\_file, mask\_map);}
\DoxyCodeLine{969       fclose(mask\_file);}
\DoxyCodeLine{970       \textcolor{comment}{// set\_roi\_map(encoder-\/>name, \&cfg, \&roi);}}
\DoxyCodeLine{971       set\_roi\_skip\_map(\&cfg, \&roi, mask\_map, prev\_mask\_map, frame\_cnt);}
\DoxyCodeLine{972       \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&codec, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca238a2ff6df22a651f6ef251ea0d81715}{VP9E\_SET\_ROI\_MAP}}, \&roi))}
\DoxyCodeLine{973         die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to set ROI map"{}});}
\DoxyCodeLine{974     \}}
\DoxyCodeLine{975 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{976     frame\_avail = read\_frame(\&input\_ctx, \&raw);}
\DoxyCodeLine{977     \textcolor{keywordflow}{if} (frame\_avail) ++rc.layer\_input\_frames[layer\_id.\mbox{\hyperlink{structvpx__svc__layer__id_a365859e15e7a6ff2b06106ea00820ea7}{temporal\_layer\_id}}];}
\DoxyCodeLine{978     vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{979     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(\&codec, frame\_avail ? \&raw : NULL, pts, 1, flags,}
\DoxyCodeLine{980                          \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}})) \{}
\DoxyCodeLine{981       die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to encode frame"{}});}
\DoxyCodeLine{982     \}}
\DoxyCodeLine{983     vpx\_usec\_timer\_mark(\&timer);}
\DoxyCodeLine{984     cx\_time += vpx\_usec\_timer\_elapsed(\&timer);}
\DoxyCodeLine{985     \textcolor{comment}{// Reset KF flag.}}
\DoxyCodeLine{986     \textcolor{keywordflow}{if} (layering\_mode != 7) \{}
\DoxyCodeLine{987       layer\_flags[0] \&= \string~VPX\_EFLAG\_FORCE\_KF;}
\DoxyCodeLine{988     \}}
\DoxyCodeLine{989     got\_data = 0;}
\DoxyCodeLine{990     \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(\&codec, \&iter))) \{}
\DoxyCodeLine{991       got\_data = 1;}
\DoxyCodeLine{992       \textcolor{keywordflow}{switch} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}}) \{}
\DoxyCodeLine{993         \textcolor{keywordflow}{case} \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}:}
\DoxyCodeLine{994           \textcolor{keywordflow}{for} (i = cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}[frame\_cnt \% cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}}];}
\DoxyCodeLine{995                i < cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++i) \{}
\DoxyCodeLine{996             vpx\_video\_writer\_write\_frame(outfile[i], pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{997                                          pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}}, pts);}
\DoxyCodeLine{998             ++rc.layer\_tot\_enc\_frames[i];}
\DoxyCodeLine{999             rc.layer\_encoding\_bitrate[i] += 8.0 * pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}};}
\DoxyCodeLine{1000             \textcolor{comment}{// Keep count of rate control stats per layer (for non-\/key frames).}}
\DoxyCodeLine{1001             \textcolor{keywordflow}{if} (i == cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4d105d2470dbfb7210b33d298f1cf1f6}{ts\_layer\_id}}[frame\_cnt \% cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a4ec338780115dd270acf0dac24193474}{ts\_periodicity}}] \&\&}
\DoxyCodeLine{1002                 !(pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_ga7a896eb3bc74f33419e6a9812c60e4c9}{VPX\_FRAME\_IS\_KEY}})) \{}
\DoxyCodeLine{1003               rc.layer\_avg\_frame\_size[i] += 8.0 * pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}};}
\DoxyCodeLine{1004               rc.layer\_avg\_rate\_mismatch[i] +=}
\DoxyCodeLine{1005                   fabs(8.0 * pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}} -\/ rc.layer\_pfb[i]) /}
\DoxyCodeLine{1006                   rc.layer\_pfb[i];}
\DoxyCodeLine{1007               ++rc.layer\_enc\_frames[i];}
\DoxyCodeLine{1008             \}}
\DoxyCodeLine{1009           \}}
\DoxyCodeLine{1010           \textcolor{comment}{// Update for short-\/time encoding bitrate states, for moving window}}
\DoxyCodeLine{1011           \textcolor{comment}{// of size rc-\/>window, shifted by rc-\/>window / 2.}}
\DoxyCodeLine{1012           \textcolor{comment}{// Ignore first window segment, due to key frame.}}
\DoxyCodeLine{1013           \textcolor{keywordflow}{if} (rc.window\_size == 0) rc.window\_size = 15;}
\DoxyCodeLine{1014           \textcolor{keywordflow}{if} (frame\_cnt > rc.window\_size) \{}
\DoxyCodeLine{1015             sum\_bitrate += 0.001 * 8.0 * pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}} * framerate;}
\DoxyCodeLine{1016             \textcolor{keywordflow}{if} (frame\_cnt \% rc.window\_size == 0) \{}
\DoxyCodeLine{1017               rc.window\_count += 1;}
\DoxyCodeLine{1018               rc.avg\_st\_encoding\_bitrate += sum\_bitrate / rc.window\_size;}
\DoxyCodeLine{1019               rc.variance\_st\_encoding\_bitrate +=}
\DoxyCodeLine{1020                   (sum\_bitrate / rc.window\_size) *}
\DoxyCodeLine{1021                   (sum\_bitrate / rc.window\_size);}
\DoxyCodeLine{1022               sum\_bitrate = 0.0;}
\DoxyCodeLine{1023             \}}
\DoxyCodeLine{1024           \}}
\DoxyCodeLine{1025           \textcolor{comment}{// Second shifted window.}}
\DoxyCodeLine{1026           \textcolor{keywordflow}{if} (frame\_cnt > rc.window\_size + rc.window\_size / 2) \{}
\DoxyCodeLine{1027             sum\_bitrate2 += 0.001 * 8.0 * pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}} * framerate;}
\DoxyCodeLine{1028             \textcolor{keywordflow}{if} (frame\_cnt > 2 * rc.window\_size \&\&}
\DoxyCodeLine{1029                 frame\_cnt \% rc.window\_size == 0) \{}
\DoxyCodeLine{1030               rc.window\_count += 1;}
\DoxyCodeLine{1031               rc.avg\_st\_encoding\_bitrate += sum\_bitrate2 / rc.window\_size;}
\DoxyCodeLine{1032               rc.variance\_st\_encoding\_bitrate +=}
\DoxyCodeLine{1033                   (sum\_bitrate2 / rc.window\_size) *}
\DoxyCodeLine{1034                   (sum\_bitrate2 / rc.window\_size);}
\DoxyCodeLine{1035               sum\_bitrate2 = 0.0;}
\DoxyCodeLine{1036             \}}
\DoxyCodeLine{1037           \}}
\DoxyCodeLine{1038           \textcolor{keywordflow}{break};}
\DoxyCodeLine{1039         \textcolor{keywordflow}{default}: \textcolor{keywordflow}{break};}
\DoxyCodeLine{1040       \}}
\DoxyCodeLine{1041     \}}
\DoxyCodeLine{1042     ++frame\_cnt;}
\DoxyCodeLine{1043     pts += frame\_duration;}
\DoxyCodeLine{1044   \}}
\DoxyCodeLine{1045 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{1046   free(mask\_map);}
\DoxyCodeLine{1047   free(prev\_mask\_map);}
\DoxyCodeLine{1048 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1049   close\_input\_file(\&input\_ctx);}
\DoxyCodeLine{1050   printout\_rate\_control\_summary(\&rc, \&cfg, frame\_cnt);}
\DoxyCodeLine{1051   printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{1052   printf(\textcolor{stringliteral}{"{}Frame cnt and encoding time/FPS stats for encoding: \%d \%f \%f \(\backslash\)n"{}},}
\DoxyCodeLine{1053          frame\_cnt, 1000 * (\textcolor{keywordtype}{float})cx\_time / (\textcolor{keywordtype}{double})(frame\_cnt * 1000000),}
\DoxyCodeLine{1054          1000000 * (\textcolor{keywordtype}{double})frame\_cnt / (\textcolor{keywordtype}{double})cx\_time);}
\DoxyCodeLine{1055 }
\DoxyCodeLine{1056   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&codec)) die\_codec(\&codec, \textcolor{stringliteral}{"{}Failed to destroy codec"{}});}
\DoxyCodeLine{1057 }
\DoxyCodeLine{1058   \textcolor{comment}{// Try to rewrite the output file headers with the actual frame count.}}
\DoxyCodeLine{1059   \textcolor{keywordflow}{for} (i = 0; i < cfg.\mbox{\hyperlink{structvpx__codec__enc__cfg_a16d4549a30cbd585e3c3056ef873d8c7}{ts\_number\_layers}}; ++i) vpx\_video\_writer\_close(outfile[i]);}
\DoxyCodeLine{1060 }
\DoxyCodeLine{1061   \textcolor{keywordflow}{if} (input\_ctx.file\_type != FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{1062     \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{1063   \}}
\DoxyCodeLine{1064 }
\DoxyCodeLine{1065 \textcolor{preprocessor}{\#if ROI\_MAP}}
\DoxyCodeLine{1066   free(roi.\mbox{\hyperlink{structvpx__roi__map_aba69e211b81d622977ba07ac47b61075}{roi\_map}});}
\DoxyCodeLine{1067 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1068   \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{1069 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vpxdec}{}\doxysubsection{vpxdec}\label{example_vpxdec}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <limits.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#if CONFIG\_LIBYUV}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}third\_party/libyuv/include/libyuv/scale.h"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}./args.h"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}./ivfdec.h"{}}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}vpx\_ports/mem\_ops.h"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}vpx\_ports/vpx\_timer.h"{}}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER || CONFIG\_VP9\_DECODER}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8dx_8h}{vpx/vp8dx.h}}"{}}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include "{}./md5\_utils.h"{}}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include "{}./tools\_common.h"{}}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}./webmdec.h"{}}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#include "{}./y4menc.h"{}}}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 \textcolor{keyword}{struct }VpxDecInputContext \{}
\DoxyCodeLine{46   \textcolor{keyword}{struct }VpxInputContext *vpx\_input\_ctx;}
\DoxyCodeLine{47   \textcolor{keyword}{struct }WebmInputContext *webm\_ctx;}
\DoxyCodeLine{48 \};}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t help =}
\DoxyCodeLine{51     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}help"{}}, 0, \textcolor{stringliteral}{"{}Show usage options and exit"{}});}
\DoxyCodeLine{52 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t looparg =}
\DoxyCodeLine{53     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}loops"{}}, 1, \textcolor{stringliteral}{"{}Number of times to decode the file"{}});}
\DoxyCodeLine{54 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t codecarg = ARG\_DEF(NULL, \textcolor{stringliteral}{"{}codec"{}}, 1, \textcolor{stringliteral}{"{}Codec to use"{}});}
\DoxyCodeLine{55 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_yv12 =}
\DoxyCodeLine{56     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}yv12"{}}, 0, \textcolor{stringliteral}{"{}Output raw YV12 frames"{}});}
\DoxyCodeLine{57 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_i420 =}
\DoxyCodeLine{58     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}i420"{}}, 0, \textcolor{stringliteral}{"{}Output raw I420 frames"{}});}
\DoxyCodeLine{59 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t flipuvarg =}
\DoxyCodeLine{60     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}flipuv"{}}, 0, \textcolor{stringliteral}{"{}Flip the chroma planes in the output"{}});}
\DoxyCodeLine{61 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rawvideo =}
\DoxyCodeLine{62     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}rawvideo"{}}, 0, \textcolor{stringliteral}{"{}Output raw YUV frames"{}});}
\DoxyCodeLine{63 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t noblitarg =}
\DoxyCodeLine{64     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}noblit"{}}, 0, \textcolor{stringliteral}{"{}Don't process the decoded frames"{}});}
\DoxyCodeLine{65 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t progressarg =}
\DoxyCodeLine{66     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}progress"{}}, 0, \textcolor{stringliteral}{"{}Show progress after each frame decodes"{}});}
\DoxyCodeLine{67 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t limitarg =}
\DoxyCodeLine{68     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}limit"{}}, 1, \textcolor{stringliteral}{"{}Stop decoding after n frames"{}});}
\DoxyCodeLine{69 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t skiparg =}
\DoxyCodeLine{70     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}skip"{}}, 1, \textcolor{stringliteral}{"{}Skip the first n input frames"{}});}
\DoxyCodeLine{71 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t postprocarg =}
\DoxyCodeLine{72     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}postproc"{}}, 0, \textcolor{stringliteral}{"{}Postprocess decoded frames"{}});}
\DoxyCodeLine{73 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t summaryarg =}
\DoxyCodeLine{74     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}summary"{}}, 0, \textcolor{stringliteral}{"{}Show timing summary"{}});}
\DoxyCodeLine{75 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t outputfile =}
\DoxyCodeLine{76     ARG\_DEF(\textcolor{stringliteral}{"{}o"{}}, \textcolor{stringliteral}{"{}output"{}}, 1, \textcolor{stringliteral}{"{}Output file name pattern (see below)"{}});}
\DoxyCodeLine{77 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t threadsarg =}
\DoxyCodeLine{78     ARG\_DEF(\textcolor{stringliteral}{"{}t"{}}, \textcolor{stringliteral}{"{}threads"{}}, 1, \textcolor{stringliteral}{"{}Max threads to use"{}});}
\DoxyCodeLine{79 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t frameparallelarg =}
\DoxyCodeLine{80     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}frame-\/parallel"{}}, 0, \textcolor{stringliteral}{"{}Frame parallel decode (ignored)"{}});}
\DoxyCodeLine{81 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t verbosearg =}
\DoxyCodeLine{82     ARG\_DEF(\textcolor{stringliteral}{"{}v"{}}, \textcolor{stringliteral}{"{}verbose"{}}, 0, \textcolor{stringliteral}{"{}Show version string"{}});}
\DoxyCodeLine{83 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t error\_concealment =}
\DoxyCodeLine{84     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}error-\/concealment"{}}, 0, \textcolor{stringliteral}{"{}Enable decoder error-\/concealment"{}});}
\DoxyCodeLine{85 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t scalearg =}
\DoxyCodeLine{86     ARG\_DEF(\textcolor{stringliteral}{"{}S"{}}, \textcolor{stringliteral}{"{}scale"{}}, 0, \textcolor{stringliteral}{"{}Scale output frames uniformly"{}});}
\DoxyCodeLine{87 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t continuearg =}
\DoxyCodeLine{88     ARG\_DEF(\textcolor{stringliteral}{"{}k"{}}, \textcolor{stringliteral}{"{}keep-\/going"{}}, 0, \textcolor{stringliteral}{"{}(debug) Continue decoding after error"{}});}
\DoxyCodeLine{89 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t fb\_arg =}
\DoxyCodeLine{90     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}frame-\/buffers"{}}, 1, \textcolor{stringliteral}{"{}Number of frame buffers to use"{}});}
\DoxyCodeLine{91 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t md5arg =}
\DoxyCodeLine{92     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}md5"{}}, 0, \textcolor{stringliteral}{"{}Compute the MD5 sum of the decoded frame"{}});}
\DoxyCodeLine{93 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{94 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t outbitdeptharg =}
\DoxyCodeLine{95     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}output-\/bit-\/depth"{}}, 1, \textcolor{stringliteral}{"{}Output bit-\/depth for decoded frames"{}});}
\DoxyCodeLine{96 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{97 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t svcdecodingarg = ARG\_DEF(}
\DoxyCodeLine{98     NULL, \textcolor{stringliteral}{"{}svc-\/decode-\/layer"{}}, 1, \textcolor{stringliteral}{"{}Decode SVC stream up to given spatial layer"{}});}
\DoxyCodeLine{99 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t framestatsarg =}
\DoxyCodeLine{100     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}framestats"{}}, 1, \textcolor{stringliteral}{"{}Output per-\/frame stats (.csv format)"{}});}
\DoxyCodeLine{101 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rowmtarg =}
\DoxyCodeLine{102     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}row-\/mt"{}}, 1, \textcolor{stringliteral}{"{}Enable multi-\/threading to run row-\/wise in VP9"{}});}
\DoxyCodeLine{103 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t lpfoptarg =}
\DoxyCodeLine{104     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}lpf-\/opt"{}}, 1,}
\DoxyCodeLine{105             \textcolor{stringliteral}{"{}Do loopfilter without waiting for all threads to sync."{}});}
\DoxyCodeLine{106 }
\DoxyCodeLine{107 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *all\_args[] = \{ \&help,}
\DoxyCodeLine{108                                        \&codecarg,}
\DoxyCodeLine{109                                        \&use\_yv12,}
\DoxyCodeLine{110                                        \&use\_i420,}
\DoxyCodeLine{111                                        \&flipuvarg,}
\DoxyCodeLine{112                                        \&rawvideo,}
\DoxyCodeLine{113                                        \&noblitarg,}
\DoxyCodeLine{114                                        \&progressarg,}
\DoxyCodeLine{115                                        \&limitarg,}
\DoxyCodeLine{116                                        \&skiparg,}
\DoxyCodeLine{117                                        \&postprocarg,}
\DoxyCodeLine{118                                        \&summaryarg,}
\DoxyCodeLine{119                                        \&outputfile,}
\DoxyCodeLine{120                                        \&threadsarg,}
\DoxyCodeLine{121                                        \&frameparallelarg,}
\DoxyCodeLine{122                                        \&verbosearg,}
\DoxyCodeLine{123                                        \&scalearg,}
\DoxyCodeLine{124                                        \&fb\_arg,}
\DoxyCodeLine{125                                        \&md5arg,}
\DoxyCodeLine{126                                        \&error\_concealment,}
\DoxyCodeLine{127                                        \&continuearg,}
\DoxyCodeLine{128 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{129                                        \&outbitdeptharg,}
\DoxyCodeLine{130 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{131                                        \&svcdecodingarg,}
\DoxyCodeLine{132                                        \&framestatsarg,}
\DoxyCodeLine{133                                        \&rowmtarg,}
\DoxyCodeLine{134                                        \&lpfoptarg,}
\DoxyCodeLine{135                                        NULL \};}
\DoxyCodeLine{136 }
\DoxyCodeLine{137 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER}}
\DoxyCodeLine{138 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t addnoise\_level =}
\DoxyCodeLine{139     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}noise-\/level"{}}, 1, \textcolor{stringliteral}{"{}Enable VP8 postproc add noise"{}});}
\DoxyCodeLine{140 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t deblock =}
\DoxyCodeLine{141     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}deblock"{}}, 0, \textcolor{stringliteral}{"{}Enable VP8 deblocking"{}});}
\DoxyCodeLine{142 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t demacroblock\_level = ARG\_DEF(}
\DoxyCodeLine{143     NULL, \textcolor{stringliteral}{"{}demacroblock-\/level"{}}, 1, \textcolor{stringliteral}{"{}Enable VP8 demacroblocking, w/ level"{}});}
\DoxyCodeLine{144 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t mfqe =}
\DoxyCodeLine{145     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}mfqe"{}}, 0, \textcolor{stringliteral}{"{}Enable multiframe quality enhancement"{}});}
\DoxyCodeLine{146 }
\DoxyCodeLine{147 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *vp8\_pp\_args[] = \{ \&addnoise\_level, \&deblock,}
\DoxyCodeLine{148                                           \&demacroblock\_level, \&mfqe, NULL \};}
\DoxyCodeLine{149 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151 \textcolor{preprocessor}{\#if CONFIG\_LIBYUV}}
\DoxyCodeLine{152 \textcolor{keyword}{static} INLINE \textcolor{keywordtype}{int} libyuv\_scale(\mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *src, \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *dst,}
\DoxyCodeLine{153                                FilterModeEnum mode) \{}
\DoxyCodeLine{154 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{155   \textcolor{keywordflow}{if} (src-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} == \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}}) \{}
\DoxyCodeLine{156     assert(dst-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} == \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}});}
\DoxyCodeLine{157     \textcolor{keywordflow}{return} I420Scale\_16(}
\DoxyCodeLine{158         (uint16\_t *)src-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}], src-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}] / 2,}
\DoxyCodeLine{159         (uint16\_t *)src-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}], src-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}] / 2,}
\DoxyCodeLine{160         (uint16\_t *)src-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], src-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}] / 2,}
\DoxyCodeLine{161         src-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, src-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, (uint16\_t *)dst-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}],}
\DoxyCodeLine{162         dst-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}] / 2, (uint16\_t *)dst-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}],}
\DoxyCodeLine{163         dst-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}] / 2, (uint16\_t *)dst-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}],}
\DoxyCodeLine{164         dst-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}] / 2, dst-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, dst-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, mode);}
\DoxyCodeLine{165   \}}
\DoxyCodeLine{166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{167   assert(src-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} == \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}});}
\DoxyCodeLine{168   assert(dst-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} == \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}});}
\DoxyCodeLine{169   \textcolor{keywordflow}{return} I420Scale(src-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}], src-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}],}
\DoxyCodeLine{170                    src-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}], src-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}],}
\DoxyCodeLine{171                    src-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], src-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], src-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}},}
\DoxyCodeLine{172                    src-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, dst-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}], dst-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}],}
\DoxyCodeLine{173                    dst-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}], dst-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}],}
\DoxyCodeLine{174                    dst-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], dst-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], dst-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}},}
\DoxyCodeLine{175                    dst-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, mode);}
\DoxyCodeLine{176 \}}
\DoxyCodeLine{177 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{178 \textcolor{keyword}{static} \textcolor{keywordtype}{void} show\_help(FILE *fout, \textcolor{keywordtype}{int} shorthelp) \{}
\DoxyCodeLine{179   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{180 }
\DoxyCodeLine{181   fprintf(fout, \textcolor{stringliteral}{"{}Usage: \%s <options> filename\(\backslash\)n\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{182 }
\DoxyCodeLine{183   \textcolor{keywordflow}{if} (shorthelp) \{}
\DoxyCodeLine{184     fprintf(fout, \textcolor{stringliteral}{"{}Use -\/-\/help to see the full list of options.\(\backslash\)n"{}});}
\DoxyCodeLine{185     \textcolor{keywordflow}{return};}
\DoxyCodeLine{186   \}}
\DoxyCodeLine{187 }
\DoxyCodeLine{188   fprintf(fout, \textcolor{stringliteral}{"{}Options:\(\backslash\)n"{}});}
\DoxyCodeLine{189   arg\_show\_usage(fout, all\_args);}
\DoxyCodeLine{190 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER}}
\DoxyCodeLine{191   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nVP8 Postprocessing Options:\(\backslash\)n"{}});}
\DoxyCodeLine{192   arg\_show\_usage(fout, vp8\_pp\_args);}
\DoxyCodeLine{193 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{194   fprintf(fout,}
\DoxyCodeLine{195           \textcolor{stringliteral}{"{}\(\backslash\)nOutput File Patterns:\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{196           \textcolor{stringliteral}{"{}  The -\/o argument specifies the name of the file(s) to "{}}}
\DoxyCodeLine{197           \textcolor{stringliteral}{"{}write to. If the\(\backslash\)n  argument does not include any escape "{}}}
\DoxyCodeLine{198           \textcolor{stringliteral}{"{}characters, the output will be\(\backslash\)n  written to a single file. "{}}}
\DoxyCodeLine{199           \textcolor{stringliteral}{"{}Otherwise, the filename will be calculated by\(\backslash\)n  expanding "{}}}
\DoxyCodeLine{200           \textcolor{stringliteral}{"{}the following escape characters:\(\backslash\)n"{}});}
\DoxyCodeLine{201   fprintf(fout,}
\DoxyCodeLine{202           \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)t\%\%w   -\/ Frame width"{}}}
\DoxyCodeLine{203           \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)t\%\%h   -\/ Frame height"{}}}
\DoxyCodeLine{204           \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)t\%\%<n> -\/ Frame number, zero padded to <n> places (1..9)"{}}}
\DoxyCodeLine{205           \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n  Pattern arguments are only supported in conjunction "{}}}
\DoxyCodeLine{206           \textcolor{stringliteral}{"{}with the -\/-\/yv12 and\(\backslash\)n  -\/-\/i420 options. If the -\/o option is "{}}}
\DoxyCodeLine{207           \textcolor{stringliteral}{"{}not specified, the output will be\(\backslash\)n  directed to stdout.\(\backslash\)n"{}});}
\DoxyCodeLine{208   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nIncluded decoders:\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{209 }
\DoxyCodeLine{210   \textcolor{keywordflow}{for} (i = 0; i < get\_vpx\_decoder\_count(); ++i) \{}
\DoxyCodeLine{211     \textcolor{keyword}{const} VpxInterface *\textcolor{keyword}{const} decoder = get\_vpx\_decoder\_by\_index(i);}
\DoxyCodeLine{212     fprintf(fout, \textcolor{stringliteral}{"{}    \%-\/6s -\/ \%s\(\backslash\)n"{}}, decoder-\/>name,}
\DoxyCodeLine{213             \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(decoder-\/>codec\_interface()));}
\DoxyCodeLine{214   \}}
\DoxyCodeLine{215 \}}
\DoxyCodeLine{216 }
\DoxyCodeLine{217 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{218   show\_help(stderr, 1);}
\DoxyCodeLine{219   exit(EXIT\_FAILURE);}
\DoxyCodeLine{220 \}}
\DoxyCodeLine{221 }
\DoxyCodeLine{222 \textcolor{keyword}{static} \textcolor{keywordtype}{int} raw\_read\_frame(FILE *infile, uint8\_t **buffer, \textcolor{keywordtype}{size\_t} *bytes\_read,}
\DoxyCodeLine{223                           \textcolor{keywordtype}{size\_t} *buffer\_size) \{}
\DoxyCodeLine{224   \textcolor{keywordtype}{char} raw\_hdr[RAW\_FRAME\_HDR\_SZ];}
\DoxyCodeLine{225   \textcolor{keywordtype}{size\_t} frame\_size = 0;}
\DoxyCodeLine{226 }
\DoxyCodeLine{227   \textcolor{keywordflow}{if} (fread(raw\_hdr, RAW\_FRAME\_HDR\_SZ, 1, infile) != 1) \{}
\DoxyCodeLine{228     \textcolor{keywordflow}{if} (!feof(infile)) warn(\textcolor{stringliteral}{"{}Failed to read RAW frame size\(\backslash\)n"{}});}
\DoxyCodeLine{229   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{230     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} kCorruptFrameThreshold = 256 * 1024 * 1024;}
\DoxyCodeLine{231     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} kFrameTooSmallThreshold = 256 * 1024;}
\DoxyCodeLine{232     frame\_size = mem\_get\_le32(raw\_hdr);}
\DoxyCodeLine{233 }
\DoxyCodeLine{234     \textcolor{keywordflow}{if} (frame\_size > kCorruptFrameThreshold) \{}
\DoxyCodeLine{235       warn(\textcolor{stringliteral}{"{}Read invalid frame size (\%u)\(\backslash\)n"{}}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})frame\_size);}
\DoxyCodeLine{236       frame\_size = 0;}
\DoxyCodeLine{237     \}}
\DoxyCodeLine{238 }
\DoxyCodeLine{239     \textcolor{keywordflow}{if} (frame\_size < kFrameTooSmallThreshold) \{}
\DoxyCodeLine{240       warn(\textcolor{stringliteral}{"{}Warning: Read invalid frame size (\%u) -\/ not a raw file?\(\backslash\)n"{}},}
\DoxyCodeLine{241            (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})frame\_size);}
\DoxyCodeLine{242     \}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244     \textcolor{keywordflow}{if} (frame\_size > *buffer\_size) \{}
\DoxyCodeLine{245       uint8\_t *new\_buf = realloc(*buffer, 2 * frame\_size);}
\DoxyCodeLine{246       \textcolor{keywordflow}{if} (new\_buf) \{}
\DoxyCodeLine{247         *buffer = new\_buf;}
\DoxyCodeLine{248         *buffer\_size = 2 * frame\_size;}
\DoxyCodeLine{249       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{250         warn(\textcolor{stringliteral}{"{}Failed to allocate compressed data buffer\(\backslash\)n"{}});}
\DoxyCodeLine{251         frame\_size = 0;}
\DoxyCodeLine{252       \}}
\DoxyCodeLine{253     \}}
\DoxyCodeLine{254   \}}
\DoxyCodeLine{255 }
\DoxyCodeLine{256   \textcolor{keywordflow}{if} (!feof(infile)) \{}
\DoxyCodeLine{257     \textcolor{keywordflow}{if} (fread(*buffer, 1, frame\_size, infile) != frame\_size) \{}
\DoxyCodeLine{258       warn(\textcolor{stringliteral}{"{}Failed to read full frame\(\backslash\)n"{}});}
\DoxyCodeLine{259       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{260     \}}
\DoxyCodeLine{261     *bytes\_read = frame\_size;}
\DoxyCodeLine{262     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{263   \}}
\DoxyCodeLine{264 }
\DoxyCodeLine{265   \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{266 \}}
\DoxyCodeLine{267 }
\DoxyCodeLine{268 \textcolor{keyword}{static} \textcolor{keywordtype}{int} dec\_read\_frame(\textcolor{keyword}{struct} VpxDecInputContext *input, uint8\_t **buf,}
\DoxyCodeLine{269                           \textcolor{keywordtype}{size\_t} *bytes\_in\_buffer, \textcolor{keywordtype}{size\_t} *buffer\_size) \{}
\DoxyCodeLine{270   \textcolor{keywordflow}{switch} (input-\/>vpx\_input\_ctx-\/>file\_type) \{}
\DoxyCodeLine{271 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{272     \textcolor{keywordflow}{case} FILE\_TYPE\_WEBM:}
\DoxyCodeLine{273       \textcolor{keywordflow}{return} webm\_read\_frame(input-\/>webm\_ctx, buf, bytes\_in\_buffer);}
\DoxyCodeLine{274 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{275     \textcolor{keywordflow}{case} FILE\_TYPE\_RAW:}
\DoxyCodeLine{276       \textcolor{keywordflow}{return} raw\_read\_frame(input-\/>vpx\_input\_ctx-\/>file, buf, bytes\_in\_buffer,}
\DoxyCodeLine{277                             buffer\_size);}
\DoxyCodeLine{278     \textcolor{keywordflow}{case} FILE\_TYPE\_IVF:}
\DoxyCodeLine{279       \textcolor{keywordflow}{return} ivf\_read\_frame(input-\/>vpx\_input\_ctx-\/>file, buf, bytes\_in\_buffer,}
\DoxyCodeLine{280                             buffer\_size);}
\DoxyCodeLine{281     \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{282   \}}
\DoxyCodeLine{283 \}}
\DoxyCodeLine{284 }
\DoxyCodeLine{285 \textcolor{keyword}{static} \textcolor{keywordtype}{void} update\_image\_md5(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img, \textcolor{keyword}{const} \textcolor{keywordtype}{int} planes[3],}
\DoxyCodeLine{286                              MD5Context *md5) \{}
\DoxyCodeLine{287   \textcolor{keywordtype}{int} i, y;}
\DoxyCodeLine{288 }
\DoxyCodeLine{289   \textcolor{keywordflow}{for} (i = 0; i < 3; ++i) \{}
\DoxyCodeLine{290     \textcolor{keyword}{const} \textcolor{keywordtype}{int} plane = planes[i];}
\DoxyCodeLine{291     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *buf = img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[plane];}
\DoxyCodeLine{292     \textcolor{keyword}{const} \textcolor{keywordtype}{int} stride = img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[plane];}
\DoxyCodeLine{293     \textcolor{keyword}{const} \textcolor{keywordtype}{int} w = vpx\_img\_plane\_width(img, plane) *}
\DoxyCodeLine{294                   ((img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) ? 2 : 1);}
\DoxyCodeLine{295     \textcolor{keyword}{const} \textcolor{keywordtype}{int} h = vpx\_img\_plane\_height(img, plane);}
\DoxyCodeLine{296 }
\DoxyCodeLine{297     \textcolor{keywordflow}{for} (y = 0; y < h; ++y) \{}
\DoxyCodeLine{298       MD5Update(md5, buf, w);}
\DoxyCodeLine{299       buf += stride;}
\DoxyCodeLine{300     \}}
\DoxyCodeLine{301   \}}
\DoxyCodeLine{302 \}}
\DoxyCodeLine{303 }
\DoxyCodeLine{304 \textcolor{keyword}{static} \textcolor{keywordtype}{void} write\_image\_file(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img, \textcolor{keyword}{const} \textcolor{keywordtype}{int} planes[3],}
\DoxyCodeLine{305                              FILE *file) \{}
\DoxyCodeLine{306   \textcolor{keywordtype}{int} i, y;}
\DoxyCodeLine{307 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{308   \textcolor{keyword}{const} \textcolor{keywordtype}{int} bytes\_per\_sample = ((img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) ? 2 : 1);}
\DoxyCodeLine{309 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{310   \textcolor{keyword}{const} \textcolor{keywordtype}{int} bytes\_per\_sample = 1;}
\DoxyCodeLine{311 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{312 }
\DoxyCodeLine{313   \textcolor{keywordflow}{for} (i = 0; i < 3; ++i) \{}
\DoxyCodeLine{314     \textcolor{keyword}{const} \textcolor{keywordtype}{int} plane = planes[i];}
\DoxyCodeLine{315     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *buf = img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[plane];}
\DoxyCodeLine{316     \textcolor{keyword}{const} \textcolor{keywordtype}{int} stride = img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[plane];}
\DoxyCodeLine{317     \textcolor{keyword}{const} \textcolor{keywordtype}{int} w = vpx\_img\_plane\_width(img, plane);}
\DoxyCodeLine{318     \textcolor{keyword}{const} \textcolor{keywordtype}{int} h = vpx\_img\_plane\_height(img, plane);}
\DoxyCodeLine{319 }
\DoxyCodeLine{320     \textcolor{keywordflow}{for} (y = 0; y < h; ++y) \{}
\DoxyCodeLine{321       fwrite(buf, bytes\_per\_sample, w, file);}
\DoxyCodeLine{322       buf += stride;}
\DoxyCodeLine{323     \}}
\DoxyCodeLine{324   \}}
\DoxyCodeLine{325 \}}
\DoxyCodeLine{326 }
\DoxyCodeLine{327 \textcolor{keyword}{static} \textcolor{keywordtype}{int} file\_is\_raw(\textcolor{keyword}{struct} VpxInputContext *input) \{}
\DoxyCodeLine{328   uint8\_t buf[32];}
\DoxyCodeLine{329   \textcolor{keywordtype}{int} is\_raw = 0;}
\DoxyCodeLine{330   \mbox{\hyperlink{structvpx__codec__stream__info}{vpx\_codec\_stream\_info\_t}} si;}
\DoxyCodeLine{331 }
\DoxyCodeLine{332   si.\mbox{\hyperlink{structvpx__codec__stream__info_a8e5eb38a9042da54a20607f71591ddbf}{sz}} = \textcolor{keyword}{sizeof}(si);}
\DoxyCodeLine{333 }
\DoxyCodeLine{334   \textcolor{keywordflow}{if} (fread(buf, 1, 32, input-\/>file) == 32) \{}
\DoxyCodeLine{335     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{336 }
\DoxyCodeLine{337     \textcolor{keywordflow}{if} (mem\_get\_le32(buf) < 256 * 1024 * 1024) \{}
\DoxyCodeLine{338       \textcolor{keywordflow}{for} (i = 0; i < get\_vpx\_decoder\_count(); ++i) \{}
\DoxyCodeLine{339         \textcolor{keyword}{const} VpxInterface *\textcolor{keyword}{const} decoder = get\_vpx\_decoder\_by\_index(i);}
\DoxyCodeLine{340         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group__decoder_gadfee4664d644175d5aac1465ef11c4b0}{vpx\_codec\_peek\_stream\_info}}(decoder-\/>codec\_interface(), buf + 4,}
\DoxyCodeLine{341                                         32 -\/ 4, \&si)) \{}
\DoxyCodeLine{342           is\_raw = 1;}
\DoxyCodeLine{343           input-\/>fourcc = decoder-\/>fourcc;}
\DoxyCodeLine{344           input-\/>width = si.\mbox{\hyperlink{structvpx__codec__stream__info_a957dbfa83c93d9b3dc08498a6b97c77d}{w}};}
\DoxyCodeLine{345           input-\/>height = si.\mbox{\hyperlink{structvpx__codec__stream__info_af7a8b114547e434d182c722bdace63a0}{h}};}
\DoxyCodeLine{346           input-\/>framerate.numerator = 30;}
\DoxyCodeLine{347           input-\/>framerate.denominator = 1;}
\DoxyCodeLine{348           \textcolor{keywordflow}{break};}
\DoxyCodeLine{349         \}}
\DoxyCodeLine{350       \}}
\DoxyCodeLine{351     \}}
\DoxyCodeLine{352   \}}
\DoxyCodeLine{353 }
\DoxyCodeLine{354   rewind(input-\/>file);}
\DoxyCodeLine{355   \textcolor{keywordflow}{return} is\_raw;}
\DoxyCodeLine{356 \}}
\DoxyCodeLine{357 }
\DoxyCodeLine{358 \textcolor{keyword}{static} \textcolor{keywordtype}{void} show\_progress(\textcolor{keywordtype}{int} frame\_in, \textcolor{keywordtype}{int} frame\_out, uint64\_t dx\_time) \{}
\DoxyCodeLine{359   fprintf(stderr,}
\DoxyCodeLine{360           \textcolor{stringliteral}{"{}\%d decoded frames/\%d showed frames in \%"{}} PRId64 \textcolor{stringliteral}{"{} us (\%.2f fps)\(\backslash\)r"{}},}
\DoxyCodeLine{361           frame\_in, frame\_out, dx\_time,}
\DoxyCodeLine{362           (\textcolor{keywordtype}{double})frame\_out * 1000000.0 / (\textcolor{keywordtype}{double})dx\_time);}
\DoxyCodeLine{363 \}}
\DoxyCodeLine{364 }
\DoxyCodeLine{365 \textcolor{keyword}{struct }ExternalFrameBuffer \{}
\DoxyCodeLine{366   uint8\_t *data;}
\DoxyCodeLine{367   \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{368   \textcolor{keywordtype}{int} in\_use;}
\DoxyCodeLine{369 \};}
\DoxyCodeLine{370 }
\DoxyCodeLine{371 \textcolor{keyword}{struct }ExternalFrameBufferList \{}
\DoxyCodeLine{372   \textcolor{keywordtype}{int} num\_external\_frame\_buffers;}
\DoxyCodeLine{373   \textcolor{keyword}{struct }ExternalFrameBuffer *ext\_fb;}
\DoxyCodeLine{374 \};}
\DoxyCodeLine{375 }
\DoxyCodeLine{376 \textcolor{comment}{// Callback used by libvpx to request an external frame buffer. |cb\_priv|}}
\DoxyCodeLine{377 \textcolor{comment}{// Application private data passed into the set function. |min\_size| is the}}
\DoxyCodeLine{378 \textcolor{comment}{// minimum size in bytes needed to decode the next frame. |fb| pointer to the}}
\DoxyCodeLine{379 \textcolor{comment}{// frame buffer.}}
\DoxyCodeLine{380 \textcolor{keyword}{static} \textcolor{keywordtype}{int} get\_vp9\_frame\_buffer(\textcolor{keywordtype}{void} *cb\_priv, \textcolor{keywordtype}{size\_t} min\_size,}
\DoxyCodeLine{381                                 \mbox{\hyperlink{structvpx__codec__frame__buffer}{vpx\_codec\_frame\_buffer\_t}} *fb) \{}
\DoxyCodeLine{382   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{383   \textcolor{keyword}{struct }ExternalFrameBufferList *\textcolor{keyword}{const} ext\_fb\_list =}
\DoxyCodeLine{384       (\textcolor{keyword}{struct }ExternalFrameBufferList *)cb\_priv;}
\DoxyCodeLine{385   \textcolor{keywordflow}{if} (ext\_fb\_list == NULL) \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{386 }
\DoxyCodeLine{387   \textcolor{comment}{// Find a free frame buffer.}}
\DoxyCodeLine{388   \textcolor{keywordflow}{for} (i = 0; i < ext\_fb\_list-\/>num\_external\_frame\_buffers; ++i) \{}
\DoxyCodeLine{389     \textcolor{keywordflow}{if} (!ext\_fb\_list-\/>ext\_fb[i].in\_use) \textcolor{keywordflow}{break};}
\DoxyCodeLine{390   \}}
\DoxyCodeLine{391 }
\DoxyCodeLine{392   \textcolor{keywordflow}{if} (i == ext\_fb\_list-\/>num\_external\_frame\_buffers) \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{393 }
\DoxyCodeLine{394   \textcolor{keywordflow}{if} (ext\_fb\_list-\/>ext\_fb[i].size < min\_size) \{}
\DoxyCodeLine{395     free(ext\_fb\_list-\/>ext\_fb[i].data);}
\DoxyCodeLine{396     ext\_fb\_list-\/>ext\_fb[i].data = (uint8\_t *)calloc(min\_size, \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{397     \textcolor{keywordflow}{if} (!ext\_fb\_list-\/>ext\_fb[i].data) \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{398 }
\DoxyCodeLine{399     ext\_fb\_list-\/>ext\_fb[i].size = min\_size;}
\DoxyCodeLine{400   \}}
\DoxyCodeLine{401 }
\DoxyCodeLine{402   fb-\/>\mbox{\hyperlink{structvpx__codec__frame__buffer_adcfd9dc0e57e1dad453c4496d8bbce30}{data}} = ext\_fb\_list-\/>ext\_fb[i].data;}
\DoxyCodeLine{403   fb-\/>\mbox{\hyperlink{structvpx__codec__frame__buffer_aa36d70c1f42be1cd31287b8ecf7b53a5}{size}} = ext\_fb\_list-\/>ext\_fb[i].size;}
\DoxyCodeLine{404   ext\_fb\_list-\/>ext\_fb[i].in\_use = 1;}
\DoxyCodeLine{405 }
\DoxyCodeLine{406   \textcolor{comment}{// Set the frame buffer's private data to point at the external frame buffer.}}
\DoxyCodeLine{407   fb-\/>\mbox{\hyperlink{structvpx__codec__frame__buffer_a7037d613f7b54f9cdad629cf17cb5e18}{priv}} = \&ext\_fb\_list-\/>ext\_fb[i];}
\DoxyCodeLine{408   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{409 \}}
\DoxyCodeLine{410 }
\DoxyCodeLine{411 \textcolor{comment}{// Callback used by libvpx when there are no references to the frame buffer.}}
\DoxyCodeLine{412 \textcolor{comment}{// |cb\_priv| user private data passed into the set function. |fb| pointer}}
\DoxyCodeLine{413 \textcolor{comment}{// to the frame buffer.}}
\DoxyCodeLine{414 \textcolor{keyword}{static} \textcolor{keywordtype}{int} release\_vp9\_frame\_buffer(\textcolor{keywordtype}{void} *cb\_priv,}
\DoxyCodeLine{415                                     \mbox{\hyperlink{structvpx__codec__frame__buffer}{vpx\_codec\_frame\_buffer\_t}} *fb) \{}
\DoxyCodeLine{416   \textcolor{keyword}{struct }ExternalFrameBuffer *\textcolor{keyword}{const} ext\_fb =}
\DoxyCodeLine{417       (\textcolor{keyword}{struct }ExternalFrameBuffer *)fb-\/>\mbox{\hyperlink{structvpx__codec__frame__buffer_a7037d613f7b54f9cdad629cf17cb5e18}{priv}};}
\DoxyCodeLine{418   (\textcolor{keywordtype}{void})cb\_priv;}
\DoxyCodeLine{419   ext\_fb-\/>in\_use = 0;}
\DoxyCodeLine{420   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{421 \}}
\DoxyCodeLine{422 }
\DoxyCodeLine{423 \textcolor{keyword}{static} \textcolor{keywordtype}{void} generate\_filename(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *pattern, \textcolor{keywordtype}{char} *out, \textcolor{keywordtype}{size\_t} q\_len,}
\DoxyCodeLine{424                               \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} d\_w, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} d\_h,}
\DoxyCodeLine{425                               \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frame\_in) \{}
\DoxyCodeLine{426   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *p = pattern;}
\DoxyCodeLine{427   \textcolor{keywordtype}{char} *q = out;}
\DoxyCodeLine{428 }
\DoxyCodeLine{429   \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{430     \textcolor{keywordtype}{char} *next\_pat = strchr(p, \textcolor{charliteral}{'\%'});}
\DoxyCodeLine{431 }
\DoxyCodeLine{432     \textcolor{keywordflow}{if} (p == next\_pat) \{}
\DoxyCodeLine{433       \textcolor{keywordtype}{size\_t} pat\_len;}
\DoxyCodeLine{434 }
\DoxyCodeLine{435       \textcolor{comment}{/* parse the pattern */}}
\DoxyCodeLine{436       q[q\_len -\/ 1] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{437       \textcolor{keywordflow}{switch} (p[1]) \{}
\DoxyCodeLine{438         \textcolor{keywordflow}{case} \textcolor{charliteral}{'w'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%d"{}}, d\_w); \textcolor{keywordflow}{break};}
\DoxyCodeLine{439         \textcolor{keywordflow}{case} \textcolor{charliteral}{'h'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%d"{}}, d\_h); \textcolor{keywordflow}{break};}
\DoxyCodeLine{440         \textcolor{keywordflow}{case} \textcolor{charliteral}{'1'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{441         \textcolor{keywordflow}{case} \textcolor{charliteral}{'2'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%02d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{442         \textcolor{keywordflow}{case} \textcolor{charliteral}{'3'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%03d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{443         \textcolor{keywordflow}{case} \textcolor{charliteral}{'4'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%04d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{444         \textcolor{keywordflow}{case} \textcolor{charliteral}{'5'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%05d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{445         \textcolor{keywordflow}{case} \textcolor{charliteral}{'6'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%06d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{446         \textcolor{keywordflow}{case} \textcolor{charliteral}{'7'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%07d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{447         \textcolor{keywordflow}{case} \textcolor{charliteral}{'8'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%08d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{448         \textcolor{keywordflow}{case} \textcolor{charliteral}{'9'}: snprintf(q, q\_len -\/ 1, \textcolor{stringliteral}{"{}\%09d"{}}, frame\_in); \textcolor{keywordflow}{break};}
\DoxyCodeLine{449         \textcolor{keywordflow}{default}: die(\textcolor{stringliteral}{"{}Unrecognized pattern \%\%\%c\(\backslash\)n"{}}, p[1]); \textcolor{keywordflow}{break};}
\DoxyCodeLine{450       \}}
\DoxyCodeLine{451 }
\DoxyCodeLine{452       pat\_len = strlen(q);}
\DoxyCodeLine{453       \textcolor{keywordflow}{if} (pat\_len >= q\_len -\/ 1) die(\textcolor{stringliteral}{"{}Output filename too long.\(\backslash\)n"{}});}
\DoxyCodeLine{454       q += pat\_len;}
\DoxyCodeLine{455       p += 2;}
\DoxyCodeLine{456       q\_len -\/= pat\_len;}
\DoxyCodeLine{457     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{458       \textcolor{keywordtype}{size\_t} copy\_len;}
\DoxyCodeLine{459 }
\DoxyCodeLine{460       \textcolor{comment}{/* copy the next segment */}}
\DoxyCodeLine{461       \textcolor{keywordflow}{if} (!next\_pat)}
\DoxyCodeLine{462         copy\_len = strlen(p);}
\DoxyCodeLine{463       \textcolor{keywordflow}{else}}
\DoxyCodeLine{464         copy\_len = next\_pat -\/ p;}
\DoxyCodeLine{465 }
\DoxyCodeLine{466       \textcolor{keywordflow}{if} (copy\_len >= q\_len -\/ 1) die(\textcolor{stringliteral}{"{}Output filename too long.\(\backslash\)n"{}});}
\DoxyCodeLine{467 }
\DoxyCodeLine{468       memcpy(q, p, copy\_len);}
\DoxyCodeLine{469       q[copy\_len] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{470       q += copy\_len;}
\DoxyCodeLine{471       p += copy\_len;}
\DoxyCodeLine{472       q\_len -\/= copy\_len;}
\DoxyCodeLine{473     \}}
\DoxyCodeLine{474   \} \textcolor{keywordflow}{while} (*p);}
\DoxyCodeLine{475 \}}
\DoxyCodeLine{476 }
\DoxyCodeLine{477 \textcolor{keyword}{static} \textcolor{keywordtype}{int} is\_single\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *outfile\_pattern) \{}
\DoxyCodeLine{478   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *p = outfile\_pattern;}
\DoxyCodeLine{479 }
\DoxyCodeLine{480   \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{481     p = strchr(p, \textcolor{charliteral}{'\%'});}
\DoxyCodeLine{482     \textcolor{keywordflow}{if} (p \&\& p[1] >= \textcolor{charliteral}{'1'} \&\& p[1] <= \textcolor{charliteral}{'9'})}
\DoxyCodeLine{483       \textcolor{keywordflow}{return} 0;  \textcolor{comment}{// pattern contains sequence number, so it's not unique}}
\DoxyCodeLine{484     \textcolor{keywordflow}{if} (p) p++;}
\DoxyCodeLine{485   \} \textcolor{keywordflow}{while} (p);}
\DoxyCodeLine{486 }
\DoxyCodeLine{487   \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{488 \}}
\DoxyCodeLine{489 }
\DoxyCodeLine{490 \textcolor{keyword}{static} \textcolor{keywordtype}{void} print\_md5(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} digest[16], \textcolor{keyword}{const} \textcolor{keywordtype}{char} *filename) \{}
\DoxyCodeLine{491   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{492 }
\DoxyCodeLine{493   \textcolor{keywordflow}{for} (i = 0; i < 16; ++i) printf(\textcolor{stringliteral}{"{}\%02x"{}}, digest[i]);}
\DoxyCodeLine{494   printf(\textcolor{stringliteral}{"{}  \%s\(\backslash\)n"{}}, filename);}
\DoxyCodeLine{495 \}}
\DoxyCodeLine{496 }
\DoxyCodeLine{497 \textcolor{keyword}{static} FILE *open\_outfile(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *name) \{}
\DoxyCodeLine{498   \textcolor{keywordflow}{if} (strcmp(\textcolor{stringliteral}{"{}-\/"{}}, name) == 0) \{}
\DoxyCodeLine{499     set\_binary\_mode(stdout);}
\DoxyCodeLine{500     \textcolor{keywordflow}{return} stdout;}
\DoxyCodeLine{501   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{502     FILE *file = fopen(name, \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{503     \textcolor{keywordflow}{if} (!file) fatal(\textcolor{stringliteral}{"{}Failed to open output file '\%s'"{}}, name);}
\DoxyCodeLine{504     \textcolor{keywordflow}{return} file;}
\DoxyCodeLine{505   \}}
\DoxyCodeLine{506 \}}
\DoxyCodeLine{507 }
\DoxyCodeLine{508 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{509 \textcolor{keyword}{static} \textcolor{keywordtype}{int} img\_shifted\_realloc\_required(\textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img,}
\DoxyCodeLine{510                                         \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *shifted,}
\DoxyCodeLine{511                                         \mbox{\hyperlink{vpx__image_8h_ad491e9c858d337700cca18afc8412545}{vpx\_img\_fmt\_t}} required\_fmt) \{}
\DoxyCodeLine{512   \textcolor{keywordflow}{return} img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} != shifted-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} || img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}} != shifted-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}} ||}
\DoxyCodeLine{513          required\_fmt != shifted-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}};}
\DoxyCodeLine{514 \}}
\DoxyCodeLine{515 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{516 }
\DoxyCodeLine{517 \textcolor{keyword}{static} \textcolor{keywordtype}{int} main\_loop(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv\_) \{}
\DoxyCodeLine{518   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} decoder;}
\DoxyCodeLine{519   \textcolor{keywordtype}{char} *fn = NULL;}
\DoxyCodeLine{520   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{521   \textcolor{keywordtype}{int} ret = EXIT\_FAILURE;}
\DoxyCodeLine{522   uint8\_t *buf = NULL;}
\DoxyCodeLine{523   \textcolor{keywordtype}{size\_t} bytes\_in\_buffer = 0, buffer\_size = 0;}
\DoxyCodeLine{524   FILE *infile;}
\DoxyCodeLine{525   \textcolor{keywordtype}{int} frame\_in = 0, frame\_out = 0, flipuv = 0, noblit = 0;}
\DoxyCodeLine{526   \textcolor{keywordtype}{int} do\_md5 = 0, progress = 0;}
\DoxyCodeLine{527   \textcolor{keywordtype}{int} stop\_after = 0, postproc = 0, summary = 0, quiet = 1;}
\DoxyCodeLine{528   \textcolor{keywordtype}{int} arg\_skip = 0;}
\DoxyCodeLine{529   \textcolor{keywordtype}{int} ec\_enabled = 0;}
\DoxyCodeLine{530   \textcolor{keywordtype}{int} keep\_going = 0;}
\DoxyCodeLine{531   \textcolor{keywordtype}{int} enable\_row\_mt = 0;}
\DoxyCodeLine{532   \textcolor{keywordtype}{int} enable\_lpf\_opt = 0;}
\DoxyCodeLine{533   \textcolor{keyword}{const} VpxInterface *\textcolor{keyword}{interface }= NULL;}
\DoxyCodeLine{534   \textcolor{keyword}{const} VpxInterface *fourcc\_interface = NULL;}
\DoxyCodeLine{535   uint64\_t dx\_time = 0;}
\DoxyCodeLine{536   \textcolor{keyword}{struct }arg arg;}
\DoxyCodeLine{537   \textcolor{keywordtype}{char} **argv, **argi, **argj;}
\DoxyCodeLine{538 }
\DoxyCodeLine{539   \textcolor{keywordtype}{int} single\_file;}
\DoxyCodeLine{540   \textcolor{keywordtype}{int} use\_y4m = 1;}
\DoxyCodeLine{541   \textcolor{keywordtype}{int} opt\_yv12 = 0;}
\DoxyCodeLine{542   \textcolor{keywordtype}{int} opt\_i420 = 0;}
\DoxyCodeLine{543   \mbox{\hyperlink{structvpx__codec__dec__cfg}{vpx\_codec\_dec\_cfg\_t}} cfg = \{ 0, 0, 0 \};}
\DoxyCodeLine{544 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{545   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} output\_bit\_depth = 0;}
\DoxyCodeLine{546 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{547   \textcolor{keywordtype}{int} svc\_decoding = 0;}
\DoxyCodeLine{548   \textcolor{keywordtype}{int} svc\_spatial\_layer = 0;}
\DoxyCodeLine{549 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER}}
\DoxyCodeLine{550   \mbox{\hyperlink{structvp8__postproc__cfg}{vp8\_postproc\_cfg\_t}} vp8\_pp\_cfg = \{ 0, 0, 0 \};}
\DoxyCodeLine{551 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{552   \textcolor{keywordtype}{int} frames\_corrupted = 0;}
\DoxyCodeLine{553   \textcolor{keywordtype}{int} dec\_flags = 0;}
\DoxyCodeLine{554   \textcolor{keywordtype}{int} do\_scale = 0;}
\DoxyCodeLine{555   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *scaled\_img = NULL;}
\DoxyCodeLine{556 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{557   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img\_shifted = NULL;}
\DoxyCodeLine{558 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{559   \textcolor{keywordtype}{int} frame\_avail, got\_data, flush\_decoder = 0;}
\DoxyCodeLine{560   \textcolor{keywordtype}{int} num\_external\_frame\_buffers = 0;}
\DoxyCodeLine{561   \textcolor{keyword}{struct }ExternalFrameBufferList ext\_fb\_list = \{ 0, NULL \};}
\DoxyCodeLine{562 }
\DoxyCodeLine{563   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *outfile\_pattern = NULL;}
\DoxyCodeLine{564   \textcolor{keywordtype}{char} outfile\_name[PATH\_MAX] = \{ 0 \};}
\DoxyCodeLine{565   FILE *outfile = NULL;}
\DoxyCodeLine{566 }
\DoxyCodeLine{567   FILE *framestats\_file = NULL;}
\DoxyCodeLine{568 }
\DoxyCodeLine{569   MD5Context md5\_ctx;}
\DoxyCodeLine{570   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} md5\_digest[16];}
\DoxyCodeLine{571 }
\DoxyCodeLine{572   \textcolor{keyword}{struct }VpxDecInputContext input = \{ NULL, NULL \};}
\DoxyCodeLine{573   \textcolor{keyword}{struct }VpxInputContext vpx\_input\_ctx;}
\DoxyCodeLine{574 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{575   \textcolor{keyword}{struct }WebmInputContext webm\_ctx;}
\DoxyCodeLine{576   memset(\&(webm\_ctx), 0, \textcolor{keyword}{sizeof}(webm\_ctx));}
\DoxyCodeLine{577   input.webm\_ctx = \&webm\_ctx;}
\DoxyCodeLine{578 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{579   input.vpx\_input\_ctx = \&vpx\_input\_ctx;}
\DoxyCodeLine{580 }
\DoxyCodeLine{581   \textcolor{comment}{/* Parse command line */}}
\DoxyCodeLine{582   exec\_name = argv\_[0];}
\DoxyCodeLine{583   argv = argv\_dup(argc -\/ 1, argv\_ + 1);}
\DoxyCodeLine{584 }
\DoxyCodeLine{585   \textcolor{keywordflow}{for} (argi = argj = argv; (*argj = *argi); argi += arg.argv\_step) \{}
\DoxyCodeLine{586     memset(\&arg, 0, \textcolor{keyword}{sizeof}(arg));}
\DoxyCodeLine{587     arg.argv\_step = 1;}
\DoxyCodeLine{588 }
\DoxyCodeLine{589     \textcolor{keywordflow}{if} (arg\_match(\&arg, \&help, argi)) \{}
\DoxyCodeLine{590       show\_help(stdout, 0);}
\DoxyCodeLine{591       exit(EXIT\_SUCCESS);}
\DoxyCodeLine{592     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&codecarg, argi)) \{}
\DoxyCodeLine{593       \textcolor{keyword}{interface }= get\_vpx\_decoder\_by\_name(arg.val);}
\DoxyCodeLine{594       \textcolor{keywordflow}{if} (!interface)}
\DoxyCodeLine{595         die(\textcolor{stringliteral}{"{}Error: Unrecognized argument (\%s) to -\/-\/codec\(\backslash\)n"{}}, arg.val);}
\DoxyCodeLine{596     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&looparg, argi)) \{}
\DoxyCodeLine{597       \textcolor{comment}{// no-\/op}}
\DoxyCodeLine{598     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&outputfile, argi))}
\DoxyCodeLine{599       outfile\_pattern = arg.val;}
\DoxyCodeLine{600     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_yv12, argi)) \{}
\DoxyCodeLine{601       use\_y4m = 0;}
\DoxyCodeLine{602       flipuv = 1;}
\DoxyCodeLine{603       opt\_yv12 = 1;}
\DoxyCodeLine{604     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_i420, argi)) \{}
\DoxyCodeLine{605       use\_y4m = 0;}
\DoxyCodeLine{606       flipuv = 0;}
\DoxyCodeLine{607       opt\_i420 = 1;}
\DoxyCodeLine{608     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rawvideo, argi)) \{}
\DoxyCodeLine{609       use\_y4m = 0;}
\DoxyCodeLine{610     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&flipuvarg, argi))}
\DoxyCodeLine{611       flipuv = 1;}
\DoxyCodeLine{612     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&noblitarg, argi))}
\DoxyCodeLine{613       noblit = 1;}
\DoxyCodeLine{614     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&progressarg, argi))}
\DoxyCodeLine{615       progress = 1;}
\DoxyCodeLine{616     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&limitarg, argi))}
\DoxyCodeLine{617       stop\_after = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{618     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&skiparg, argi))}
\DoxyCodeLine{619       arg\_skip = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{620     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&postprocarg, argi))}
\DoxyCodeLine{621       postproc = 1;}
\DoxyCodeLine{622     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&md5arg, argi))}
\DoxyCodeLine{623       do\_md5 = 1;}
\DoxyCodeLine{624     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&summaryarg, argi))}
\DoxyCodeLine{625       summary = 1;}
\DoxyCodeLine{626     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&threadsarg, argi))}
\DoxyCodeLine{627       cfg.\mbox{\hyperlink{structvpx__codec__dec__cfg_afca69d81e99ee15e1d641a639aefb7eb}{threads}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{628 \textcolor{preprocessor}{\#if CONFIG\_VP9\_DECODER}}
\DoxyCodeLine{629     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&frameparallelarg, argi)) \{}
\DoxyCodeLine{630       \textcolor{comment}{/* ignored for compatibility */}}
\DoxyCodeLine{631     \}}
\DoxyCodeLine{632 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{633     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&verbosearg, argi))}
\DoxyCodeLine{634       quiet = 0;}
\DoxyCodeLine{635     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&scalearg, argi))}
\DoxyCodeLine{636       do\_scale = 1;}
\DoxyCodeLine{637     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&fb\_arg, argi))}
\DoxyCodeLine{638       num\_external\_frame\_buffers = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{639     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&continuearg, argi))}
\DoxyCodeLine{640       keep\_going = 1;}
\DoxyCodeLine{641 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{642     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&outbitdeptharg, argi)) \{}
\DoxyCodeLine{643       output\_bit\_depth = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{644     \}}
\DoxyCodeLine{645 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{646     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&svcdecodingarg, argi)) \{}
\DoxyCodeLine{647       svc\_decoding = 1;}
\DoxyCodeLine{648       svc\_spatial\_layer = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{649     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&framestatsarg, argi)) \{}
\DoxyCodeLine{650       framestats\_file = fopen(arg.val, \textcolor{stringliteral}{"{}w"{}});}
\DoxyCodeLine{651       \textcolor{keywordflow}{if} (!framestats\_file) \{}
\DoxyCodeLine{652         die(\textcolor{stringliteral}{"{}Error: Could not open -\/-\/framestats file (\%s) for writing.\(\backslash\)n"{}},}
\DoxyCodeLine{653             arg.val);}
\DoxyCodeLine{654       \}}
\DoxyCodeLine{655     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rowmtarg, argi)) \{}
\DoxyCodeLine{656       enable\_row\_mt = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{657     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&lpfoptarg, argi)) \{}
\DoxyCodeLine{658       enable\_lpf\_opt = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{659     \}}
\DoxyCodeLine{660 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER}}
\DoxyCodeLine{661     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&addnoise\_level, argi)) \{}
\DoxyCodeLine{662       postproc = 1;}
\DoxyCodeLine{663       vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_ae9adc230642ac230f39eb4c531cf85e5}{post\_proc\_flag}} |= VP8\_ADDNOISE;}
\DoxyCodeLine{664       vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_a32f28e4003e5d9bf55d188247f3f156c}{noise\_level}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{665     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&demacroblock\_level, argi)) \{}
\DoxyCodeLine{666       postproc = 1;}
\DoxyCodeLine{667       vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_ae9adc230642ac230f39eb4c531cf85e5}{post\_proc\_flag}} |= VP8\_DEMACROBLOCK;}
\DoxyCodeLine{668       vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_afe919a9546e79798d840b1492f7e0249}{deblocking\_level}} = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{669     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&deblock, argi)) \{}
\DoxyCodeLine{670       postproc = 1;}
\DoxyCodeLine{671       vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_ae9adc230642ac230f39eb4c531cf85e5}{post\_proc\_flag}} |= VP8\_DEBLOCK;}
\DoxyCodeLine{672     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&mfqe, argi)) \{}
\DoxyCodeLine{673       postproc = 1;}
\DoxyCodeLine{674       vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_ae9adc230642ac230f39eb4c531cf85e5}{post\_proc\_flag}} |= VP8\_MFQE;}
\DoxyCodeLine{675     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&error\_concealment, argi)) \{}
\DoxyCodeLine{676       ec\_enabled = 1;}
\DoxyCodeLine{677     \}}
\DoxyCodeLine{678 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP8\_DECODER}}
\DoxyCodeLine{679     \textcolor{keywordflow}{else}}
\DoxyCodeLine{680       argj++;}
\DoxyCodeLine{681   \}}
\DoxyCodeLine{682 }
\DoxyCodeLine{683   \textcolor{comment}{/* Check for unrecognized options */}}
\DoxyCodeLine{684   \textcolor{keywordflow}{for} (argi = argv; *argi; argi++)}
\DoxyCodeLine{685     \textcolor{keywordflow}{if} (argi[0][0] == \textcolor{charliteral}{'-\/'} \&\& strlen(argi[0]) > 1)}
\DoxyCodeLine{686       die(\textcolor{stringliteral}{"{}Error: Unrecognized option \%s\(\backslash\)n"{}}, *argi);}
\DoxyCodeLine{687 }
\DoxyCodeLine{688   \textcolor{comment}{/* Handle non-\/option arguments */}}
\DoxyCodeLine{689   fn = argv[0];}
\DoxyCodeLine{690 }
\DoxyCodeLine{691   \textcolor{keywordflow}{if} (!fn) \{}
\DoxyCodeLine{692     free(argv);}
\DoxyCodeLine{693     fprintf(stderr, \textcolor{stringliteral}{"{}No input file specified!\(\backslash\)n"{}});}
\DoxyCodeLine{694     usage\_exit();}
\DoxyCodeLine{695   \}}
\DoxyCodeLine{696   \textcolor{comment}{/* Open file */}}
\DoxyCodeLine{697   infile = strcmp(fn, \textcolor{stringliteral}{"{}-\/"{}}) ? fopen(fn, \textcolor{stringliteral}{"{}rb"{}}) : set\_binary\_mode(stdin);}
\DoxyCodeLine{698 }
\DoxyCodeLine{699   \textcolor{keywordflow}{if} (!infile) \{}
\DoxyCodeLine{700     fatal(\textcolor{stringliteral}{"{}Failed to open input file '\%s'"{}}, strcmp(fn, \textcolor{stringliteral}{"{}-\/"{}}) ? fn : \textcolor{stringliteral}{"{}stdin"{}});}
\DoxyCodeLine{701   \}}
\DoxyCodeLine{702 \textcolor{preprocessor}{\#if CONFIG\_OS\_SUPPORT}}
\DoxyCodeLine{703   \textcolor{comment}{/* Make sure we don't dump to the terminal, unless forced to with -\/o -\/ */}}
\DoxyCodeLine{704   \textcolor{keywordflow}{if} (!outfile\_pattern \&\& isatty(fileno(stdout)) \&\& !do\_md5 \&\& !noblit) \{}
\DoxyCodeLine{705     fprintf(stderr,}
\DoxyCodeLine{706             \textcolor{stringliteral}{"{}Not dumping raw video to your terminal. Use '-\/o -\/' to "{}}}
\DoxyCodeLine{707             \textcolor{stringliteral}{"{}override.\(\backslash\)n"{}});}
\DoxyCodeLine{708     \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{709   \}}
\DoxyCodeLine{710 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{711   input.vpx\_input\_ctx-\/>file = infile;}
\DoxyCodeLine{712   \textcolor{keywordflow}{if} (file\_is\_ivf(input.vpx\_input\_ctx))}
\DoxyCodeLine{713     input.vpx\_input\_ctx-\/>file\_type = FILE\_TYPE\_IVF;}
\DoxyCodeLine{714 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{715   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (file\_is\_webm(input.webm\_ctx, input.vpx\_input\_ctx))}
\DoxyCodeLine{716     input.vpx\_input\_ctx-\/>file\_type = FILE\_TYPE\_WEBM;}
\DoxyCodeLine{717 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{718   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (file\_is\_raw(input.vpx\_input\_ctx))}
\DoxyCodeLine{719     input.vpx\_input\_ctx-\/>file\_type = FILE\_TYPE\_RAW;}
\DoxyCodeLine{720   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{721     fprintf(stderr, \textcolor{stringliteral}{"{}Unrecognized input file type.\(\backslash\)n"{}});}
\DoxyCodeLine{722 \textcolor{preprocessor}{\#if !CONFIG\_WEBM\_IO}}
\DoxyCodeLine{723     fprintf(stderr, \textcolor{stringliteral}{"{}vpxdec was built without WebM container support.\(\backslash\)n"{}});}
\DoxyCodeLine{724 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{725     free(argv);}
\DoxyCodeLine{726     \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{727   \}}
\DoxyCodeLine{728 }
\DoxyCodeLine{729   outfile\_pattern = outfile\_pattern ? outfile\_pattern : \textcolor{stringliteral}{"{}-\/"{}};}
\DoxyCodeLine{730   single\_file = is\_single\_file(outfile\_pattern);}
\DoxyCodeLine{731 }
\DoxyCodeLine{732   \textcolor{keywordflow}{if} (!noblit \&\& single\_file) \{}
\DoxyCodeLine{733     generate\_filename(outfile\_pattern, outfile\_name, PATH\_MAX,}
\DoxyCodeLine{734                       vpx\_input\_ctx.width, vpx\_input\_ctx.height, 0);}
\DoxyCodeLine{735     \textcolor{keywordflow}{if} (do\_md5)}
\DoxyCodeLine{736       MD5Init(\&md5\_ctx);}
\DoxyCodeLine{737     \textcolor{keywordflow}{else}}
\DoxyCodeLine{738       outfile = open\_outfile(outfile\_name);}
\DoxyCodeLine{739   \}}
\DoxyCodeLine{740 }
\DoxyCodeLine{741   \textcolor{keywordflow}{if} (use\_y4m \&\& !noblit) \{}
\DoxyCodeLine{742     \textcolor{keywordflow}{if} (!single\_file) \{}
\DoxyCodeLine{743       fprintf(stderr,}
\DoxyCodeLine{744               \textcolor{stringliteral}{"{}YUV4MPEG2 not supported with output patterns,"{}}}
\DoxyCodeLine{745               \textcolor{stringliteral}{"{} try -\/-\/i420 or -\/-\/yv12 or -\/-\/rawvideo.\(\backslash\)n"{}});}
\DoxyCodeLine{746       \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{747     \}}
\DoxyCodeLine{748 }
\DoxyCodeLine{749 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{750     \textcolor{keywordflow}{if} (vpx\_input\_ctx.file\_type == FILE\_TYPE\_WEBM) \{}
\DoxyCodeLine{751       \textcolor{keywordflow}{if} (webm\_guess\_framerate(input.webm\_ctx, input.vpx\_input\_ctx)) \{}
\DoxyCodeLine{752         fprintf(stderr,}
\DoxyCodeLine{753                 \textcolor{stringliteral}{"{}Failed to guess framerate -\/-\/ error parsing "{}}}
\DoxyCodeLine{754                 \textcolor{stringliteral}{"{}webm file?\(\backslash\)n"{}});}
\DoxyCodeLine{755         \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{756       \}}
\DoxyCodeLine{757     \}}
\DoxyCodeLine{758 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{759   \}}
\DoxyCodeLine{760 }
\DoxyCodeLine{761   fourcc\_interface = get\_vpx\_decoder\_by\_fourcc(vpx\_input\_ctx.fourcc);}
\DoxyCodeLine{762   \textcolor{keywordflow}{if} (interface \&\& fourcc\_interface \&\& interface != fourcc\_interface)}
\DoxyCodeLine{763     warn(\textcolor{stringliteral}{"{}Header indicates codec: \%s\(\backslash\)n"{}}, fourcc\_interface-\/>name);}
\DoxyCodeLine{764   \textcolor{keywordflow}{else}}
\DoxyCodeLine{765     \textcolor{keyword}{interface }= fourcc\_interface;}
\DoxyCodeLine{766 }
\DoxyCodeLine{767   \textcolor{keywordflow}{if} (!interface) \textcolor{keyword}{interface }= get\_vpx\_decoder\_by\_index(0);}
\DoxyCodeLine{768 }
\DoxyCodeLine{769   dec\_flags = (postproc ? \mbox{\hyperlink{group__decoder_ga6fe14f30254aff769412b128b29664cc}{VPX\_CODEC\_USE\_POSTPROC}} : 0) |}
\DoxyCodeLine{770               (ec\_enabled ? \mbox{\hyperlink{group__decoder_ga520d7005e360202f5844982fa2392581}{VPX\_CODEC\_USE\_ERROR\_CONCEALMENT}} : 0);}
\DoxyCodeLine{771   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&decoder, interface-\/>codec\_interface(), \&cfg,}
\DoxyCodeLine{772                          dec\_flags)) \{}
\DoxyCodeLine{773     fprintf(stderr, \textcolor{stringliteral}{"{}Failed to initialize decoder: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{774             \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{775     \textcolor{keywordflow}{goto} fail2;}
\DoxyCodeLine{776   \}}
\DoxyCodeLine{777   \textcolor{keywordflow}{if} (svc\_decoding) \{}
\DoxyCodeLine{778     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8__decoder_ggaf9dd3f2e6d1412106ee791af768e57c1ab1998be4a82605b6ce2a931210878916}{VP9\_DECODE\_SVC\_SPATIAL\_LAYER}},}
\DoxyCodeLine{779                           svc\_spatial\_layer)) \{}
\DoxyCodeLine{780       fprintf(stderr, \textcolor{stringliteral}{"{}Failed to set spatial layer for svc decode: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{781               \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{782       \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{783     \}}
\DoxyCodeLine{784   \}}
\DoxyCodeLine{785   \textcolor{keywordflow}{if} (interface-\/>fourcc == VP9\_FOURCC \&\&}
\DoxyCodeLine{786       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8__decoder_ggaf9dd3f2e6d1412106ee791af768e57c1a387b0251963942c5589c830a77dfa46b}{VP9D\_SET\_ROW\_MT}}, enable\_row\_mt)) \{}
\DoxyCodeLine{787     fprintf(stderr, \textcolor{stringliteral}{"{}Failed to set decoder in row multi-\/thread mode: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{788             \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{789     \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{790   \}}
\DoxyCodeLine{791   \textcolor{keywordflow}{if} (interface-\/>fourcc == VP9\_FOURCC \&\&}
\DoxyCodeLine{792       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8__decoder_ggaf9dd3f2e6d1412106ee791af768e57c1a5d6eacaeb7072d962bdb16acb1eeca61}{VP9D\_SET\_LOOP\_FILTER\_OPT}}, enable\_lpf\_opt)) \{}
\DoxyCodeLine{793     fprintf(stderr, \textcolor{stringliteral}{"{}Failed to set decoder in optimized loopfilter mode: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{794             \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{795     \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{796   \}}
\DoxyCodeLine{797   \textcolor{keywordflow}{if} (!quiet) fprintf(stderr, \textcolor{stringliteral}{"{}\%s\(\backslash\)n"{}}, decoder.\mbox{\hyperlink{structvpx__codec__ctx_a7ed1bf8f6434ea2df01da8011849c6cb}{name}});}
\DoxyCodeLine{798 }
\DoxyCodeLine{799 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER}}
\DoxyCodeLine{800   \textcolor{keywordflow}{if} (vp8\_pp\_cfg.\mbox{\hyperlink{structvp8__postproc__cfg_ae9adc230642ac230f39eb4c531cf85e5}{post\_proc\_flag}} \&\&}
\DoxyCodeLine{801       \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a43e85c68bc1c1473f4a94b005a59482c}{VP8\_SET\_POSTPROC}}, \&vp8\_pp\_cfg)) \{}
\DoxyCodeLine{802     fprintf(stderr, \textcolor{stringliteral}{"{}Failed to configure postproc: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{803             \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{804     \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{805   \}}
\DoxyCodeLine{806 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{807 }
\DoxyCodeLine{808   \textcolor{keywordflow}{if} (arg\_skip) fprintf(stderr, \textcolor{stringliteral}{"{}Skipping first \%d frames.\(\backslash\)n"{}}, arg\_skip);}
\DoxyCodeLine{809   \textcolor{keywordflow}{while} (arg\_skip) \{}
\DoxyCodeLine{810     \textcolor{keywordflow}{if} (dec\_read\_frame(\&input, \&buf, \&bytes\_in\_buffer, \&buffer\_size)) \textcolor{keywordflow}{break};}
\DoxyCodeLine{811     arg\_skip-\/-\/;}
\DoxyCodeLine{812   \}}
\DoxyCodeLine{813 }
\DoxyCodeLine{814   \textcolor{keywordflow}{if} (num\_external\_frame\_buffers > 0) \{}
\DoxyCodeLine{815     ext\_fb\_list.num\_external\_frame\_buffers = num\_external\_frame\_buffers;}
\DoxyCodeLine{816     ext\_fb\_list.ext\_fb = (\textcolor{keyword}{struct }ExternalFrameBuffer *)calloc(}
\DoxyCodeLine{817         num\_external\_frame\_buffers, \textcolor{keyword}{sizeof}(*ext\_fb\_list.ext\_fb));}
\DoxyCodeLine{818     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__cap__external__frame__buffer_gad209e7c3f6a330d11846be70a880182c}{vpx\_codec\_set\_frame\_buffer\_functions}}(\&decoder, get\_vp9\_frame\_buffer,}
\DoxyCodeLine{819                                              release\_vp9\_frame\_buffer,}
\DoxyCodeLine{820                                              \&ext\_fb\_list)) \{}
\DoxyCodeLine{821       fprintf(stderr, \textcolor{stringliteral}{"{}Failed to configure external frame buffers: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{822               \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{823       \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{824     \}}
\DoxyCodeLine{825   \}}
\DoxyCodeLine{826 }
\DoxyCodeLine{827   frame\_avail = 1;}
\DoxyCodeLine{828   got\_data = 0;}
\DoxyCodeLine{829 }
\DoxyCodeLine{830   \textcolor{keywordflow}{if} (framestats\_file) fprintf(framestats\_file, \textcolor{stringliteral}{"{}bytes,qp\(\backslash\)n"{}});}
\DoxyCodeLine{831 }
\DoxyCodeLine{832   \textcolor{comment}{/* Decode file */}}
\DoxyCodeLine{833   \textcolor{keywordflow}{while} (frame\_avail || got\_data) \{}
\DoxyCodeLine{834     \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{835     \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *img;}
\DoxyCodeLine{836     \textcolor{keyword}{struct }vpx\_usec\_timer timer;}
\DoxyCodeLine{837     \textcolor{keywordtype}{int} corrupted = 0;}
\DoxyCodeLine{838 }
\DoxyCodeLine{839     frame\_avail = 0;}
\DoxyCodeLine{840     \textcolor{keywordflow}{if} (!stop\_after || frame\_in < stop\_after) \{}
\DoxyCodeLine{841       \textcolor{keywordflow}{if} (!dec\_read\_frame(\&input, \&buf, \&bytes\_in\_buffer, \&buffer\_size)) \{}
\DoxyCodeLine{842         frame\_avail = 1;}
\DoxyCodeLine{843         frame\_in++;}
\DoxyCodeLine{844 }
\DoxyCodeLine{845         vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{846 }
\DoxyCodeLine{847         \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&decoder, buf, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})bytes\_in\_buffer, NULL,}
\DoxyCodeLine{848                              0)) \{}
\DoxyCodeLine{849           \textcolor{keyword}{const} \textcolor{keywordtype}{char} *detail = \mbox{\hyperlink{group__codec_ga68a900e49d568c5c39b6a53e25b5d4a8}{vpx\_codec\_error\_detail}}(\&decoder);}
\DoxyCodeLine{850           warn(\textcolor{stringliteral}{"{}Failed to decode frame \%d: \%s"{}}, frame\_in,}
\DoxyCodeLine{851                \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{852           \textcolor{keywordflow}{if} (detail) warn(\textcolor{stringliteral}{"{}Additional information: \%s"{}}, detail);}
\DoxyCodeLine{853           corrupted = 1;}
\DoxyCodeLine{854           \textcolor{keywordflow}{if} (!keep\_going) \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{855         \}}
\DoxyCodeLine{856 }
\DoxyCodeLine{857         \textcolor{keywordflow}{if} (framestats\_file) \{}
\DoxyCodeLine{858           \textcolor{keywordtype}{int} qp;}
\DoxyCodeLine{859           \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8__decoder_ggaf9dd3f2e6d1412106ee791af768e57c1a96ef4253540f901d6bd46afeef3d41c3}{VPXD\_GET\_LAST\_QUANTIZER}}, \&qp)) \{}
\DoxyCodeLine{860             warn(\textcolor{stringliteral}{"{}Failed VPXD\_GET\_LAST\_QUANTIZER: \%s"{}},}
\DoxyCodeLine{861                  \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{862             \textcolor{keywordflow}{if} (!keep\_going) \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{863           \}}
\DoxyCodeLine{864           fprintf(framestats\_file, \textcolor{stringliteral}{"{}\%d,\%d\(\backslash\)n"{}}, (\textcolor{keywordtype}{int})bytes\_in\_buffer, qp);}
\DoxyCodeLine{865         \}}
\DoxyCodeLine{866 }
\DoxyCodeLine{867         vpx\_usec\_timer\_mark(\&timer);}
\DoxyCodeLine{868         dx\_time += vpx\_usec\_timer\_elapsed(\&timer);}
\DoxyCodeLine{869       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{870         flush\_decoder = 1;}
\DoxyCodeLine{871       \}}
\DoxyCodeLine{872     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{873       flush\_decoder = 1;}
\DoxyCodeLine{874     \}}
\DoxyCodeLine{875 }
\DoxyCodeLine{876     vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{877 }
\DoxyCodeLine{878     \textcolor{keywordflow}{if} (flush\_decoder) \{}
\DoxyCodeLine{879       \textcolor{comment}{// Flush the decoder in frame parallel decode.}}
\DoxyCodeLine{880       \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&decoder, NULL, 0, NULL, 0)) \{}
\DoxyCodeLine{881         warn(\textcolor{stringliteral}{"{}Failed to flush decoder: \%s"{}}, \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{882         corrupted = 1;}
\DoxyCodeLine{883         \textcolor{keywordflow}{if} (!keep\_going) \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{884       \}}
\DoxyCodeLine{885     \}}
\DoxyCodeLine{886 }
\DoxyCodeLine{887     got\_data = 0;}
\DoxyCodeLine{888     \textcolor{keywordflow}{if} ((img = \mbox{\hyperlink{group__decoder_gac23542417b964c7f7cd6767e72775b54}{vpx\_codec\_get\_frame}}(\&decoder, \&iter))) \{}
\DoxyCodeLine{889       ++frame\_out;}
\DoxyCodeLine{890       got\_data = 1;}
\DoxyCodeLine{891     \}}
\DoxyCodeLine{892 }
\DoxyCodeLine{893     vpx\_usec\_timer\_mark(\&timer);}
\DoxyCodeLine{894     dx\_time += (\textcolor{keywordtype}{unsigned} int)vpx\_usec\_timer\_elapsed(\&timer);}
\DoxyCodeLine{895 }
\DoxyCodeLine{896     \textcolor{keywordflow}{if} (!corrupted \&\&}
\DoxyCodeLine{897         \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8__decoder_ggaf9dd3f2e6d1412106ee791af768e57c1af9f82d9e7930e6a2244b30b031b79599}{VP8D\_GET\_FRAME\_CORRUPTED}}, \&corrupted)) \{}
\DoxyCodeLine{898       warn(\textcolor{stringliteral}{"{}Failed VP8\_GET\_FRAME\_CORRUPTED: \%s"{}}, \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{899       \textcolor{keywordflow}{if} (!keep\_going) \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{900     \}}
\DoxyCodeLine{901     frames\_corrupted += corrupted;}
\DoxyCodeLine{902 }
\DoxyCodeLine{903     \textcolor{keywordflow}{if} (progress) show\_progress(frame\_in, frame\_out, dx\_time);}
\DoxyCodeLine{904 }
\DoxyCodeLine{905     \textcolor{keywordflow}{if} (!noblit \&\& img) \{}
\DoxyCodeLine{906       \textcolor{keyword}{const} \textcolor{keywordtype}{int} PLANES\_YUV[] = \{ \mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}, \mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}, \mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}} \};}
\DoxyCodeLine{907       \textcolor{keyword}{const} \textcolor{keywordtype}{int} PLANES\_YVU[] = \{ \mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}, \mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}, \mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}} \};}
\DoxyCodeLine{908       \textcolor{keyword}{const} \textcolor{keywordtype}{int} *planes = flipuv ? PLANES\_YVU : PLANES\_YUV;}
\DoxyCodeLine{909 }
\DoxyCodeLine{910       \textcolor{keywordflow}{if} (do\_scale) \{}
\DoxyCodeLine{911         \textcolor{keywordflow}{if} (frame\_out == 1) \{}
\DoxyCodeLine{912           \textcolor{comment}{// If the output frames are to be scaled to a fixed display size then}}
\DoxyCodeLine{913           \textcolor{comment}{// use the width and height specified in the container. If either of}}
\DoxyCodeLine{914           \textcolor{comment}{// these is set to 0, use the display size set in the first frame}}
\DoxyCodeLine{915           \textcolor{comment}{// header. If that is unavailable, use the raw decoded size of the}}
\DoxyCodeLine{916           \textcolor{comment}{// first decoded frame.}}
\DoxyCodeLine{917           \textcolor{keywordtype}{int} render\_width = vpx\_input\_ctx.width;}
\DoxyCodeLine{918           \textcolor{keywordtype}{int} render\_height = vpx\_input\_ctx.height;}
\DoxyCodeLine{919           \textcolor{keywordflow}{if} (!render\_width || !render\_height) \{}
\DoxyCodeLine{920             \textcolor{keywordtype}{int} render\_size[2];}
\DoxyCodeLine{921             \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&decoder, \mbox{\hyperlink{group__vp8__decoder_ggaf9dd3f2e6d1412106ee791af768e57c1aec6eaaa866488cfe1d0cb83cab302ebd}{VP9D\_GET\_DISPLAY\_SIZE}},}
\DoxyCodeLine{922                                   render\_size)) \{}
\DoxyCodeLine{923               \textcolor{comment}{// As last resort use size of first frame as display size.}}
\DoxyCodeLine{924               render\_width = img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}};}
\DoxyCodeLine{925               render\_height = img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}};}
\DoxyCodeLine{926             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{927               render\_width = render\_size[0];}
\DoxyCodeLine{928               render\_height = render\_size[1];}
\DoxyCodeLine{929             \}}
\DoxyCodeLine{930           \}}
\DoxyCodeLine{931           scaled\_img =}
\DoxyCodeLine{932               \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(NULL, img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}}, render\_width, render\_height, 16);}
\DoxyCodeLine{933           scaled\_img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}} = img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}};}
\DoxyCodeLine{934         \}}
\DoxyCodeLine{935 }
\DoxyCodeLine{936         \textcolor{keywordflow}{if} (img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} != scaled\_img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} || img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}} != scaled\_img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}) \{}
\DoxyCodeLine{937 \textcolor{preprocessor}{\#if CONFIG\_LIBYUV}}
\DoxyCodeLine{938           libyuv\_scale(img, scaled\_img, kFilterBox);}
\DoxyCodeLine{939           img = scaled\_img;}
\DoxyCodeLine{940 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{941           fprintf(stderr,}
\DoxyCodeLine{942                   \textcolor{stringliteral}{"{}Failed  to scale output frame: \%s.\(\backslash\)n"{}}}
\DoxyCodeLine{943                   \textcolor{stringliteral}{"{}Scaling is disabled in this configuration. "{}}}
\DoxyCodeLine{944                   \textcolor{stringliteral}{"{}To enable scaling, configure with -\/-\/enable-\/libyuv\(\backslash\)n"{}},}
\DoxyCodeLine{945                   \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{946           \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{947 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{948         \}}
\DoxyCodeLine{949       \}}
\DoxyCodeLine{950 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{951       \textcolor{comment}{// Default to codec bit depth if output bit depth not set}}
\DoxyCodeLine{952       \textcolor{keywordflow}{if} (!output\_bit\_depth \&\& single\_file \&\& !do\_md5) \{}
\DoxyCodeLine{953         output\_bit\_depth = img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}};}
\DoxyCodeLine{954       \}}
\DoxyCodeLine{955       \textcolor{comment}{// Shift up or down if necessary}}
\DoxyCodeLine{956       \textcolor{keywordflow}{if} (output\_bit\_depth != 0 \&\& output\_bit\_depth != img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}}) \{}
\DoxyCodeLine{957         \textcolor{keyword}{const} \mbox{\hyperlink{vpx__image_8h_ad491e9c858d337700cca18afc8412545}{vpx\_img\_fmt\_t}} shifted\_fmt =}
\DoxyCodeLine{958             output\_bit\_depth == 8}
\DoxyCodeLine{959                 ? img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \string^ (img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}})}
\DoxyCodeLine{960                 : img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} | \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}};}
\DoxyCodeLine{961         if (img\_shifted \&\&}
\DoxyCodeLine{962             img\_shifted\_realloc\_required(img, img\_shifted, shifted\_fmt)) \{}
\DoxyCodeLine{963           \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(img\_shifted);}
\DoxyCodeLine{964           img\_shifted = NULL;}
\DoxyCodeLine{965         \}}
\DoxyCodeLine{966         \textcolor{keywordflow}{if} (!img\_shifted) \{}
\DoxyCodeLine{967           img\_shifted =}
\DoxyCodeLine{968               \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(NULL, shifted\_fmt, img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, 16);}
\DoxyCodeLine{969           img\_shifted-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}} = output\_bit\_depth;}
\DoxyCodeLine{970         \}}
\DoxyCodeLine{971         \textcolor{keywordflow}{if} (output\_bit\_depth > img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}}) \{}
\DoxyCodeLine{972           vpx\_img\_upshift(img\_shifted, img, output\_bit\_depth -\/ img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}});}
\DoxyCodeLine{973         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{974           vpx\_img\_downshift(img\_shifted, img,}
\DoxyCodeLine{975                             img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}} -\/ output\_bit\_depth);}
\DoxyCodeLine{976         \}}
\DoxyCodeLine{977         img = img\_shifted;}
\DoxyCodeLine{978       \}}
\DoxyCodeLine{979 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{980 }
\DoxyCodeLine{981       \textcolor{keywordflow}{if} (single\_file) \{}
\DoxyCodeLine{982         \textcolor{keywordflow}{if} (use\_y4m) \{}
\DoxyCodeLine{983           \textcolor{keywordtype}{char} buf[Y4M\_BUFFER\_SIZE] = \{ 0 \};}
\DoxyCodeLine{984           \textcolor{keywordtype}{size\_t} len = 0;}
\DoxyCodeLine{985           \textcolor{keywordflow}{if} (img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} == \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193abd8236de582725101cc28e5df344adf0}{VPX\_IMG\_FMT\_I440}} || img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} == \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a2f62c84c87d447666f2f19ce5a54052e}{VPX\_IMG\_FMT\_I44016}}) \{}
\DoxyCodeLine{986             fprintf(stderr, \textcolor{stringliteral}{"{}Cannot produce y4m output for 440 sampling.\(\backslash\)n"{}});}
\DoxyCodeLine{987             \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{988           \}}
\DoxyCodeLine{989           \textcolor{keywordflow}{if} (frame\_out == 1) \{}
\DoxyCodeLine{990             \textcolor{comment}{// Y4M file header}}
\DoxyCodeLine{991             len = y4m\_write\_file\_header(}
\DoxyCodeLine{992                 buf, \textcolor{keyword}{sizeof}(buf), vpx\_input\_ctx.width, vpx\_input\_ctx.height,}
\DoxyCodeLine{993                 \&vpx\_input\_ctx.framerate, img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}}, img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}});}
\DoxyCodeLine{994             \textcolor{keywordflow}{if} (do\_md5) \{}
\DoxyCodeLine{995               MD5Update(\&md5\_ctx, (md5byte *)buf, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len);}
\DoxyCodeLine{996             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{997               fputs(buf, outfile);}
\DoxyCodeLine{998             \}}
\DoxyCodeLine{999           \}}
\DoxyCodeLine{1000 }
\DoxyCodeLine{1001           \textcolor{comment}{// Y4M frame header}}
\DoxyCodeLine{1002           len = y4m\_write\_frame\_header(buf, \textcolor{keyword}{sizeof}(buf));}
\DoxyCodeLine{1003           \textcolor{keywordflow}{if} (do\_md5) \{}
\DoxyCodeLine{1004             MD5Update(\&md5\_ctx, (md5byte *)buf, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len);}
\DoxyCodeLine{1005           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1006             fputs(buf, outfile);}
\DoxyCodeLine{1007           \}}
\DoxyCodeLine{1008         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1009           \textcolor{keywordflow}{if} (frame\_out == 1) \{}
\DoxyCodeLine{1010             \textcolor{comment}{// Check if -\/-\/yv12 or -\/-\/i420 options are consistent with the}}
\DoxyCodeLine{1011             \textcolor{comment}{// bit-\/stream decoded}}
\DoxyCodeLine{1012             \textcolor{keywordflow}{if} (opt\_i420) \{}
\DoxyCodeLine{1013               \textcolor{keywordflow}{if} (img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}} \&\&}
\DoxyCodeLine{1014                   img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}}) \{}
\DoxyCodeLine{1015                 fprintf(stderr, \textcolor{stringliteral}{"{}Cannot produce i420 output for bit-\/stream.\(\backslash\)n"{}});}
\DoxyCodeLine{1016                 \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{1017               \}}
\DoxyCodeLine{1018             \}}
\DoxyCodeLine{1019             \textcolor{keywordflow}{if} (opt\_yv12) \{}
\DoxyCodeLine{1020               \textcolor{keywordflow}{if} ((img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}} \&\&}
\DoxyCodeLine{1021                    img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a6e4e8961bbcf96478c300dc4c3e1dc18}{VPX\_IMG\_FMT\_YV12}}) ||}
\DoxyCodeLine{1022                   img-\/>\mbox{\hyperlink{structvpx__image_aac11754e8f8e4fb9e7b3a721ce8be0f1}{bit\_depth}} != 8) \{}
\DoxyCodeLine{1023                 fprintf(stderr, \textcolor{stringliteral}{"{}Cannot produce yv12 output for bit-\/stream.\(\backslash\)n"{}});}
\DoxyCodeLine{1024                 \textcolor{keywordflow}{goto} fail;}
\DoxyCodeLine{1025               \}}
\DoxyCodeLine{1026             \}}
\DoxyCodeLine{1027           \}}
\DoxyCodeLine{1028         \}}
\DoxyCodeLine{1029 }
\DoxyCodeLine{1030         \textcolor{keywordflow}{if} (do\_md5) \{}
\DoxyCodeLine{1031           update\_image\_md5(img, planes, \&md5\_ctx);}
\DoxyCodeLine{1032         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1033           \textcolor{keywordflow}{if} (!corrupted) write\_image\_file(img, planes, outfile);}
\DoxyCodeLine{1034         \}}
\DoxyCodeLine{1035       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1036         generate\_filename(outfile\_pattern, outfile\_name, PATH\_MAX, img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}},}
\DoxyCodeLine{1037                           img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, frame\_in);}
\DoxyCodeLine{1038         \textcolor{keywordflow}{if} (do\_md5) \{}
\DoxyCodeLine{1039           MD5Init(\&md5\_ctx);}
\DoxyCodeLine{1040           update\_image\_md5(img, planes, \&md5\_ctx);}
\DoxyCodeLine{1041           MD5Final(md5\_digest, \&md5\_ctx);}
\DoxyCodeLine{1042           print\_md5(md5\_digest, outfile\_name);}
\DoxyCodeLine{1043         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1044           outfile = open\_outfile(outfile\_name);}
\DoxyCodeLine{1045           write\_image\_file(img, planes, outfile);}
\DoxyCodeLine{1046           fclose(outfile);}
\DoxyCodeLine{1047         \}}
\DoxyCodeLine{1048       \}}
\DoxyCodeLine{1049     \}}
\DoxyCodeLine{1050   \}}
\DoxyCodeLine{1051 }
\DoxyCodeLine{1052   \textcolor{keywordflow}{if} (summary || progress) \{}
\DoxyCodeLine{1053     show\_progress(frame\_in, frame\_out, dx\_time);}
\DoxyCodeLine{1054     fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{1055   \}}
\DoxyCodeLine{1056 }
\DoxyCodeLine{1057   \textcolor{keywordflow}{if} (frames\_corrupted) \{}
\DoxyCodeLine{1058     fprintf(stderr, \textcolor{stringliteral}{"{}WARNING: \%d frames corrupted.\(\backslash\)n"{}}, frames\_corrupted);}
\DoxyCodeLine{1059   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1060     ret = EXIT\_SUCCESS;}
\DoxyCodeLine{1061   \}}
\DoxyCodeLine{1062 }
\DoxyCodeLine{1063 fail:}
\DoxyCodeLine{1064 }
\DoxyCodeLine{1065   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&decoder)) \{}
\DoxyCodeLine{1066     fprintf(stderr, \textcolor{stringliteral}{"{}Failed to destroy decoder: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{1067             \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(\&decoder));}
\DoxyCodeLine{1068   \}}
\DoxyCodeLine{1069 }
\DoxyCodeLine{1070 fail2:}
\DoxyCodeLine{1071 }
\DoxyCodeLine{1072   \textcolor{keywordflow}{if} (!noblit \&\& single\_file) \{}
\DoxyCodeLine{1073     \textcolor{keywordflow}{if} (do\_md5) \{}
\DoxyCodeLine{1074       MD5Final(md5\_digest, \&md5\_ctx);}
\DoxyCodeLine{1075       print\_md5(md5\_digest, outfile\_name);}
\DoxyCodeLine{1076     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1077       fclose(outfile);}
\DoxyCodeLine{1078     \}}
\DoxyCodeLine{1079   \}}
\DoxyCodeLine{1080 }
\DoxyCodeLine{1081 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{1082   \textcolor{keywordflow}{if} (input.vpx\_input\_ctx-\/>file\_type == FILE\_TYPE\_WEBM)}
\DoxyCodeLine{1083     webm\_free(input.webm\_ctx);}
\DoxyCodeLine{1084 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1085 }
\DoxyCodeLine{1086   \textcolor{keywordflow}{if} (input.vpx\_input\_ctx-\/>file\_type != FILE\_TYPE\_WEBM) free(buf);}
\DoxyCodeLine{1087 }
\DoxyCodeLine{1088   \textcolor{keywordflow}{if} (scaled\_img) \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(scaled\_img);}
\DoxyCodeLine{1089 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1090   \textcolor{keywordflow}{if} (img\_shifted) \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(img\_shifted);}
\DoxyCodeLine{1091 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1092 }
\DoxyCodeLine{1093   \textcolor{keywordflow}{for} (i = 0; i < ext\_fb\_list.num\_external\_frame\_buffers; ++i) \{}
\DoxyCodeLine{1094     free(ext\_fb\_list.ext\_fb[i].data);}
\DoxyCodeLine{1095   \}}
\DoxyCodeLine{1096   free(ext\_fb\_list.ext\_fb);}
\DoxyCodeLine{1097 }
\DoxyCodeLine{1098   fclose(infile);}
\DoxyCodeLine{1099   \textcolor{keywordflow}{if} (framestats\_file) fclose(framestats\_file);}
\DoxyCodeLine{1100 }
\DoxyCodeLine{1101   free(argv);}
\DoxyCodeLine{1102 }
\DoxyCodeLine{1103   \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1104 \}}
\DoxyCodeLine{1105 }
\DoxyCodeLine{1106 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv\_) \{}
\DoxyCodeLine{1107   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} loops = 1, i;}
\DoxyCodeLine{1108   \textcolor{keywordtype}{char} **argv, **argi, **argj;}
\DoxyCodeLine{1109   \textcolor{keyword}{struct }arg arg;}
\DoxyCodeLine{1110   \textcolor{keywordtype}{int} error = 0;}
\DoxyCodeLine{1111 }
\DoxyCodeLine{1112   argv = argv\_dup(argc -\/ 1, argv\_ + 1);}
\DoxyCodeLine{1113   \textcolor{keywordflow}{for} (argi = argj = argv; (*argj = *argi); argi += arg.argv\_step) \{}
\DoxyCodeLine{1114     memset(\&arg, 0, \textcolor{keyword}{sizeof}(arg));}
\DoxyCodeLine{1115     arg.argv\_step = 1;}
\DoxyCodeLine{1116 }
\DoxyCodeLine{1117     \textcolor{keywordflow}{if} (arg\_match(\&arg, \&looparg, argi)) \{}
\DoxyCodeLine{1118       loops = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1119       \textcolor{keywordflow}{break};}
\DoxyCodeLine{1120     \}}
\DoxyCodeLine{1121   \}}
\DoxyCodeLine{1122   free(argv);}
\DoxyCodeLine{1123   \textcolor{keywordflow}{for} (i = 0; !error \&\& i < loops; i++) error = main\_loop(argc, argv\_);}
\DoxyCodeLine{1124   \textcolor{keywordflow}{return} error;}
\DoxyCodeLine{1125 \}}

\end{DoxyCodeInclude}
 \hypertarget{example_vpxenc}{}\doxysubsection{vpxenc}\label{example_vpxenc}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Use of this source code is governed by a BSD-\/style license}}
\DoxyCodeLine{5 \textcolor{comment}{ *  that can be found in the LICENSE file in the root of the source}}
\DoxyCodeLine{6 \textcolor{comment}{ *  tree. An additional intellectual property rights grant can be found}}
\DoxyCodeLine{7 \textcolor{comment}{ *  in the file PATENTS.  All contributing project authors may}}
\DoxyCodeLine{8 \textcolor{comment}{ *  be found in the AUTHORS file in the root of the source tree.}}
\DoxyCodeLine{9 \textcolor{comment}{ */}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}./vpxenc.h"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}./vpx\_config.h"{}}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <limits.h>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#if CONFIG\_LIBYUV}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}third\_party/libyuv/include/libyuv/scale.h"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__encoder_8h}{vpx/vpx\_encoder.h}}"{}}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#if CONFIG\_DECODERS}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vpx__decoder_8h}{vpx/vpx\_decoder.h}}"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include "{}./args.h"{}}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include "{}./ivfenc.h"{}}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include "{}./tools\_common.h"{}}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{preprocessor}{\#if CONFIG\_VP8\_ENCODER || CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8cx_8h}{vpx/vp8cx.h}}"{}}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#if CONFIG\_VP8\_DECODER || CONFIG\_VP9\_DECODER}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vp8dx_8h}{vpx/vp8dx.h}}"{}}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include "{}vpx/vpx\_integer.h"{}}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#include "{}vpx\_ports/mem\_ops.h"{}}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#include "{}vpx\_ports/vpx\_timer.h"{}}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#include "{}./rate\_hist.h"{}}}
\DoxyCodeLine{46 \textcolor{preprocessor}{\#include "{}./vpxstats.h"{}}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#include "{}./warnings.h"{}}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include "{}./webmenc.h"{}}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#include "{}./y4minput.h"{}}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} wrap\_fwrite(\textcolor{keyword}{const} \textcolor{keywordtype}{void} *ptr, \textcolor{keywordtype}{size\_t} size, \textcolor{keywordtype}{size\_t} nmemb,}
\DoxyCodeLine{54                           FILE *stream) \{}
\DoxyCodeLine{55   \textcolor{keywordflow}{return} fwrite(ptr, size, nmemb, stream);}
\DoxyCodeLine{56 \}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#define fwrite wrap\_fwrite}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *exec\_name;}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keyword}{static} VPX\_TOOLS\_FORMAT\_PRINTF(3, 0) void warn\_or\_exit\_on\_errorv(}
\DoxyCodeLine{62     \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *ctx, \textcolor{keywordtype}{int} fatal, const \textcolor{keywordtype}{char} *s, va\_list ap) \{}
\DoxyCodeLine{63   \textcolor{keywordflow}{if} (ctx-\/>err) \{}
\DoxyCodeLine{64     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *detail = \mbox{\hyperlink{group__codec_ga68a900e49d568c5c39b6a53e25b5d4a8}{vpx\_codec\_error\_detail}}(ctx);}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     vfprintf(stderr, s, ap);}
\DoxyCodeLine{67     fprintf(stderr, \textcolor{stringliteral}{"{}: \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_gaea707e8aaeb2badbf40f1c1dc32462b4}{vpx\_codec\_error}}(ctx));}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \textcolor{keywordflow}{if} (detail) fprintf(stderr, \textcolor{stringliteral}{"{}    \%s\(\backslash\)n"{}}, detail);}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \textcolor{keywordflow}{if} (fatal) exit(EXIT\_FAILURE);}
\DoxyCodeLine{72   \}}
\DoxyCodeLine{73 \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{keyword}{static} VPX\_TOOLS\_FORMAT\_PRINTF(2,}
\DoxyCodeLine{76                                3) void ctx\_exit\_on\_error(\mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *ctx,}
\DoxyCodeLine{77                                                          const \textcolor{keywordtype}{char} *s, ...) \{}
\DoxyCodeLine{78   va\_list ap;}
\DoxyCodeLine{79 }
\DoxyCodeLine{80   va\_start(ap, s);}
\DoxyCodeLine{81   warn\_or\_exit\_on\_errorv(ctx, 1, s, ap);}
\DoxyCodeLine{82   va\_end(ap);}
\DoxyCodeLine{83 \}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 \textcolor{keyword}{static} VPX\_TOOLS\_FORMAT\_PRINTF(3, 4) void warn\_or\_exit\_on\_error(}
\DoxyCodeLine{86     \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} *ctx, \textcolor{keywordtype}{int} fatal, const \textcolor{keywordtype}{char} *s, ...) \{}
\DoxyCodeLine{87   va\_list ap;}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   va\_start(ap, s);}
\DoxyCodeLine{90   warn\_or\_exit\_on\_errorv(ctx, fatal, s, ap);}
\DoxyCodeLine{91   va\_end(ap);}
\DoxyCodeLine{92 \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t help =}
\DoxyCodeLine{95     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}help"{}}, 0, \textcolor{stringliteral}{"{}Show usage options and exit"{}});}
\DoxyCodeLine{96 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t debugmode =}
\DoxyCodeLine{97     ARG\_DEF(\textcolor{stringliteral}{"{}D"{}}, \textcolor{stringliteral}{"{}debug"{}}, 0, \textcolor{stringliteral}{"{}Debug mode (makes output deterministic)"{}});}
\DoxyCodeLine{98 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t outputfile =}
\DoxyCodeLine{99     ARG\_DEF(\textcolor{stringliteral}{"{}o"{}}, \textcolor{stringliteral}{"{}output"{}}, 1, \textcolor{stringliteral}{"{}Output filename"{}});}
\DoxyCodeLine{100 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_nv12 =}
\DoxyCodeLine{101     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}nv12"{}}, 0, \textcolor{stringliteral}{"{}Input file is NV12 "{}});}
\DoxyCodeLine{102 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_yv12 =}
\DoxyCodeLine{103     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}yv12"{}}, 0, \textcolor{stringliteral}{"{}Input file is YV12 "{}});}
\DoxyCodeLine{104 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_i420 =}
\DoxyCodeLine{105     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}i420"{}}, 0, \textcolor{stringliteral}{"{}Input file is I420 (default)"{}});}
\DoxyCodeLine{106 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_i422 =}
\DoxyCodeLine{107     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}i422"{}}, 0, \textcolor{stringliteral}{"{}Input file is I422"{}});}
\DoxyCodeLine{108 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_i444 =}
\DoxyCodeLine{109     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}i444"{}}, 0, \textcolor{stringliteral}{"{}Input file is I444"{}});}
\DoxyCodeLine{110 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_i440 =}
\DoxyCodeLine{111     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}i440"{}}, 0, \textcolor{stringliteral}{"{}Input file is I440"{}});}
\DoxyCodeLine{112 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t codecarg = ARG\_DEF(NULL, \textcolor{stringliteral}{"{}codec"{}}, 1, \textcolor{stringliteral}{"{}Codec to use"{}});}
\DoxyCodeLine{113 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t passes =}
\DoxyCodeLine{114     ARG\_DEF(\textcolor{stringliteral}{"{}p"{}}, \textcolor{stringliteral}{"{}passes"{}}, 1, \textcolor{stringliteral}{"{}Number of passes (1/2)"{}});}
\DoxyCodeLine{115 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t pass\_arg =}
\DoxyCodeLine{116     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}pass"{}}, 1, \textcolor{stringliteral}{"{}Pass to execute (1/2)"{}});}
\DoxyCodeLine{117 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t fpf\_name =}
\DoxyCodeLine{118     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}fpf"{}}, 1, \textcolor{stringliteral}{"{}First pass statistics file name"{}});}
\DoxyCodeLine{119 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t limit =}
\DoxyCodeLine{120     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}limit"{}}, 1, \textcolor{stringliteral}{"{}Stop encoding after n input frames"{}});}
\DoxyCodeLine{121 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t skip =}
\DoxyCodeLine{122     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}skip"{}}, 1, \textcolor{stringliteral}{"{}Skip the first n input frames"{}});}
\DoxyCodeLine{123 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t deadline =}
\DoxyCodeLine{124     ARG\_DEF(\textcolor{stringliteral}{"{}d"{}}, \textcolor{stringliteral}{"{}deadline"{}}, 1, \textcolor{stringliteral}{"{}Deadline per frame (usec)"{}});}
\DoxyCodeLine{125 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t best\_dl =}
\DoxyCodeLine{126     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}best"{}}, 0, \textcolor{stringliteral}{"{}Use Best Quality Deadline"{}});}
\DoxyCodeLine{127 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t good\_dl =}
\DoxyCodeLine{128     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}good"{}}, 0, \textcolor{stringliteral}{"{}Use Good Quality Deadline"{}});}
\DoxyCodeLine{129 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rt\_dl =}
\DoxyCodeLine{130     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}rt"{}}, 0, \textcolor{stringliteral}{"{}Use Realtime Quality Deadline"{}});}
\DoxyCodeLine{131 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t quietarg =}
\DoxyCodeLine{132     ARG\_DEF(\textcolor{stringliteral}{"{}q"{}}, \textcolor{stringliteral}{"{}quiet"{}}, 0, \textcolor{stringliteral}{"{}Do not print encode progress"{}});}
\DoxyCodeLine{133 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t verbosearg =}
\DoxyCodeLine{134     ARG\_DEF(\textcolor{stringliteral}{"{}v"{}}, \textcolor{stringliteral}{"{}verbose"{}}, 0, \textcolor{stringliteral}{"{}Show encoder parameters"{}});}
\DoxyCodeLine{135 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t psnrarg =}
\DoxyCodeLine{136     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}psnr"{}}, 0, \textcolor{stringliteral}{"{}Show PSNR in status line"{}});}
\DoxyCodeLine{137 }
\DoxyCodeLine{138 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list test\_decode\_enum[] = \{}
\DoxyCodeLine{139   \{ \textcolor{stringliteral}{"{}off"{}}, TEST\_DECODE\_OFF \},}
\DoxyCodeLine{140   \{ \textcolor{stringliteral}{"{}fatal"{}}, TEST\_DECODE\_FATAL \},}
\DoxyCodeLine{141   \{ \textcolor{stringliteral}{"{}warn"{}}, TEST\_DECODE\_WARN \},}
\DoxyCodeLine{142   \{ NULL, 0 \}}
\DoxyCodeLine{143 \};}
\DoxyCodeLine{144 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t recontest = ARG\_DEF\_ENUM(}
\DoxyCodeLine{145     NULL, \textcolor{stringliteral}{"{}test-\/decode"{}}, 1, \textcolor{stringliteral}{"{}Test encode/decode mismatch"{}}, test\_decode\_enum);}
\DoxyCodeLine{146 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t framerate =}
\DoxyCodeLine{147     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}fps"{}}, 1, \textcolor{stringliteral}{"{}Stream frame rate (rate/scale)"{}});}
\DoxyCodeLine{148 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_webm =}
\DoxyCodeLine{149     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}webm"{}}, 0, \textcolor{stringliteral}{"{}Output WebM (default when WebM IO is enabled)"{}});}
\DoxyCodeLine{150 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_ivf = ARG\_DEF(NULL, \textcolor{stringliteral}{"{}ivf"{}}, 0, \textcolor{stringliteral}{"{}Output IVF"{}});}
\DoxyCodeLine{151 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t out\_part =}
\DoxyCodeLine{152     ARG\_DEF(\textcolor{stringliteral}{"{}P"{}}, \textcolor{stringliteral}{"{}output-\/partitions"{}}, 0,}
\DoxyCodeLine{153             \textcolor{stringliteral}{"{}Makes encoder output partitions. Requires IVF output!"{}});}
\DoxyCodeLine{154 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t q\_hist\_n =}
\DoxyCodeLine{155     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}q-\/hist"{}}, 1, \textcolor{stringliteral}{"{}Show quantizer histogram (n-\/buckets)"{}});}
\DoxyCodeLine{156 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rate\_hist\_n =}
\DoxyCodeLine{157     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}rate-\/hist"{}}, 1, \textcolor{stringliteral}{"{}Show rate histogram (n-\/buckets)"{}});}
\DoxyCodeLine{158 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t disable\_warnings =}
\DoxyCodeLine{159     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}disable-\/warnings"{}}, 0,}
\DoxyCodeLine{160             \textcolor{stringliteral}{"{}Disable warnings about potentially incorrect encode settings."{}});}
\DoxyCodeLine{161 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t disable\_warning\_prompt =}
\DoxyCodeLine{162     ARG\_DEF(\textcolor{stringliteral}{"{}y"{}}, \textcolor{stringliteral}{"{}disable-\/warning-\/prompt"{}}, 0,}
\DoxyCodeLine{163             \textcolor{stringliteral}{"{}Display warnings, but do not prompt user to continue."{}});}
\DoxyCodeLine{164 }
\DoxyCodeLine{165 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{166 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t test16bitinternalarg = ARG\_DEF(}
\DoxyCodeLine{167     NULL, \textcolor{stringliteral}{"{}test-\/16bit-\/internal"{}}, 0, \textcolor{stringliteral}{"{}Force use of 16 bit internal buffer"{}});}
\DoxyCodeLine{168 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *main\_args[] = \{ \&help,}
\DoxyCodeLine{171                                         \&debugmode,}
\DoxyCodeLine{172                                         \&outputfile,}
\DoxyCodeLine{173                                         \&codecarg,}
\DoxyCodeLine{174                                         \&passes,}
\DoxyCodeLine{175                                         \&pass\_arg,}
\DoxyCodeLine{176                                         \&fpf\_name,}
\DoxyCodeLine{177                                         \&limit,}
\DoxyCodeLine{178                                         \&skip,}
\DoxyCodeLine{179                                         \&deadline,}
\DoxyCodeLine{180                                         \&best\_dl,}
\DoxyCodeLine{181                                         \&good\_dl,}
\DoxyCodeLine{182                                         \&rt\_dl,}
\DoxyCodeLine{183                                         \&quietarg,}
\DoxyCodeLine{184                                         \&verbosearg,}
\DoxyCodeLine{185                                         \&psnrarg,}
\DoxyCodeLine{186                                         \&use\_webm,}
\DoxyCodeLine{187                                         \&use\_ivf,}
\DoxyCodeLine{188                                         \&out\_part,}
\DoxyCodeLine{189                                         \&q\_hist\_n,}
\DoxyCodeLine{190                                         \&rate\_hist\_n,}
\DoxyCodeLine{191                                         \&disable\_warnings,}
\DoxyCodeLine{192                                         \&disable\_warning\_prompt,}
\DoxyCodeLine{193                                         \&recontest,}
\DoxyCodeLine{194                                         NULL \};}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t usage =}
\DoxyCodeLine{197     ARG\_DEF(\textcolor{stringliteral}{"{}u"{}}, \textcolor{stringliteral}{"{}usage"{}}, 1, \textcolor{stringliteral}{"{}Usage profile number to use"{}});}
\DoxyCodeLine{198 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t threads =}
\DoxyCodeLine{199     ARG\_DEF(\textcolor{stringliteral}{"{}t"{}}, \textcolor{stringliteral}{"{}threads"{}}, 1, \textcolor{stringliteral}{"{}Max number of threads to use"{}});}
\DoxyCodeLine{200 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t profile =}
\DoxyCodeLine{201     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}profile"{}}, 1, \textcolor{stringliteral}{"{}Bitstream profile number to use"{}});}
\DoxyCodeLine{202 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t width = ARG\_DEF(\textcolor{stringliteral}{"{}w"{}}, \textcolor{stringliteral}{"{}width"{}}, 1, \textcolor{stringliteral}{"{}Frame width"{}});}
\DoxyCodeLine{203 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t height = ARG\_DEF(\textcolor{stringliteral}{"{}h"{}}, \textcolor{stringliteral}{"{}height"{}}, 1, \textcolor{stringliteral}{"{}Frame height"{}});}
\DoxyCodeLine{204 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{205 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list stereo\_mode\_enum[] = \{}
\DoxyCodeLine{206   \{ \textcolor{stringliteral}{"{}mono"{}}, STEREO\_FORMAT\_MONO \},}
\DoxyCodeLine{207   \{ \textcolor{stringliteral}{"{}left-\/right"{}}, STEREO\_FORMAT\_LEFT\_RIGHT \},}
\DoxyCodeLine{208   \{ \textcolor{stringliteral}{"{}bottom-\/top"{}}, STEREO\_FORMAT\_BOTTOM\_TOP \},}
\DoxyCodeLine{209   \{ \textcolor{stringliteral}{"{}top-\/bottom"{}}, STEREO\_FORMAT\_TOP\_BOTTOM \},}
\DoxyCodeLine{210   \{ \textcolor{stringliteral}{"{}right-\/left"{}}, STEREO\_FORMAT\_RIGHT\_LEFT \},}
\DoxyCodeLine{211   \{ NULL, 0 \}}
\DoxyCodeLine{212 \};}
\DoxyCodeLine{213 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t stereo\_mode = ARG\_DEF\_ENUM(}
\DoxyCodeLine{214     NULL, \textcolor{stringliteral}{"{}stereo-\/mode"{}}, 1, \textcolor{stringliteral}{"{}Stereo 3D video format"{}}, stereo\_mode\_enum);}
\DoxyCodeLine{215 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{216 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t timebase = ARG\_DEF(}
\DoxyCodeLine{217     NULL, \textcolor{stringliteral}{"{}timebase"{}}, 1, \textcolor{stringliteral}{"{}Output timestamp precision (fractional seconds)"{}});}
\DoxyCodeLine{218 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t error\_resilient =}
\DoxyCodeLine{219     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}error-\/resilient"{}}, 1, \textcolor{stringliteral}{"{}Enable error resiliency features"{}});}
\DoxyCodeLine{220 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t lag\_in\_frames =}
\DoxyCodeLine{221     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}lag-\/in-\/frames"{}}, 1, \textcolor{stringliteral}{"{}Max number of frames to lag"{}});}
\DoxyCodeLine{222 }
\DoxyCodeLine{223 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *global\_args[] = \{ \&use\_nv12,}
\DoxyCodeLine{224                                           \&use\_yv12,}
\DoxyCodeLine{225                                           \&use\_i420,}
\DoxyCodeLine{226                                           \&use\_i422,}
\DoxyCodeLine{227                                           \&use\_i444,}
\DoxyCodeLine{228                                           \&use\_i440,}
\DoxyCodeLine{229                                           \&usage,}
\DoxyCodeLine{230                                           \&threads,}
\DoxyCodeLine{231                                           \&profile,}
\DoxyCodeLine{232                                           \&width,}
\DoxyCodeLine{233                                           \&height,}
\DoxyCodeLine{234 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{235                                           \&stereo\_mode,}
\DoxyCodeLine{236 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{237                                           \&timebase,}
\DoxyCodeLine{238                                           \&framerate,}
\DoxyCodeLine{239                                           \&error\_resilient,}
\DoxyCodeLine{240 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{241                                           \&test16bitinternalarg,}
\DoxyCodeLine{242 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{243                                           \&lag\_in\_frames,}
\DoxyCodeLine{244                                           NULL \};}
\DoxyCodeLine{245 }
\DoxyCodeLine{246 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t dropframe\_thresh =}
\DoxyCodeLine{247     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}drop-\/frame"{}}, 1, \textcolor{stringliteral}{"{}Temporal resampling threshold (buf \%)"{}});}
\DoxyCodeLine{248 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t resize\_allowed =}
\DoxyCodeLine{249     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}resize-\/allowed"{}}, 1, \textcolor{stringliteral}{"{}Spatial resampling enabled (bool)"{}});}
\DoxyCodeLine{250 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t resize\_width =}
\DoxyCodeLine{251     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}resize-\/width"{}}, 1, \textcolor{stringliteral}{"{}Width of encoded frame"{}});}
\DoxyCodeLine{252 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t resize\_height =}
\DoxyCodeLine{253     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}resize-\/height"{}}, 1, \textcolor{stringliteral}{"{}Height of encoded frame"{}});}
\DoxyCodeLine{254 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t resize\_up\_thresh =}
\DoxyCodeLine{255     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}resize-\/up"{}}, 1, \textcolor{stringliteral}{"{}Upscale threshold (buf \%)"{}});}
\DoxyCodeLine{256 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t resize\_down\_thresh =}
\DoxyCodeLine{257     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}resize-\/down"{}}, 1, \textcolor{stringliteral}{"{}Downscale threshold (buf \%)"{}});}
\DoxyCodeLine{258 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list end\_usage\_enum[] = \{ \{ \textcolor{stringliteral}{"{}vbr"{}}, \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2ab8fbe4441ed3f31a167c8194e8a64f87}{VPX\_VBR}} \},}
\DoxyCodeLine{259                                                        \{ \textcolor{stringliteral}{"{}cbr"{}}, \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2a8b02853cb35790d60cc171a11f6c268a}{VPX\_CBR}} \},}
\DoxyCodeLine{260                                                        \{ \textcolor{stringliteral}{"{}cq"{}}, \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2a5f2fd02b55c67d62bfd79380bcb03f63}{VPX\_CQ}} \},}
\DoxyCodeLine{261                                                        \{ \textcolor{stringliteral}{"{}q"{}}, \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2a5ebb5564dc5e8ec99d3c6221d89b8858}{VPX\_Q}} \},}
\DoxyCodeLine{262                                                        \{ NULL, 0 \} \};}
\DoxyCodeLine{263 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t end\_usage =}
\DoxyCodeLine{264     ARG\_DEF\_ENUM(NULL, \textcolor{stringliteral}{"{}end-\/usage"{}}, 1, \textcolor{stringliteral}{"{}Rate control mode"{}}, end\_usage\_enum);}
\DoxyCodeLine{265 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t target\_bitrate =}
\DoxyCodeLine{266     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}target-\/bitrate"{}}, 1, \textcolor{stringliteral}{"{}Bitrate (kbps)"{}});}
\DoxyCodeLine{267 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t min\_quantizer =}
\DoxyCodeLine{268     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}min-\/q"{}}, 1, \textcolor{stringliteral}{"{}Minimum (best) quantizer"{}});}
\DoxyCodeLine{269 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t max\_quantizer =}
\DoxyCodeLine{270     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}max-\/q"{}}, 1, \textcolor{stringliteral}{"{}Maximum (worst) quantizer"{}});}
\DoxyCodeLine{271 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t undershoot\_pct =}
\DoxyCodeLine{272     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}undershoot-\/pct"{}}, 1, \textcolor{stringliteral}{"{}Datarate undershoot (min) target (\%)"{}});}
\DoxyCodeLine{273 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t overshoot\_pct =}
\DoxyCodeLine{274     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}overshoot-\/pct"{}}, 1, \textcolor{stringliteral}{"{}Datarate overshoot (max) target (\%)"{}});}
\DoxyCodeLine{275 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t buf\_sz =}
\DoxyCodeLine{276     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}buf-\/sz"{}}, 1, \textcolor{stringliteral}{"{}Client buffer size (ms)"{}});}
\DoxyCodeLine{277 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t buf\_initial\_sz =}
\DoxyCodeLine{278     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}buf-\/initial-\/sz"{}}, 1, \textcolor{stringliteral}{"{}Client initial buffer size (ms)"{}});}
\DoxyCodeLine{279 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t buf\_optimal\_sz =}
\DoxyCodeLine{280     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}buf-\/optimal-\/sz"{}}, 1, \textcolor{stringliteral}{"{}Client optimal buffer size (ms)"{}});}
\DoxyCodeLine{281 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *rc\_args[] = \{}
\DoxyCodeLine{282   \&dropframe\_thresh, \&resize\_allowed,     \&resize\_width,   \&resize\_height,}
\DoxyCodeLine{283   \&resize\_up\_thresh, \&resize\_down\_thresh, \&end\_usage,      \&target\_bitrate,}
\DoxyCodeLine{284   \&min\_quantizer,    \&max\_quantizer,      \&undershoot\_pct, \&overshoot\_pct,}
\DoxyCodeLine{285   \&buf\_sz,           \&buf\_initial\_sz,     \&buf\_optimal\_sz, NULL}
\DoxyCodeLine{286 \};}
\DoxyCodeLine{287 }
\DoxyCodeLine{288 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{289 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t use\_vizier\_rc\_params =}
\DoxyCodeLine{290     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}use-\/vizier-\/rc-\/params"{}}, 1, \textcolor{stringliteral}{"{}Use vizier rc params"{}});}
\DoxyCodeLine{291 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t active\_wq\_factor =}
\DoxyCodeLine{292     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}active-\/wq-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Active worst quality factor"{}});}
\DoxyCodeLine{293 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t err\_per\_mb\_factor =}
\DoxyCodeLine{294     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}err-\/per-\/mb-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Error per macroblock factor"{}});}
\DoxyCodeLine{295 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t sr\_default\_decay\_limit = ARG\_DEF(}
\DoxyCodeLine{296     NULL, \textcolor{stringliteral}{"{}sr-\/default-\/decay-\/limit"{}}, 1, \textcolor{stringliteral}{"{}Second reference default decay limit"{}});}
\DoxyCodeLine{297 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t sr\_diff\_factor =}
\DoxyCodeLine{298     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}sr-\/diff-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Second reference diff factor"{}});}
\DoxyCodeLine{299 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_err\_per\_mb\_factor = ARG\_DEF(}
\DoxyCodeLine{300     NULL, \textcolor{stringliteral}{"{}kf-\/err-\/per-\/mb-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Keyframe error per macroblock factor"{}});}
\DoxyCodeLine{301 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_frame\_min\_boost\_factor =}
\DoxyCodeLine{302     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}kf-\/frame-\/min-\/boost-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Keyframe min boost"{}});}
\DoxyCodeLine{303 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_frame\_max\_boost\_first\_factor =}
\DoxyCodeLine{304     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}kf-\/frame-\/max-\/boost-\/first-\/factor"{}}, 1,}
\DoxyCodeLine{305             \textcolor{stringliteral}{"{}Max keyframe boost adjustment factor for first frame"{}});}
\DoxyCodeLine{306 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_frame\_max\_boost\_subs\_factor =}
\DoxyCodeLine{307     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}kf-\/frame-\/max-\/boost-\/subs-\/factor"{}}, 1,}
\DoxyCodeLine{308             \textcolor{stringliteral}{"{}Max boost adjustment factor for subsequent KFs"{}});}
\DoxyCodeLine{309 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_max\_total\_boost\_factor = ARG\_DEF(}
\DoxyCodeLine{310     NULL, \textcolor{stringliteral}{"{}kf-\/max-\/total-\/boost-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Keyframe max total boost factor"{}});}
\DoxyCodeLine{311 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t gf\_max\_total\_boost\_factor =}
\DoxyCodeLine{312     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}gf-\/max-\/total-\/boost-\/factor"{}}, 1,}
\DoxyCodeLine{313             \textcolor{stringliteral}{"{}Golden frame max total boost factor"{}});}
\DoxyCodeLine{314 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t gf\_frame\_max\_boost\_factor =}
\DoxyCodeLine{315     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}gf-\/frame-\/max-\/boost-\/factor"{}}, 1,}
\DoxyCodeLine{316             \textcolor{stringliteral}{"{}Golden frame max per frame boost factor"{}});}
\DoxyCodeLine{317 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t zm\_factor =}
\DoxyCodeLine{318     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}zm-\/factor"{}}, 1, \textcolor{stringliteral}{"{}Zero motion power factor"{}});}
\DoxyCodeLine{319 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rd\_mult\_inter\_qp\_fac =}
\DoxyCodeLine{320     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}rd-\/mult-\/inter-\/qp-\/fac"{}}, 1,}
\DoxyCodeLine{321             \textcolor{stringliteral}{"{}RD multiplier adjustment for inter frames"{}});}
\DoxyCodeLine{322 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rd\_mult\_arf\_qp\_fac =}
\DoxyCodeLine{323     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}rd-\/mult-\/arf-\/qp-\/fac"{}}, 1,}
\DoxyCodeLine{324             \textcolor{stringliteral}{"{}RD multiplier adjustment for alt-\/ref frames"{}});}
\DoxyCodeLine{325 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t rd\_mult\_key\_qp\_fac = ARG\_DEF(}
\DoxyCodeLine{326     NULL, \textcolor{stringliteral}{"{}rd-\/mult-\/key-\/qp-\/fac"{}}, 1, \textcolor{stringliteral}{"{}RD multiplier adjustment for key frames"{}});}
\DoxyCodeLine{327 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *vizier\_rc\_args[] = \{ \&use\_vizier\_rc\_params,}
\DoxyCodeLine{328                                              \&active\_wq\_factor,}
\DoxyCodeLine{329                                              \&err\_per\_mb\_factor,}
\DoxyCodeLine{330                                              \&sr\_default\_decay\_limit,}
\DoxyCodeLine{331                                              \&sr\_diff\_factor,}
\DoxyCodeLine{332                                              \&kf\_err\_per\_mb\_factor,}
\DoxyCodeLine{333                                              \&kf\_frame\_min\_boost\_factor,}
\DoxyCodeLine{334                                              \&kf\_frame\_max\_boost\_first\_factor,}
\DoxyCodeLine{335                                              \&kf\_frame\_max\_boost\_subs\_factor,}
\DoxyCodeLine{336                                              \&kf\_max\_total\_boost\_factor,}
\DoxyCodeLine{337                                              \&gf\_max\_total\_boost\_factor,}
\DoxyCodeLine{338                                              \&gf\_frame\_max\_boost\_factor,}
\DoxyCodeLine{339                                              \&zm\_factor,}
\DoxyCodeLine{340                                              \&rd\_mult\_inter\_qp\_fac,}
\DoxyCodeLine{341                                              \&rd\_mult\_arf\_qp\_fac,}
\DoxyCodeLine{342                                              \&rd\_mult\_key\_qp\_fac,}
\DoxyCodeLine{343                                              NULL \};}
\DoxyCodeLine{344 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{345 }
\DoxyCodeLine{346 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t bias\_pct =}
\DoxyCodeLine{347     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}bias-\/pct"{}}, 1, \textcolor{stringliteral}{"{}CBR/VBR bias (0=CBR, 100=VBR)"{}});}
\DoxyCodeLine{348 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t minsection\_pct =}
\DoxyCodeLine{349     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}minsection-\/pct"{}}, 1, \textcolor{stringliteral}{"{}GOP min bitrate (\% of target)"{}});}
\DoxyCodeLine{350 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t maxsection\_pct =}
\DoxyCodeLine{351     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}maxsection-\/pct"{}}, 1, \textcolor{stringliteral}{"{}GOP max bitrate (\% of target)"{}});}
\DoxyCodeLine{352 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t corpus\_complexity =}
\DoxyCodeLine{353     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}corpus-\/complexity"{}}, 1, \textcolor{stringliteral}{"{}corpus vbr complexity midpoint"{}});}
\DoxyCodeLine{354 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *rc\_twopass\_args[] = \{ \&bias\_pct, \&minsection\_pct,}
\DoxyCodeLine{355                                               \&maxsection\_pct,}
\DoxyCodeLine{356                                               \&corpus\_complexity, NULL \};}
\DoxyCodeLine{357 }
\DoxyCodeLine{358 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_min\_dist =}
\DoxyCodeLine{359     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}kf-\/min-\/dist"{}}, 1, \textcolor{stringliteral}{"{}Minimum keyframe interval (frames)"{}});}
\DoxyCodeLine{360 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_max\_dist =}
\DoxyCodeLine{361     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}kf-\/max-\/dist"{}}, 1, \textcolor{stringliteral}{"{}Maximum keyframe interval (frames)"{}});}
\DoxyCodeLine{362 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t kf\_disabled =}
\DoxyCodeLine{363     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}disable-\/kf"{}}, 0, \textcolor{stringliteral}{"{}Disable keyframe placement"{}});}
\DoxyCodeLine{364 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *kf\_args[] = \{ \&kf\_min\_dist, \&kf\_max\_dist, \&kf\_disabled,}
\DoxyCodeLine{365                                       NULL \};}
\DoxyCodeLine{366 }
\DoxyCodeLine{367 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t noise\_sens =}
\DoxyCodeLine{368     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}noise-\/sensitivity"{}}, 1, \textcolor{stringliteral}{"{}Noise sensitivity (frames to blur)"{}});}
\DoxyCodeLine{369 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t sharpness =}
\DoxyCodeLine{370     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}sharpness"{}}, 1,}
\DoxyCodeLine{371             \textcolor{stringliteral}{"{}Increase sharpness at the expense of lower PSNR. (0..7)"{}});}
\DoxyCodeLine{372 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t static\_thresh =}
\DoxyCodeLine{373     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}static-\/thresh"{}}, 1, \textcolor{stringliteral}{"{}Motion detection threshold"{}});}
\DoxyCodeLine{374 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t arnr\_maxframes =}
\DoxyCodeLine{375     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}arnr-\/maxframes"{}}, 1, \textcolor{stringliteral}{"{}AltRef max frames (0..15)"{}});}
\DoxyCodeLine{376 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t arnr\_strength =}
\DoxyCodeLine{377     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}arnr-\/strength"{}}, 1, \textcolor{stringliteral}{"{}AltRef filter strength (0..6)"{}});}
\DoxyCodeLine{378 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t arnr\_type =}
\DoxyCodeLine{379     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}arnr-\/type"{}}, 1, \textcolor{stringliteral}{"{}AltRef filter type (1..3)"{}});}
\DoxyCodeLine{380 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list tuning\_enum[] = \{ \{ \textcolor{stringliteral}{"{}psnr"{}}, VP8\_TUNE\_PSNR \},}
\DoxyCodeLine{381                                                     \{ \textcolor{stringliteral}{"{}ssim"{}}, VP8\_TUNE\_SSIM \},}
\DoxyCodeLine{382                                                     \{ NULL, 0 \} \};}
\DoxyCodeLine{383 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t tune\_ssim =}
\DoxyCodeLine{384     ARG\_DEF\_ENUM(NULL, \textcolor{stringliteral}{"{}tune"{}}, 1, \textcolor{stringliteral}{"{}Material to favor"{}}, tuning\_enum);}
\DoxyCodeLine{385 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t cq\_level =}
\DoxyCodeLine{386     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}cq-\/level"{}}, 1, \textcolor{stringliteral}{"{}Constant/Constrained Quality level"{}});}
\DoxyCodeLine{387 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t max\_intra\_rate\_pct =}
\DoxyCodeLine{388     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}max-\/intra-\/rate"{}}, 1, \textcolor{stringliteral}{"{}Max I-\/frame bitrate (pct)"{}});}
\DoxyCodeLine{389 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t gf\_cbr\_boost\_pct = ARG\_DEF(}
\DoxyCodeLine{390     NULL, \textcolor{stringliteral}{"{}gf-\/cbr-\/boost"{}}, 1, \textcolor{stringliteral}{"{}Boost for Golden Frame in CBR mode (pct)"{}});}
\DoxyCodeLine{391 }
\DoxyCodeLine{392 \textcolor{preprocessor}{\#if CONFIG\_VP8\_ENCODER}}
\DoxyCodeLine{393 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t cpu\_used\_vp8 =}
\DoxyCodeLine{394     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}cpu-\/used"{}}, 1, \textcolor{stringliteral}{"{}CPU Used (-\/16..16)"{}});}
\DoxyCodeLine{395 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t auto\_altref\_vp8 = ARG\_DEF(}
\DoxyCodeLine{396     NULL, \textcolor{stringliteral}{"{}auto-\/alt-\/ref"{}}, 1, \textcolor{stringliteral}{"{}Enable automatic alt reference frames. (0..1)"{}});}
\DoxyCodeLine{397 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t token\_parts =}
\DoxyCodeLine{398     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}token-\/parts"{}}, 1, \textcolor{stringliteral}{"{}Number of token partitions to use, log2"{}});}
\DoxyCodeLine{399 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t screen\_content\_mode =}
\DoxyCodeLine{400     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}screen-\/content-\/mode"{}}, 1, \textcolor{stringliteral}{"{}Screen content mode"{}});}
\DoxyCodeLine{401 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *vp8\_args[] = \{ \&cpu\_used\_vp8,}
\DoxyCodeLine{402                                        \&auto\_altref\_vp8,}
\DoxyCodeLine{403                                        \&noise\_sens,}
\DoxyCodeLine{404                                        \&sharpness,}
\DoxyCodeLine{405                                        \&static\_thresh,}
\DoxyCodeLine{406                                        \&token\_parts,}
\DoxyCodeLine{407                                        \&arnr\_maxframes,}
\DoxyCodeLine{408                                        \&arnr\_strength,}
\DoxyCodeLine{409                                        \&arnr\_type,}
\DoxyCodeLine{410                                        \&tune\_ssim,}
\DoxyCodeLine{411                                        \&cq\_level,}
\DoxyCodeLine{412                                        \&max\_intra\_rate\_pct,}
\DoxyCodeLine{413                                        \&gf\_cbr\_boost\_pct,}
\DoxyCodeLine{414                                        \&screen\_content\_mode,}
\DoxyCodeLine{415                                        NULL \};}
\DoxyCodeLine{416 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} vp8\_arg\_ctrl\_map[] = \{ \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca953ff0eaa2fcdc2ecd627e449b026853}{VP8E\_SET\_CPUUSED}},}
\DoxyCodeLine{417                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca24a5530efabb8b4949d01622b1d72cb0}{VP8E\_SET\_ENABLEAUTOALTREF}},}
\DoxyCodeLine{418                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca3fa90cb70bade72af3c2d8d91471a36c}{VP8E\_SET\_NOISE\_SENSITIVITY}},}
\DoxyCodeLine{419                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca815930923fff388825ee3cc4ef69bb28}{VP8E\_SET\_SHARPNESS}},}
\DoxyCodeLine{420                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecab34559df04d3d662616300ed0682dcfd}{VP8E\_SET\_STATIC\_THRESHOLD}},}
\DoxyCodeLine{421                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca462a4f14f39a6eb5c4a4004fc8d0ad75}{VP8E\_SET\_TOKEN\_PARTITIONS}},}
\DoxyCodeLine{422                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca628d73f1a69fadd8aa57e0dfef578da8}{VP8E\_SET\_ARNR\_MAXFRAMES}},}
\DoxyCodeLine{423                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca0a8c40a768af935ae73faa53355c3244}{VP8E\_SET\_ARNR\_STRENGTH}},}
\DoxyCodeLine{424                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca4e0a0af58670012026c213083cd48f3a}{VP8E\_SET\_ARNR\_TYPE}},}
\DoxyCodeLine{425                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca126ccbe7bde63b59cec5ea68a82dd498}{VP8E\_SET\_TUNING}},}
\DoxyCodeLine{426                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacd4f5b730bddb9788c3d0b82218ec503}{VP8E\_SET\_CQ\_LEVEL}},}
\DoxyCodeLine{427                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca09c69ff4a3aabdb307d4f24027dfc4c1}{VP8E\_SET\_MAX\_INTRA\_BITRATE\_PCT}},}
\DoxyCodeLine{428                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca816c34530f29b611644592f439addfae}{VP8E\_SET\_GF\_CBR\_BOOST\_PCT}},}
\DoxyCodeLine{429                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacbd74e1cbae2b8a95907ea5eabbbe590}{VP8E\_SET\_SCREEN\_CONTENT\_MODE}},}
\DoxyCodeLine{430                                         0 \};}
\DoxyCodeLine{431 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{432 }
\DoxyCodeLine{433 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{434 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t cpu\_used\_vp9 =}
\DoxyCodeLine{435     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}cpu-\/used"{}}, 1, \textcolor{stringliteral}{"{}CPU Used (-\/9..9)"{}});}
\DoxyCodeLine{436 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t auto\_altref\_vp9 = ARG\_DEF(}
\DoxyCodeLine{437     NULL, \textcolor{stringliteral}{"{}auto-\/alt-\/ref"{}}, 1,}
\DoxyCodeLine{438     \textcolor{stringliteral}{"{}Enable automatic alt reference frames, 2+ enables multi-\/layer. (0..6)"{}});}
\DoxyCodeLine{439 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t tile\_cols =}
\DoxyCodeLine{440     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}tile-\/columns"{}}, 1, \textcolor{stringliteral}{"{}Number of tile columns to use, log2"{}});}
\DoxyCodeLine{441 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t tile\_rows =}
\DoxyCodeLine{442     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}tile-\/rows"{}}, 1,}
\DoxyCodeLine{443             \textcolor{stringliteral}{"{}Number of tile rows to use, log2 (set to 0 while threads > 1)"{}});}
\DoxyCodeLine{444 }
\DoxyCodeLine{445 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t enable\_tpl\_model =}
\DoxyCodeLine{446     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}enable-\/tpl"{}}, 1, \textcolor{stringliteral}{"{}Enable temporal dependency model"{}});}
\DoxyCodeLine{447 }
\DoxyCodeLine{448 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t lossless =}
\DoxyCodeLine{449     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}lossless"{}}, 1, \textcolor{stringliteral}{"{}Lossless mode (0: false (default), 1: true)"{}});}
\DoxyCodeLine{450 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t frame\_parallel\_decoding = ARG\_DEF(}
\DoxyCodeLine{451     NULL, \textcolor{stringliteral}{"{}frame-\/parallel"{}}, 1, \textcolor{stringliteral}{"{}Enable frame parallel decodability features"{}});}
\DoxyCodeLine{452 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t aq\_mode = ARG\_DEF(}
\DoxyCodeLine{453     NULL, \textcolor{stringliteral}{"{}aq-\/mode"{}}, 1,}
\DoxyCodeLine{454     \textcolor{stringliteral}{"{}Adaptive quantization mode (0: off (default), 1: variance 2: complexity, "{}}}
\DoxyCodeLine{455     \textcolor{stringliteral}{"{}3: cyclic refresh, 4: equator360)"{}});}
\DoxyCodeLine{456 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t alt\_ref\_aq = ARG\_DEF(NULL, \textcolor{stringliteral}{"{}alt-\/ref-\/aq"{}}, 1,}
\DoxyCodeLine{457                                             \textcolor{stringliteral}{"{}Special adaptive quantization for "{}}}
\DoxyCodeLine{458                                             \textcolor{stringliteral}{"{}the alternate reference frames."{}});}
\DoxyCodeLine{459 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t frame\_periodic\_boost =}
\DoxyCodeLine{460     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}frame-\/boost"{}}, 1,}
\DoxyCodeLine{461             \textcolor{stringliteral}{"{}Enable frame periodic boost (0: off (default), 1: on)"{}});}
\DoxyCodeLine{462 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t max\_inter\_rate\_pct =}
\DoxyCodeLine{463     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}max-\/inter-\/rate"{}}, 1, \textcolor{stringliteral}{"{}Max P-\/frame bitrate (pct)"{}});}
\DoxyCodeLine{464 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t min\_gf\_interval = ARG\_DEF(}
\DoxyCodeLine{465     NULL, \textcolor{stringliteral}{"{}min-\/gf-\/interval"{}}, 1,}
\DoxyCodeLine{466     \textcolor{stringliteral}{"{}min gf/arf frame interval (default 0, indicating in-\/built behavior)"{}});}
\DoxyCodeLine{467 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t max\_gf\_interval = ARG\_DEF(}
\DoxyCodeLine{468     NULL, \textcolor{stringliteral}{"{}max-\/gf-\/interval"{}}, 1,}
\DoxyCodeLine{469     \textcolor{stringliteral}{"{}max gf/arf frame interval (default 0, indicating in-\/built behavior)"{}});}
\DoxyCodeLine{470 }
\DoxyCodeLine{471 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list color\_space\_enum[] = \{}
\DoxyCodeLine{472   \{ \textcolor{stringliteral}{"{}unknown"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0ae039d02fe72e38d97e871aadccb49983}{VPX\_CS\_UNKNOWN}} \},}
\DoxyCodeLine{473   \{ \textcolor{stringliteral}{"{}bt601"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0aa88555230e42885238a78702bed06ccf}{VPX\_CS\_BT\_601}} \},}
\DoxyCodeLine{474   \{ \textcolor{stringliteral}{"{}bt709"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0a1cf07322afddb380115c2e44a0a41897}{VPX\_CS\_BT\_709}} \},}
\DoxyCodeLine{475   \{ \textcolor{stringliteral}{"{}smpte170"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0ad6b52554e4ef85c21202f4706f08e4d6}{VPX\_CS\_SMPTE\_170}} \},}
\DoxyCodeLine{476   \{ \textcolor{stringliteral}{"{}smpte240"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0ae5086aefd5c262f8e3adc048d086a15c}{VPX\_CS\_SMPTE\_240}} \},}
\DoxyCodeLine{477   \{ \textcolor{stringliteral}{"{}bt2020"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0aaedabef15fc5263f41145f9b733ef9e1}{VPX\_CS\_BT\_2020}} \},}
\DoxyCodeLine{478   \{ \textcolor{stringliteral}{"{}reserved"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0ae90aa2028199b5b1ec7e76a19241f59a}{VPX\_CS\_RESERVED}} \},}
\DoxyCodeLine{479   \{ \textcolor{stringliteral}{"{}sRGB"{}}, \mbox{\hyperlink{vpx__image_8h_a015098daa919d66314a81dadcdd38ef0a3fab005feb8c95c928b2410a7781a111}{VPX\_CS\_SRGB}} \},}
\DoxyCodeLine{480   \{ NULL, 0 \}}
\DoxyCodeLine{481 \};}
\DoxyCodeLine{482 }
\DoxyCodeLine{483 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t input\_color\_space =}
\DoxyCodeLine{484     ARG\_DEF\_ENUM(NULL, \textcolor{stringliteral}{"{}color-\/space"{}}, 1,}
\DoxyCodeLine{485                  \textcolor{stringliteral}{"{}The color space of input content:"{}}, color\_space\_enum);}
\DoxyCodeLine{486 }
\DoxyCodeLine{487 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{488 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list bitdepth\_enum[] = \{}
\DoxyCodeLine{489   \{ \textcolor{stringliteral}{"{}8"{}}, \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a664e60a9d8c84563836073d88ae1cfe8}{VPX\_BITS\_8}} \}, \{ \textcolor{stringliteral}{"{}10"{}}, \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9aaecd7245969d06b539de89cf580401e1}{VPX\_BITS\_10}} \}, \{ \textcolor{stringliteral}{"{}12"{}}, \mbox{\hyperlink{group__codec_ggaeb4bba376f987595b3ad11253adf86d9a7d053a31e269b4d3746e88b0ff424862}{VPX\_BITS\_12}} \}, \{ NULL, 0 \}}
\DoxyCodeLine{490 \};}
\DoxyCodeLine{491 }
\DoxyCodeLine{492 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t bitdeptharg = ARG\_DEF\_ENUM(}
\DoxyCodeLine{493     \textcolor{stringliteral}{"{}b"{}}, \textcolor{stringliteral}{"{}bit-\/depth"{}}, 1,}
\DoxyCodeLine{494     \textcolor{stringliteral}{"{}Bit depth for codec (8 for version <=1, 10 or 12 for version 2)"{}},}
\DoxyCodeLine{495     bitdepth\_enum);}
\DoxyCodeLine{496 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t inbitdeptharg =}
\DoxyCodeLine{497     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}input-\/bit-\/depth"{}}, 1, \textcolor{stringliteral}{"{}Bit depth of input"{}});}
\DoxyCodeLine{498 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{499 }
\DoxyCodeLine{500 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }arg\_enum\_list tune\_content\_enum[] = \{}
\DoxyCodeLine{501   \{ \textcolor{stringliteral}{"{}default"{}}, VP9E\_CONTENT\_DEFAULT \},}
\DoxyCodeLine{502   \{ \textcolor{stringliteral}{"{}screen"{}}, VP9E\_CONTENT\_SCREEN \},}
\DoxyCodeLine{503   \{ \textcolor{stringliteral}{"{}film"{}}, VP9E\_CONTENT\_FILM \},}
\DoxyCodeLine{504   \{ NULL, 0 \}}
\DoxyCodeLine{505 \};}
\DoxyCodeLine{506 }
\DoxyCodeLine{507 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t tune\_content = ARG\_DEF\_ENUM(}
\DoxyCodeLine{508     NULL, \textcolor{stringliteral}{"{}tune-\/content"{}}, 1, \textcolor{stringliteral}{"{}Tune content type"{}}, tune\_content\_enum);}
\DoxyCodeLine{509 }
\DoxyCodeLine{510 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t target\_level = ARG\_DEF(}
\DoxyCodeLine{511     NULL, \textcolor{stringliteral}{"{}target-\/level"{}}, 1,}
\DoxyCodeLine{512     \textcolor{stringliteral}{"{}Target level\(\backslash\)n"{}}}
\DoxyCodeLine{513     \textcolor{stringliteral}{"{}                                        255: off (default)\(\backslash\)n"{}}}
\DoxyCodeLine{514     \textcolor{stringliteral}{"{}                                          0: only keep level stats\(\backslash\)n"{}}}
\DoxyCodeLine{515     \textcolor{stringliteral}{"{}                                          1: adaptively set alt-\/ref "{}}}
\DoxyCodeLine{516     \textcolor{stringliteral}{"{}distance and column tile limit based on picture size, and keep"{}}}
\DoxyCodeLine{517     \textcolor{stringliteral}{"{} level stats\(\backslash\)n"{}}}
\DoxyCodeLine{518     \textcolor{stringliteral}{"{}                                         10: level 1.0  11: level 1.1  "{}}}
\DoxyCodeLine{519     \textcolor{stringliteral}{"{}...  62: level 6.2"{}});}
\DoxyCodeLine{520 }
\DoxyCodeLine{521 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t row\_mt =}
\DoxyCodeLine{522     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}row-\/mt"{}}, 1,}
\DoxyCodeLine{523             \textcolor{stringliteral}{"{}Enable row based non-\/deterministic multi-\/threading in VP9"{}});}
\DoxyCodeLine{524 }
\DoxyCodeLine{525 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t disable\_loopfilter =}
\DoxyCodeLine{526     ARG\_DEF(NULL, \textcolor{stringliteral}{"{}disable-\/loopfilter"{}}, 1,}
\DoxyCodeLine{527             \textcolor{stringliteral}{"{}Control Loopfilter in VP9\(\backslash\)n"{}}}
\DoxyCodeLine{528             \textcolor{stringliteral}{"{}0: Loopfilter on for all frames (default)\(\backslash\)n"{}}}
\DoxyCodeLine{529             \textcolor{stringliteral}{"{}1: Loopfilter off for non reference frames\(\backslash\)n"{}}}
\DoxyCodeLine{530             \textcolor{stringliteral}{"{}2: Loopfilter off for all frames"{}});}
\DoxyCodeLine{531 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{532 }
\DoxyCodeLine{533 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{534 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *vp9\_args[] = \{ \&cpu\_used\_vp9,}
\DoxyCodeLine{535                                        \&auto\_altref\_vp9,}
\DoxyCodeLine{536                                        \&sharpness,}
\DoxyCodeLine{537                                        \&static\_thresh,}
\DoxyCodeLine{538                                        \&tile\_cols,}
\DoxyCodeLine{539                                        \&tile\_rows,}
\DoxyCodeLine{540                                        \&enable\_tpl\_model,}
\DoxyCodeLine{541                                        \&arnr\_maxframes,}
\DoxyCodeLine{542                                        \&arnr\_strength,}
\DoxyCodeLine{543                                        \&arnr\_type,}
\DoxyCodeLine{544                                        \&tune\_ssim,}
\DoxyCodeLine{545                                        \&cq\_level,}
\DoxyCodeLine{546                                        \&max\_intra\_rate\_pct,}
\DoxyCodeLine{547                                        \&max\_inter\_rate\_pct,}
\DoxyCodeLine{548                                        \&gf\_cbr\_boost\_pct,}
\DoxyCodeLine{549                                        \&lossless,}
\DoxyCodeLine{550                                        \&frame\_parallel\_decoding,}
\DoxyCodeLine{551                                        \&aq\_mode,}
\DoxyCodeLine{552                                        \&alt\_ref\_aq,}
\DoxyCodeLine{553                                        \&frame\_periodic\_boost,}
\DoxyCodeLine{554                                        \&noise\_sens,}
\DoxyCodeLine{555                                        \&tune\_content,}
\DoxyCodeLine{556                                        \&input\_color\_space,}
\DoxyCodeLine{557                                        \&min\_gf\_interval,}
\DoxyCodeLine{558                                        \&max\_gf\_interval,}
\DoxyCodeLine{559                                        \&target\_level,}
\DoxyCodeLine{560                                        \&row\_mt,}
\DoxyCodeLine{561                                        \&disable\_loopfilter,}
\DoxyCodeLine{562 \textcolor{comment}{// NOTE: The entries above have a corresponding entry in vp9\_arg\_ctrl\_map. The}}
\DoxyCodeLine{563 \textcolor{comment}{// entries below do not have a corresponding entry in vp9\_arg\_ctrl\_map. They}}
\DoxyCodeLine{564 \textcolor{comment}{// must be listed at the end of vp9\_args.}}
\DoxyCodeLine{565 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{566                                        \&bitdeptharg,}
\DoxyCodeLine{567                                        \&inbitdeptharg,}
\DoxyCodeLine{568 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{569                                        NULL \};}
\DoxyCodeLine{570 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} vp9\_arg\_ctrl\_map[] = \{ \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca953ff0eaa2fcdc2ecd627e449b026853}{VP8E\_SET\_CPUUSED}},}
\DoxyCodeLine{571                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca24a5530efabb8b4949d01622b1d72cb0}{VP8E\_SET\_ENABLEAUTOALTREF}},}
\DoxyCodeLine{572                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca815930923fff388825ee3cc4ef69bb28}{VP8E\_SET\_SHARPNESS}},}
\DoxyCodeLine{573                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecab34559df04d3d662616300ed0682dcfd}{VP8E\_SET\_STATIC\_THRESHOLD}},}
\DoxyCodeLine{574                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca9c221dc99c51eb5e6304461aed9b5f5b}{VP9E\_SET\_TILE\_COLUMNS}},}
\DoxyCodeLine{575                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca5c6da58a82728ce850d0b2c9188f9fa2}{VP9E\_SET\_TILE\_ROWS}},}
\DoxyCodeLine{576                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca8cc35557a64db25075d35e2b34373864}{VP9E\_SET\_TPL}},}
\DoxyCodeLine{577                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca628d73f1a69fadd8aa57e0dfef578da8}{VP8E\_SET\_ARNR\_MAXFRAMES}},}
\DoxyCodeLine{578                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca0a8c40a768af935ae73faa53355c3244}{VP8E\_SET\_ARNR\_STRENGTH}},}
\DoxyCodeLine{579                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca4e0a0af58670012026c213083cd48f3a}{VP8E\_SET\_ARNR\_TYPE}},}
\DoxyCodeLine{580                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca126ccbe7bde63b59cec5ea68a82dd498}{VP8E\_SET\_TUNING}},}
\DoxyCodeLine{581                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacd4f5b730bddb9788c3d0b82218ec503}{VP8E\_SET\_CQ\_LEVEL}},}
\DoxyCodeLine{582                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca09c69ff4a3aabdb307d4f24027dfc4c1}{VP8E\_SET\_MAX\_INTRA\_BITRATE\_PCT}},}
\DoxyCodeLine{583                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca05c677432387056a74b92d0546c80fd4}{VP9E\_SET\_MAX\_INTER\_BITRATE\_PCT}},}
\DoxyCodeLine{584                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecae38181c436d82d8554b43303e18cff0b}{VP9E\_SET\_GF\_CBR\_BOOST\_PCT}},}
\DoxyCodeLine{585                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca7224f4edeeaf940584e6fe3ff2345b86}{VP9E\_SET\_LOSSLESS}},}
\DoxyCodeLine{586                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca7e61bfc05a2eb5a53d8f2091ebc5d40e}{VP9E\_SET\_FRAME\_PARALLEL\_DECODING}},}
\DoxyCodeLine{587                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca375af288e2d7fa169cbfef4ba586c1d2}{VP9E\_SET\_AQ\_MODE}},}
\DoxyCodeLine{588                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecaee9ecd5c9530a1bb3a770c9aee6c1f66}{VP9E\_SET\_ALT\_REF\_AQ}},}
\DoxyCodeLine{589                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca064d768f60d2d60a07c160174c3df266}{VP9E\_SET\_FRAME\_PERIODIC\_BOOST}},}
\DoxyCodeLine{590                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecace6096a9fbe83dc72ed6a54a81ce215b}{VP9E\_SET\_NOISE\_SENSITIVITY}},}
\DoxyCodeLine{591                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca87292610b42f00676aebdc75b63227de}{VP9E\_SET\_TUNE\_CONTENT}},}
\DoxyCodeLine{592                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecab67a3db9b16d938513d1ee6a69b24e02}{VP9E\_SET\_COLOR\_SPACE}},}
\DoxyCodeLine{593                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca04ae4a1b699c5d22f2510c7509124ea9}{VP9E\_SET\_MIN\_GF\_INTERVAL}},}
\DoxyCodeLine{594                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecae8a09d2ee42538af1c00bc403c6d29d8}{VP9E\_SET\_MAX\_GF\_INTERVAL}},}
\DoxyCodeLine{595                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca2e6d09f137b021acf240cdfc1a7372a8}{VP9E\_SET\_TARGET\_LEVEL}},}
\DoxyCodeLine{596                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322eca8ec97b90e57f4ddba099cd881a509360}{VP9E\_SET\_ROW\_MT}},}
\DoxyCodeLine{597                                         \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecacd2d31e611840edb87a0484a9ef1781a}{VP9E\_SET\_DISABLE\_LOOPFILTER}},}
\DoxyCodeLine{598                                         0 \};}
\DoxyCodeLine{599 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{600 }
\DoxyCodeLine{601 \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t *no\_args[] = \{ NULL \};}
\DoxyCodeLine{602 }
\DoxyCodeLine{603 \textcolor{keyword}{static} \textcolor{keywordtype}{void} show\_help(FILE *fout, \textcolor{keywordtype}{int} shorthelp) \{}
\DoxyCodeLine{604   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{605   \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_encoder = get\_vpx\_encoder\_count();}
\DoxyCodeLine{606 }
\DoxyCodeLine{607   fprintf(fout, \textcolor{stringliteral}{"{}Usage: \%s <options> -\/o dst\_filename src\_filename \(\backslash\)n"{}},}
\DoxyCodeLine{608           exec\_name);}
\DoxyCodeLine{609 }
\DoxyCodeLine{610   \textcolor{keywordflow}{if} (shorthelp) \{}
\DoxyCodeLine{611     fprintf(fout, \textcolor{stringliteral}{"{}Use -\/-\/help to see the full list of options.\(\backslash\)n"{}});}
\DoxyCodeLine{612     \textcolor{keywordflow}{return};}
\DoxyCodeLine{613   \}}
\DoxyCodeLine{614 }
\DoxyCodeLine{615   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nOptions:\(\backslash\)n"{}});}
\DoxyCodeLine{616   arg\_show\_usage(fout, main\_args);}
\DoxyCodeLine{617   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nEncoder Global Options:\(\backslash\)n"{}});}
\DoxyCodeLine{618   arg\_show\_usage(fout, global\_args);}
\DoxyCodeLine{619   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nRate Control Options:\(\backslash\)n"{}});}
\DoxyCodeLine{620   arg\_show\_usage(fout, rc\_args);}
\DoxyCodeLine{621   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nTwopass Rate Control Options:\(\backslash\)n"{}});}
\DoxyCodeLine{622   arg\_show\_usage(fout, rc\_twopass\_args);}
\DoxyCodeLine{623   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nKeyframe Placement Options:\(\backslash\)n"{}});}
\DoxyCodeLine{624   arg\_show\_usage(fout, kf\_args);}
\DoxyCodeLine{625 \textcolor{preprocessor}{\#if CONFIG\_VP8\_ENCODER}}
\DoxyCodeLine{626   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nVP8 Specific Options:\(\backslash\)n"{}});}
\DoxyCodeLine{627   arg\_show\_usage(fout, vp8\_args);}
\DoxyCodeLine{628 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{629 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{630   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nVP9 Specific Options:\(\backslash\)n"{}});}
\DoxyCodeLine{631   arg\_show\_usage(fout, vp9\_args);}
\DoxyCodeLine{632   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nVizier Rate Control Options:\(\backslash\)n"{}});}
\DoxyCodeLine{633   arg\_show\_usage(fout, vizier\_rc\_args);}
\DoxyCodeLine{634 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{635   fprintf(fout,}
\DoxyCodeLine{636           \textcolor{stringliteral}{"{}\(\backslash\)nStream timebase (-\/-\/timebase):\(\backslash\)n"{}}}
\DoxyCodeLine{637           \textcolor{stringliteral}{"{}  The desired precision of timestamps in the output, expressed\(\backslash\)n"{}}}
\DoxyCodeLine{638           \textcolor{stringliteral}{"{}  in fractional seconds. Default is 1/1000.\(\backslash\)n"{}});}
\DoxyCodeLine{639   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)nIncluded encoders:\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{640 }
\DoxyCodeLine{641   \textcolor{keywordflow}{for} (i = 0; i < num\_encoder; ++i) \{}
\DoxyCodeLine{642     \textcolor{keyword}{const} VpxInterface *\textcolor{keyword}{const} encoder = get\_vpx\_encoder\_by\_index(i);}
\DoxyCodeLine{643     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *defstr = (i == (num\_encoder -\/ 1)) ? \textcolor{stringliteral}{"{}(default)"{}} : \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{644     fprintf(fout, \textcolor{stringliteral}{"{}    \%-\/6s -\/ \%s \%s\(\backslash\)n"{}}, encoder-\/>name,}
\DoxyCodeLine{645             \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(encoder-\/>codec\_interface()), defstr);}
\DoxyCodeLine{646   \}}
\DoxyCodeLine{647   fprintf(fout, \textcolor{stringliteral}{"{}\(\backslash\)n        "{}});}
\DoxyCodeLine{648   fprintf(fout, \textcolor{stringliteral}{"{}Use -\/-\/codec to switch to a non-\/default encoder.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{649 \}}
\DoxyCodeLine{650 }
\DoxyCodeLine{651 \textcolor{keywordtype}{void} usage\_exit(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{652   show\_help(stderr, 1);}
\DoxyCodeLine{653   exit(EXIT\_FAILURE);}
\DoxyCodeLine{654 \}}
\DoxyCodeLine{655 }
\DoxyCodeLine{656 \textcolor{preprocessor}{\#define NELEMENTS(x) (sizeof(x) / sizeof(x[0]))}}
\DoxyCodeLine{657 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{658 \textcolor{preprocessor}{\#define ARG\_CTRL\_CNT\_MAX NELEMENTS(vp9\_arg\_ctrl\_map)}}
\DoxyCodeLine{659 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{660 \textcolor{preprocessor}{\#define ARG\_CTRL\_CNT\_MAX NELEMENTS(vp8\_arg\_ctrl\_map)}}
\DoxyCodeLine{661 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{662 }
\DoxyCodeLine{663 \textcolor{preprocessor}{\#if !CONFIG\_WEBM\_IO}}
\DoxyCodeLine{664 \textcolor{keyword}{typedef} \textcolor{keywordtype}{int} stereo\_format\_t;}
\DoxyCodeLine{665 \textcolor{keyword}{struct }WebmOutputContext \{}
\DoxyCodeLine{666   \textcolor{keywordtype}{int} debug;}
\DoxyCodeLine{667 \};}
\DoxyCodeLine{668 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{669 }
\DoxyCodeLine{670 \textcolor{comment}{/* Per-\/stream configuration */}}
\DoxyCodeLine{671 \textcolor{keyword}{struct }stream\_config \{}
\DoxyCodeLine{672   \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg}} cfg;}
\DoxyCodeLine{673   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *out\_fn;}
\DoxyCodeLine{674   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *stats\_fn;}
\DoxyCodeLine{675   stereo\_format\_t stereo\_fmt;}
\DoxyCodeLine{676   \textcolor{keywordtype}{int} arg\_ctrls[ARG\_CTRL\_CNT\_MAX][2];}
\DoxyCodeLine{677   \textcolor{keywordtype}{int} arg\_ctrl\_cnt;}
\DoxyCodeLine{678   \textcolor{keywordtype}{int} write\_webm;}
\DoxyCodeLine{679 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{680   \textcolor{comment}{// whether to use 16bit internal buffers}}
\DoxyCodeLine{681   \textcolor{keywordtype}{int} use\_16bit\_internal;}
\DoxyCodeLine{682 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{683 \};}
\DoxyCodeLine{684 }
\DoxyCodeLine{685 \textcolor{keyword}{struct }stream\_state \{}
\DoxyCodeLine{686   \textcolor{keywordtype}{int} index;}
\DoxyCodeLine{687   \textcolor{keyword}{struct }stream\_state *next;}
\DoxyCodeLine{688   \textcolor{keyword}{struct }stream\_config config;}
\DoxyCodeLine{689   FILE *file;}
\DoxyCodeLine{690   \textcolor{keyword}{struct }rate\_hist *rate\_hist;}
\DoxyCodeLine{691   \textcolor{keyword}{struct }WebmOutputContext webm\_ctx;}
\DoxyCodeLine{692   uint64\_t psnr\_sse\_total;}
\DoxyCodeLine{693   uint64\_t psnr\_samples\_total;}
\DoxyCodeLine{694   \textcolor{keywordtype}{double} psnr\_totals[4];}
\DoxyCodeLine{695   \textcolor{keywordtype}{int} psnr\_count;}
\DoxyCodeLine{696   \textcolor{keywordtype}{int} counts[64];}
\DoxyCodeLine{697   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} encoder;}
\DoxyCodeLine{698   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frames\_out;}
\DoxyCodeLine{699   uint64\_t cx\_time;}
\DoxyCodeLine{700   \textcolor{keywordtype}{size\_t} nbytes;}
\DoxyCodeLine{701   stats\_io\_t stats;}
\DoxyCodeLine{702   \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__image}{vpx\_image}} *img;}
\DoxyCodeLine{703   \mbox{\hyperlink{structvpx__codec__ctx}{vpx\_codec\_ctx\_t}} decoder;}
\DoxyCodeLine{704   \textcolor{keywordtype}{int} mismatch\_seen;}
\DoxyCodeLine{705 \};}
\DoxyCodeLine{706 }
\DoxyCodeLine{707 \textcolor{keyword}{static} \textcolor{keywordtype}{void} validate\_positive\_rational(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *msg,}
\DoxyCodeLine{708                                        \textcolor{keyword}{struct} \mbox{\hyperlink{structvpx__rational}{vpx\_rational}} *rat) \{}
\DoxyCodeLine{709   \textcolor{keywordflow}{if} (rat-\/>\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} < 0) \{}
\DoxyCodeLine{710     rat-\/>\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} *= -\/1;}
\DoxyCodeLine{711     rat-\/>\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} *= -\/1;}
\DoxyCodeLine{712   \}}
\DoxyCodeLine{713 }
\DoxyCodeLine{714   \textcolor{keywordflow}{if} (rat-\/>\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} < 0) die(\textcolor{stringliteral}{"{}Error: \%s must be positive\(\backslash\)n"{}}, msg);}
\DoxyCodeLine{715 }
\DoxyCodeLine{716   \textcolor{keywordflow}{if} (!rat-\/>\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}}) die(\textcolor{stringliteral}{"{}Error: \%s has zero denominator\(\backslash\)n"{}}, msg);}
\DoxyCodeLine{717 \}}
\DoxyCodeLine{718 }
\DoxyCodeLine{719 \textcolor{keyword}{static} \textcolor{keywordtype}{void} parse\_global\_config(\textcolor{keyword}{struct} VpxEncoderConfig *global, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{720   \textcolor{keywordtype}{char} **argi, **argj;}
\DoxyCodeLine{721   \textcolor{keyword}{struct }arg arg;}
\DoxyCodeLine{722   \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_encoder = get\_vpx\_encoder\_count();}
\DoxyCodeLine{723 }
\DoxyCodeLine{724   \textcolor{keywordflow}{if} (num\_encoder < 1) die(\textcolor{stringliteral}{"{}Error: no valid encoder available\(\backslash\)n"{}});}
\DoxyCodeLine{725 }
\DoxyCodeLine{726   \textcolor{comment}{/* Initialize default parameters */}}
\DoxyCodeLine{727   memset(global, 0, \textcolor{keyword}{sizeof}(*global));}
\DoxyCodeLine{728   global-\/>codec = get\_vpx\_encoder\_by\_index(num\_encoder -\/ 1);}
\DoxyCodeLine{729   global-\/>passes = 0;}
\DoxyCodeLine{730   global-\/>color\_type = I420;}
\DoxyCodeLine{731   \textcolor{comment}{/* Assign default deadline to good quality */}}
\DoxyCodeLine{732   global-\/>deadline = \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}};}
\DoxyCodeLine{733 }
\DoxyCodeLine{734   \textcolor{keywordflow}{for} (argi = argj = argv; (*argj = *argi); argi += arg.argv\_step) \{}
\DoxyCodeLine{735     arg.argv\_step = 1;}
\DoxyCodeLine{736 }
\DoxyCodeLine{737     \textcolor{keywordflow}{if} (arg\_match(\&arg, \&help, argi)) \{}
\DoxyCodeLine{738       show\_help(stdout, 0);}
\DoxyCodeLine{739       exit(EXIT\_SUCCESS);}
\DoxyCodeLine{740     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&codecarg, argi)) \{}
\DoxyCodeLine{741       global-\/>codec = get\_vpx\_encoder\_by\_name(arg.val);}
\DoxyCodeLine{742       \textcolor{keywordflow}{if} (!global-\/>codec)}
\DoxyCodeLine{743         die(\textcolor{stringliteral}{"{}Error: Unrecognized argument (\%s) to -\/-\/codec\(\backslash\)n"{}}, arg.val);}
\DoxyCodeLine{744     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&passes, argi)) \{}
\DoxyCodeLine{745       global-\/>passes = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{746 }
\DoxyCodeLine{747       \textcolor{keywordflow}{if} (global-\/>passes < 1 || global-\/>passes > 2)}
\DoxyCodeLine{748         die(\textcolor{stringliteral}{"{}Error: Invalid number of passes (\%d)\(\backslash\)n"{}}, global-\/>passes);}
\DoxyCodeLine{749     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&pass\_arg, argi)) \{}
\DoxyCodeLine{750       global-\/>pass = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{751 }
\DoxyCodeLine{752       \textcolor{keywordflow}{if} (global-\/>pass < 1 || global-\/>pass > 2)}
\DoxyCodeLine{753         die(\textcolor{stringliteral}{"{}Error: Invalid pass selected (\%d)\(\backslash\)n"{}}, global-\/>pass);}
\DoxyCodeLine{754     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&usage, argi))}
\DoxyCodeLine{755       global-\/>usage = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{756     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&deadline, argi))}
\DoxyCodeLine{757       global-\/>deadline = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{758     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&best\_dl, argi))}
\DoxyCodeLine{759       global-\/>deadline = \mbox{\hyperlink{group__encoder_gab350573bea112f2fdf8e5677db3ac0da}{VPX\_DL\_BEST\_QUALITY}};}
\DoxyCodeLine{760     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&good\_dl, argi))}
\DoxyCodeLine{761       global-\/>deadline = \mbox{\hyperlink{group__encoder_ga5d00a9f9e10b9f49ca91e72c1f01c9fd}{VPX\_DL\_GOOD\_QUALITY}};}
\DoxyCodeLine{762     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rt\_dl, argi))}
\DoxyCodeLine{763       global-\/>deadline = \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}};}
\DoxyCodeLine{764     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_yv12, argi))}
\DoxyCodeLine{765       global-\/>color\_type = YV12;}
\DoxyCodeLine{766     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_nv12, argi))}
\DoxyCodeLine{767       global-\/>color\_type = NV12;}
\DoxyCodeLine{768     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_i420, argi))}
\DoxyCodeLine{769       global-\/>color\_type = I420;}
\DoxyCodeLine{770     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_i422, argi))}
\DoxyCodeLine{771       global-\/>color\_type = I422;}
\DoxyCodeLine{772     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_i444, argi))}
\DoxyCodeLine{773       global-\/>color\_type = I444;}
\DoxyCodeLine{774     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_i440, argi))}
\DoxyCodeLine{775       global-\/>color\_type = I440;}
\DoxyCodeLine{776     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&quietarg, argi))}
\DoxyCodeLine{777       global-\/>quiet = 1;}
\DoxyCodeLine{778     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&verbosearg, argi))}
\DoxyCodeLine{779       global-\/>verbose = 1;}
\DoxyCodeLine{780     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&limit, argi))}
\DoxyCodeLine{781       global-\/>limit = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{782     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&skip, argi))}
\DoxyCodeLine{783       global-\/>skip\_frames = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{784     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&psnrarg, argi))}
\DoxyCodeLine{785       global-\/>show\_psnr = 1;}
\DoxyCodeLine{786     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&recontest, argi))}
\DoxyCodeLine{787       global-\/>test\_decode = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{788     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&framerate, argi)) \{}
\DoxyCodeLine{789       global-\/>framerate = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{790       validate\_positive\_rational(arg.name, \&global-\/>framerate);}
\DoxyCodeLine{791       global-\/>have\_framerate = 1;}
\DoxyCodeLine{792     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&out\_part, argi))}
\DoxyCodeLine{793       global-\/>out\_part = 1;}
\DoxyCodeLine{794     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&debugmode, argi))}
\DoxyCodeLine{795       global-\/>debug = 1;}
\DoxyCodeLine{796     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&q\_hist\_n, argi))}
\DoxyCodeLine{797       global-\/>show\_q\_hist\_buckets = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{798     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rate\_hist\_n, argi))}
\DoxyCodeLine{799       global-\/>show\_rate\_hist\_buckets = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{800     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&disable\_warnings, argi))}
\DoxyCodeLine{801       global-\/>disable\_warnings = 1;}
\DoxyCodeLine{802     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&disable\_warning\_prompt, argi))}
\DoxyCodeLine{803       global-\/>disable\_warning\_prompt = 1;}
\DoxyCodeLine{804     \textcolor{keywordflow}{else}}
\DoxyCodeLine{805       argj++;}
\DoxyCodeLine{806   \}}
\DoxyCodeLine{807 }
\DoxyCodeLine{808   \textcolor{keywordflow}{if} (global-\/>pass) \{}
\DoxyCodeLine{809     \textcolor{comment}{/* DWIM: Assume the user meant passes=2 if pass=2 is specified */}}
\DoxyCodeLine{810     \textcolor{keywordflow}{if} (global-\/>pass > global-\/>passes) \{}
\DoxyCodeLine{811       warn(\textcolor{stringliteral}{"{}Assuming -\/-\/pass=\%d implies -\/-\/passes=\%d\(\backslash\)n"{}}, global-\/>pass,}
\DoxyCodeLine{812            global-\/>pass);}
\DoxyCodeLine{813       global-\/>passes = global-\/>pass;}
\DoxyCodeLine{814     \}}
\DoxyCodeLine{815   \}}
\DoxyCodeLine{816   \textcolor{comment}{/* Validate global config */}}
\DoxyCodeLine{817   \textcolor{keywordflow}{if} (global-\/>passes == 0) \{}
\DoxyCodeLine{818 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{819     \textcolor{comment}{// Make default VP9 passes = 2 until there is a better quality 1-\/pass}}
\DoxyCodeLine{820     \textcolor{comment}{// encoder}}
\DoxyCodeLine{821     \textcolor{keywordflow}{if} (global-\/>codec != NULL \&\& global-\/>codec-\/>name != NULL)}
\DoxyCodeLine{822       global-\/>passes = (strcmp(global-\/>codec-\/>name, \textcolor{stringliteral}{"{}vp9"{}}) == 0 \&\&}
\DoxyCodeLine{823                         global-\/>deadline != \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}})}
\DoxyCodeLine{824                            ? 2}
\DoxyCodeLine{825                            : 1;}
\DoxyCodeLine{826 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{827     global-\/>passes = 1;}
\DoxyCodeLine{828 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{829   \}}
\DoxyCodeLine{830 }
\DoxyCodeLine{831   \textcolor{keywordflow}{if} (global-\/>deadline == \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}} \&\& global-\/>passes > 1) \{}
\DoxyCodeLine{832     warn(\textcolor{stringliteral}{"{}Enforcing one-\/pass encoding in realtime mode\(\backslash\)n"{}});}
\DoxyCodeLine{833     global-\/>passes = 1;}
\DoxyCodeLine{834   \}}
\DoxyCodeLine{835 \}}
\DoxyCodeLine{836 }
\DoxyCodeLine{837 \textcolor{keyword}{static} \textcolor{keyword}{struct }stream\_state *new\_stream(\textcolor{keyword}{struct} VpxEncoderConfig *global,}
\DoxyCodeLine{838                                        \textcolor{keyword}{struct} stream\_state *prev) \{}
\DoxyCodeLine{839   \textcolor{keyword}{struct }stream\_state *stream;}
\DoxyCodeLine{840 }
\DoxyCodeLine{841   stream = calloc(1, \textcolor{keyword}{sizeof}(*stream));}
\DoxyCodeLine{842   \textcolor{keywordflow}{if} (stream == NULL) \{}
\DoxyCodeLine{843     fatal(\textcolor{stringliteral}{"{}Failed to allocate new stream."{}});}
\DoxyCodeLine{844   \}}
\DoxyCodeLine{845 }
\DoxyCodeLine{846   \textcolor{keywordflow}{if} (prev) \{}
\DoxyCodeLine{847     memcpy(stream, prev, \textcolor{keyword}{sizeof}(*stream));}
\DoxyCodeLine{848     stream-\/>index++;}
\DoxyCodeLine{849     prev-\/>next = stream;}
\DoxyCodeLine{850   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{851     \mbox{\hyperlink{group__codec_gada1084710837ad363b92f2379dd2b8d2}{vpx\_codec\_err\_t}} res;}
\DoxyCodeLine{852 }
\DoxyCodeLine{853     \textcolor{comment}{/* Populate encoder configuration */}}
\DoxyCodeLine{854     res = \mbox{\hyperlink{group__encoder_ga9ab8c79623312e9c5d5405d66a788f59}{vpx\_codec\_enc\_config\_default}}(global-\/>codec-\/>codec\_interface(),}
\DoxyCodeLine{855                                        \&stream-\/>config.cfg, global-\/>usage);}
\DoxyCodeLine{856     \textcolor{keywordflow}{if} (res) fatal(\textcolor{stringliteral}{"{}Failed to get config: \%s\(\backslash\)n"{}}, \mbox{\hyperlink{group__codec_ga550c4616424a08e85fc102486846141e}{vpx\_codec\_err\_to\_string}}(res));}
\DoxyCodeLine{857 }
\DoxyCodeLine{858     \textcolor{comment}{/* Change the default timebase to a high enough value so that the}}
\DoxyCodeLine{859 \textcolor{comment}{     * encoder will always create strictly increasing timestamps.}}
\DoxyCodeLine{860 \textcolor{comment}{     */}}
\DoxyCodeLine{861     stream-\/>config.cfg.g\_timebase.den = 1000;}
\DoxyCodeLine{862 }
\DoxyCodeLine{863     \textcolor{comment}{/* Never use the library's default resolution, require it be parsed}}
\DoxyCodeLine{864 \textcolor{comment}{     * from the file or set on the command line.}}
\DoxyCodeLine{865 \textcolor{comment}{     */}}
\DoxyCodeLine{866     stream-\/>config.cfg.g\_w = 0;}
\DoxyCodeLine{867     stream-\/>config.cfg.g\_h = 0;}
\DoxyCodeLine{868 }
\DoxyCodeLine{869     \textcolor{comment}{/* Initialize remaining stream parameters */}}
\DoxyCodeLine{870     stream-\/>config.write\_webm = 1;}
\DoxyCodeLine{871 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{872     stream-\/>config.stereo\_fmt = STEREO\_FORMAT\_MONO;}
\DoxyCodeLine{873     stream-\/>webm\_ctx.last\_pts\_ns = -\/1;}
\DoxyCodeLine{874     stream-\/>webm\_ctx.writer = NULL;}
\DoxyCodeLine{875     stream-\/>webm\_ctx.segment = NULL;}
\DoxyCodeLine{876 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{877 }
\DoxyCodeLine{878     \textcolor{comment}{/* Allows removal of the application version from the EBML tags */}}
\DoxyCodeLine{879     stream-\/>webm\_ctx.debug = global-\/>debug;}
\DoxyCodeLine{880 }
\DoxyCodeLine{881     \textcolor{comment}{/* Default lag\_in\_frames is 0 in realtime mode CBR mode*/}}
\DoxyCodeLine{882     \textcolor{keywordflow}{if} (global-\/>deadline == \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}} \&\&}
\DoxyCodeLine{883         stream-\/>config.cfg.rc\_end\_usage == 1)}
\DoxyCodeLine{884       stream-\/>config.cfg.g\_lag\_in\_frames = 0;}
\DoxyCodeLine{885   \}}
\DoxyCodeLine{886 }
\DoxyCodeLine{887   \textcolor{comment}{/* Output files must be specified for each stream */}}
\DoxyCodeLine{888   stream-\/>config.out\_fn = NULL;}
\DoxyCodeLine{889 }
\DoxyCodeLine{890   stream-\/>next = NULL;}
\DoxyCodeLine{891   \textcolor{keywordflow}{return} stream;}
\DoxyCodeLine{892 \}}
\DoxyCodeLine{893 }
\DoxyCodeLine{894 \textcolor{keyword}{static} \textcolor{keywordtype}{int} parse\_stream\_params(\textcolor{keyword}{struct} VpxEncoderConfig *global,}
\DoxyCodeLine{895                                \textcolor{keyword}{struct} stream\_state *stream, \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{896   \textcolor{keywordtype}{char} **argi, **argj;}
\DoxyCodeLine{897   \textcolor{keyword}{struct }arg arg;}
\DoxyCodeLine{898   \textcolor{keyword}{static} \textcolor{keyword}{const} arg\_def\_t **ctrl\_args = no\_args;}
\DoxyCodeLine{899   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} *ctrl\_args\_map = NULL;}
\DoxyCodeLine{900   \textcolor{keyword}{struct }stream\_config *config = \&stream-\/>config;}
\DoxyCodeLine{901   \textcolor{keywordtype}{int} eos\_mark\_found = 0;}
\DoxyCodeLine{902 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{903   \textcolor{keywordtype}{int} test\_16bit\_internal = 0;}
\DoxyCodeLine{904 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{905 }
\DoxyCodeLine{906   \textcolor{comment}{// Handle codec specific options}}
\DoxyCodeLine{907   \textcolor{keywordflow}{if} (0) \{}
\DoxyCodeLine{908 \textcolor{preprocessor}{\#if CONFIG\_VP8\_ENCODER}}
\DoxyCodeLine{909   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(global-\/>codec-\/>name, \textcolor{stringliteral}{"{}vp8"{}}) == 0) \{}
\DoxyCodeLine{910     ctrl\_args = vp8\_args;}
\DoxyCodeLine{911     ctrl\_args\_map = vp8\_arg\_ctrl\_map;}
\DoxyCodeLine{912 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{913 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{914   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(global-\/>codec-\/>name, \textcolor{stringliteral}{"{}vp9"{}}) == 0) \{}
\DoxyCodeLine{915     ctrl\_args = vp9\_args;}
\DoxyCodeLine{916     ctrl\_args\_map = vp9\_arg\_ctrl\_map;}
\DoxyCodeLine{917 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{918   \}}
\DoxyCodeLine{919 }
\DoxyCodeLine{920   \textcolor{keywordflow}{for} (argi = argj = argv; (*argj = *argi); argi += arg.argv\_step) \{}
\DoxyCodeLine{921     arg.argv\_step = 1;}
\DoxyCodeLine{922 }
\DoxyCodeLine{923     \textcolor{comment}{/* Once we've found an end-\/of-\/stream marker (-\/-\/) we want to continue}}
\DoxyCodeLine{924 \textcolor{comment}{     * shifting arguments but not consuming them.}}
\DoxyCodeLine{925 \textcolor{comment}{     */}}
\DoxyCodeLine{926     \textcolor{keywordflow}{if} (eos\_mark\_found) \{}
\DoxyCodeLine{927       argj++;}
\DoxyCodeLine{928       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{929     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(*argj, \textcolor{stringliteral}{"{}-\/-\/"{}})) \{}
\DoxyCodeLine{930       eos\_mark\_found = 1;}
\DoxyCodeLine{931       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{932     \}}
\DoxyCodeLine{933 }
\DoxyCodeLine{934     \textcolor{keywordflow}{if} (arg\_match(\&arg, \&outputfile, argi)) \{}
\DoxyCodeLine{935       config-\/>out\_fn = arg.val;}
\DoxyCodeLine{936     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&fpf\_name, argi)) \{}
\DoxyCodeLine{937       config-\/>stats\_fn = arg.val;}
\DoxyCodeLine{938     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_webm, argi)) \{}
\DoxyCodeLine{939 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{940       config-\/>write\_webm = 1;}
\DoxyCodeLine{941 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{942       die(\textcolor{stringliteral}{"{}Error: -\/-\/webm specified but webm is disabled."{}});}
\DoxyCodeLine{943 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{944     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_ivf, argi)) \{}
\DoxyCodeLine{945       config-\/>write\_webm = 0;}
\DoxyCodeLine{946     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&threads, argi)) \{}
\DoxyCodeLine{947       config-\/>cfg.g\_threads = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{948     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&profile, argi)) \{}
\DoxyCodeLine{949       config-\/>cfg.g\_profile = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{950     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&width, argi)) \{}
\DoxyCodeLine{951       config-\/>cfg.g\_w = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{952     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&height, argi)) \{}
\DoxyCodeLine{953       config-\/>cfg.g\_h = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{954 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{955     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&bitdeptharg, argi)) \{}
\DoxyCodeLine{956       config-\/>cfg.g\_bit\_depth = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{957     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&inbitdeptharg, argi)) \{}
\DoxyCodeLine{958       config-\/>cfg.g\_input\_bit\_depth = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{959 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{960 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{961     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&stereo\_mode, argi)) \{}
\DoxyCodeLine{962       config-\/>stereo\_fmt = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{963 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{964     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&timebase, argi)) \{}
\DoxyCodeLine{965       config-\/>cfg.g\_timebase = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{966       validate\_positive\_rational(arg.name, \&config-\/>cfg.g\_timebase);}
\DoxyCodeLine{967     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&error\_resilient, argi)) \{}
\DoxyCodeLine{968       config-\/>cfg.g\_error\_resilient = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{969     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&end\_usage, argi)) \{}
\DoxyCodeLine{970       config-\/>cfg.rc\_end\_usage = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{971     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&lag\_in\_frames, argi)) \{}
\DoxyCodeLine{972       config-\/>cfg.g\_lag\_in\_frames = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{973       \textcolor{keywordflow}{if} (global-\/>deadline == \mbox{\hyperlink{group__encoder_ga04253cc9ec1146d72fa8bb86bcf32144}{VPX\_DL\_REALTIME}} \&\&}
\DoxyCodeLine{974           config-\/>cfg.rc\_end\_usage == \mbox{\hyperlink{group__encoder_ggaf50e74d91be4cae6f70dfeba5b7410d2a8b02853cb35790d60cc171a11f6c268a}{VPX\_CBR}} \&\&}
\DoxyCodeLine{975           config-\/>cfg.g\_lag\_in\_frames != 0) \{}
\DoxyCodeLine{976         warn(\textcolor{stringliteral}{"{}non-\/zero \%s option ignored in realtime CBR mode.\(\backslash\)n"{}}, arg.name);}
\DoxyCodeLine{977         config-\/>cfg.g\_lag\_in\_frames = 0;}
\DoxyCodeLine{978       \}}
\DoxyCodeLine{979     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&dropframe\_thresh, argi)) \{}
\DoxyCodeLine{980       config-\/>cfg.rc\_dropframe\_thresh = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{981     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&resize\_allowed, argi)) \{}
\DoxyCodeLine{982       config-\/>cfg.rc\_resize\_allowed = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{983     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&resize\_width, argi)) \{}
\DoxyCodeLine{984       config-\/>cfg.rc\_scaled\_width = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{985     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&resize\_height, argi)) \{}
\DoxyCodeLine{986       config-\/>cfg.rc\_scaled\_height = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{987     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&resize\_up\_thresh, argi)) \{}
\DoxyCodeLine{988       config-\/>cfg.rc\_resize\_up\_thresh = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{989     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&resize\_down\_thresh, argi)) \{}
\DoxyCodeLine{990       config-\/>cfg.rc\_resize\_down\_thresh = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{991     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&end\_usage, argi)) \{}
\DoxyCodeLine{992       config-\/>cfg.rc\_end\_usage = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{993     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&target\_bitrate, argi)) \{}
\DoxyCodeLine{994       config-\/>cfg.rc\_target\_bitrate = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{995     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&min\_quantizer, argi)) \{}
\DoxyCodeLine{996       config-\/>cfg.rc\_min\_quantizer = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{997     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&max\_quantizer, argi)) \{}
\DoxyCodeLine{998       config-\/>cfg.rc\_max\_quantizer = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{999     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&undershoot\_pct, argi)) \{}
\DoxyCodeLine{1000       config-\/>cfg.rc\_undershoot\_pct = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1001     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&overshoot\_pct, argi)) \{}
\DoxyCodeLine{1002       config-\/>cfg.rc\_overshoot\_pct = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1003     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&buf\_sz, argi)) \{}
\DoxyCodeLine{1004       config-\/>cfg.rc\_buf\_sz = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1005     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&buf\_initial\_sz, argi)) \{}
\DoxyCodeLine{1006       config-\/>cfg.rc\_buf\_initial\_sz = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1007     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&buf\_optimal\_sz, argi)) \{}
\DoxyCodeLine{1008       config-\/>cfg.rc\_buf\_optimal\_sz = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1009     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&bias\_pct, argi)) \{}
\DoxyCodeLine{1010       config-\/>cfg.rc\_2pass\_vbr\_bias\_pct = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1011       \textcolor{keywordflow}{if} (global-\/>passes < 2)}
\DoxyCodeLine{1012         warn(\textcolor{stringliteral}{"{}option \%s ignored in one-\/pass mode.\(\backslash\)n"{}}, arg.name);}
\DoxyCodeLine{1013     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&minsection\_pct, argi)) \{}
\DoxyCodeLine{1014       config-\/>cfg.rc\_2pass\_vbr\_minsection\_pct = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1015 }
\DoxyCodeLine{1016       \textcolor{keywordflow}{if} (global-\/>passes < 2)}
\DoxyCodeLine{1017         warn(\textcolor{stringliteral}{"{}option \%s ignored in one-\/pass mode.\(\backslash\)n"{}}, arg.name);}
\DoxyCodeLine{1018     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&maxsection\_pct, argi)) \{}
\DoxyCodeLine{1019       config-\/>cfg.rc\_2pass\_vbr\_maxsection\_pct = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1020 }
\DoxyCodeLine{1021       \textcolor{keywordflow}{if} (global-\/>passes < 2)}
\DoxyCodeLine{1022         warn(\textcolor{stringliteral}{"{}option \%s ignored in one-\/pass mode.\(\backslash\)n"{}}, arg.name);}
\DoxyCodeLine{1023     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&corpus\_complexity, argi)) \{}
\DoxyCodeLine{1024       config-\/>cfg.rc\_2pass\_vbr\_corpus\_complexity = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1025 }
\DoxyCodeLine{1026       \textcolor{keywordflow}{if} (global-\/>passes < 2)}
\DoxyCodeLine{1027         warn(\textcolor{stringliteral}{"{}option \%s ignored in one-\/pass mode.\(\backslash\)n"{}}, arg.name);}
\DoxyCodeLine{1028     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_min\_dist, argi)) \{}
\DoxyCodeLine{1029       config-\/>cfg.kf\_min\_dist = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1030     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_max\_dist, argi)) \{}
\DoxyCodeLine{1031       config-\/>cfg.kf\_max\_dist = arg\_parse\_uint(\&arg);}
\DoxyCodeLine{1032     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_disabled, argi)) \{}
\DoxyCodeLine{1033       config-\/>cfg.kf\_mode = \mbox{\hyperlink{group__encoder_gga9f461802aa4db35c04a8b23837987f40a56513f60cbf3434ca0092173005d0ab2}{VPX\_KF\_DISABLED}};}
\DoxyCodeLine{1034 \textcolor{preprocessor}{\#if CONFIG\_VP9\_ENCODER}}
\DoxyCodeLine{1035     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&use\_vizier\_rc\_params, argi)) \{}
\DoxyCodeLine{1036       config-\/>cfg.use\_vizier\_rc\_params = arg\_parse\_int(\&arg);}
\DoxyCodeLine{1037     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&active\_wq\_factor, argi)) \{}
\DoxyCodeLine{1038       config-\/>cfg.active\_wq\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1039     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&err\_per\_mb\_factor, argi)) \{}
\DoxyCodeLine{1040       config-\/>cfg.err\_per\_mb\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1041     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&sr\_default\_decay\_limit, argi)) \{}
\DoxyCodeLine{1042       config-\/>cfg.sr\_default\_decay\_limit = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1043     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&sr\_diff\_factor, argi)) \{}
\DoxyCodeLine{1044       config-\/>cfg.sr\_diff\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1045     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_err\_per\_mb\_factor, argi)) \{}
\DoxyCodeLine{1046       config-\/>cfg.kf\_err\_per\_mb\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1047     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_frame\_min\_boost\_factor, argi)) \{}
\DoxyCodeLine{1048       config-\/>cfg.kf\_frame\_min\_boost\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1049     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_frame\_max\_boost\_first\_factor, argi)) \{}
\DoxyCodeLine{1050       config-\/>cfg.kf\_frame\_max\_boost\_first\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1051     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_frame\_max\_boost\_subs\_factor, argi)) \{}
\DoxyCodeLine{1052       config-\/>cfg.kf\_frame\_max\_boost\_subs\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1053     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&kf\_max\_total\_boost\_factor, argi)) \{}
\DoxyCodeLine{1054       config-\/>cfg.kf\_max\_total\_boost\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1055     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&gf\_max\_total\_boost\_factor, argi)) \{}
\DoxyCodeLine{1056       config-\/>cfg.gf\_max\_total\_boost\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1057     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&gf\_frame\_max\_boost\_factor, argi)) \{}
\DoxyCodeLine{1058       config-\/>cfg.gf\_frame\_max\_boost\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1059     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&zm\_factor, argi)) \{}
\DoxyCodeLine{1060       config-\/>cfg.zm\_factor = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1061     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rd\_mult\_inter\_qp\_fac, argi)) \{}
\DoxyCodeLine{1062       config-\/>cfg.rd\_mult\_inter\_qp\_fac = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1063     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rd\_mult\_arf\_qp\_fac, argi)) \{}
\DoxyCodeLine{1064       config-\/>cfg.rd\_mult\_arf\_qp\_fac = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1065     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&rd\_mult\_key\_qp\_fac, argi)) \{}
\DoxyCodeLine{1066       config-\/>cfg.rd\_mult\_key\_qp\_fac = arg\_parse\_rational(\&arg);}
\DoxyCodeLine{1067 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1068 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1069     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arg\_match(\&arg, \&test16bitinternalarg, argi)) \{}
\DoxyCodeLine{1070       \textcolor{keywordflow}{if} (strcmp(global-\/>codec-\/>name, \textcolor{stringliteral}{"{}vp9"{}}) == 0) \{}
\DoxyCodeLine{1071         test\_16bit\_internal = 1;}
\DoxyCodeLine{1072       \}}
\DoxyCodeLine{1073 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1074     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1075       \textcolor{keywordtype}{int} i, match = 0;}
\DoxyCodeLine{1076       \textcolor{keywordflow}{for} (i = 0; ctrl\_args[i]; i++) \{}
\DoxyCodeLine{1077         \textcolor{keywordflow}{if} (arg\_match(\&arg, ctrl\_args[i], argi)) \{}
\DoxyCodeLine{1078           \textcolor{keywordtype}{int} j;}
\DoxyCodeLine{1079           match = 1;}
\DoxyCodeLine{1080 }
\DoxyCodeLine{1081           \textcolor{comment}{/* Point either to the next free element or the first}}
\DoxyCodeLine{1082 \textcolor{comment}{           * instance of this control.}}
\DoxyCodeLine{1083 \textcolor{comment}{           */}}
\DoxyCodeLine{1084           \textcolor{keywordflow}{for} (j = 0; j < config-\/>arg\_ctrl\_cnt; j++)}
\DoxyCodeLine{1085             \textcolor{keywordflow}{if} (ctrl\_args\_map != NULL \&\&}
\DoxyCodeLine{1086                 config-\/>arg\_ctrls[j][0] == ctrl\_args\_map[i])}
\DoxyCodeLine{1087               \textcolor{keywordflow}{break};}
\DoxyCodeLine{1088 }
\DoxyCodeLine{1089           \textcolor{comment}{/* Update/insert */}}
\DoxyCodeLine{1090           assert(j < (\textcolor{keywordtype}{int})ARG\_CTRL\_CNT\_MAX);}
\DoxyCodeLine{1091           \textcolor{keywordflow}{if} (ctrl\_args\_map != NULL \&\& j < (\textcolor{keywordtype}{int})ARG\_CTRL\_CNT\_MAX) \{}
\DoxyCodeLine{1092             config-\/>arg\_ctrls[j][0] = ctrl\_args\_map[i];}
\DoxyCodeLine{1093             config-\/>arg\_ctrls[j][1] = arg\_parse\_enum\_or\_int(\&arg);}
\DoxyCodeLine{1094             \textcolor{keywordflow}{if} (j == config-\/>arg\_ctrl\_cnt) config-\/>arg\_ctrl\_cnt++;}
\DoxyCodeLine{1095           \}}
\DoxyCodeLine{1096         \}}
\DoxyCodeLine{1097       \}}
\DoxyCodeLine{1098       \textcolor{keywordflow}{if} (!match) argj++;}
\DoxyCodeLine{1099     \}}
\DoxyCodeLine{1100   \}}
\DoxyCodeLine{1101 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1102   \textcolor{keywordflow}{if} (strcmp(global-\/>codec-\/>name, \textcolor{stringliteral}{"{}vp9"{}}) == 0) \{}
\DoxyCodeLine{1103     config-\/>use\_16bit\_internal =}
\DoxyCodeLine{1104         test\_16bit\_internal | (config-\/>cfg.g\_profile > 1);}
\DoxyCodeLine{1105   \}}
\DoxyCodeLine{1106 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1107   \textcolor{keywordflow}{return} eos\_mark\_found;}
\DoxyCodeLine{1108 \}}
\DoxyCodeLine{1109 }
\DoxyCodeLine{1110 \textcolor{preprocessor}{\#define FOREACH\_STREAM(func)                                \(\backslash\)}}
\DoxyCodeLine{1111 \textcolor{preprocessor}{  do \{                                                      \(\backslash\)}}
\DoxyCodeLine{1112 \textcolor{preprocessor}{    struct stream\_state *stream;                            \(\backslash\)}}
\DoxyCodeLine{1113 \textcolor{preprocessor}{    for (stream = streams; stream; stream = stream-\/>next) \{ \(\backslash\)}}
\DoxyCodeLine{1114 \textcolor{preprocessor}{      func;                                                 \(\backslash\)}}
\DoxyCodeLine{1115 \textcolor{preprocessor}{    \}                                                       \(\backslash\)}}
\DoxyCodeLine{1116 \textcolor{preprocessor}{  \} while (0)}}
\DoxyCodeLine{1117 }
\DoxyCodeLine{1118 \textcolor{keyword}{static} \textcolor{keywordtype}{void} validate\_stream\_config(\textcolor{keyword}{const} \textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1119                                    \textcolor{keyword}{const} \textcolor{keyword}{struct} VpxEncoderConfig *global) \{}
\DoxyCodeLine{1120   \textcolor{keyword}{const} \textcolor{keyword}{struct }stream\_state *streami;}
\DoxyCodeLine{1121   (void)global;}
\DoxyCodeLine{1122 }
\DoxyCodeLine{1123   \textcolor{keywordflow}{if} (!stream-\/>config.cfg.g\_w || !stream-\/>config.cfg.g\_h)}
\DoxyCodeLine{1124     fatal(}
\DoxyCodeLine{1125         \textcolor{stringliteral}{"{}Stream \%d: Specify stream dimensions with -\/-\/width (-\/w) "{}}}
\DoxyCodeLine{1126         \textcolor{stringliteral}{"{} and -\/-\/height (-\/h)"{}},}
\DoxyCodeLine{1127         stream-\/>index);}
\DoxyCodeLine{1128 }
\DoxyCodeLine{1129   \textcolor{comment}{// Check that the codec bit depth is greater than the input bit depth.}}
\DoxyCodeLine{1130   \textcolor{keywordflow}{if} (stream-\/>config.cfg.g\_input\_bit\_depth >}
\DoxyCodeLine{1131       (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})stream-\/>config.cfg.g\_bit\_depth) \{}
\DoxyCodeLine{1132     fatal(\textcolor{stringliteral}{"{}Stream \%d: codec bit depth (\%d) less than input bit depth (\%d)"{}},}
\DoxyCodeLine{1133           stream-\/>index, (\textcolor{keywordtype}{int})stream-\/>config.cfg.g\_bit\_depth,}
\DoxyCodeLine{1134           stream-\/>config.cfg.g\_input\_bit\_depth);}
\DoxyCodeLine{1135   \}}
\DoxyCodeLine{1136 }
\DoxyCodeLine{1137   \textcolor{keywordflow}{for} (streami = stream; streami; streami = streami-\/>next) \{}
\DoxyCodeLine{1138     \textcolor{comment}{/* All streams require output files */}}
\DoxyCodeLine{1139     \textcolor{keywordflow}{if} (!streami-\/>config.out\_fn)}
\DoxyCodeLine{1140       fatal(\textcolor{stringliteral}{"{}Stream \%d: Output file is required (specify with -\/o)"{}},}
\DoxyCodeLine{1141             streami-\/>index);}
\DoxyCodeLine{1142 }
\DoxyCodeLine{1143     \textcolor{comment}{/* Check for two streams outputting to the same file */}}
\DoxyCodeLine{1144     \textcolor{keywordflow}{if} (streami != stream) \{}
\DoxyCodeLine{1145       \textcolor{keyword}{const} \textcolor{keywordtype}{char} *a = stream-\/>config.out\_fn;}
\DoxyCodeLine{1146       \textcolor{keyword}{const} \textcolor{keywordtype}{char} *b = streami-\/>config.out\_fn;}
\DoxyCodeLine{1147       \textcolor{keywordflow}{if} (!strcmp(a, b) \&\& strcmp(a, \textcolor{stringliteral}{"{}/dev/null"{}}) \&\& strcmp(a, \textcolor{stringliteral}{"{}:nul"{}}))}
\DoxyCodeLine{1148         fatal(\textcolor{stringliteral}{"{}Stream \%d: duplicate output file (from stream \%d)"{}},}
\DoxyCodeLine{1149               streami-\/>index, stream-\/>index);}
\DoxyCodeLine{1150     \}}
\DoxyCodeLine{1151 }
\DoxyCodeLine{1152     \textcolor{comment}{/* Check for two streams sharing a stats file. */}}
\DoxyCodeLine{1153     \textcolor{keywordflow}{if} (streami != stream) \{}
\DoxyCodeLine{1154       \textcolor{keyword}{const} \textcolor{keywordtype}{char} *a = stream-\/>config.stats\_fn;}
\DoxyCodeLine{1155       \textcolor{keyword}{const} \textcolor{keywordtype}{char} *b = streami-\/>config.stats\_fn;}
\DoxyCodeLine{1156       \textcolor{keywordflow}{if} (a \&\& b \&\& !strcmp(a, b))}
\DoxyCodeLine{1157         fatal(\textcolor{stringliteral}{"{}Stream \%d: duplicate stats file (from stream \%d)"{}},}
\DoxyCodeLine{1158               streami-\/>index, stream-\/>index);}
\DoxyCodeLine{1159     \}}
\DoxyCodeLine{1160   \}}
\DoxyCodeLine{1161 \}}
\DoxyCodeLine{1162 }
\DoxyCodeLine{1163 \textcolor{keyword}{static} \textcolor{keywordtype}{void} set\_stream\_dimensions(\textcolor{keyword}{struct} stream\_state *stream, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} w,}
\DoxyCodeLine{1164                                   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} h) \{}
\DoxyCodeLine{1165   \textcolor{keywordflow}{if} (!stream-\/>config.cfg.g\_w) \{}
\DoxyCodeLine{1166     \textcolor{keywordflow}{if} (!stream-\/>config.cfg.g\_h)}
\DoxyCodeLine{1167       stream-\/>config.cfg.g\_w = w;}
\DoxyCodeLine{1168     \textcolor{keywordflow}{else}}
\DoxyCodeLine{1169       stream-\/>config.cfg.g\_w = w * stream-\/>config.cfg.g\_h / h;}
\DoxyCodeLine{1170   \}}
\DoxyCodeLine{1171   \textcolor{keywordflow}{if} (!stream-\/>config.cfg.g\_h) \{}
\DoxyCodeLine{1172     stream-\/>config.cfg.g\_h = h * stream-\/>config.cfg.g\_w / w;}
\DoxyCodeLine{1173   \}}
\DoxyCodeLine{1174 \}}
\DoxyCodeLine{1175 }
\DoxyCodeLine{1176 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_type\_to\_string(\textcolor{keyword}{enum} VideoFileType t) \{}
\DoxyCodeLine{1177   \textcolor{keywordflow}{switch} (t) \{}
\DoxyCodeLine{1178     \textcolor{keywordflow}{case} FILE\_TYPE\_RAW: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}RAW"{}};}
\DoxyCodeLine{1179     \textcolor{keywordflow}{case} FILE\_TYPE\_Y4M: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Y4M"{}};}
\DoxyCodeLine{1180     \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Other"{}};}
\DoxyCodeLine{1181   \}}
\DoxyCodeLine{1182 \}}
\DoxyCodeLine{1183 }
\DoxyCodeLine{1184 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *image\_format\_to\_string(\mbox{\hyperlink{vpx__image_8h_ad491e9c858d337700cca18afc8412545}{vpx\_img\_fmt\_t}} f) \{}
\DoxyCodeLine{1185   \textcolor{keywordflow}{switch} (f) \{}
\DoxyCodeLine{1186     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I420"{}};}
\DoxyCodeLine{1187     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193aff252f61fc80e0c71924beac4615e812}{VPX\_IMG\_FMT\_I422}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I422"{}};}
\DoxyCodeLine{1188     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193aaeaaafc8f14c88e1a63ff9da398c9f99}{VPX\_IMG\_FMT\_I444}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I444"{}};}
\DoxyCodeLine{1189     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193abd8236de582725101cc28e5df344adf0}{VPX\_IMG\_FMT\_I440}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I440"{}};}
\DoxyCodeLine{1190     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a6e4e8961bbcf96478c300dc4c3e1dc18}{VPX\_IMG\_FMT\_YV12}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}YV12"{}};}
\DoxyCodeLine{1191     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I42016"{}};}
\DoxyCodeLine{1192     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a1564a04c49b4d043678ea5252137fd59}{VPX\_IMG\_FMT\_I42216}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I42216"{}};}
\DoxyCodeLine{1193     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193aea72721e07f09e733aa6d7fe2efd5178}{VPX\_IMG\_FMT\_I44416}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I44416"{}};}
\DoxyCodeLine{1194     \textcolor{keywordflow}{case} \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a2f62c84c87d447666f2f19ce5a54052e}{VPX\_IMG\_FMT\_I44016}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}I44016"{}};}
\DoxyCodeLine{1195     \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Other"{}};}
\DoxyCodeLine{1196   \}}
\DoxyCodeLine{1197 \}}
\DoxyCodeLine{1198 }
\DoxyCodeLine{1199 \textcolor{keyword}{static} \textcolor{keywordtype}{void} show\_stream\_config(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1200                                \textcolor{keyword}{struct} VpxEncoderConfig *global,}
\DoxyCodeLine{1201                                \textcolor{keyword}{struct} VpxInputContext *input) \{}
\DoxyCodeLine{1202 \textcolor{preprocessor}{\#define SHOW(field) \(\backslash\)}}
\DoxyCodeLine{1203 \textcolor{preprocessor}{  fprintf(stderr, "{}    \%-\/28s = \%d\(\backslash\)n"{}}, \#field, stream-\/>config.cfg.field)}
\DoxyCodeLine{1204 }
\DoxyCodeLine{1205   \textcolor{keywordflow}{if} (stream-\/>index == 0) \{}
\DoxyCodeLine{1206     fprintf(stderr, \textcolor{stringliteral}{"{}Codec: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{1207             \mbox{\hyperlink{group__codec_ga723b3bb6778e7362bb2eb2058348a530}{vpx\_codec\_iface\_name}}(global-\/>codec-\/>codec\_interface()));}
\DoxyCodeLine{1208     fprintf(stderr, \textcolor{stringliteral}{"{}Source file: \%s File Type: \%s Format: \%s\(\backslash\)n"{}},}
\DoxyCodeLine{1209             input-\/>filename, file\_type\_to\_string(input-\/>file\_type),}
\DoxyCodeLine{1210             image\_format\_to\_string(input-\/>fmt));}
\DoxyCodeLine{1211   \}}
\DoxyCodeLine{1212   \textcolor{keywordflow}{if} (stream-\/>next || stream-\/>index)}
\DoxyCodeLine{1213     fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)nStream Index: \%d\(\backslash\)n"{}}, stream-\/>index);}
\DoxyCodeLine{1214   fprintf(stderr, \textcolor{stringliteral}{"{}Destination file: \%s\(\backslash\)n"{}}, stream-\/>config.out\_fn);}
\DoxyCodeLine{1215   fprintf(stderr, \textcolor{stringliteral}{"{}Encoder parameters:\(\backslash\)n"{}});}
\DoxyCodeLine{1216 }
\DoxyCodeLine{1217   SHOW(g\_usage);}
\DoxyCodeLine{1218   SHOW(g\_threads);}
\DoxyCodeLine{1219   SHOW(g\_profile);}
\DoxyCodeLine{1220   SHOW(g\_w);}
\DoxyCodeLine{1221   SHOW(g\_h);}
\DoxyCodeLine{1222   SHOW(g\_bit\_depth);}
\DoxyCodeLine{1223   SHOW(g\_input\_bit\_depth);}
\DoxyCodeLine{1224   SHOW(g\_timebase.num);}
\DoxyCodeLine{1225   SHOW(g\_timebase.den);}
\DoxyCodeLine{1226   SHOW(g\_error\_resilient);}
\DoxyCodeLine{1227   SHOW(g\_pass);}
\DoxyCodeLine{1228   SHOW(g\_lag\_in\_frames);}
\DoxyCodeLine{1229   SHOW(rc\_dropframe\_thresh);}
\DoxyCodeLine{1230   SHOW(rc\_resize\_allowed);}
\DoxyCodeLine{1231   SHOW(rc\_scaled\_width);}
\DoxyCodeLine{1232   SHOW(rc\_scaled\_height);}
\DoxyCodeLine{1233   SHOW(rc\_resize\_up\_thresh);}
\DoxyCodeLine{1234   SHOW(rc\_resize\_down\_thresh);}
\DoxyCodeLine{1235   SHOW(rc\_end\_usage);}
\DoxyCodeLine{1236   SHOW(rc\_target\_bitrate);}
\DoxyCodeLine{1237   SHOW(rc\_min\_quantizer);}
\DoxyCodeLine{1238   SHOW(rc\_max\_quantizer);}
\DoxyCodeLine{1239   SHOW(rc\_undershoot\_pct);}
\DoxyCodeLine{1240   SHOW(rc\_overshoot\_pct);}
\DoxyCodeLine{1241   SHOW(rc\_buf\_sz);}
\DoxyCodeLine{1242   SHOW(rc\_buf\_initial\_sz);}
\DoxyCodeLine{1243   SHOW(rc\_buf\_optimal\_sz);}
\DoxyCodeLine{1244   SHOW(rc\_2pass\_vbr\_bias\_pct);}
\DoxyCodeLine{1245   SHOW(rc\_2pass\_vbr\_minsection\_pct);}
\DoxyCodeLine{1246   SHOW(rc\_2pass\_vbr\_maxsection\_pct);}
\DoxyCodeLine{1247   SHOW(rc\_2pass\_vbr\_corpus\_complexity);}
\DoxyCodeLine{1248   SHOW(kf\_mode);}
\DoxyCodeLine{1249   SHOW(kf\_min\_dist);}
\DoxyCodeLine{1250   SHOW(kf\_max\_dist);}
\DoxyCodeLine{1251   \textcolor{comment}{// Temporary use for debug}}
\DoxyCodeLine{1252   SHOW(use\_vizier\_rc\_params);}
\DoxyCodeLine{1253   SHOW(active\_wq\_factor.num);}
\DoxyCodeLine{1254   SHOW(active\_wq\_factor.den);}
\DoxyCodeLine{1255 \}}
\DoxyCodeLine{1256 }
\DoxyCodeLine{1257 \textcolor{keyword}{static} \textcolor{keywordtype}{void} open\_output\_file(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1258                              \textcolor{keyword}{struct} VpxEncoderConfig *global,}
\DoxyCodeLine{1259                              \textcolor{keyword}{const} \textcolor{keyword}{struct} VpxRational *pixel\_aspect\_ratio) \{}
\DoxyCodeLine{1260   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fn = stream-\/>config.out\_fn;}
\DoxyCodeLine{1261   \textcolor{keyword}{const} \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg}} *\textcolor{keyword}{const} cfg = \&stream-\/>config.cfg;}
\DoxyCodeLine{1262 }
\DoxyCodeLine{1263   \textcolor{keywordflow}{if} (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a70d62d87aae7d1168746577f14a6dccf}{g\_pass}} == \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493faa0765945345b160905f3b762986dae3b}{VPX\_RC\_FIRST\_PASS}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{1264 }
\DoxyCodeLine{1265   stream-\/>file = strcmp(fn, \textcolor{stringliteral}{"{}-\/"{}}) ? fopen(fn, \textcolor{stringliteral}{"{}wb"{}}) : set\_binary\_mode(stdout);}
\DoxyCodeLine{1266 }
\DoxyCodeLine{1267   \textcolor{keywordflow}{if} (!stream-\/>file) fatal(\textcolor{stringliteral}{"{}Failed to open output file"{}});}
\DoxyCodeLine{1268 }
\DoxyCodeLine{1269   \textcolor{keywordflow}{if} (stream-\/>config.write\_webm \&\& fseek(stream-\/>file, 0, SEEK\_CUR))}
\DoxyCodeLine{1270     fatal(\textcolor{stringliteral}{"{}WebM output to pipes not supported."{}});}
\DoxyCodeLine{1271 }
\DoxyCodeLine{1272 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{1273   \textcolor{keywordflow}{if} (stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1274     stream-\/>webm\_ctx.stream = stream-\/>file;}
\DoxyCodeLine{1275     write\_webm\_file\_header(\&stream-\/>webm\_ctx, cfg, stream-\/>config.stereo\_fmt,}
\DoxyCodeLine{1276                            global-\/>codec-\/>fourcc, pixel\_aspect\_ratio);}
\DoxyCodeLine{1277   \}}
\DoxyCodeLine{1278 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1279   (void)pixel\_aspect\_ratio;}
\DoxyCodeLine{1280 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1281 }
\DoxyCodeLine{1282   \textcolor{keywordflow}{if} (!stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1283     ivf\_write\_file\_header(stream-\/>file, cfg, global-\/>codec-\/>fourcc, 0);}
\DoxyCodeLine{1284   \}}
\DoxyCodeLine{1285 \}}
\DoxyCodeLine{1286 }
\DoxyCodeLine{1287 \textcolor{keyword}{static} \textcolor{keywordtype}{void} close\_output\_file(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1288                               \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} fourcc) \{}
\DoxyCodeLine{1289   \textcolor{keyword}{const} \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg}} *\textcolor{keyword}{const} cfg = \&stream-\/>config.cfg;}
\DoxyCodeLine{1290 }
\DoxyCodeLine{1291   \textcolor{keywordflow}{if} (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a70d62d87aae7d1168746577f14a6dccf}{g\_pass}} == \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493faa0765945345b160905f3b762986dae3b}{VPX\_RC\_FIRST\_PASS}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{1292 }
\DoxyCodeLine{1293 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{1294   \textcolor{keywordflow}{if} (stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1295     write\_webm\_file\_footer(\&stream-\/>webm\_ctx);}
\DoxyCodeLine{1296   \}}
\DoxyCodeLine{1297 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1298 }
\DoxyCodeLine{1299   \textcolor{keywordflow}{if} (!stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1300     \textcolor{keywordflow}{if} (!fseek(stream-\/>file, 0, SEEK\_SET))}
\DoxyCodeLine{1301       ivf\_write\_file\_header(stream-\/>file, \&stream-\/>config.cfg, fourcc,}
\DoxyCodeLine{1302                             stream-\/>frames\_out);}
\DoxyCodeLine{1303   \}}
\DoxyCodeLine{1304 }
\DoxyCodeLine{1305   fclose(stream-\/>file);}
\DoxyCodeLine{1306 \}}
\DoxyCodeLine{1307 }
\DoxyCodeLine{1308 \textcolor{keyword}{static} \textcolor{keywordtype}{void} setup\_pass(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1309                        \textcolor{keyword}{struct} VpxEncoderConfig *global, \textcolor{keywordtype}{int} pass) \{}
\DoxyCodeLine{1310   \textcolor{keywordflow}{if} (stream-\/>config.stats\_fn) \{}
\DoxyCodeLine{1311     \textcolor{keywordflow}{if} (!stats\_open\_file(\&stream-\/>stats, stream-\/>config.stats\_fn, pass))}
\DoxyCodeLine{1312       fatal(\textcolor{stringliteral}{"{}Failed to open statistics store"{}});}
\DoxyCodeLine{1313   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1314     \textcolor{keywordflow}{if} (!stats\_open\_mem(\&stream-\/>stats, pass))}
\DoxyCodeLine{1315       fatal(\textcolor{stringliteral}{"{}Failed to open statistics store"{}});}
\DoxyCodeLine{1316   \}}
\DoxyCodeLine{1317 }
\DoxyCodeLine{1318   stream-\/>config.cfg.g\_pass = global-\/>passes == 2}
\DoxyCodeLine{1319                                   ? pass ? \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493fa65da543b956d6a9b1f301ab8cc90d3a7}{VPX\_RC\_LAST\_PASS}} : \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493faa0765945345b160905f3b762986dae3b}{VPX\_RC\_FIRST\_PASS}}}
\DoxyCodeLine{1320                                   : \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493fa7b6943a41868e8e26a77e9500f139ca1}{VPX\_RC\_ONE\_PASS}};}
\DoxyCodeLine{1321   \textcolor{keywordflow}{if} (pass) \{}
\DoxyCodeLine{1322     stream-\/>config.cfg.rc\_twopass\_stats\_in = stats\_get(\&stream-\/>stats);}
\DoxyCodeLine{1323   \}}
\DoxyCodeLine{1324 }
\DoxyCodeLine{1325   stream-\/>cx\_time = 0;}
\DoxyCodeLine{1326   stream-\/>nbytes = 0;}
\DoxyCodeLine{1327   stream-\/>frames\_out = 0;}
\DoxyCodeLine{1328 \}}
\DoxyCodeLine{1329 }
\DoxyCodeLine{1330 \textcolor{keyword}{static} \textcolor{keywordtype}{void} initialize\_encoder(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1331                                \textcolor{keyword}{struct} VpxEncoderConfig *global) \{}
\DoxyCodeLine{1332   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{1333   \textcolor{keywordtype}{int} flags = 0;}
\DoxyCodeLine{1334 }
\DoxyCodeLine{1335   flags |= global-\/>show\_psnr ? \mbox{\hyperlink{group__encoder_ga57bb9eb1881c7e4bf86580660a5e40a0}{VPX\_CODEC\_USE\_PSNR}} : 0;}
\DoxyCodeLine{1336   flags |= global-\/>out\_part ? \mbox{\hyperlink{group__encoder_gac26cd92b3719953aa0fbb0ff8c1d9c8d}{VPX\_CODEC\_USE\_OUTPUT\_PARTITION}} : 0;}
\DoxyCodeLine{1337 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1338   flags |= stream-\/>config.use\_16bit\_internal ? \mbox{\hyperlink{group__encoder_ga69576ef94099286853e64aee29661608}{VPX\_CODEC\_USE\_HIGHBITDEPTH}} : 0;}
\DoxyCodeLine{1339 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1340 }
\DoxyCodeLine{1341   \textcolor{comment}{/* Construct Encoder Context */}}
\DoxyCodeLine{1342   \mbox{\hyperlink{group__encoder_ga3d490a2a9a6acd7c9ef82a603155f3cf}{vpx\_codec\_enc\_init}}(\&stream-\/>encoder, global-\/>codec-\/>codec\_interface(),}
\DoxyCodeLine{1343                      \&stream-\/>config.cfg, flags);}
\DoxyCodeLine{1344   ctx\_exit\_on\_error(\&stream-\/>encoder, \textcolor{stringliteral}{"{}Failed to initialize encoder"{}});}
\DoxyCodeLine{1345 }
\DoxyCodeLine{1346   \textcolor{comment}{/* Note that we bypass the vpx\_codec\_control wrapper macro because}}
\DoxyCodeLine{1347 \textcolor{comment}{   * we're being clever to store the control IDs in an array. Real}}
\DoxyCodeLine{1348 \textcolor{comment}{   * applications will want to make use of the enumerations directly}}
\DoxyCodeLine{1349 \textcolor{comment}{   */}}
\DoxyCodeLine{1350   \textcolor{keywordflow}{for} (i = 0; i < stream-\/>config.arg\_ctrl\_cnt; i++) \{}
\DoxyCodeLine{1351     \textcolor{keywordtype}{int} ctrl = stream-\/>config.arg\_ctrls[i][0];}
\DoxyCodeLine{1352     \textcolor{keywordtype}{int} value = stream-\/>config.arg\_ctrls[i][1];}
\DoxyCodeLine{1353     \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__codec_gaf7849b69cc390b21d889c8c71f69ec14}{vpx\_codec\_control\_}}(\&stream-\/>encoder, ctrl, value))}
\DoxyCodeLine{1354       fprintf(stderr, \textcolor{stringliteral}{"{}Error: Tried to set control \%d = \%d\(\backslash\)n"{}}, ctrl, value);}
\DoxyCodeLine{1355 }
\DoxyCodeLine{1356     ctx\_exit\_on\_error(\&stream-\/>encoder, \textcolor{stringliteral}{"{}Failed to control codec"{}});}
\DoxyCodeLine{1357   \}}
\DoxyCodeLine{1358 }
\DoxyCodeLine{1359 \textcolor{preprocessor}{\#if CONFIG\_DECODERS}}
\DoxyCodeLine{1360   \textcolor{keywordflow}{if} (global-\/>test\_decode != TEST\_DECODE\_OFF) \{}
\DoxyCodeLine{1361     \textcolor{keyword}{const} VpxInterface *decoder = get\_vpx\_decoder\_by\_name(global-\/>codec-\/>name);}
\DoxyCodeLine{1362     \mbox{\hyperlink{group__decoder_ga8c2f0b12f1bd4927eb3c68b01eab19d3}{vpx\_codec\_dec\_init}}(\&stream-\/>decoder, decoder-\/>codec\_interface(), NULL, 0);}
\DoxyCodeLine{1363   \}}
\DoxyCodeLine{1364 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1365 \}}
\DoxyCodeLine{1366 }
\DoxyCodeLine{1367 \textcolor{keyword}{static} \textcolor{keywordtype}{void} encode\_frame(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1368                          \textcolor{keyword}{struct} VpxEncoderConfig *global, \textcolor{keyword}{struct} \mbox{\hyperlink{structvpx__image}{vpx\_image}} *img,}
\DoxyCodeLine{1369                          \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frames\_in) \{}
\DoxyCodeLine{1370   \mbox{\hyperlink{group__encoder_ga7e711b0a71c65aef8f0faea8bd57b05f}{vpx\_codec\_pts\_t}} frame\_start, next\_frame\_start;}
\DoxyCodeLine{1371   \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg}} *cfg = \&stream-\/>config.cfg;}
\DoxyCodeLine{1372   \textcolor{keyword}{struct }vpx\_usec\_timer timer;}
\DoxyCodeLine{1373 }
\DoxyCodeLine{1374   frame\_start =}
\DoxyCodeLine{1375       (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} * (int64\_t)(frames\_in -\/ 1) * global-\/>framerate.den) /}
\DoxyCodeLine{1376       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} / global-\/>framerate.num;}
\DoxyCodeLine{1377   next\_frame\_start =}
\DoxyCodeLine{1378       (cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_a29dd2ab4001377b3aa21885ef969759f}{den}} * (int64\_t)(frames\_in)*global-\/>framerate.den) /}
\DoxyCodeLine{1379       cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a6498d378e4c29ef3e22258289e481087}{g\_timebase}}.\mbox{\hyperlink{structvpx__rational_ae7774f21a22c9bef3aa73156c79f4731}{num}} / global-\/>framerate.num;}
\DoxyCodeLine{1380 }
\DoxyCodeLine{1381 \textcolor{comment}{/* Scale if necessary */}}
\DoxyCodeLine{1382 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1383   \textcolor{keywordflow}{if} (img) \{}
\DoxyCodeLine{1384     \textcolor{keywordflow}{if} ((img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \&\&}
\DoxyCodeLine{1385         (img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} != cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} || img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}} != cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}})) \{}
\DoxyCodeLine{1386       \textcolor{keywordflow}{if} (img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}}) \{}
\DoxyCodeLine{1387         fprintf(stderr, \textcolor{stringliteral}{"{}\%s can only scale 4:2:0 inputs\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{1388         exit(EXIT\_FAILURE);}
\DoxyCodeLine{1389       \}}
\DoxyCodeLine{1390 \textcolor{preprocessor}{\#if CONFIG\_LIBYUV}}
\DoxyCodeLine{1391       \textcolor{keywordflow}{if} (!stream-\/>img) \{}
\DoxyCodeLine{1392         stream-\/>img =}
\DoxyCodeLine{1393             \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(NULL, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a93598e3a282b878ddad1487de80918c2}{VPX\_IMG\_FMT\_I42016}}, cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}}, 16);}
\DoxyCodeLine{1394       \}}
\DoxyCodeLine{1395       I420Scale\_16(}
\DoxyCodeLine{1396           (uint16\_t *)img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}], img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}] / 2,}
\DoxyCodeLine{1397           (uint16\_t *)img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}], img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}] / 2,}
\DoxyCodeLine{1398           (uint16\_t *)img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}] / 2,}
\DoxyCodeLine{1399           img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, (uint16\_t *)stream-\/>img-\/>planes[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}],}
\DoxyCodeLine{1400           stream-\/>img-\/>stride[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}] / 2,}
\DoxyCodeLine{1401           (uint16\_t *)stream-\/>img-\/>planes[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}],}
\DoxyCodeLine{1402           stream-\/>img-\/>stride[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}] / 2,}
\DoxyCodeLine{1403           (uint16\_t *)stream-\/>img-\/>planes[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}],}
\DoxyCodeLine{1404           stream-\/>img-\/>stride[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}] / 2, stream-\/>img-\/>d\_w,}
\DoxyCodeLine{1405           stream-\/>img-\/>d\_h, kFilterBox);}
\DoxyCodeLine{1406       img = stream-\/>img;}
\DoxyCodeLine{1407 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1408       stream-\/>encoder.err = 1;}
\DoxyCodeLine{1409       ctx\_exit\_on\_error(\&stream-\/>encoder,}
\DoxyCodeLine{1410                         \textcolor{stringliteral}{"{}Stream \%d: Failed to encode frame.\(\backslash\)n"{}}}
\DoxyCodeLine{1411                         \textcolor{stringliteral}{"{}Scaling disabled in this configuration. \(\backslash\)n"{}}}
\DoxyCodeLine{1412                         \textcolor{stringliteral}{"{}To enable, configure with -\/-\/enable-\/libyuv\(\backslash\)n"{}},}
\DoxyCodeLine{1413                         stream-\/>index);}
\DoxyCodeLine{1414 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1415     \}}
\DoxyCodeLine{1416   \}}
\DoxyCodeLine{1417 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1418   \textcolor{keywordflow}{if} (img \&\& (img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}} != cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}} || img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}} != cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}})) \{}
\DoxyCodeLine{1419     \textcolor{keywordflow}{if} (img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}} \&\& img-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} != \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a6e4e8961bbcf96478c300dc4c3e1dc18}{VPX\_IMG\_FMT\_YV12}}) \{}
\DoxyCodeLine{1420       fprintf(stderr, \textcolor{stringliteral}{"{}\%s can only scale 4:2:0 8bpp inputs\(\backslash\)n"{}}, exec\_name);}
\DoxyCodeLine{1421       exit(EXIT\_FAILURE);}
\DoxyCodeLine{1422     \}}
\DoxyCodeLine{1423 \textcolor{preprocessor}{\#if CONFIG\_LIBYUV}}
\DoxyCodeLine{1424     \textcolor{keywordflow}{if} (!stream-\/>img)}
\DoxyCodeLine{1425       stream-\/>img =}
\DoxyCodeLine{1426           \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(NULL, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a5c165f5b41ca1158f2883983a2b7709c}{g\_w}}, cfg-\/>\mbox{\hyperlink{structvpx__codec__enc__cfg_a4132bd89ce85bce7c08f2cc3b6f2b82e}{g\_h}}, 16);}
\DoxyCodeLine{1427     I420Scale(}
\DoxyCodeLine{1428         img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}], img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}],}
\DoxyCodeLine{1429         img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}], img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}],}
\DoxyCodeLine{1430         img-\/>\mbox{\hyperlink{structvpx__image_ab6258308ba7a5f4a113348120e20e2ce}{planes}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], img-\/>\mbox{\hyperlink{structvpx__image_ac9c7b83e3eea44cb680956f90dc789cf}{stride}}[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], img-\/>\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, img-\/>\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}},}
\DoxyCodeLine{1431         stream-\/>img-\/>planes[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}], stream-\/>img-\/>stride[\mbox{\hyperlink{vpx__image_8h_a08171c4636c655e1ab0b76e06219f9e2}{VPX\_PLANE\_Y}}],}
\DoxyCodeLine{1432         stream-\/>img-\/>planes[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}], stream-\/>img-\/>stride[\mbox{\hyperlink{vpx__image_8h_a4770fc8fa60021a2229f25553152cf81}{VPX\_PLANE\_U}}],}
\DoxyCodeLine{1433         stream-\/>img-\/>planes[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}], stream-\/>img-\/>stride[\mbox{\hyperlink{vpx__image_8h_aca9436ec761457cc6d2e356e0ac2fd23}{VPX\_PLANE\_V}}],}
\DoxyCodeLine{1434         stream-\/>img-\/>d\_w, stream-\/>img-\/>d\_h, kFilterBox);}
\DoxyCodeLine{1435     img = stream-\/>img;}
\DoxyCodeLine{1436 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1437     stream-\/>encoder.err = 1;}
\DoxyCodeLine{1438     ctx\_exit\_on\_error(\&stream-\/>encoder,}
\DoxyCodeLine{1439                       \textcolor{stringliteral}{"{}Stream \%d: Failed to encode frame.\(\backslash\)n"{}}}
\DoxyCodeLine{1440                       \textcolor{stringliteral}{"{}Scaling disabled in this configuration. \(\backslash\)n"{}}}
\DoxyCodeLine{1441                       \textcolor{stringliteral}{"{}To enable, configure with -\/-\/enable-\/libyuv\(\backslash\)n"{}},}
\DoxyCodeLine{1442                       stream-\/>index);}
\DoxyCodeLine{1443 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1444   \}}
\DoxyCodeLine{1445 }
\DoxyCodeLine{1446   vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{1447   \mbox{\hyperlink{group__encoder_gaf990542e2aeb389f05fae3e9c7803639}{vpx\_codec\_encode}}(\&stream-\/>encoder, img, frame\_start,}
\DoxyCodeLine{1448                    (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})(next\_frame\_start -\/ frame\_start), 0,}
\DoxyCodeLine{1449                    global-\/>deadline);}
\DoxyCodeLine{1450   vpx\_usec\_timer\_mark(\&timer);}
\DoxyCodeLine{1451   stream-\/>cx\_time += vpx\_usec\_timer\_elapsed(\&timer);}
\DoxyCodeLine{1452   ctx\_exit\_on\_error(\&stream-\/>encoder, \textcolor{stringliteral}{"{}Stream \%d: Failed to encode frame"{}},}
\DoxyCodeLine{1453                     stream-\/>index);}
\DoxyCodeLine{1454 \}}
\DoxyCodeLine{1455 }
\DoxyCodeLine{1456 \textcolor{keyword}{static} \textcolor{keywordtype}{void} update\_quantizer\_histogram(\textcolor{keyword}{struct} stream\_state *stream) \{}
\DoxyCodeLine{1457   \textcolor{keywordflow}{if} (stream-\/>config.cfg.g\_pass != \mbox{\hyperlink{group__encoder_gga476c5417f9c15a1dc5d3f68fa44c493faa0765945345b160905f3b762986dae3b}{VPX\_RC\_FIRST\_PASS}}) \{}
\DoxyCodeLine{1458     \textcolor{keywordtype}{int} q;}
\DoxyCodeLine{1459 }
\DoxyCodeLine{1460     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&stream-\/>encoder, \mbox{\hyperlink{group__vp8__encoder_gga6deae3d561c838952552c3d3756322ecad2cfc9712d2eab30b5a59a60d0daaade}{VP8E\_GET\_LAST\_QUANTIZER\_64}}, \&q);}
\DoxyCodeLine{1461     ctx\_exit\_on\_error(\&stream-\/>encoder, \textcolor{stringliteral}{"{}Failed to read quantizer"{}});}
\DoxyCodeLine{1462     stream-\/>counts[q]++;}
\DoxyCodeLine{1463   \}}
\DoxyCodeLine{1464 \}}
\DoxyCodeLine{1465 }
\DoxyCodeLine{1466 \textcolor{keyword}{static} \textcolor{keywordtype}{void} get\_cx\_data(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1467                         \textcolor{keyword}{struct} VpxEncoderConfig *global, \textcolor{keywordtype}{int} *got\_data) \{}
\DoxyCodeLine{1468   \textcolor{keyword}{const} \mbox{\hyperlink{structvpx__codec__cx__pkt}{vpx\_codec\_cx\_pkt\_t}} *pkt;}
\DoxyCodeLine{1469   \textcolor{keyword}{const} \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__codec__enc__cfg}{vpx\_codec\_enc\_cfg}} *cfg = \&stream-\/>config.cfg;}
\DoxyCodeLine{1470   \mbox{\hyperlink{group__codec_ga6ea348f76b1f8a1fe50e14db684146c6}{vpx\_codec\_iter\_t}} iter = NULL;}
\DoxyCodeLine{1471 }
\DoxyCodeLine{1472   *got\_data = 0;}
\DoxyCodeLine{1473   \textcolor{keywordflow}{while} ((pkt = \mbox{\hyperlink{group__encoder_ga5f7ee7fb6c7e5af848db9f363b3c375c}{vpx\_codec\_get\_cx\_data}}(\&stream-\/>encoder, \&iter))) \{}
\DoxyCodeLine{1474     \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} fsize = 0;}
\DoxyCodeLine{1475     \textcolor{keyword}{static} FileOffset ivf\_header\_pos = 0;}
\DoxyCodeLine{1476 }
\DoxyCodeLine{1477     \textcolor{keywordflow}{switch} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_a41f395b39516343c1329a4a85a0084f2}{kind}}) \{}
\DoxyCodeLine{1478       \textcolor{keywordflow}{case} \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a2261aae5594289400e812fb1e6b6b0cc}{VPX\_CODEC\_CX\_FRAME\_PKT}}:}
\DoxyCodeLine{1479         \textcolor{keywordflow}{if} (!(pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_gafb9f7dbf9b8a764c521d8b12c0e6959d}{VPX\_FRAME\_IS\_FRAGMENT}})) \{}
\DoxyCodeLine{1480           stream-\/>frames\_out++;}
\DoxyCodeLine{1481         \}}
\DoxyCodeLine{1482         \textcolor{keywordflow}{if} (!global-\/>quiet)}
\DoxyCodeLine{1483           fprintf(stderr, \textcolor{stringliteral}{"{} \%6luF"{}}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}});}
\DoxyCodeLine{1484 }
\DoxyCodeLine{1485         update\_rate\_histogram(stream-\/>rate\_hist, cfg, pkt);}
\DoxyCodeLine{1486 \textcolor{preprocessor}{\#if CONFIG\_WEBM\_IO}}
\DoxyCodeLine{1487         \textcolor{keywordflow}{if} (stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1488           write\_webm\_block(\&stream-\/>webm\_ctx, cfg, pkt);}
\DoxyCodeLine{1489         \}}
\DoxyCodeLine{1490 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1491         \textcolor{keywordflow}{if} (!stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1492           \textcolor{keywordflow}{if} (pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aaffee6af93af238ca7a145fb56c6d6f7}{partition\_id}} <= 0) \{}
\DoxyCodeLine{1493             ivf\_header\_pos = ftello(stream-\/>file);}
\DoxyCodeLine{1494             fsize = pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}};}
\DoxyCodeLine{1495 }
\DoxyCodeLine{1496             ivf\_write\_frame\_header(stream-\/>file, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aa75fe039fe6b47fb25d20684864bef12}{pts}}, fsize);}
\DoxyCodeLine{1497           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1498             fsize += pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}};}
\DoxyCodeLine{1499 }
\DoxyCodeLine{1500             \textcolor{keywordflow}{if} (!(pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a3876fe0306342611465e9c15c6c4ae2f}{flags}} \& \mbox{\hyperlink{group__encoder_gafb9f7dbf9b8a764c521d8b12c0e6959d}{VPX\_FRAME\_IS\_FRAGMENT}})) \{}
\DoxyCodeLine{1501               \textcolor{keyword}{const} FileOffset currpos = ftello(stream-\/>file);}
\DoxyCodeLine{1502               fseeko(stream-\/>file, ivf\_header\_pos, SEEK\_SET);}
\DoxyCodeLine{1503               ivf\_write\_frame\_size(stream-\/>file, fsize);}
\DoxyCodeLine{1504               fseeko(stream-\/>file, currpos, SEEK\_SET);}
\DoxyCodeLine{1505             \}}
\DoxyCodeLine{1506           \}}
\DoxyCodeLine{1507 }
\DoxyCodeLine{1508           (void)fwrite(pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}}, 1, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}},}
\DoxyCodeLine{1509                        stream-\/>file);}
\DoxyCodeLine{1510         \}}
\DoxyCodeLine{1511         stream-\/>nbytes += pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aaa868193733b055ea9fec923c64fbd19}{raw}}.\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}};}
\DoxyCodeLine{1512 }
\DoxyCodeLine{1513         *got\_data = 1;}
\DoxyCodeLine{1514 \textcolor{preprocessor}{\#if CONFIG\_DECODERS}}
\DoxyCodeLine{1515         \textcolor{keywordflow}{if} (global-\/>test\_decode != TEST\_DECODE\_OFF \&\& !stream-\/>mismatch\_seen) \{}
\DoxyCodeLine{1516           \mbox{\hyperlink{group__decoder_ga3441e157a7a69108bca9a069f2ee8e0d}{vpx\_codec\_decode}}(\&stream-\/>decoder, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a9e1db068593b6037e70b05b5239784d2}{buf}},}
\DoxyCodeLine{1517                            (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a7928a49d271fa3d34c9f41160c66e015}{frame}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a857321ba2dc65e81c430d14c36a542d9}{sz}}, NULL, 0);}
\DoxyCodeLine{1518           \textcolor{keywordflow}{if} (stream-\/>decoder.err) \{}
\DoxyCodeLine{1519             warn\_or\_exit\_on\_error(\&stream-\/>decoder,}
\DoxyCodeLine{1520                                   global-\/>test\_decode == TEST\_DECODE\_FATAL,}
\DoxyCodeLine{1521                                   \textcolor{stringliteral}{"{}Failed to decode frame \%d in stream \%d"{}},}
\DoxyCodeLine{1522                                   stream-\/>frames\_out + 1, stream-\/>index);}
\DoxyCodeLine{1523             stream-\/>mismatch\_seen = stream-\/>frames\_out + 1;}
\DoxyCodeLine{1524           \}}
\DoxyCodeLine{1525         \}}
\DoxyCodeLine{1526 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1527         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1528       \textcolor{keywordflow}{case} \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a77cd8b95d9891bcce36117f5f31994fd}{VPX\_CODEC\_STATS\_PKT}}:}
\DoxyCodeLine{1529         stream-\/>frames\_out++;}
\DoxyCodeLine{1530         stats\_write(\&stream-\/>stats, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a4018900fa26ecc55abc4703cc7d7c7fc}{twopass\_stats}}.\mbox{\hyperlink{structvpx__fixed__buf_ac93e43ae3fcc1023dca86d37016ae3f0}{buf}},}
\DoxyCodeLine{1531                     pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a4018900fa26ecc55abc4703cc7d7c7fc}{twopass\_stats}}.\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}});}
\DoxyCodeLine{1532         stream-\/>nbytes += pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_aaa868193733b055ea9fec923c64fbd19}{raw}}.\mbox{\hyperlink{structvpx__fixed__buf_a43d7f8247ed9752f65f0a7639817ae84}{sz}};}
\DoxyCodeLine{1533         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1534       \textcolor{keywordflow}{case} \mbox{\hyperlink{group__encoder_gga28a79375279536526552af3a83d2ed72a11eefa1328e6d22eb7c844645a260628}{VPX\_CODEC\_PSNR\_PKT}}:}
\DoxyCodeLine{1535 }
\DoxyCodeLine{1536         \textcolor{keywordflow}{if} (global-\/>show\_psnr) \{}
\DoxyCodeLine{1537           \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{1538 }
\DoxyCodeLine{1539           stream-\/>psnr\_sse\_total += pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a63744aeceb50355d6402d55309c151b6}{psnr}}.sse[0];}
\DoxyCodeLine{1540           stream-\/>psnr\_samples\_total += pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a63744aeceb50355d6402d55309c151b6}{psnr}}.samples[0];}
\DoxyCodeLine{1541           \textcolor{keywordflow}{for} (i = 0; i < 4; i++) \{}
\DoxyCodeLine{1542             \textcolor{keywordflow}{if} (!global-\/>quiet)}
\DoxyCodeLine{1543               fprintf(stderr, \textcolor{stringliteral}{"{}\%.3f "{}}, pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a63744aeceb50355d6402d55309c151b6}{psnr}}.psnr[i]);}
\DoxyCodeLine{1544             stream-\/>psnr\_totals[i] += pkt-\/>\mbox{\hyperlink{structvpx__codec__cx__pkt_afd9885d1a95a351c96eee6c45a184e1a}{data}}.\mbox{\hyperlink{structvpx__codec__cx__pkt_a63744aeceb50355d6402d55309c151b6}{psnr}}.psnr[i];}
\DoxyCodeLine{1545           \}}
\DoxyCodeLine{1546           stream-\/>psnr\_count++;}
\DoxyCodeLine{1547         \}}
\DoxyCodeLine{1548 }
\DoxyCodeLine{1549         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1550       \textcolor{keywordflow}{default}: \textcolor{keywordflow}{break};}
\DoxyCodeLine{1551     \}}
\DoxyCodeLine{1552   \}}
\DoxyCodeLine{1553 \}}
\DoxyCodeLine{1554 }
\DoxyCodeLine{1555 \textcolor{keyword}{static} \textcolor{keywordtype}{void} show\_psnr(\textcolor{keyword}{struct} stream\_state *stream, \textcolor{keywordtype}{double} peak) \{}
\DoxyCodeLine{1556   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{1557   \textcolor{keywordtype}{double} ovpsnr;}
\DoxyCodeLine{1558 }
\DoxyCodeLine{1559   \textcolor{keywordflow}{if} (!stream-\/>psnr\_count) \textcolor{keywordflow}{return};}
\DoxyCodeLine{1560 }
\DoxyCodeLine{1561   fprintf(stderr, \textcolor{stringliteral}{"{}Stream \%d PSNR (Overall/Avg/Y/U/V)"{}}, stream-\/>index);}
\DoxyCodeLine{1562   ovpsnr = sse\_to\_psnr((\textcolor{keywordtype}{double})stream-\/>psnr\_samples\_total, peak,}
\DoxyCodeLine{1563                        (\textcolor{keywordtype}{double})stream-\/>psnr\_sse\_total);}
\DoxyCodeLine{1564   fprintf(stderr, \textcolor{stringliteral}{"{} \%.3f"{}}, ovpsnr);}
\DoxyCodeLine{1565 }
\DoxyCodeLine{1566   \textcolor{keywordflow}{for} (i = 0; i < 4; i++) \{}
\DoxyCodeLine{1567     fprintf(stderr, \textcolor{stringliteral}{"{} \%.3f"{}}, stream-\/>psnr\_totals[i] / stream-\/>psnr\_count);}
\DoxyCodeLine{1568   \}}
\DoxyCodeLine{1569   fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{1570 \}}
\DoxyCodeLine{1571 }
\DoxyCodeLine{1572 \textcolor{keyword}{static} \textcolor{keywordtype}{float} usec\_to\_fps(uint64\_t usec, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} frames) \{}
\DoxyCodeLine{1573   \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})(usec > 0 ? frames * 1000000.0 / (float)usec : 0);}
\DoxyCodeLine{1574 \}}
\DoxyCodeLine{1575 }
\DoxyCodeLine{1576 \textcolor{keyword}{static} \textcolor{keywordtype}{void} test\_decode(\textcolor{keyword}{struct} stream\_state *stream,}
\DoxyCodeLine{1577                         \textcolor{keyword}{enum} TestDecodeFatality fatal,}
\DoxyCodeLine{1578                         \textcolor{keyword}{const} VpxInterface *codec) \{}
\DoxyCodeLine{1579   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} enc\_img, dec\_img;}
\DoxyCodeLine{1580 }
\DoxyCodeLine{1581   \textcolor{keywordflow}{if} (stream-\/>mismatch\_seen) \textcolor{keywordflow}{return};}
\DoxyCodeLine{1582 }
\DoxyCodeLine{1583   \textcolor{comment}{/* Get the internal reference frame */}}
\DoxyCodeLine{1584   \textcolor{keywordflow}{if} (strcmp(codec-\/>name, \textcolor{stringliteral}{"{}vp8"{}}) == 0) \{}
\DoxyCodeLine{1585     \textcolor{keyword}{struct }\mbox{\hyperlink{structvpx__ref__frame}{vpx\_ref\_frame}} ref\_enc, ref\_dec;}
\DoxyCodeLine{1586     \textcolor{keywordtype}{int} width, height;}
\DoxyCodeLine{1587 }
\DoxyCodeLine{1588     width = (stream-\/>config.cfg.g\_w + 15) \& \string~15;}
\DoxyCodeLine{1589     height = (stream-\/>config.cfg.g\_h + 15) \& \string~15;}
\DoxyCodeLine{1590     \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&ref\_enc.img, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, width, height, 1);}
\DoxyCodeLine{1591     enc\_img = ref\_enc.img;}
\DoxyCodeLine{1592     \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&ref\_dec.img, \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}, width, height, 1);}
\DoxyCodeLine{1593     dec\_img = ref\_dec.img;}
\DoxyCodeLine{1594 }
\DoxyCodeLine{1595     ref\_enc.frame\_type = VP8\_LAST\_FRAME;}
\DoxyCodeLine{1596     ref\_dec.frame\_type = VP8\_LAST\_FRAME;}
\DoxyCodeLine{1597     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&stream-\/>encoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a5375b3ea3a4867d50daee6f5971c7470}{VP8\_COPY\_REFERENCE}}, \&ref\_enc);}
\DoxyCodeLine{1598     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&stream-\/>decoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a5375b3ea3a4867d50daee6f5971c7470}{VP8\_COPY\_REFERENCE}}, \&ref\_dec);}
\DoxyCodeLine{1599   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1600     \textcolor{keyword}{struct }\mbox{\hyperlink{structvp9__ref__frame}{vp9\_ref\_frame}} ref\_enc, ref\_dec;}
\DoxyCodeLine{1601 }
\DoxyCodeLine{1602     ref\_enc.\mbox{\hyperlink{structvp9__ref__frame_a26e0d119a61c29b72c6ccb91748b6b82}{idx}} = 0;}
\DoxyCodeLine{1603     ref\_dec.idx = 0;}
\DoxyCodeLine{1604     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&stream-\/>encoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a91e44472b21c720a9a7d087c7226d083}{VP9\_GET\_REFERENCE}}, \&ref\_enc);}
\DoxyCodeLine{1605     enc\_img = ref\_enc.img;}
\DoxyCodeLine{1606     \mbox{\hyperlink{group__codec_gac1b91e04698c1bd4c0a2b8aa85b08cd2}{vpx\_codec\_control}}(\&stream-\/>decoder, \mbox{\hyperlink{group__vp8_gga8cadbc8e0af3da96ef7a2dbd4ed06599a91e44472b21c720a9a7d087c7226d083}{VP9\_GET\_REFERENCE}}, \&ref\_dec);}
\DoxyCodeLine{1607     dec\_img = ref\_dec.img;}
\DoxyCodeLine{1608 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1609     \textcolor{keywordflow}{if} ((enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) !=}
\DoxyCodeLine{1610         (dec\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}})) \{}
\DoxyCodeLine{1611       \textcolor{keywordflow}{if} (enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \{}
\DoxyCodeLine{1612         \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&enc\_img, enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} -\/ \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}},}
\DoxyCodeLine{1613                       enc\_img.\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, enc\_img.\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, 16);}
\DoxyCodeLine{1614         vpx\_img\_truncate\_16\_to\_8(\&enc\_img, \&ref\_enc.img);}
\DoxyCodeLine{1615       \}}
\DoxyCodeLine{1616       \textcolor{keywordflow}{if} (dec\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \{}
\DoxyCodeLine{1617         \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&dec\_img, dec\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} -\/ \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}},}
\DoxyCodeLine{1618                       dec\_img.\mbox{\hyperlink{structvpx__image_a806bf23143bf00a0b3fdbd6ba030c483}{d\_w}}, dec\_img.\mbox{\hyperlink{structvpx__image_a31bc5f045d4f3c2b6bb0f57bb53078e7}{d\_h}}, 16);}
\DoxyCodeLine{1619         vpx\_img\_truncate\_16\_to\_8(\&dec\_img, \&ref\_dec.img);}
\DoxyCodeLine{1620       \}}
\DoxyCodeLine{1621     \}}
\DoxyCodeLine{1622 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1623   \}}
\DoxyCodeLine{1624   ctx\_exit\_on\_error(\&stream-\/>encoder, \textcolor{stringliteral}{"{}Failed to get encoder reference frame"{}});}
\DoxyCodeLine{1625   ctx\_exit\_on\_error(\&stream-\/>decoder, \textcolor{stringliteral}{"{}Failed to get decoder reference frame"{}});}
\DoxyCodeLine{1626 }
\DoxyCodeLine{1627   \textcolor{keywordflow}{if} (!compare\_img(\&enc\_img, \&dec\_img)) \{}
\DoxyCodeLine{1628     \textcolor{keywordtype}{int} y[4], u[4], v[4];}
\DoxyCodeLine{1629 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1630     \textcolor{keywordflow}{if} (enc\_img.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) \{}
\DoxyCodeLine{1631       find\_mismatch\_high(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{1632     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1633       find\_mismatch(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{1634     \}}
\DoxyCodeLine{1635 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1636     find\_mismatch(\&enc\_img, \&dec\_img, y, u, v);}
\DoxyCodeLine{1637 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1638     stream-\/>decoder.err = 1;}
\DoxyCodeLine{1639     warn\_or\_exit\_on\_error(\&stream-\/>decoder, fatal == TEST\_DECODE\_FATAL,}
\DoxyCodeLine{1640                           \textcolor{stringliteral}{"{}Stream \%d: Encode/decode mismatch on frame \%d at"{}}}
\DoxyCodeLine{1641                           \textcolor{stringliteral}{"{} Y[\%d, \%d] \{\%d/\%d\},"{}}}
\DoxyCodeLine{1642                           \textcolor{stringliteral}{"{} U[\%d, \%d] \{\%d/\%d\},"{}}}
\DoxyCodeLine{1643                           \textcolor{stringliteral}{"{} V[\%d, \%d] \{\%d/\%d\}"{}},}
\DoxyCodeLine{1644                           stream-\/>index, stream-\/>frames\_out, y[0], y[1], y[2],}
\DoxyCodeLine{1645                           y[3], u[0], u[1], u[2], u[3], v[0], v[1], v[2], v[3]);}
\DoxyCodeLine{1646     stream-\/>mismatch\_seen = stream-\/>frames\_out;}
\DoxyCodeLine{1647   \}}
\DoxyCodeLine{1648 }
\DoxyCodeLine{1649   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&enc\_img);}
\DoxyCodeLine{1650   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&dec\_img);}
\DoxyCodeLine{1651 \}}
\DoxyCodeLine{1652 }
\DoxyCodeLine{1653 \textcolor{keyword}{static} \textcolor{keywordtype}{void} print\_time(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *label, int64\_t etl) \{}
\DoxyCodeLine{1654   int64\_t hours;}
\DoxyCodeLine{1655   int64\_t mins;}
\DoxyCodeLine{1656   int64\_t secs;}
\DoxyCodeLine{1657 }
\DoxyCodeLine{1658   \textcolor{keywordflow}{if} (etl >= 0) \{}
\DoxyCodeLine{1659     hours = etl / 3600;}
\DoxyCodeLine{1660     etl -\/= hours * 3600;}
\DoxyCodeLine{1661     mins = etl / 60;}
\DoxyCodeLine{1662     etl -\/= mins * 60;}
\DoxyCodeLine{1663     secs = etl;}
\DoxyCodeLine{1664 }
\DoxyCodeLine{1665     fprintf(stderr, \textcolor{stringliteral}{"{}[\%3s \%2"{}} PRId64 \textcolor{stringliteral}{"{}:\%02"{}} PRId64 \textcolor{stringliteral}{"{}:\%02"{}} PRId64 \textcolor{stringliteral}{"{}] "{}}, label,}
\DoxyCodeLine{1666             hours, mins, secs);}
\DoxyCodeLine{1667   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1668     fprintf(stderr, \textcolor{stringliteral}{"{}[\%3s  unknown] "{}}, label);}
\DoxyCodeLine{1669   \}}
\DoxyCodeLine{1670 \}}
\DoxyCodeLine{1671 }
\DoxyCodeLine{1672 \textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv\_) \{}
\DoxyCodeLine{1673   \textcolor{keywordtype}{int} pass;}
\DoxyCodeLine{1674   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw;}
\DoxyCodeLine{1675 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1676   \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} raw\_shift;}
\DoxyCodeLine{1677   \textcolor{keywordtype}{int} allocated\_raw\_shift = 0;}
\DoxyCodeLine{1678   \textcolor{keywordtype}{int} use\_16bit\_internal = 0;}
\DoxyCodeLine{1679   \textcolor{keywordtype}{int} input\_shift = 0;}
\DoxyCodeLine{1680 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1681   \textcolor{keywordtype}{int} frame\_avail, got\_data;}
\DoxyCodeLine{1682 }
\DoxyCodeLine{1683   \textcolor{keyword}{struct }VpxInputContext input;}
\DoxyCodeLine{1684   \textcolor{keyword}{struct }VpxEncoderConfig global;}
\DoxyCodeLine{1685   \textcolor{keyword}{struct }stream\_state *streams = NULL;}
\DoxyCodeLine{1686   \textcolor{keywordtype}{char} **argv, **argi;}
\DoxyCodeLine{1687   uint64\_t cx\_time = 0;}
\DoxyCodeLine{1688   \textcolor{keywordtype}{int} stream\_cnt = 0;}
\DoxyCodeLine{1689   \textcolor{keywordtype}{int} res = 0;}
\DoxyCodeLine{1690 }
\DoxyCodeLine{1691   memset(\&input, 0, \textcolor{keyword}{sizeof}(input));}
\DoxyCodeLine{1692   memset(\&raw, 0, \textcolor{keyword}{sizeof}(raw));}
\DoxyCodeLine{1693   exec\_name = argv\_[0];}
\DoxyCodeLine{1694 }
\DoxyCodeLine{1695   \textcolor{comment}{/* Setup default input stream settings */}}
\DoxyCodeLine{1696   input.framerate.numerator = 30;}
\DoxyCodeLine{1697   input.framerate.denominator = 1;}
\DoxyCodeLine{1698   input.only\_i420 = 1;}
\DoxyCodeLine{1699   input.bit\_depth = 0;}
\DoxyCodeLine{1700 }
\DoxyCodeLine{1701   \textcolor{comment}{/* First parse the global configuration values, because we want to apply}}
\DoxyCodeLine{1702 \textcolor{comment}{   * other parameters on top of the default configuration provided by the}}
\DoxyCodeLine{1703 \textcolor{comment}{   * codec.}}
\DoxyCodeLine{1704 \textcolor{comment}{   */}}
\DoxyCodeLine{1705   argv = argv\_dup(argc -\/ 1, argv\_ + 1);}
\DoxyCodeLine{1706   parse\_global\_config(\&global, argv);}
\DoxyCodeLine{1707 }
\DoxyCodeLine{1708   \textcolor{keywordflow}{if} (argc < 3) usage\_exit();}
\DoxyCodeLine{1709 }
\DoxyCodeLine{1710   \textcolor{keywordflow}{switch} (global.color\_type) \{}
\DoxyCodeLine{1711     \textcolor{keywordflow}{case} I420: input.fmt = \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193af17ce49c9a6efd7c8c8ea8928d4ce26c}{VPX\_IMG\_FMT\_I420}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{1712     \textcolor{keywordflow}{case} I422: input.fmt = \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193aff252f61fc80e0c71924beac4615e812}{VPX\_IMG\_FMT\_I422}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{1713     \textcolor{keywordflow}{case} I444: input.fmt = \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193aaeaaafc8f14c88e1a63ff9da398c9f99}{VPX\_IMG\_FMT\_I444}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{1714     \textcolor{keywordflow}{case} I440: input.fmt = \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193abd8236de582725101cc28e5df344adf0}{VPX\_IMG\_FMT\_I440}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{1715     \textcolor{keywordflow}{case} YV12: input.fmt = \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a6e4e8961bbcf96478c300dc4c3e1dc18}{VPX\_IMG\_FMT\_YV12}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{1716     \textcolor{keywordflow}{case} NV12: input.fmt = \mbox{\hyperlink{vpx__image_8h_a7a30a7bff7400fb83ad45fede5077193a4dfa1428ebda772a75eabe412ca90207}{VPX\_IMG\_FMT\_NV12}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{1717   \}}
\DoxyCodeLine{1718 }
\DoxyCodeLine{1719   \{}
\DoxyCodeLine{1720     \textcolor{comment}{/* Now parse each stream's parameters. Using a local scope here}}
\DoxyCodeLine{1721 \textcolor{comment}{     * due to the use of 'stream' as loop variable in FOREACH\_STREAM}}
\DoxyCodeLine{1722 \textcolor{comment}{     * loops}}
\DoxyCodeLine{1723 \textcolor{comment}{     */}}
\DoxyCodeLine{1724     \textcolor{keyword}{struct }stream\_state *stream = NULL;}
\DoxyCodeLine{1725 }
\DoxyCodeLine{1726     \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{1727       stream = new\_stream(\&global, stream);}
\DoxyCodeLine{1728       stream\_cnt++;}
\DoxyCodeLine{1729       \textcolor{keywordflow}{if} (!streams) streams = stream;}
\DoxyCodeLine{1730     \} \textcolor{keywordflow}{while} (parse\_stream\_params(\&global, stream, argv));}
\DoxyCodeLine{1731   \}}
\DoxyCodeLine{1732 }
\DoxyCodeLine{1733   \textcolor{comment}{/* Check for unrecognized options */}}
\DoxyCodeLine{1734   \textcolor{keywordflow}{for} (argi = argv; *argi; argi++)}
\DoxyCodeLine{1735     \textcolor{keywordflow}{if} (argi[0][0] == \textcolor{charliteral}{'-\/'} \&\& argi[0][1])}
\DoxyCodeLine{1736       die(\textcolor{stringliteral}{"{}Error: Unrecognized option \%s\(\backslash\)n"{}}, *argi);}
\DoxyCodeLine{1737 }
\DoxyCodeLine{1738   FOREACH\_STREAM(check\_encoder\_config(global.disable\_warning\_prompt, \&global,}
\DoxyCodeLine{1739                                       \&stream-\/>config.cfg););}
\DoxyCodeLine{1740 }
\DoxyCodeLine{1741   \textcolor{comment}{/* Handle non-\/option arguments */}}
\DoxyCodeLine{1742   input.filename = argv[0];}
\DoxyCodeLine{1743 }
\DoxyCodeLine{1744   \textcolor{keywordflow}{if} (!input.filename) \{}
\DoxyCodeLine{1745     fprintf(stderr, \textcolor{stringliteral}{"{}No input file specified!\(\backslash\)n"{}});}
\DoxyCodeLine{1746     usage\_exit();}
\DoxyCodeLine{1747   \}}
\DoxyCodeLine{1748 }
\DoxyCodeLine{1749   \textcolor{comment}{/* Decide if other chroma subsamplings than 4:2:0 are supported */}}
\DoxyCodeLine{1750   \textcolor{keywordflow}{if} (global.codec-\/>fourcc == VP9\_FOURCC) input.only\_i420 = 0;}
\DoxyCodeLine{1751 }
\DoxyCodeLine{1752   \textcolor{keywordflow}{for} (pass = global.pass ? global.pass -\/ 1 : 0; pass < global.passes; pass++) \{}
\DoxyCodeLine{1753     \textcolor{keywordtype}{int} frames\_in = 0, seen\_frames = 0;}
\DoxyCodeLine{1754     int64\_t estimated\_time\_left = -\/1;}
\DoxyCodeLine{1755     int64\_t average\_rate = -\/1;}
\DoxyCodeLine{1756     int64\_t lagged\_count = 0;}
\DoxyCodeLine{1757 }
\DoxyCodeLine{1758     open\_input\_file(\&input);}
\DoxyCodeLine{1759 }
\DoxyCodeLine{1760     \textcolor{comment}{/* If the input file doesn't specify its w/h (raw files), try to get}}
\DoxyCodeLine{1761 \textcolor{comment}{     * the data from the first stream's configuration.}}
\DoxyCodeLine{1762 \textcolor{comment}{     */}}
\DoxyCodeLine{1763     \textcolor{keywordflow}{if} (!input.width || !input.height) \{}
\DoxyCodeLine{1764       FOREACH\_STREAM(\{}
\DoxyCodeLine{1765         \textcolor{keywordflow}{if} (stream-\/>config.cfg.g\_w \&\& stream-\/>config.cfg.g\_h) \{}
\DoxyCodeLine{1766           input.width = stream-\/>config.cfg.g\_w;}
\DoxyCodeLine{1767           input.height = stream-\/>config.cfg.g\_h;}
\DoxyCodeLine{1768           break;}
\DoxyCodeLine{1769         \}}
\DoxyCodeLine{1770       \});}
\DoxyCodeLine{1771     \}}
\DoxyCodeLine{1772 }
\DoxyCodeLine{1773     \textcolor{comment}{/* Update stream configurations from the input file's parameters */}}
\DoxyCodeLine{1774     \textcolor{keywordflow}{if} (!input.width || !input.height)}
\DoxyCodeLine{1775       fatal(}
\DoxyCodeLine{1776           \textcolor{stringliteral}{"{}Specify stream dimensions with -\/-\/width (-\/w) "{}}}
\DoxyCodeLine{1777           \textcolor{stringliteral}{"{} and -\/-\/height (-\/h)"{}});}
\DoxyCodeLine{1778 }
\DoxyCodeLine{1779     \textcolor{comment}{/* If input file does not specify bit-\/depth but input-\/bit-\/depth parameter}}
\DoxyCodeLine{1780 \textcolor{comment}{     * exists, assume that to be the input bit-\/depth. However, if the}}
\DoxyCodeLine{1781 \textcolor{comment}{     * input-\/bit-\/depth paramter does not exist, assume the input bit-\/depth}}
\DoxyCodeLine{1782 \textcolor{comment}{     * to be the same as the codec bit-\/depth.}}
\DoxyCodeLine{1783 \textcolor{comment}{     */}}
\DoxyCodeLine{1784     \textcolor{keywordflow}{if} (!input.bit\_depth) \{}
\DoxyCodeLine{1785       FOREACH\_STREAM(\{}
\DoxyCodeLine{1786         \textcolor{keywordflow}{if} (stream-\/>config.cfg.g\_input\_bit\_depth)}
\DoxyCodeLine{1787           input.bit\_depth = stream-\/>config.cfg.g\_input\_bit\_depth;}
\DoxyCodeLine{1788         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1789           input.bit\_depth = stream-\/>config.cfg.g\_input\_bit\_depth =}
\DoxyCodeLine{1790               (\textcolor{keywordtype}{int})stream-\/>config.cfg.g\_bit\_depth;}
\DoxyCodeLine{1791       \});}
\DoxyCodeLine{1792       \textcolor{keywordflow}{if} (input.bit\_depth > 8) input.fmt |= \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}};}
\DoxyCodeLine{1793     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1794       FOREACH\_STREAM(}
\DoxyCodeLine{1795           \{ stream-\/>config.cfg.g\_input\_bit\_depth = input.bit\_depth; \});}
\DoxyCodeLine{1796     \}}
\DoxyCodeLine{1797 }
\DoxyCodeLine{1798     FOREACH\_STREAM(set\_stream\_dimensions(stream, input.width, input.height));}
\DoxyCodeLine{1799     FOREACH\_STREAM(validate\_stream\_config(stream, \&global));}
\DoxyCodeLine{1800 }
\DoxyCodeLine{1801     \textcolor{comment}{/* Ensure that -\/-\/passes and -\/-\/pass are consistent. If -\/-\/pass is set and}}
\DoxyCodeLine{1802 \textcolor{comment}{     * -\/-\/passes=2, ensure -\/-\/fpf was set.}}
\DoxyCodeLine{1803 \textcolor{comment}{     */}}
\DoxyCodeLine{1804     \textcolor{keywordflow}{if} (global.pass \&\& global.passes == 2)}
\DoxyCodeLine{1805       FOREACH\_STREAM(\{}
\DoxyCodeLine{1806         \textcolor{keywordflow}{if} (!stream-\/>config.stats\_fn)}
\DoxyCodeLine{1807           die(\textcolor{stringliteral}{"{}Stream \%d: Must specify -\/-\/fpf when -\/-\/pass=\%d"{}}}
\DoxyCodeLine{1808               \textcolor{stringliteral}{"{} and -\/-\/passes=2\(\backslash\)n"{}},}
\DoxyCodeLine{1809               stream-\/>index, global.pass);}
\DoxyCodeLine{1810       \});}
\DoxyCodeLine{1811 }
\DoxyCodeLine{1812 \textcolor{preprocessor}{\#if !CONFIG\_WEBM\_IO}}
\DoxyCodeLine{1813     FOREACH\_STREAM(\{}
\DoxyCodeLine{1814       \textcolor{keywordflow}{if} (stream-\/>config.write\_webm) \{}
\DoxyCodeLine{1815         stream-\/>config.write\_webm = 0;}
\DoxyCodeLine{1816         warn(}
\DoxyCodeLine{1817             \textcolor{stringliteral}{"{}vpxenc was compiled without WebM container support."{}}}
\DoxyCodeLine{1818             \textcolor{stringliteral}{"{}Producing IVF output"{}});}
\DoxyCodeLine{1819       \}}
\DoxyCodeLine{1820     \});}
\DoxyCodeLine{1821 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1822 }
\DoxyCodeLine{1823     \textcolor{comment}{/* Use the frame rate from the file only if none was specified}}
\DoxyCodeLine{1824 \textcolor{comment}{     * on the command-\/line.}}
\DoxyCodeLine{1825 \textcolor{comment}{     */}}
\DoxyCodeLine{1826     \textcolor{keywordflow}{if} (!global.have\_framerate) \{}
\DoxyCodeLine{1827       global.framerate.num = input.framerate.numerator;}
\DoxyCodeLine{1828       global.framerate.den = input.framerate.denominator;}
\DoxyCodeLine{1829       FOREACH\_STREAM(stream-\/>config.cfg.g\_timebase.den = global.framerate.num;}
\DoxyCodeLine{1830                      stream-\/>config.cfg.g\_timebase.num = global.framerate.den);}
\DoxyCodeLine{1831     \}}
\DoxyCodeLine{1832 }
\DoxyCodeLine{1833     \textcolor{comment}{/* Show configuration */}}
\DoxyCodeLine{1834     \textcolor{keywordflow}{if} (global.verbose \&\& pass == 0)}
\DoxyCodeLine{1835       FOREACH\_STREAM(show\_stream\_config(stream, \&global, \&input));}
\DoxyCodeLine{1836 }
\DoxyCodeLine{1837     \textcolor{keywordflow}{if} (pass == (global.pass ? global.pass -\/ 1 : 0)) \{}
\DoxyCodeLine{1838       \textcolor{comment}{// The Y4M reader does its own allocation.}}
\DoxyCodeLine{1839       \textcolor{keywordflow}{if} (input.file\_type != FILE\_TYPE\_Y4M) \{}
\DoxyCodeLine{1840         \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw, input.fmt, input.width, input.height, 32);}
\DoxyCodeLine{1841       \}}
\DoxyCodeLine{1842       FOREACH\_STREAM(stream-\/>rate\_hist = init\_rate\_histogram(}
\DoxyCodeLine{1843                          \&stream-\/>config.cfg, \&global.framerate));}
\DoxyCodeLine{1844     \}}
\DoxyCodeLine{1845 }
\DoxyCodeLine{1846     FOREACH\_STREAM(setup\_pass(stream, \&global, pass));}
\DoxyCodeLine{1847     FOREACH\_STREAM(}
\DoxyCodeLine{1848         open\_output\_file(stream, \&global, \&input.pixel\_aspect\_ratio));}
\DoxyCodeLine{1849     FOREACH\_STREAM(initialize\_encoder(stream, \&global));}
\DoxyCodeLine{1850 }
\DoxyCodeLine{1851 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1852     \textcolor{keywordflow}{if} (strcmp(global.codec-\/>name, \textcolor{stringliteral}{"{}vp9"{}}) == 0) \{}
\DoxyCodeLine{1853       \textcolor{comment}{// Check to see if at least one stream uses 16 bit internal.}}
\DoxyCodeLine{1854       \textcolor{comment}{// Currently assume that the bit\_depths for all streams using}}
\DoxyCodeLine{1855       \textcolor{comment}{// highbitdepth are the same.}}
\DoxyCodeLine{1856       FOREACH\_STREAM(\{}
\DoxyCodeLine{1857         \textcolor{keywordflow}{if} (stream-\/>config.use\_16bit\_internal) \{}
\DoxyCodeLine{1858           use\_16bit\_internal = 1;}
\DoxyCodeLine{1859         \}}
\DoxyCodeLine{1860         if (stream-\/>config.cfg.g\_profile == 0) \{}
\DoxyCodeLine{1861           input\_shift = 0;}
\DoxyCodeLine{1862         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1863           input\_shift = (int)stream-\/>config.cfg.g\_bit\_depth -\/}
\DoxyCodeLine{1864                         stream-\/>config.cfg.g\_input\_bit\_depth;}
\DoxyCodeLine{1865         \}}
\DoxyCodeLine{1866       \});}
\DoxyCodeLine{1867     \}}
\DoxyCodeLine{1868 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1869 }
\DoxyCodeLine{1870     frame\_avail = 1;}
\DoxyCodeLine{1871     got\_data = 0;}
\DoxyCodeLine{1872 }
\DoxyCodeLine{1873     \textcolor{keywordflow}{while} (frame\_avail || got\_data) \{}
\DoxyCodeLine{1874       \textcolor{keyword}{struct }vpx\_usec\_timer timer;}
\DoxyCodeLine{1875 }
\DoxyCodeLine{1876       \textcolor{keywordflow}{if} (!global.limit || frames\_in < global.limit) \{}
\DoxyCodeLine{1877         frame\_avail = read\_frame(\&input, \&raw);}
\DoxyCodeLine{1878 }
\DoxyCodeLine{1879         \textcolor{keywordflow}{if} (frame\_avail) frames\_in++;}
\DoxyCodeLine{1880         seen\_frames =}
\DoxyCodeLine{1881             frames\_in > global.skip\_frames ? frames\_in -\/ global.skip\_frames : 0;}
\DoxyCodeLine{1882 }
\DoxyCodeLine{1883         \textcolor{keywordflow}{if} (!global.quiet) \{}
\DoxyCodeLine{1884           \textcolor{keywordtype}{float} fps = usec\_to\_fps(cx\_time, seen\_frames);}
\DoxyCodeLine{1885           fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)rPass \%d/\%d "{}}, pass + 1, global.passes);}
\DoxyCodeLine{1886 }
\DoxyCodeLine{1887           \textcolor{keywordflow}{if} (stream\_cnt == 1)}
\DoxyCodeLine{1888             fprintf(stderr, \textcolor{stringliteral}{"{}frame \%4d/\%-\/4d \%7"{}} PRId64 \textcolor{stringliteral}{"{}B "{}}, frames\_in,}
\DoxyCodeLine{1889                     streams-\/>frames\_out, (int64\_t)streams-\/>nbytes);}
\DoxyCodeLine{1890           \textcolor{keywordflow}{else}}
\DoxyCodeLine{1891             fprintf(stderr, \textcolor{stringliteral}{"{}frame \%4d "{}}, frames\_in);}
\DoxyCodeLine{1892 }
\DoxyCodeLine{1893           fprintf(stderr, \textcolor{stringliteral}{"{}\%7"{}} PRId64 \textcolor{stringliteral}{"{} \%s \%.2f \%s "{}},}
\DoxyCodeLine{1894                   cx\_time > 9999999 ? cx\_time / 1000 : cx\_time,}
\DoxyCodeLine{1895                   cx\_time > 9999999 ? \textcolor{stringliteral}{"{}ms"{}} : \textcolor{stringliteral}{"{}us"{}}, fps >= 1.0 ? fps : fps * 60,}
\DoxyCodeLine{1896                   fps >= 1.0 ? \textcolor{stringliteral}{"{}fps"{}} : \textcolor{stringliteral}{"{}fpm"{}});}
\DoxyCodeLine{1897           print\_time(\textcolor{stringliteral}{"{}ETA"{}}, estimated\_time\_left);}
\DoxyCodeLine{1898         \}}
\DoxyCodeLine{1899 }
\DoxyCodeLine{1900       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{1901         frame\_avail = 0;}
\DoxyCodeLine{1902 }
\DoxyCodeLine{1903       \textcolor{keywordflow}{if} (frames\_in > global.skip\_frames) \{}
\DoxyCodeLine{1904 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{1905         \mbox{\hyperlink{structvpx__image}{vpx\_image\_t}} *frame\_to\_encode;}
\DoxyCodeLine{1906         \textcolor{keywordflow}{if} (input\_shift || (use\_16bit\_internal \&\& input.bit\_depth == 8)) \{}
\DoxyCodeLine{1907           assert(use\_16bit\_internal);}
\DoxyCodeLine{1908           \textcolor{comment}{// Input bit depth and stream bit depth do not match, so up}}
\DoxyCodeLine{1909           \textcolor{comment}{// shift frame to stream bit depth}}
\DoxyCodeLine{1910           \textcolor{keywordflow}{if} (!allocated\_raw\_shift) \{}
\DoxyCodeLine{1911             \mbox{\hyperlink{vpx__image_8h_a0e458791d0d7ce2df6b25d141aac557f}{vpx\_img\_alloc}}(\&raw\_shift, raw.\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} | \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}},}
\DoxyCodeLine{1912                           input.width, input.height, 32);}
\DoxyCodeLine{1913             allocated\_raw\_shift = 1;}
\DoxyCodeLine{1914           \}}
\DoxyCodeLine{1915           vpx\_img\_upshift(\&raw\_shift, \&raw, input\_shift);}
\DoxyCodeLine{1916           frame\_to\_encode = \&raw\_shift;}
\DoxyCodeLine{1917         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1918           frame\_to\_encode = \&raw;}
\DoxyCodeLine{1919         \}}
\DoxyCodeLine{1920         vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{1921         \textcolor{keywordflow}{if} (use\_16bit\_internal) \{}
\DoxyCodeLine{1922           assert(frame\_to\_encode-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}});}
\DoxyCodeLine{1923           FOREACH\_STREAM(\{}
\DoxyCodeLine{1924             \textcolor{keywordflow}{if} (stream-\/>config.use\_16bit\_internal)}
\DoxyCodeLine{1925               encode\_frame(stream, \&global,}
\DoxyCodeLine{1926                            frame\_avail ? frame\_to\_encode : NULL, frames\_in);}
\DoxyCodeLine{1927             \textcolor{keywordflow}{else}}
\DoxyCodeLine{1928               assert(0);}
\DoxyCodeLine{1929           \});}
\DoxyCodeLine{1930         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1931           assert((frame\_to\_encode-\/>\mbox{\hyperlink{structvpx__image_a1d734f8afa9200a21c2d9f6bcf8c04d8}{fmt}} \& \mbox{\hyperlink{vpx__image_8h_a3bc1062c5b6a80bfa8a4ae2c8f961026}{VPX\_IMG\_FMT\_HIGHBITDEPTH}}) == 0);}
\DoxyCodeLine{1932           FOREACH\_STREAM(encode\_frame(stream, \&global,}
\DoxyCodeLine{1933                                       frame\_avail ? frame\_to\_encode : NULL,}
\DoxyCodeLine{1934                                       frames\_in));}
\DoxyCodeLine{1935         \}}
\DoxyCodeLine{1936 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1937         vpx\_usec\_timer\_start(\&timer);}
\DoxyCodeLine{1938         FOREACH\_STREAM(encode\_frame(stream, \&global, frame\_avail ? \&raw : NULL,}
\DoxyCodeLine{1939                                     frames\_in));}
\DoxyCodeLine{1940 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1941         vpx\_usec\_timer\_mark(\&timer);}
\DoxyCodeLine{1942         cx\_time += vpx\_usec\_timer\_elapsed(\&timer);}
\DoxyCodeLine{1943 }
\DoxyCodeLine{1944         FOREACH\_STREAM(update\_quantizer\_histogram(stream));}
\DoxyCodeLine{1945 }
\DoxyCodeLine{1946         got\_data = 0;}
\DoxyCodeLine{1947         FOREACH\_STREAM(get\_cx\_data(stream, \&global, \&got\_data));}
\DoxyCodeLine{1948 }
\DoxyCodeLine{1949         \textcolor{keywordflow}{if} (!got\_data \&\& input.length \&\& streams != NULL \&\&}
\DoxyCodeLine{1950             !streams-\/>frames\_out) \{}
\DoxyCodeLine{1951           lagged\_count = global.limit ? seen\_frames : ftello(input.file);}
\DoxyCodeLine{1952         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (input.length) \{}
\DoxyCodeLine{1953           int64\_t remaining;}
\DoxyCodeLine{1954           int64\_t rate;}
\DoxyCodeLine{1955 }
\DoxyCodeLine{1956           \textcolor{keywordflow}{if} (global.limit) \{}
\DoxyCodeLine{1957             \textcolor{keyword}{const} int64\_t frame\_in\_lagged = (seen\_frames -\/ lagged\_count) * 1000;}
\DoxyCodeLine{1958 }
\DoxyCodeLine{1959             rate = cx\_time ? frame\_in\_lagged * (int64\_t)1000000 / cx\_time : 0;}
\DoxyCodeLine{1960             remaining = 1000 * (global.limit -\/ global.skip\_frames -\/}
\DoxyCodeLine{1961                                 seen\_frames + lagged\_count);}
\DoxyCodeLine{1962           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1963             \textcolor{keyword}{const} int64\_t input\_pos = ftello(input.file);}
\DoxyCodeLine{1964             \textcolor{keyword}{const} int64\_t input\_pos\_lagged = input\_pos -\/ lagged\_count;}
\DoxyCodeLine{1965             \textcolor{keyword}{const} int64\_t limit = input.length;}
\DoxyCodeLine{1966 }
\DoxyCodeLine{1967             rate = cx\_time ? input\_pos\_lagged * (int64\_t)1000000 / cx\_time : 0;}
\DoxyCodeLine{1968             remaining = limit -\/ input\_pos + lagged\_count;}
\DoxyCodeLine{1969           \}}
\DoxyCodeLine{1970 }
\DoxyCodeLine{1971           average\_rate =}
\DoxyCodeLine{1972               (average\_rate <= 0) ? rate : (average\_rate * 7 + rate) / 8;}
\DoxyCodeLine{1973           estimated\_time\_left = average\_rate ? remaining / average\_rate : -\/1;}
\DoxyCodeLine{1974         \}}
\DoxyCodeLine{1975 }
\DoxyCodeLine{1976         \textcolor{keywordflow}{if} (got\_data \&\& global.test\_decode != TEST\_DECODE\_OFF)}
\DoxyCodeLine{1977           FOREACH\_STREAM(test\_decode(stream, global.test\_decode, global.codec));}
\DoxyCodeLine{1978       \}}
\DoxyCodeLine{1979 }
\DoxyCodeLine{1980       fflush(stdout);}
\DoxyCodeLine{1981       \textcolor{keywordflow}{if} (!global.quiet) fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)033[K"{}});}
\DoxyCodeLine{1982     \}}
\DoxyCodeLine{1983 }
\DoxyCodeLine{1984     \textcolor{keywordflow}{if} (stream\_cnt > 1) fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{1985 }
\DoxyCodeLine{1986     \textcolor{keywordflow}{if} (!global.quiet) \{}
\DoxyCodeLine{1987       FOREACH\_STREAM(fprintf(}
\DoxyCodeLine{1988           stderr,}
\DoxyCodeLine{1989           \textcolor{stringliteral}{"{}\(\backslash\)rPass \%d/\%d frame \%4d/\%-\/4d \%7"{}} PRId64 \textcolor{stringliteral}{"{}B \%7"{}} PRId64 \textcolor{stringliteral}{"{}b/f \%7"{}} PRId64}
\DoxyCodeLine{1990           \textcolor{stringliteral}{"{}b/s \%7"{}} PRId64 \textcolor{stringliteral}{"{} \%s (\%.2f fps)\(\backslash\)033[K\(\backslash\)n"{}},}
\DoxyCodeLine{1991           pass + 1, global.passes, frames\_in, stream-\/>frames\_out,}
\DoxyCodeLine{1992           (int64\_t)stream-\/>nbytes,}
\DoxyCodeLine{1993           seen\_frames ? (int64\_t)(stream-\/>nbytes * 8 / seen\_frames) : 0,}
\DoxyCodeLine{1994           seen\_frames}
\DoxyCodeLine{1995               ? (int64\_t)stream-\/>nbytes * 8 * (int64\_t)global.framerate.num /}
\DoxyCodeLine{1996                     global.framerate.den / seen\_frames}
\DoxyCodeLine{1997               : 0,}
\DoxyCodeLine{1998           stream-\/>cx\_time > 9999999 ? stream-\/>cx\_time / 1000 : stream-\/>cx\_time,}
\DoxyCodeLine{1999           stream-\/>cx\_time > 9999999 ? \textcolor{stringliteral}{"{}ms"{}} : \textcolor{stringliteral}{"{}us"{}},}
\DoxyCodeLine{2000           usec\_to\_fps(stream-\/>cx\_time, seen\_frames)));}
\DoxyCodeLine{2001     \}}
\DoxyCodeLine{2002 }
\DoxyCodeLine{2003     \textcolor{keywordflow}{if} (global.show\_psnr) \{}
\DoxyCodeLine{2004       \textcolor{keywordflow}{if} (global.codec-\/>fourcc == VP9\_FOURCC) \{}
\DoxyCodeLine{2005         FOREACH\_STREAM(}
\DoxyCodeLine{2006             show\_psnr(stream, (1 << stream-\/>config.cfg.g\_input\_bit\_depth) -\/ 1));}
\DoxyCodeLine{2007       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2008         FOREACH\_STREAM(show\_psnr(stream, 255.0));}
\DoxyCodeLine{2009       \}}
\DoxyCodeLine{2010     \}}
\DoxyCodeLine{2011 }
\DoxyCodeLine{2012     FOREACH\_STREAM(\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&stream-\/>encoder));}
\DoxyCodeLine{2013 }
\DoxyCodeLine{2014     \textcolor{keywordflow}{if} (global.test\_decode != TEST\_DECODE\_OFF) \{}
\DoxyCodeLine{2015       FOREACH\_STREAM(\mbox{\hyperlink{group__codec_ga6ae21d96909660d0ac978b59a863f53b}{vpx\_codec\_destroy}}(\&stream-\/>decoder));}
\DoxyCodeLine{2016     \}}
\DoxyCodeLine{2017 }
\DoxyCodeLine{2018     close\_input\_file(\&input);}
\DoxyCodeLine{2019 }
\DoxyCodeLine{2020     \textcolor{keywordflow}{if} (global.test\_decode == TEST\_DECODE\_FATAL) \{}
\DoxyCodeLine{2021       FOREACH\_STREAM(res |= stream-\/>mismatch\_seen);}
\DoxyCodeLine{2022     \}}
\DoxyCodeLine{2023     FOREACH\_STREAM(close\_output\_file(stream, global.codec-\/>fourcc));}
\DoxyCodeLine{2024 }
\DoxyCodeLine{2025     FOREACH\_STREAM(stats\_close(\&stream-\/>stats, global.passes -\/ 1));}
\DoxyCodeLine{2026 }
\DoxyCodeLine{2027     \textcolor{keywordflow}{if} (global.pass) \textcolor{keywordflow}{break};}
\DoxyCodeLine{2028   \}}
\DoxyCodeLine{2029 }
\DoxyCodeLine{2030   \textcolor{keywordflow}{if} (global.show\_q\_hist\_buckets)}
\DoxyCodeLine{2031     FOREACH\_STREAM(}
\DoxyCodeLine{2032         show\_q\_histogram(stream-\/>counts, global.show\_q\_hist\_buckets));}
\DoxyCodeLine{2033 }
\DoxyCodeLine{2034   \textcolor{keywordflow}{if} (global.show\_rate\_hist\_buckets)}
\DoxyCodeLine{2035     FOREACH\_STREAM(show\_rate\_histogram(stream-\/>rate\_hist, \&stream-\/>config.cfg,}
\DoxyCodeLine{2036                                        global.show\_rate\_hist\_buckets));}
\DoxyCodeLine{2037   FOREACH\_STREAM(destroy\_rate\_histogram(stream-\/>rate\_hist));}
\DoxyCodeLine{2038 }
\DoxyCodeLine{2039 \textcolor{preprocessor}{\#if CONFIG\_INTERNAL\_STATS}}
\DoxyCodeLine{2040   \textcolor{comment}{/* TODO(jkoleszar): This doesn't belong in this executable. Do it for now,}}
\DoxyCodeLine{2041 \textcolor{comment}{   * to match some existing utilities.}}
\DoxyCodeLine{2042 \textcolor{comment}{   */}}
\DoxyCodeLine{2043   \textcolor{keywordflow}{if} (!(global.pass == 1 \&\& global.passes == 2))}
\DoxyCodeLine{2044     FOREACH\_STREAM(\{}
\DoxyCodeLine{2045       FILE *f = fopen(\textcolor{stringliteral}{"{}opsnr.stt"{}}, \textcolor{stringliteral}{"{}a"{}});}
\DoxyCodeLine{2046       \textcolor{keywordflow}{if} (stream-\/>mismatch\_seen) \{}
\DoxyCodeLine{2047         fprintf(f, \textcolor{stringliteral}{"{}First mismatch occurred in frame \%d\(\backslash\)n"{}},}
\DoxyCodeLine{2048                 stream-\/>mismatch\_seen);}
\DoxyCodeLine{2049       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2050         fprintf(f, \textcolor{stringliteral}{"{}No mismatch detected in recon buffers\(\backslash\)n"{}});}
\DoxyCodeLine{2051       \}}
\DoxyCodeLine{2052       fclose(f);}
\DoxyCodeLine{2053     \});}
\DoxyCodeLine{2054 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2055 }
\DoxyCodeLine{2056 \textcolor{preprocessor}{\#if CONFIG\_VP9\_HIGHBITDEPTH}}
\DoxyCodeLine{2057   \textcolor{keywordflow}{if} (allocated\_raw\_shift) \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw\_shift);}
\DoxyCodeLine{2058 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{2059   \mbox{\hyperlink{vpx__image_8h_af47ebaf286812d037425d41990d48a17}{vpx\_img\_free}}(\&raw);}
\DoxyCodeLine{2060   free(argv);}
\DoxyCodeLine{2061   free(streams);}
\DoxyCodeLine{2062   \textcolor{keywordflow}{return} res ? EXIT\_FAILURE : EXIT\_SUCCESS;}
\DoxyCodeLine{2063 \}}

\end{DoxyCodeInclude}
 